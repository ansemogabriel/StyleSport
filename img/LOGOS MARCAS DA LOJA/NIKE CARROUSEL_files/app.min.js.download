"use strict";angular.module("Proj",["ngRoute","ngCookies","ngAnimate","ngMessages","ngMaterial","ngMask"]).directive("mAppLoading",["$animate",function(o){return{link:function(o,e,a){$(e).delay(100).fadeOut(400)},restrict:"C"}}]).config(["$mdThemingProvider","$routeProvider","$httpProvider","$compileProvider","$mdDateLocaleProvider",function(o,e,a,r,t){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"],e.otherwise({redirectTo:"/erro/404"}),o.definePalette("black",{50:"e0e0e0",100:"b3b3b3",200:"808080",300:"4d4d4d",400:"262626",500:"000000",600:"000000",700:"000000",800:"000000",900:"000000",A100:"a6a6a6",A200:"8c8c8c",A400:"737373",A700:"666666",contrastDefaultColor:"light",contrastDarkColors:["50","100","200","A100","A200"],contrastLightColors:["300","400","500","600","700","800","900","A400","A700"]}),o.theme("default").primaryPalette("black").accentPalette("indigo"),r.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|sms|tel|localhost|ionic):/),r.imgSrcSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|chrome-extension|localhost|ionic|blob):|data:image\//);var n=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];function i(o){return o<=9?"0"+o:o.toString()}t.months=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],t.shortMonths=n,t.days=["Domingo","Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado"],t.shortDays=["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],t.parseDate=function(o){var o=(o||"").split("/"),e=parseInt(o[0])||1,a=parseInt(o[1])||1,o=parseInt(o[2])||2e3;return new Date(o,a-1,e)},t.formatDate=function(o){var e=o.getFullYear(),a=o.getMonth()+1;return i(o.getDate())+"/"+i(a)+"/"+i(e)},t.monthHeaderFormatter=function(o){return n[o.getMonth()]+"/"+o.getFullYear()},t.msgCalendar="Calendário",t.msgOpenCalendar="Abrir calendário"}]).run(["$rootScope","$mdDialog","idOneSignal","$location","ckTagManagerService","$mdBottomSheet","AuthFactory",function(n,i,o,c,s,l,d){document.addEventListener("backbutton",function(o){angular.element(document.body).hasClass("md-dialog-is-showing")?(o.preventDefault(),n.hideDialog()):n.voltarPagina()}),document.addEventListener("deviceready",function(){window.cordova&&window.plugins&&window.plugins.OneSignal&&(window.plugins.OneSignal.setAppId(o),window.plugins.OneSignal.setNotificationOpenedHandler(function(o){var e=o.notification.additionalData.url;n.$apply(function(){c.path(e)})}),window.plugins.OneSignal.promptForPushNotificationsWithUserResponse(function(o){})),window.cordova&&window.ga.startTrackerWithId("UA-148265371-1",30,function(o){},function(o){console.error("GA START FAIL",o)})},!1),window.catalokoHistory=[],window.changePageTitle=function(o){"undefined"!=o&&null!=o&&""!=o&&(document.title=o)},window.changePageDescription=function(o){"undefined"!=o&&null!=o&&""!=o&&(document.description=o)},n.$on("$routeChangeStart",function(o,e,a){e.$$route&&(window.changePageTitle(e.$$route.title),n.tabControl=e.$$route.tabControl);window.location.pathname;window.catalokoHistory.push(e&&e.$$route?e.$$route.originalPath:"/");try{var r=""===c.path()?"home":c.path(),t=d.get();t&&t.id?s.pageViewGlobal(c.path(),r,"global","global",t.id+""):s.pageViewGlobal(c.path(),r,"global","global","")}catch(o){console.error("GTAG",o)}angular.element(document.body).hasClass("md-dialog-is-showing")&&i.hide(),0<angular.element("md-backdrop").length&&l.hide()}),n.stateIsLoading=!1,n.$on("$routeChangeStart",function(){n.stateIsLoading=!0}),n.$on("$routeChangeSuccess",function(){n.stateIsLoading=!1}),n.$on("$routeChangeError",function(){n.stateIsLoading=!1})}]).controller("CatalokoCtrl",["$scope","$rootScope","$q","$sce","$request","$window","$mdToast","$mdMedia","$mdBottomSheet","$location","$route","$mdDialog","HomeService","ApiCK","urlSharer","urlPainel","LocationBackStore","AuthFactory","mpTaxa","GeralService","ckComp","CkTouchScreen","CkViewState","CkGlobalState","CkGlobalEvents",function(n,f,i,e,o,a,r,t,c,m,s,l,d,u,p,g,h,v,w,C,b,S,P,y,k){n.currentYear=(new Date).getFullYear(),f.internacionalCodes=["+55","+1","+351","+54","+598","+81"],f.internacionalCodesV2=[{value:"+55",area:"Brasil",mask:""},{value:"+1",area:"USA",mask:""},{value:"+351",area:"Portugal",mask:""},{value:"+595",area:"Paraguai",mask:""},{value:"+44",area:"United Kingdom",mask:""},{value:"+81",area:"Japan",mask:""},{value:"+54",area:"Argentina",mask:""}],f.isDevelopment=function(){return"localhost"==window.location.hostname},f.isIOS=function(){return/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints},f.isAndroid=function(){return navigator.userAgent.match(/Android/i)},f.isXS=function(){return t("xs")},f.isDialog=function(){return angular.element(document.body).hasClass("md-dialog-is-showing")},f.buildURL=function(o){return m.$$html5?o:"#"+o},f.trustSrc=function(o){return e.trustAsResourceUrl(o)},f.voltarPagina=function(){window.history.back()},f.verLoja=function(o){m.path("/l/"+o,"_self")},n.verProduto=function(o){m.path("/produto/"+o,"_self")},n.irParaDrop=function(o){m.path("/d/"+o.id+"/"+o.query,"_self")},f.toTop=function(){window.scrollTo(0,0)},f.smoothScroll=function(o,e){var a,r,t=window.scrollY,n=t,i=e||400,c=function(){return!1},s=0,s=t<o?(r=o,c=function(o){return r<=o},1):(a=o,c=function(o){return o<=a},-1),l=Date.now();return window.requestAnimationFrame(function o(){var e;c(n)||(e=Date.now(),n+=i*((e-l)/1e3)*s,window.scroll(0,n),window.requestAnimationFrame(o))}),Ys},f.scrollToItem=function(o,e,a,r,t,n){var i,c,e=document.querySelector(e),o=document.querySelector(o);return!(!e||!o)&&(i=o.scrollLeft,c=o.scrollTop,r=r*(e.getBoundingClientRect().width+a)+t,"horizontal"===n?o.scrollTo(r,0):o.scrollTo(0,r),e=o.scrollLeft,a=o.scrollTop,i!==e||c!==a)},f.irPara=function(o){m.path(o)},f.irParaTab=function(o){var e=0===window.scrollY,a=m.path(),r="/"===a||"home"===a||"/home"===a;("/"===o||"home"===o||"/home"===o)&&r||a==o?e?r?k.pub("home_reload",{shouldReload:!0}):s.reload():window.scroll(0,0):m.path(o)},f.irParaTabSparks=function(){f.globalState.temSparkNovo&&P.clearSparks(),f.irParaTab("/sparks")},f.irParaHome=function(){f.homeNovidadesultimaPaginaVisitada=0,f.homeNovidadesultimoFiltroAplicado=0,m.path("/")},f.irParaLocalizacao=function(o){a.open(o,"_blank")},f.substituirUri=function(o){var e=s.current,a=f.$on("$locationChangeSuccess",function(){s.current=e,f.stateIsLoading=!1,a()});m.path(o),m.replace()},f.irParaURLExterna=function(o){o.indexOf("http://")<0&&o.indexOf("https://")<0&&(o="http://"+o),window.cordova?window.cordova.InAppBrowser.open(o,"_blank","hideurlbar=no,zoom=no,lefttoright=yes,toolbarposition=top"):window.open(o,"_blank")},f.irParaPagamento=function(o){var e,a=v.getToken();window.cordova?(e=p+"pagamento/"+o+"/t/"+a,e=(e+="?cordova=true")+"&token="+a,a="hideurlbar=yes,zoom=no,lefttoright=yes",f.isIOS()&&(a+=",hidespinner=true,toolbarposition=top"),window.ref=window.cordova.InAppBrowser.open(e,"_blank",a)):f.irPara("/pagamento/"+o)},f.openBrowser=function(o){window.cordova||window.open(o,"_self");var e="hideurlbar=yes,zoom=no,lefttoright=yes";f.isIOS()&&(e+=",hidespinner=true,toolbarposition=top"),window.ref=window.cordova.InAppBrowser.open(o,"_blank",e)},f.irParaBusca=function(){window.catalokoHistory.push("/buscar?hidetitle=true"),f.irPara("/buscar")},f.showToast=function(o){null!=o&&0<o.length&&" "!=o&&r.showSimple(o)},f.irParaLoginOrigemProduto=function(o){m.path("produto/"+o),f.irParaLogin()},f.obterTotalMensagensNaoLidas=function(){f.totalMensagensNaoLidas=0,v.isLoggedIn()&&o.get(u+"conversas/naolidas/v2").then(function(o){"number"==typeof o?(f.totalMensagensNaoLidas=o,f.totalMensagensNaoLidasV2=!1):(f.totalMensagensNaoLidas=0,f.totalMensagensNaoLidasV2=o.temMensagem)})},f.irParaLogin=function(){h.set(m.path()),m.path("login")},f.irParaAnunciar=function(){f.isLogado()?f.irPara("/anunciar/type/"+v.get().tipo):f.irPara("market")},f.changePageTitle=function(o){window.changePageTitle(o)},f.changePageDescription=function(o){window.changePageDescription(o)},f.verAvaliacoes=function(o,e){"1"==o?f.irPara("/"+e+"/avaliacoes"):f.irPara("l/"+e+"/avaliacoes")},f.avaliarVendedor=function(o,e){f.irPara("1"==o?"/"+e+"/avaliacoes":"l/"+e+"/avaliacoes")},f.visitarVendedor=function(o,e){"1"==o?f.irPara(e):f.verLoja(e)},f.isLogado=function(){return v.isLoggedIn()},f.getLoggedUser=function(){return v.get()},f.isLojaLogado=function(){if(v.isLoggedIn()){var o=v.get();if(o&&"2"===o.tipo)return f.lojasession=v.get(),f.lojaIsLoggedIn=!0}return!1},f.isClienteLogado=function(){if(v.isLoggedIn()){var o=v.get();if(o&&"1"===o.tipo)return f.session=v.get(),f.isLoggedIn=!0}return!1},f.sessionClienteLogout=function(){v.logout(),location.reload()},f.logoutAndExit=function(){v.logout(),f.irPara("/mais")},n.openMenu=function(o,e){o.open()},f.hideDialog=function(){l.hide()},f.hideBottomSheet=function(){c.hide()},f.recarregarPagina=function(){window.location.reload()},f.isDesktop=function(){var o=navigator.userAgent.match(/Android/i),e=navigator.userAgent.match(/iPhone|iPad|iPod/i);return!o&&!e},n.showShareLink=function(o,e,a,r,t){o=f.resolveUrlSharer(o,e);f.shareUrl=o,n.shareUrl=o,window.cordova&&window.plugins.socialsharing?window.plugins.socialsharing.share(r,null,t,o,null,function(o){},function(o){console.error("window.plugins.socialsharing",o)}):(l.show({controller:"CatalokoCtrl",templateUrl:"angular/app/home/partials/shareLink.tpl.html",parent:angular.element(document.body),scope:f,targetEvent:a,preserveScope:!0,clickOutsideToClose:!0}).then(function(){},function(){}),b.load("clipboard.js").then(function(o){window.clipboard=new ClipboardJS("#ck-btn-copy"),window.clipboard.on("success",function(o){$("#showShareStatusLink").text("Copiado").css("color","green")}),window.clipboard.on("error",function(o){$("#showShareStatusLink").text("Não foi possível copiar").css("color","red")})}))},f.showShareLink=n.showShareLink,f.showProduto=function(o,e){f.showProdutoId=e,l.show({controller:"ProdutoCtrl",templateUrl:"previewProdutoDialog.cached.html",parent:angular.element(document.body),fullscreen:!0,preserveScope:!0,clickOutsideToClose:!1,focusOnOpen:!1}).then(function(){},function(){})},f.resolveUrlSharer=function(o,e){return"loja"==e?p+"l/"+o:"produto"==e?p+"p/"+o:"news"==e||"cliente"==e?p+o:"link"==e||"telefone"==e?o:""},f.openPageApp=function(o){navigator.userAgent.match(/Android/i),navigator.userAgent.match(/iPhone|iPad|iPod/i);var e="instagram"==o?"https://www.instagram.com/droper/":"https://droper.app";"instagram"==o&&window.cordova&&(e="https://www.secure.instagram.com/droper/"),"fb"==o&&(e="https://facebook.com/droper.sneakers"),"messenger"==o&&(e="http://m.me/droper.sneakers"),"appstore"==o&&(e="https://apps.apple.com/br/app/droper/id1374613204"),"googleplay"==o&&(e="https://play.google.com/store/apps/details?id=com.s9.cataloko"),window.cordova?f.irParaURLExterna(e):window.open(e,"_blank")},f.isCordova=function(){return"undefined"!=window.cordova&&null!=window.cordova},f.replaceAll=function(o,e,a){for(o=o||"";-1!=o.indexOf(e);)o=o.replace(e,a);return o},f.replaceAllOnArray=function(o,e,a){for(var r=0;e.length>r;r++)o=f.replaceAll(o,e[r],a);return o},f.showImageSelector=function(o,e,a,r){var t=i.defer();return l.show({controller:["$scope","$rootScope",function(o,e){o.$watch("multimidia",function(o){void 0!==o&&l.hide(o)})}],clickOutsideToClose:!1,template:'<md-dialog-content aria-label="Área para alteração de imagens" layout="column" layout-align="center center"><div ck-upload-image data-ng-model="multimidia" data-maxsize="'+o+'" data-maxwidth="'+e+'" data-protegido="'+(a?"true":"false")+'" data-format="\''+r+"'\"></div></md-dialog-content>"}).then(function(o){t.resolve(o.filename)},function(o){console.error("SHOW IMG SELECTOR",o)}),t.promise},f.formErrorBinder=function(a,o){if(null==a.ckErrorsReg?a.ckErrorsReg=[]:angular.forEach(a.ckErrorsReg,function(o,e){a[o]=null}),a.singleError=null,o.status&&o.traceId&&null!=o.errors){for(var e in a.singleError=null!=o.Message?o.Message:t(o),o.errors){var r="dados"+e+"CkError";a.ckErrorsReg.push(r),a[r]=o.errors[e][0]||"Dado inválido"}null!=o.title&&(a.singleError=o.title||"Confira os erros acima")}else if(a.singleError=null!=o.Message?o.Message:t(o),null!=o.ModelError)for(var e in o.ModelError){r=o.ModelError[e].campo;a.ckErrorsReg.push(r),a[r]=o.ModelError[e].erro||"Dado inválido"}function t(o){return-1<o.toString().indexOf("{")||null!=o.ModelError?"Verifique os erros":o}},f.resolvePreviewImageUrl=function(o){return window.cordova&&null!=o&&o.indexOf("http:")<0&&o.indexOf("https:")<0&&o.indexOf("angular/img")<0?"https:"+o:o},f.resolvePrimeiroNome=function(o){var e=(o=f.replaceAllOnArray(o,["@","_","insta","inxsta"],"")).split(" ");return 0<e.length?e[0]:o},f.resolvePrimeiroNomeInibindo=function(o){o=f.resolvePrimeiroNome(o);return f.replaceAllOnArray(o,[">","ig","a","e","i","o","u","_"],"*")},f.resolveTempoPassado=function(o){var e,o=new Date(o),a=new Date;return a<o?"":1<(e=(o=(a=(a-o)/1e3/60)/60)/24)?7<=e?Math.trunc(e/7)+"w":Math.trunc(e)+"d":1<o?Math.trunc(o)+"h":1<a?Math.trunc(a)+"m":"agora"},f.resolveTaxaPercent=function(){return w},f.calcularTaxa=function(o,e){try{var a,r,t,n,i,c;return null==o||""==o?0:(a=parseFloat(o.replace(",",".")),r=w.replace("%","").replace(",","."),n=a*(t=e||parseFloat(r)/100),i=a*(1-t),(c={}).subtraido=f.formatMoney(n,2,",",""),c.recebido=f.formatMoney(i,2,",",""),c)}catch(o){return-1}},f.formatMoney=function(o,e,a,r){try{e=Math.abs(e),e=isNaN(e)?2:e;var t=o<0?"-":"",n=parseInt(o=Math.abs(Number(o)||0).toFixed(e)).toString(),i=3<n.length?n.length%3:0;return t+(i?n.substr(0,i)+r:"")+n.substr(i).replace(/(\d{3})(?=\d)/g,"$1"+r)+(e?a+Math.abs(o-n).toFixed(e).slice(2):"")}catch(o){return"0,00"}},f.roloutToEnd=function(o){$(document).ready(function(){window.scrollTo(0,document.body.scrollHeight||document.documentElement.scrollHeight)})},f.soundAlert=function(){$("#ck-chat--audio").trigger("play")},f.showVerificarPIN=function(){var e=i.defer();return l.show({controller:"PinCtrl",templateUrl:"angular/app/market/pin/partials/verificarDialog.tpl.html",parent:angular.element(document.body),focusOnOpen:!1,clickOutsideToClose:!window.cordova}).then(function(o){e.resolve(o)},function(){e.resolve(!1)}),e.promise},f.showAvisoLGPDUp=!1,f.verificarAvisoLGPD=function(){window.cordova||v.isLoggedIn()||v.aceitouPoliticas()||(t("xs")&&(f.showAvisoLGPDUp=!0),r.show({hideDelay:1e4,position:"bottom right",templateUrl:"angular/app/geral/partials/avisolgpd.tpl.html"}),f.closeToast=function(){r.hide()},f.aceitarCookies=function(){v.aceitarPoliticas()})},f.homeTabIsSelected=function(o){return o==m.path()},f.estaComprando=!0,f.verificarEstaComprando=function(){v.isLoggedIn()&&C.verificarEstaComprando().then(function(o){f.estaComprando=o.estaComprando}).catch(function(o){}).finally(function(){})},f.verificarEstaComprando(),f.vibrate=function(o){window.cordova&&navigator.vibrate&&navigator.vibrate(o)};var T=30;function E(o){try{var e,a,r=o.distancia,t=o.brilho,n=o.finalizouTouch,i=o.touchInicial||{},c=document.getElementById("ck-media-render"),s=c.getBoundingClientRect(),l=(!function(o,e,a){try{var r,t,n,i,c,s;if(!(e<0))r=document.getElementById("ck-media-render"),t=document.querySelector("html"),n=document.querySelector("body"),i=m.path(),c="/"===i,s=i.startsWith("/lapses"),0<o.left&&o.left<T&&!c&&!s&&(r.style.position="relative",r.style.top="0px",r.style.left=e+"px",t.style.overflow="hidden",n.style.overflow="hidden",r.style.filter="brightness("+a+"%)")}catch(o){return}}(i,r,t,o.event),m.path()),d="/"===l,u=l.startsWith("/lapses"),p=l.startsWith("/spark");d||u||(e=document.querySelector("body")||{},a=document.querySelector("html")||{},n?(s.left>=window.innerWidth/2&&(d||p||f.voltarPagina(),p)&&k.pub("spark",{swipeBack:!0}),c.style.top="0px",c.style.left="0px",c.style.position="",a.style.overflow="",e.style.background=null,e.style.overflow=""):f.darkModeStatus()?e.style.background="rgba(36,36,36,255)":e.style.background="rgba(245,245,247,255)")}catch(o){console.error(o)}}try{f.isCordova()&&S.listen("#ck-media-render",E,!1,"left")}catch(o){console.error(o)}f.abrirDarkMode=function(){l.show({controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/selectdarkmodedialog.tpl.html",parent:angular.element(document.body),preserveScope:!0,fullscreen:!1,clickOutsideToClose:!window.cordova}).then(function(){},function(){})},f.globalSearch=function(o){var e,a=document.getElementById("inputToolbarSearch");a&&o.termo&&(e="/buscar/"+o.termo,f.irPara(e),a.blur(),o.show=!1,o.termo="")},f.hideToolbarSearchButton=function(o){o.termo||(o.show=!1)},f.segmentos=[],f.carregandoSegmentos=!1,f.globalState={segmentos:[],carregandoSegmentos:!1,precacheSparks:{},temSparkNovo:!1,carregandoPrecacheSparks:!1,marcarSparkComoAssistido:function(){try{this.temSparkNovo=!1,y.precacheSparks.data().temNovo=!1}catch(o){}}};try{f.globalState.carregandoSegmentos=!0,y.segmentos.load().then(function(o){f.globalState.segmentos=o}).catch(function(){}).finally(function(){f.globalState.carregandoSegmentos=!1}),f.globalState.carregandoPrecacheSparks=!0,y.precacheSparks.load().then(function(o){f.globalState.precacheSparks=o.sparks,f.globalState.temSparkNovo=o.temNovo}).catch(function(){}).finally(function(){f.globalState.carregandoPrecacheSparks=!1})}catch(o){}}]).run(["$rootScope","$location","GeralService","AuthFactory","$mdToast","notificationTimeout",function(r,t,o,e,n,a){window.ckNotification={},window.ckNotification.exists=!1,window.ckNotification.totalNotificacoes=0,window.ckNotification.showedAlertData=new Date;1!=window.notificationCrono&&(e.isLoggedIn()&&i(),window.ckNotification.exists=!1,setInterval(function(){e.isLoggedIn()&&i()},a)),window.notificationCrono=!0,r.turnOffNotification=function(){window.ckNotification.totalNotificacoes=0,window.ckNotification.exists=!1},r.NOTIFICATION_ON=function(){return window.ckNotification.exists},r.getTotalNotification=function(){return window.ckNotification.totalNotificacoes};function i(){o.verifyNotifications().then(function(o){var e,a;o.verify?(window.ckNotification.exists=!0,window.ckNotification.totalNotificacoes=o.totalNotificacoes,null!=o.notificacaoAlerta&&(a=new Date(o.notificacaoAlerta.dataCriacao))>window.ckNotification.showedAlertData&&(window.ckNotification.showedAlertData=a,e=o.notificacaoAlerta,-1<(a=t.path()).indexOf("/comentario/")&&(5===e.tipo||4===e.tipo)||-1<a.indexOf("/mensagens")||(a=n.simple().textContent(e.mensagem).action("VER").highlightAction(!0).highlightClass("md-accent").hideDelay(window.cordova?3e3:5e3).position("top right"),n.show(a).then(function(o){"ok"==o&&r.irPara(e.href)})))):window.ckNotification.exists=!1}).catch(function(o){console.error("UPDATE NOTIFY ERROR>",o),window.ckNotification.exists=!1})}}]).run(["$rootScope","$location","$timeout",function(e,a,r){function t(o){r(function(){e.$apply(function(){a.path(o)})},800)}document.addEventListener("deviceready",function(){window.cordova&&window.IonicDeeplink?(window.IonicDeeplink.route({"/p/:title/:id":{target:"/p/:title/:id",parent:"/home"},"/produto/:id":{target:"/produto/:id",parent:"/home"},"/l/:route":{target:"/l/:route",parent:"/home"},"/comofunciona":{target:"/comofunciona",parent:"/home"},"/d/:id/:q":{target:"/d/:id/:q",parent:"/home"},"/n/:title/:id":{target:"/n/:title/:id",parent:"/home"}},function(o){t(o.$link.path)},function(o){t(o.$link.path)}),window.IonicDeeplink.onDeepLink(function(o){t(o.path)})):console.warn("ionic deep link não está pronto",window.IonicDeeplink)},!1)}]).directive("scrollHorizontal",["$rootScope",function(o){return function(o,e,a){var r=navigator.userAgent.match(/Android/i),t=navigator.userAgent.match(/iPhone|iPad|iPod/i);r||t||$(e).mousewheel(function(o,e){$(this).scrollLeft(this.scrollLeft+40*-e),o.preventDefault()})}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/market",{controller:"MarketCtrl",templateUrl:"angular/app/market/partials/view.tpl.html",tabControl:"Market",title:"Market"}).when("/market/anuncios",{controller:"MarketCtrl",templateUrl:"angular/app/market/partials/view.tpl.html",tabControl:"Market",title:"Market"}).when("/market/pin/update",{controller:"PinCtrl",templateUrl:"angular/app/market/pin/partials/pincreate.tpl.html",tabControl:"Market",title:"Atualização do PIN "}).when("/market/email/confirm/:token",{controller:"MarketCtrl",templateUrl:"angular/app/market/partials/confirmacaoemail2.tpl.html",tabControl:"Market",title:"Confirmação de e-mail"}).when("/market/pin/reset",{controller:"PinCtrl",templateUrl:"angular/app/market/pin/partials/pinreset.tpl.html",tabControl:"Market",title:"PIN"})}]).controller("MarketCtrl",["$scope","$rootScope","$mdMedia","$mdDialog","$routeParams","AuthFactory","MarketService",function(e,o,a,r,t,n,i){e.mdMedia=a,e.redirect=function(){n.isLoggedIn()&&("2"===n.get().tipo?o.irPara("market/loja/inicio"):o.irPara("market/cliente/inicio"))},e.verificarEmail=function(){e.verificandoEmail=!0,i.verificarEmail(t.token).then(function(o){e.erroVerificacaoEmail=!1}).catch(function(o){e.erroVerificacaoEmail=!0}).finally(function(){e.verificandoEmail=!1})}}]).controller("PinCtrl",["$scope","$q","$rootScope","$mdMedia","$mdDialog","AuthFactory","MarketService","$timeout",function(a,o,e,r,t,n,i,c){a.mdMedia=r,a.preCondicoes=function(){n.isLoggedIn()||alert("Você não está logado")},a.pinReady=!1,a.focused=null,a.salvando=!1,a.data={},l();var s=/^\d$/;function l(){a.data.one=null,a.data.two=null,a.data.tree=null,a.data.four=null,$("#pin1").focus()}a.showAtualizarPin=function(){i.verificarUsuarioTemPin(n.get().id).then(function(o){o.existe?e.showVerificarPIN().then(function(o){null!=o?t.show({controller:"PinCtrl",preserveScope:!0,scope:a,templateUrl:"angular/app/market/pin/partials/editDialog.tpl.html",parent:angular.element(document.body),focusOnOpen:!1,clickOutsideToClose:!window.cordova}):(a.erro=!0,a.sucessoPin=!1)}).catch(function(){a.erro=!0,a.sucessoPin=!1}):t.show({controller:"PinCtrl",preserveScope:!0,scope:a,templateUrl:"angular/app/market/pin/partials/editDialog.tpl.html",parent:angular.element(document.body),focusOnOpen:!1,clickOutsideToClose:!window.cordova})})},a.pinStart=function(){a.pinInput1=$("#pin1"),a.pinInput2=$("#pin2"),a.pinInput3=$("#pin3"),a.pinInput4=$("#pin4"),a.pinInput1.focus()},a.controlePreDigito=function(o){var e=parseInt(o.target.value);0<=e&&e<=9&&o.preventDefault()},a.controlePinForm=function(o){var e;if(13==o.originalEvent.keyCode&&(e=document.getElementById("formsubmit"),c(function(){angular.element(e).triggerHandler("click")},0)),null!=o&&8==o.originalEvent.keyCode){if("pin1"==a.focused)return o.preventDefault(),void(a.data.one=null);if("pin2"==a.focused)return o.preventDefault(),a.pinInput1.focus(),a.focused=document.activeElement.attributes.id.value,a.verificarPinPronto(),void(a.data.two=null);if("pin3"==a.focused)return o.preventDefault(),a.pinInput2.focus(),a.focused=document.activeElement.attributes.id.value,a.verificarPinPronto(),void(a.data.tree=null);if("pin4"==a.focused)return o.preventDefault(),a.pinInput3.focus(),a.focused=document.activeElement.attributes.id.value,a.verificarPinPronto(),void(a.data.four=null)}else null!=a.data.one&&null==a.data.two?(a.data.two=null,a.data.tree=null,a.data.four=null,a.pinInput2.focus()):null!=a.data.one&&null!=a.data.two&&null==a.data.tree?(a.data.tree=null,a.data.four=null,a.pinInput3.focus()):null!=a.data.one&&null!=a.data.two&&null!=a.data.tree&&null==a.data.four&&a.pinInput4.focus(),a.focused=document.activeElement.attributes.id.value;a.verificarPinPronto()},a.verificarPinPronto=function(){null!=a.data.one&&null!=a.data.one&&null!=a.data.two&&null!=a.data.two&&null!=a.data.tree&&null!=a.data.tree&&null!=a.data.four&&null!=a.data.four?(a.pin=a.data.one.toString()+a.data.two.toString()+a.data.tree.toString()+a.data.four.toString(),a.mensagem=null,a.pinReady=!0):(a.pinReady=!1,a.pin=null)},a.salvar=function(o){s.test(o)?(a.data.one="",a.data.two="",a.data.tree="",a.data.four="",a.mensagem="Digite somente números",a.pinInput1.focus()):(a.salvando=!0,i.salvarPin(n.get().id,o).then(function(o){e.hideDialog(),e.showToast("PIN atualizado com sucesso"),a.sucessoPin=!0,a.erro=!1}).catch(function(o){a.mensagem=o,a.erro=!0,a.salvando=!1,a.sucessoPin=!1}))},a.resultadoVerificacao=null,a.verificando=!1,a.verificar=function(o){a.verificando=!0,i.verificarPinv2(n.get().id,o).then(function(o){null!=o?t.hide(o):(l(),a.mensagem="PIN inválido",a.verificando=!1)}).catch(function(o){a.mensagem=o||"Erro ao verificar seu PIN",a.verificando=!1})},a.resetPinEnviado=!1,a.enviarResetPin=function(){a.enviandoReset=!0,n.isLoggedIn()||(alert("Você não está logado"),e.irPara("/mais")),i.resetarPin(n.get().id).then(function(o){a.sucessoPinReset=!0,a.erro=!1,e.showToast(o)}).catch(function(o){a.erro=!0,a.sucessoPinReset=!1,e.showToast(o)}).finally(function(){a.resetPinEnviado=!0,a.enviandoReset=!1})},a.iniciarCSU=void a.preCondicoes()}]).controller("MarketRelatorioCtrl",["$scope","$rootScope","$mdDialog","$mdMedia","MarketService","ckComp",function(a,o,e,r,t,n){a.$mdMedia=r,a.periodos=[{periodo:"ultimasemana",desc:"Últimos 7 dias"},{periodo:"ultimaquinzena",desc:"Últimos 15 dias"}],a.periodoSelecionado="ultimasemana",a.carregarRelatorioVendasComparadas=function(){a.carregando=!0,t.obterRelatorioVendasComparadas(a.periodoSelecionado).then(function(o){0<o.relatorio.periodoAnterior.length&&0<o.relatorio.periodoAtual.length?(o=o.relatorio,a.dtPeriodoAtual={data:o.periodoAtual.map(function(o){return o.dia+"/"+o.mes}),qtd:o.periodoAtual.map(function(o){return o.qtde})},a.dtPeriodoAnterior={data:o.periodoAnterior.map(function(o){return o.dia+"/"+o.mes}),qtd:o.periodoAnterior.map(function(o){return o.qtde})},a.criarGraficoVendasComparadas(),a.showGrafico=!0,a.erroGrafico=!1,a.showMsgGraficoVazio=!1):a.showMsgGraficoVazio=!0}).catch(function(o){console.log(o),a.showGrafico=!1,a.erroGrafico=!0}).finally(function(){a.carregando=!1})},a.criarGraficoVendasComparadas=function(){try{var o=document.getElementById("chartVendas");a.graficoVendasComp&&a.graficoVendasComp.destroy(),a.graficoVendasComp=new Chart(o,{type:"line",data:{labels:a.dtPeriodoAtual.data,datasets:[{label:"# Perído Atual",data:a.dtPeriodoAtual.qtd,borderWidth:1,backgroundColor:["rgba(0, 102, 204, 0.4)"],borderColor:["rgba(0, 102, 204, 1)"]},{label:"# Período Anterior",data:a.dtPeriodoAnterior.qtd,borderWidth:1,backgroundColor:["rgba(255, 102, 102, 0.4)"],borderColor:["rgba(255, 102, 102, 1)"],borderDash:[10,10]}]},options:{plugins:{tooltip:{mode:"index",intersect:!1,callbacks:{title:function(o,e){return a.dtPeriodoAtual.data[o[0].dataIndex]+" - "+a.dtPeriodoAnterior.data[o[0].dataIndex]}}}},scales:{y:{beginAtZero:!0},x:{ticks:{callback:function(o){return this.getLabelForValue(o)}}},xAxis2:{type:"category",grid:{drawOnChartArea:!1},ticks:{callback:function(o,e){return a.dtPeriodoAnterior.data[e]}}}},responsive:!0}})}catch(o){a.showGrafico=!1}},a.closeDialog=function(){e&&e.cancel&&e.cancel()},n.load("chart.js").then(function(o){a.carregarRelatorioVendasComparadas()})}]).controller("MarketTaxasDialogCtrl",["$scope","$rootScope","$mdDialog","$mdMedia","MarketService",function(e,o,a,r,t){e.dadosTaxa=[],e.taxaAtual={},e.qtdVendas=0,e.erroTaxas=!1,e.closeDialog=function(){a&&a.cancel&&a.cancel()},e.carregandoTaxas=!0,t.obterTaxaDetalhada().then(function(o){console.log("taxas",o),e.dadosTaxa=o.taxas,e.qtdVendas=o.qtdVendas,e.taxaAtual=o.taxas.find(function(o){return!0===o.isTaxaUsuario}),e.erroTaxas=!1}).catch(function(o){console.log(o),e.erroTaxas=!0}).finally(function(){e.carregandoTaxas=!1})}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/buscar",{controller:"BuscarCtrl",templateUrl:"angular/app/buscar/partials/buscar.tpl.html",tabControl:"Busca",title:"Buscar"}).when("/buscar/:termourl",{controller:"BuscarCtrl",templateUrl:"angular/app/buscar/partials/buscar.tpl.html",tabControl:"Busca",title:"Buscar"}).when("/buscar/t/:tag",{controller:"BuscarCtrl",templateUrl:"angular/app/buscar/partials/buscar.tpl.html",tabControl:"Busca",title:"Buscar"}).when("/t/:tag",{controller:["$routeParams",function(o){o=o.tag;window.location.replace("/buscar/t/"+o)}],template:"<div></div>",tabControl:"Busca",title:"Buscar"}).when("/marca/:marca",{controller:"BuscarCtrl",templateUrl:"angular/app/buscar/partials/buscar.tpl.html",tabControl:"Busca",title:"Marca"}).when("/marca/:marca/modelo/:modelo",{controller:"BuscarCtrl",templateUrl:"angular/app/buscar/partials/buscar.tpl.html",tabControl:"Busca",title:"Modelo"}).when("/buscaloja",{controller:"BuscarCtrl",templateUrl:"angular/app/buscar/partials/buscar.tpl.html",tabControl:"Busca",title:"Buscar"})}]).directive("autofocus",["$timeout",function(a){return{restrict:"A",link:function(o,e){a(function(){e[0].focus()})}}}]).controller("BuscarCtrl",["$scope","$window","$timeout","$rootScope","$routeParams","$route","$location","$mdMedia","$mdDialog","BuscarService","UserStore","DropService","LocationBackStore","CkViewState","ckTagManagerService",function(i,o,a,c,r,e,s,t,n,l,d,u,p,f,m){(i.$mdMedia=t)("sm");i.feedbackBusca=1,i.listadrops=[],i.dropPage=0,i.dropAmount=40,i.temMaisDrops=!1,i.listaTermos=[],i.tag=null,i.marca=null,i.modelo=null,i.dadosMarca=null,i.dadosModelo=null,i.showSeletorSneakersOuOutros=!0,i.tiposProduto=[],i.tiposParaExibir=[],i.showTitle=!0;var g,h=s.path();function v(o){o=o||{};i.banner.nome=o.nome,i.banner.subtitulo=null,i.banner.subtituloLink=null,i.banner.descricao=o.descricao,i.banner.wallpaper=o.wallpaper,i.banner.wallpaperMobile=o.wallpaperMobile}function w(o,e){o=o||{},e=e||{};i.banner.nome=o.nome,i.banner.subtitulo=e.nome,i.banner.subtituloLink="/marca/"+e.url,i.banner.descricao=o.descricao,i.banner.wallpaper=o.wallpaperDesktop,i.banner.wallpaperMobile=o.wallpaperMobile}function C(){var o,e,a=i.dadosMarca;a&&a.tiposProduto&&a.tiposProduto.length?(o=(a=a.tiposProduto).filter(function(o){return 1!==o.id}),a=a.length!==o.length,e=!!o.length,i.showSeletorSneakersOuOutros=a&&e,i.tiposParaExibir=o,a?i.filtrarSneakers():(i.filtrarOutros(),i.selecionarTipo(o[0]))):(i.showSeletorSneakersOuOutros=!0,i.tiposParaExibir=i.outrosTipos.map(function(o){return o.id}))}function b(o){function e(o){return o?1:0}function a(o){return o&&o.length||0}return e(o.tipoProduto)+a(o.tamanhos)+a(o.cores)+e(o.precoAte)+e(o.condicao)}function S(o){var e=[];if(!o)return[];for(var a=0;a<o.length;a++)e.push(o[a]);return e}!c.isDesktop()&&2<=window.catalokoHistory.length&&(t=window.catalokoHistory[window.catalokoHistory.length-2],i.showTitle=null==t||"/"!=t),i.voltar=function(){c.voltarPagina()},i.$on("$destroy",function(){var o={scope:i,scroll:{x:window.scrollX,y:window.scrollY},path:h};f.busca(o)}),i.buscarDropV3=function(e){i.isFiltrando||(g&&a.cancel(g),g=a(function(){g=null,i.carregandoDrops=!0,u.pesquisar(e).then(function(o){o.length>i.listadrops.length&&(i.listadrops=o,i.moreDropsV3=i._moreDropsV3({termo:e}))}).catch(function(o){}).finally(function(){i.carregandoDrops=!1})},600))},i._moreDropsV3=function(o){return function(){i.carregarMaisDrops(o)}},i.moreDropsV3=i._moreDropsV3(),i.carregarMaisDrops=function(o){i.dropPage++,i.carregandoMaisDrops=!0,l.searchV3DropPagination(o||i.filtroAplicado,i.dropPage).then(function(o){i.listadrops=i.listadrops.concat(o.drops),i.temMaisDrops=o.temMaisDrops,i.exibindoFiltros=!1,i.aplicandoFiltros=!1}).catch(function(o){}).finally(function(){i.carregandoMaisDrops=!1})},i.scrollTamanhosIniciado=!1,i.scrollTamanhosIndex=null,i.indexTamanhoRelevante=function(o,e){var a=i.scrollTamanhosIndex&&i.scrollTamanhosIndex<e,r=i.filtros&&i.filtros.tamanhos&&i.filtros.tamanhos.length;return a||(r?i.isTamanhoSelecionado(o)&&(i.scrollTamanhosIndex=e):"36"===o.titulo&&(i.scrollTamanhosIndex=e)),i.scrollTamanhosIndex},i.initScrollTamanhos=function(){i.scrollTamanhosIniciado=!1,i.scrollTamanhosIndex=null},i.scrollAteTamanho=function(o){!i.scrollTamanhosIniciado&&1&&(i.scrollTamanhosIniciado=c.scrollToItem(".scroll-tamanhos",".scroll-tamanhos--btn-relevant",6,o,-25,"horizontal"))},i.filtrosConfig=null,i.carregandoFiltros=!1,i.carregandoSugestoes=!1,i.carregandoMarca=!1,i.aplicandoFiltros=!1,i.filtrandoSneakers=!0,i.filtrandoOutros=!1,i.exibindoFiltros=!1,i.tipoSneakers={tamanhos:[]},i.outrosTipos=[],i.maxPrecoAte=5e3,i.sugestoes={},i.filtros={marca:null,termo:null,tipoProduto:null,tamanhos:[],cores:[],precoAte:null,condicao:null,ordenacao:null,page:null,amount:null,tag:null},i.banner={nome:"",subtitulo:"",subtituloLink:"",descricao:"",wallpaper:"",wallpaperMobile:""},i.filtroAplicado=angular.copy(i.filtros),i.page=0,i.amount=40,i.isFiltrando=!1,i.colorpicker={canvas:null,ctx:null},i.carregarBusca=function(){var o,e;(o=f.busca())&&o.changed&&o.path===h&&(f.restoreScope(o.scope,i),window.setTimeout(function(){window.scroll(o.scroll.x||0,o.scroll.y||0)},300),1)?i.dadosMarca:(i.hideTitle=!1,2<window.catalokoHistory.length&&(e=window.catalokoHistory.length,i.hideTitle="/buscar?hidetitle=true"==window.catalokoHistory[e-2]),i.feedbackBusca=1,i.limparFiltrosV3(),i.carregarSugestoes(),i.carregarFiltrosV3(),i.buscasRecentes=d.getBuscaRecente(),i.termo=r.termourl||null,i.filtros.modelo=r.modelo||null,i.filtros.tag=r.tag||null,i.filtros.marca=r.marca||null,!!i.filtros.modelo?(i.hideTitle=!0,i.carregandoMarca=!0,i.feedbackBusca=3,l.getMarcaEModelo(i.filtros.marca,i.filtros.modelo).then(function(o){i.dadosMarca=o.marca,i.dadosModelo=o.modelo,i.termo=o.modelo.nome,c.changePageTitle(i.dadosMarca.nome),i.searchV3({marca:i.filtros.marca,tag:i.filtros.tag,termo:i.termo,modelo:i.filtros.modelo}),w(o.modelo,o.marca),l.contabilizarClickMarcaEModelo(i.filtros.marca,i.filtros.modelo).then(function(){}).catch(function(){})}).catch(function(){i.hideTitle=!1,i.feedbackBusca=4}).finally(function(){i.carregandoMarca=!1})):(i.filtros.marca&&(i.hideTitle=!0,i.carregandoMarca=!0,l.getMarca(i.filtros.marca).then(function(o){i.dadosMarca=o,c.changePageTitle(i.dadosMarca.nome),v(o)}).catch(function(){i.hideTitle=!1}).finally(function(){i.carregandoMarca=!1})),(i.filtros.marca||i.termo||i.filtros.tag||i.filtros.modelo)&&i.searchV3({marca:i.filtros.marca,tag:i.filtros.tag,termo:i.termo,modelo:i.filtros.modelo})))},i.buscarPorTermoPesquisa=function(o){var e=i.filtros||{},a=i.dadosMarca||{},r=a.nome||"",a=a.url||e.marca,e=(i.termo=r+" "+o.nome,{marca:a,tag:i.filtros.tag,termo:i.termo});i.searchV3(e,!0,!0),i.contabilizarClickTermoPesquisa(o)},i.contabilizarClickTermoPesquisa=function(o){l.contabilizarClickTermoPesquisa(o.id)},i.searchV3=function(o,r,e){var t=i.termo;try{m.searchInteraction(t)}catch(o){}i.feedbackBusca=3,i.listadrops=[],i.dropPage=0;var n=i.isFiltrando?i.filtroAplicado:{};(n=o||n).termo=t,n.page=i.page,n.amount=i.amount,l.searchV3(n).then(function(o){i.produtos=o.produtos,i.totalProdutos=o.totalProdutos,i.listadrops=o.drops,i.temMaisDrops=o.temMaisDrops;var e=!!i.dadosMarca;o.marca&&e&&(i.dadosMarca.id,o.marca.id);if(i.dadosMarca=o.marca,C(),o.marca?(o.marca.titulo&&c.changePageTitle(o.marca.titulo),v(o.marca),i.listaTermos=i.dadosMarca.termosPesquisa):i.listaTermos=[],o.modelo&&w(o.modelo,o.marca),o.banner&&(e=(e=o.banner)||{},i.banner.nome=e.nome,i.banner.subtitulo=e.subtitulo,i.banner.subtituloLink=e.subtituloLink,i.banner.descricao=e.descricao,i.banner.wallpaper=e.wallpaper,i.banner.wallpaperMobile=e.wallpaperMobile),0==o.totalProdutos?i.feedbackBusca=4:i.feedbackBusca=2,i.filtroAplicado=angular.copy(n),i.moreDropsV3=i._moreDropsV3(),i.exibindoFiltros=!1,i.aplicandoFiltros=!1,r)try{var a=document.querySelector("form[name=buscar-mobile]");a&&a.scrollIntoView()}catch(o){}else c.toTop();null!=t&&" "!=t&&"  "!=t&&d.setBuscaRecente(t);e=c.getLoggedUser();try{e&&e.id?m.searchResult(s.path(),"pagina de busca","Drops","Drops",e.id):m.searchResult(s.path(),"pagina de busca","Drops","Drops","")}catch(o){}}).catch(function(o){i.feedbackBusca=4,i.mensagemNotFound=o}).finally(function(){i.aplicandoFiltros=!1}),$("#busca-mobile").blur()},i._moreV3=function(e){return function(){var o=e||i.filtroAplicado;i.carregandoMais=!0,o.page+=1,l.searchV3(o).then(function(o){var e=i.produtos||[];i.produtos=e.concat(o.produtos),0==i.produtos.length&&(i.feedbackBusca=4)}).catch(function(o){alert("Ops! Algo deu errado")}).finally(function(){i.carregandoMais=!1})}},i.moreV3=i._moreV3(),i.filterV3=function(){i.isFiltrando=!0,i.produtos=[],i.page=0,i.aplicandoFiltros=!0,i.filtroAplicado=i.construirFiltrosV3(),i.searchV3()},i.buscarOnEnterV3=function(){i.searchV3(),c.substituirUri("buscar/"+i.termo),h=s.path()},i.carregarSugestoes=function(){i.carregandoSugestoes=!0,l.obterSugestoes().then(function(o){i.sugestoes=o}).catch(function(o){}).finally(function(){})},i.carregarFiltrosV3=function(){i.carregandoFiltros=!0,l.getFiltersV3().then(function(o){i.filtrosConfig=o.filtros,i.tiposProduto=o.filtros.tipos,i.tipoSneakers=function(o,e){for(var a=(e||{}).tipos||[],r=0;r<a.length;r++){var t=a[r];if(t.id===o)return t}return null}(1,i.filtrosConfig),i.outrosTipos=function(o,e){for(var a=(e||{}).tipos||[],r=[],t=0;t<a.length;t++){var n=a[t];n.id!==o&&r.push(n)}return r}(1,i.filtrosConfig),i.filtros.tipoProduto=i.tipoSneakers,C()}).catch(function(o){console.error("FILTER_CONFIG",o)}).finally(function(){i.carregandoFiltros=!1})},i.deveExibirTipo=function(e){return(i.tiposParaExibir||[]).some(function(o){return o===e.id})},i.limparTermo=function(){i.termo="",i.limparFiltrosV3(!0)},i.limparDados=function(){i.produtos=[],i.totalProdutos=0,i.listadrops=[],i.temMaisDrops=!1,i.page=0},i.limparFiltrosV3=function(o){i.filtros={termo:null,tipoProduto:i.tipoSneakers,tamanhos:[],cores:[],precoAte:null,condicao:null,ordenacao:null,page:null,amount:null,marca:r.marca||null,tag:r.tag||null},i.dropPage=0,i.filtrarSneakers(),o&&(i.limparDados(),i.isFiltrando=!1,i.exibindoFiltros=!1,i.feedbackBusca=1,c.toTop(),i.termo)&&i.searchV3()},i.exibirFiltros=function(){i.exibindoFiltros=!i.exibindoFiltros},i.construirFiltrosV3=function(){return{marca:i.filtros.marca,termo:i.termo,tipoProduto:i.filtros.tipoProduto.id,tamanhos:S(i.filtros.tamanhos),cores:S(i.filtros.cores),precoAte:i.filtros.precoAte,condicao:i.filtros.condicao,ordenacao:i.filtros.ordenacao,page:i.filtros.page,amount:i.filtros.amount,tag:i.filtros.tag}},i.filtrarSneakers=function(){i.filtrandoSneakers=!0,i.filtrandoOutros=!1,i.filtros.tipoProduto=i.tipoSneakers},i.filtrarOutros=function(){i.filtrandoSneakers=!1,i.filtrandoOutros=!0,i.filtros.tipoProduto=null,i.filtros.cores=[]},i.selecionarTipo=function(o){i.filtros.tipoProduto=o,i.filtros.tamanhos=[]},i.selecionarTamanho=function(o){i.isTamanhoSelecionado(o)?i.removerTamanho(o):(i.filtros.tamanhos=i.filtros.tamanhos||[],i.filtros.tamanhos.push(o.titulo))},i.removerTamanho=function(e){var o=i.filtros.tamanhos||[];i.filtros.tamanhos=o.filter(function(o){return o!==e.titulo})},i.isTamanhoSelecionado=function(e){return(i.filtros.tamanhos||[]).some(function(o){return o===e.titulo})},i.selecionarCor=function(o){i.isCorSelecionada(o)?i.removerCor(o):(i.filtros.cores=i.filtros.cores||[],i.filtros.cores.push(o.hex))},i.selecionarOrdenacao=function(o){i.filtros.ordenacao===o?i.filtros.ordenacao=null:i.filtros.ordenacao=o},i.removerCor=function(e){var o=i.filtros.cores||[];i.filtros.cores=o.filter(function(o){return o!==e.hex})},i.isCorSelecionada=function(e){return(i.filtros.cores||[]).some(function(o){return o===e.hex})},i.corDestaque=function(o){if(o)try{var e=o.hex||o,a=RGBA(e);return 20<=luma(a.r,a.g,a.b)?"rgba(0, 0, 0, .3)":"#fefefe44"}catch(o){console.error(o)}return"#000"},i.selecionarCondicao=function(o){o="novo"===o?"novo":"usado"===o?"usado":null;o===i.filtros.condicao?i.filtros.condicao=null:i.filtros.condicao=o},i.voltarParaFiltros=function(){c.toTop(),i.exibindoFiltros=!0},i.qtdeFiltros=function(){return b(i.filtros)},i.qtdeFiltrosAplicados=function(){return b(i.filtroAplicado)},i.ajustarLayoutSelectFiltros=function(){function o(){var o=(o=document.querySelector(".filtros-bar--space").getBoundingClientRect()).bottom-o.height;e.style.bottom="calc(100vh - "+o+"px)",e.style.top="initial",e.style.left="calc(100vw/2 - 0/2)"}var e=document.querySelector(".select-ordenar-container");o(),window.ResizeObserver&&new ResizeObserver(o).observe(e)},i.uppercase=function(o){return(o||"").toUpperCase()}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/entrar",{controller:"ClienteCtrl",templateUrl:"angular/app/cliente/partials/entrar.tpl.html",tabControl:"Mais",title:"Entrar com e-mail"}).when("/from/ig/p/:idproduto/entrar",{controller:"ClienteCtrl",templateUrl:"angular/app/cliente/partials/entrar.tpl.html",tabControl:"Mais",title:"Entrar com e-mail"}).when("/cadastrar",{controller:"ClienteCtrl",templateUrl:"angular/app/cliente/partials/cadastro.tpl.html",tabControl:"Mais",title:"Cadastrar com e-mail"}).when("/lojasseguidas",{controller:"ClienteCtrl",templateUrl:"angular/app/cliente/partials/lojasseguidas.tpl.html",tabControl:"Mais",title:"Lojas Seguidas"}).when("/favoritos",{controller:"ClienteCtrl",templateUrl:"angular/app/cliente/partials/produtosfavoritos.tpl.html",tabControl:"Mais",title:"Favoritos"}).when("/login/continue/:continue",{controller:"ClienteCtrl",templateUrl:"angular/app/cliente/partials/login.tpl.html",tabControl:"Mais",title:"Entrando no Droper"}).when("/login",{controller:"ClienteCtrl",templateUrl:"angular/app/cliente/partials/login.tpl.html",tabControl:"Mais",title:"Entrar no Droper"}).when("/from/ig/p/:idproduto/login",{controller:"ClienteCtrl",templateUrl:"angular/app/cliente/partials/login.tpl.html",tabControl:"Mais",title:"Entrar no Droper"}).when("/login/google",{controller:"ClienteCtrl",templateUrl:"angular/app/cliente/partials/login.tpl.html",tabControl:"Mais",title:"Entrar no Droper"}).when("/login/:keypass",{controller:"ClienteCtrl",templateUrl:"angular/app/cliente/partials/keypass.tpl.html",tabControl:"Mais",title:"Entrando no Droper"}).when("/cliente/editar",{controller:"CadastroClienteCtrl",templateUrl:"angular/app/cliente/partials/editar.tpl.html",tabControl:"Mais",title:"Editar dados"}).when("/cliente/editarsenha",{controller:"ClienteMudarSenhaCtrl",templateUrl:"angular/app/cliente/partials/editarSenha.tpl.html",tabControl:"Market",title:"Editar senha"})}]).controller("ClienteCtrl",["$scope","$rootScope","$location","$routeParams","$mdDialog","$mdMedia","ClienteService","FacebookService","GoogleService","LocationBackStore","AuthFactory","DeviceService","AppleSignService","$timeout",function(a,r,e,t,o,n,i,c,s,l,d,u,p,f){function m(){return e.absUrl().includes("/from/ig/p/")}function g(){var o;m()?(o=t.idproduto,e.path("/produto/"+o)):(o=l.get(),e.path("/login"==o||null==o?"/mais":o))}a.aceitaTermosEPoliticas=!1,a.tipoLogin=0,a.dadosDevice={},a.carregandoDevice=!1,a.isIg=u.isIG(),a.idProduto=null,a.obterDadosDevice=function(){a.carregandoDevice=!0,u.getDevice().then(function(o){a.dadosDevice=o}).finally(function(){a.carregandoDevice=!1})},a.verPerfil=function(){o.show({controller:"ClienteCtrl",templateUrl:"angular/app/cliente/partials/perfilDialog.tpl.html",parent:angular.element(document.body),scope:a,preserveScope:!0,clickOutsideToClose:!window.cordova})},a.USER_Auth=function(e){i.checkToken(e,a.dadosDevice).then(function(o){o.token=e,d.login(o),r.isClienteLogado(),i.updateOneSignal(e),g(),r.showToast("Você está logado como "+o.nome),r.verificarEstaComprando()}).catch(function(){window.history.back(),r.showToast("Ops, algo de errado aconteceu!")})},a.loginComum=function(o){o.device=a.dadosDevice,a.carregandoLogin=!0,a.loginError="",i.authEmail(o).then(function(o){o.token=o.keypass,d.login(o),r.isClienteLogado(),i.updateOneSignal(o.token),g(),"1"==o.tipo?r.showToast("Você está logado como "+o.nome):r.showToast("Você logou com uma conta PRO!"),r.verificarEstaComprando()}).catch(function(o){a.loginError="Email ou senha estão incorretos. Tente recuperar sua senha!"}).finally(function(){a.carregandoLogin=!1})},a.facebookLogin=function(){a.verificando=!0,a.erro=!1,c.login().then(function(o){a.validationFacebookAccessToken(o.authResponse.accessToken)}).catch(function(o){r.showToast(o),a.verificando=!1,a.erro=!0})},a.validationFacebookAccessToken=function(o){i.convertFbAt(o).then(function(o){a.USER_Auth(o.keypass)}).catch(function(o){r.showToast(o),a.verificando=!1,a.erro=!0})},a.googleLogin=function(){a.verificando=!0,a.erro=!1,s.login().then(function(o){a.postGoogleUser(o)}).catch(function(o){a.erro=!0,a.verificando=!1})},a.postGoogleUser=function(o){a.verificando=!0,i.postGoogleUser(o).then(function(o){a.USER_Auth(o.keypass)}).catch(function(o){r.showToast(o),a.verificando=!1,a.erro=!0})},a.appleLogin=function(){a.verificando=!0,a.erro=!1,p.login().then(function(o){i.postAppleUser(o).then(function(o){a.USER_Auth(o.keypass)}).catch(function(o){r.showToast(o),a.verificando=!1,a.erro=!0})}).catch(function(){a.erro=!0,a.verificando=!1})},a.entrarEmail=function(){var o;m()?(o=t.idproduto,r.irPara("/from/ig/p/"+o+"/entrar")):r.irPara("/entrar")},a.show=!1,a.setDelay=function(){a.show=!1,f(function(){a.show=!0},1e4)},a.verificarTelefone=function(){d.isLoggedIn()?i.verificarTelefone(d.get().id).then(function(o){o.ok||(a.showEditarTelefone=!0)}):a.showEditarTelefone=!1},a.editarTelefone=function(o){a.salvandoTelefone=!0;var e=d.get().id;i.editarTelefone(e,o).then(function(o){r.showToast(o),a.showEditarTelefone=!1,a.salvandoTelefone=!1}).catch(function(o){r.showToast(o||"Ops, algo de errado aconteceu"),a.showEditarTelefone=!1,a.salvandoTelefone=!1})},a.toggleProdutoFavorito=function(o){a.carregandoProdutoFavorito=!0,d.isLoggedIn()&&"1"==d.get().tipo?(a.produtoFavoritado?i.desfavoritarProduto(d.getToken(),o).then(function(o){a.produtoFavoritado=!1}).catch(function(o){}):i.favoritarProduto(d.getToken(),o).then(function(o){a.produtoFavoritado=!0}).catch(function(o){})).finally(function(){a.carregandoProdutoFavorito=!1}):(r.hideDialog(),r.showToast("Entre com seu Facebook para favoritar o produto"),r.irParaLogin())},a.carregarProdutoFavorito=function(o){a.carregandoProdutoFavorito=!0,a.produtoFavoritado=!1,d.isLoggedIn()&&"1"==d.get().tipo?i.obterProdutoFavorito(d.getToken(),o).then(function(o){a.produtoFavoritado=o}).catch(function(o){}).finally(function(){a.carregandoProdutoFavorito=!1}):a.carregandoProdutoFavorito=!1},a.removerProdutoFavorito=function(o,e){i.desfavoritarProduto(d.getToken(),o).then(function(o){a.dados.produtos.splice(e,1),r.showToast(o)}).catch(function(o){r.showToast("Ops! Algo de errado aconteceu")}).finally(function(){a.carregandoProdutoFavorito=!1})},a.carregarProdutosFavoritos=function(){a.carregandoProdutosFavoritos=!0,i.obterProdutosFavoritos(d.getToken()).then(function(o){a.dados=o,a.carregandoProdutosFavoritos=!1}).catch(function(o){a.erro=!0,r.showToast(o||"Ops, algo de errado aconteceu")}).finally(function(){a.carregandoProdutosFavoritos=!1})},a.recarregarProdutosFavoritos=function(){i.obterProdutosFavoritos(d.getToken()).then(function(o){a.dados=o}).catch(function(o){r.showToast("Ops, algo de errado aconteceu")})}}]).controller("CadastroClienteCtrl",["$scope","$rootScope","ClienteService","AuthFactory","DataValidationService",function(e,a,r,t,n){e.dados={},e.podeAlterarSenha=!1,e.carregarEdicaoCliente=function(){e.carregando=!0,t.isLoggedIn()||(a.showToast("Para editar os dados você deve estar logado"),a.irParaLogin()),r.obter(t.get().idCliente).then(function(o){e.dados=o,r.obterTamanhosDisponiveis().then(function(o){e.tamanhos=o.sneaker.Tamanhos}).catch(function(o){}).finally(function(){})}).catch(function(o){a.showToast(o),a.voltarPagina()}).finally(function(){e.carregando=!1})},e.salvar=function(o){o.dataNascimento=n.validarDataNascimento(o.dataNascimentoDia,o.dataNascimentoMes,o.dataNascimentoAno),null==o.dataNascimento?e.singleError="Data de nascimento inválida":(e.salvando=!0,r.editar(o.idCliente,o).then(function(o){t.updateUser(t.getToken()).then(function(o){a.voltarPagina(),a.showToast("Dados atualizados com sucessso"),a.isClienteLogado()}).finally(function(o){e.salvando=!1})}).catch(function(o){e.salvando=!1,a.formErrorBinder(e,o),a.showToast("Valide os dados")}))},e.alterarFotoPerfil=function(){a.showImageSelector(1e3,50,!1,"image").then(function(o){e.dados.fotoperfil=o}).catch(function(o){a.showToast("Erro ao atualizar foto de perfil")})},e.carregarPreferenciasTamanho=function(){t.isLoggedIn()&&"1"==t.get().tipo?(e.carregandoPreferencias=!0,e.tamanhoSelecionado={},r.obterPreferenciasTamanho().then(function(o){e.temPreferencias=o.temPreferencias,e.tamanhosShoes=o.sneaker}).catch(function(o){e.erro=!0}).finally(function(){e.carregandoPreferencias=!1})):e.temPreferencias=!0},e.selecionarTamanhoShoes=function(o){e.tamanhoSelecionado=o},e.confirmarTamanhoShoes=function(o){e.selecionando=!0,r.selecionarTamanhoTenis(t.get().id,o.id).then(function(o){e.selecionando=!1,e.tamanhoFoiEscolhido=!0}).catch(function(o){e.selecionando=!1})}}]).controller("ClienteNoticiasCtrl",["$scope","$rootScope","$routeParams","ClienteService","AuthFactory",function(a,r,e,t,n){function i(o){a.isFollower=o,a.$parent.actionBtnSeguir=o?"SEGUINDO":"SEGUIR"}a.checkFollowAutor=function(o){void 0===o&&(o=e.id),a.$parent.carregandoBtnSeguir=!0,a.isFollower=!1,n.isLoggedIn()&&"1"===n.get().tipo?t.checkFollowAutor(n.getToken(),o).then(function(o){i(o.isFollower)}).catch(function(o){}).finally(function(){a.$parent.carregandoBtnSeguir=!1}):(a.$parent.carregandoBtnSeguir=!1,a.$parent.actionBtnSeguir="SEGUIR")},a.toogleAutor=function(o,e){a.$parent.carregandoBtnSeguir=!0,n.isLoggedIn()&&"2"!=n.get().tipo?(e?t.unfollowAutor(n.getToken(),o).then(function(o){r.showToast(o),i(!1)}).catch(function(o){r.showToast("Ops, algo de errado aconteceu.")}):t.followAutor(n.getToken(),o).then(function(o){r.showToast(o),i(!0)}).catch(function(o){r.showToast("Ops, algo de errado aconteceu.")})).finally(function(){a.$parent.carregandoBtnSeguir=!1}):(r.irParaLogin(),r.showToast("Entre com seu Facebook para seguir o autor."))}}]).controller("ClienteMudarSenhaCtrl",["$scope","$rootScope","$location","$routeParams","$mdDialog","CadastroService","MarketService","AuthFactory",function(e,a,o,r,t,n,i,c){i.verificarUsuarioTemPin(c.get().id).then(function(o){o.existe&&a.showVerificarPIN().then(function(o){o||a.voltarPagina()})}),e.salvarNovaSenha=function(o){e.salvando=!0,n.userMudarSenha(o).then(function(o){a.showToast(o),a.irPara("mais")}).catch(function(o){a.formErrorBinder(e,o)}).finally(function(){e.salvando=!1})}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/c/:id/:q",{controller:"ColecaoCtrl",templateUrl:"angular/app/colecao/partials/view.tpl.html",title:"Coleção"}).when("/colecao/:id/:q",{controller:"ColecaoCtrl",templateUrl:"angular/app/colecao/partials/view.tpl.html",title:"Coleção"}).when("/marca/:nomemarca/colecao/:id/:q",{controller:"ColecaoCtrl",templateUrl:"angular/app/colecao/partials/view.tpl.html",title:"Coleção"})}]).controller("ColecaoCtrl",["$scope","$rootScope","$routeParams","$mdMedia","AuthFactory","ColecaoService",function(e,t,o,n,a,r){e.$mdMedia=n,e.isIOS=t.isIOS(),e.xs="xs",e.colecao={},e.showGlider=!0,e.carregando=!1,e.carregandoGlider=!1,e.erro=!1,e.wallpaper="",e.carregar=function(){e.carregando=!0,r.obterVitrine(o.id).then(function(o){t.changePageTitle(o.titulo),null!=o.descricao&&1<o.descricao.length&&document.querySelector('meta[name="description"]').setAttribute("content",o.descricao),e.colecao=o,e.exibirWallpaper()}).catch(function(o){e.erro=!0}).finally(function(){e.carregando=!1})},e.gliderInit=function(o,e){var a="glider-"+o,r=$("#"+a);r.ready(function(){var o=document.getElementById(a);window.glider=new Glider(o,{draggable:!0,slidesToScroll:1,slidesToShow:1,scrollLock:!0,rewind:!0,resizeLock:!0,dragVelocity:.8,arrows:{next:".glider-next-"+e.id}}),o.addEventListener("glider-slide-visible",function(o){o.detail.slide;window.cordova&&!t.isIOS()&&t.vibrate(5)}),n("xs")||(o=$(".glider-track"),800<=$(window).height()&&(r.height(750),o.height(750)),1e3<=$(window).height()&&(r.height(900),o.height(900)))})},e.obterLinkCompartilhamento=function(){return null==e.colecao.path?"colecao/"+e.colecao.id+"/"+e.colecao.titulo:e.colecao.path},e.exibirWallpaper=function(){return n("xs")?e.colecao.wallpaperMobile:e.colecao.wallpaperDesktop}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/compra/:id",{controller:"CompraCtrl",templateUrl:"angular/app/compra/partials/compra.tpl.html",tabControl:"Mais",title:"Comprar"}).when("/venda/:idinteresse",{controller:"CompraCtrl",templateUrl:"angular/app/compra/partials/venda.tpl.html",tabControl:"Mais",title:"Comprar"}).when("/compras",{controller:"CompraCtrl",templateUrl:"angular/app/compra/partials/list.tpl.html",tabControl:"Mais",title:"Compras"}).when("/compra/:id/avaliar",{controller:"AvaliacaoCompraCtrl",templateUrl:"angular/app/compra/partials/avaliacao.tpl.html",tabControl:"Mais",title:"Comprar"}).when("/compra/:idinteresse/anuncios",{controller:"CompraCtrl",templateUrl:"angular/app/compra/partials/anuncios.tpl.html",tabControl:"Mais",title:"Comprar"})}]).controller("CompraCtrl",["$scope","$rootScope","$interval","$location","$mdDialog","$mdMedia","$routeParams","CompraService","AuthFactory","LocationBackStore","EnderecoService","PaymentService","RastreioService","MapsService","$window","ckTagManagerService","DeviceService",function(t,u,a,e,r,o,n,i,c,s,l,d,p,f,m,g,h){t.mdMedia=o,t.itensCollapsed=!0,t.erro,window.stopCompra,window.stopIntervalCompra=function(){angular.isDefined(window.stopCompra)&&(a.cancel(window.stopCompra),window.stopCompra=void 0)},t.anuncios=[],t.filtrosDisponiveis={tipos:[]},t.vendoTudo=!1,t.carregandoFiltros=!1,t.carregandoMaisAnuncios=!1,t.mostrandoBusca=!1,t.temMaisAnuncios=!1,t.filtro={termo:"",tipoProduto:null,tamanhos:[],page:0,amount:48};var v=0;function w(){var o={termo:null,idTipoProduto:null,colIdTamanho:null,page:null,amount:null};if(t.filtro.termo&&(o.termo=t.filtro.termo),t.filtro.tipoProduto&&(o.idTipoProduto=t.filtro.tipoProduto.id),t.filtro.tamanhos&&t.filtro.tamanhos.length){for(var e=[],a=0;a<t.filtro.tamanhos.length;a++)e.push(t.filtro.tamanhos[a].id);o.colIdTamanho=e}return t.filtro.amount&&(o.page=t.filtro.page||0,o.amount=t.filtro.amount),o}function C(o,e){t.compra.totalItens=o.totalItens,t.compra.precoCobradoText=o.precoCobradoText,t.compra.precoCobrado=o.precoCobrado,t.compra.precoApresentacaoText=o.precoApresentacaoText,t.compra.precoApresentacao=o.precoApresentacao,t.compra.cartMode=o.cartMode,t.compra.temItensIndisponiveis=o.temItensIndisponiveis,e&&(t.compra.Itens=o.Itens)}function b(e){null==e||e.isTransacionada||i.syncCompra(e.id).then(function(o){(o.mudouAlgo||null!=t.status&&t.status!=o.status.status)&&(u.showToast("O pagamento foi detectado"),window.stopIntervalCompra(),t.carregarCompra()),e.id!=n.id&&(window.stopIntervalCompra(),a.cancel(window.wathcherCompra)),o.status&&(t.status=o.status.status)})}function S(o){try{g.cartChange(o)}catch(o){console.error("ANALYTICS",o)}}t.carregarCompras=function(){return t.carregando=!0,t.showButtonHistorico=!0,c.isLoggedIn()?"2"==c.get().tipo?(u.showToast("Você não pode comprar com perfil de loja"),u.voltarPagina(),!1):void i.obterCompras().then(function(o){t.compras=o,u.verificarEstaComprando(),u.toTop()}).catch(function(o){u.showToast(o),t.erro=!0}).finally(function(){t.carregando=!1}):(u.showToast("Para comprar você precisa estar logado."),u.irPara("login"),!1)},t.irParaCompra=function(o){1==o.status&&2==o.cartMode||1==o.status&&o.carrinhoHabilitado?u.irPara("compra/"+o.id+"/anuncios"):u.irPara("compra/"+o.id)},t.carregarHistorico=function(){t.carregando=!0,i.obterHistoricoCompras().then(function(o){t.compras=o,window.scrollTo(0,0),t.showButtonHistorico=!1}).catch(function(o){u.showToast(o),t.erro=!0}).finally(function(){t.carregando=!1})},t.iniciarCompra=function(s,l,d){var o=null;return c.isLoggedIn()?1<s.TamanhoProdutoSelecao.length&&null==l?!(u.mensagemCompra="Selecione um tamanho"):(1==s.TamanhoProdutoSelecao.length&&null==l&&(l=s.TamanhoProdutoSelecao[0].id),d&&(o=n.idinteresse),u.mensagemCompra="Iniciando sua compra...",t.iniciandoCompra=!0,void i.iniciarCompra(s.id,l,o).then(function(o){var e=s,a=l,r=o.idcompra;try{for(var t=(e=e||{}).Drop||{},n=e.TamanhoProdutoSelecao||[],i="",c=0;c<n.length;c++)a===n[c].id&&(i=n[c].titulo);g.addToCart(r,e.id,t.id,"iniciado",e.nome,e.precof,t.precofRetail,e.tituloTipoProduto,e.marca||t.marca,1,i)}catch(o){console.error("ANALYTICS",o)}u.mensagemCompra=null,d||u.irPara("/compra/"+o.idcompra),o.carrinhoHabilitado&&u.irPara("/compra/"+o.idcompra+"/anuncios"),u.hideDialog(),u.verificarEstaComprando()}).catch(function(o){u.mensagemCompra=o}).finally(function(){t.iniciandoCompra=!1})):(u.showToast("Para comprar você precisa estar logado."),h.isIG()?u.irPara("/from/ig/p/"+s.id+"/login"):u.irParaLoginOrigemProduto(s.id),!1)},t.carregarCompra=function(){if(t.carregando=!0,!c.isLoggedIn())return u.showToast("Para comprar você precisa estar logado."),u.irPara("login"),!1;t.idUsuario=c.get().id,i.obterCompra(n.id).then(function(o){if(null==(t.compra=o).idEndereco&&t.alertaEnderecoEmpty(),2==t.compra.status&&t.watchStatusDisponibilidade(t.compra),3!=t.compra.status&&6!=t.compra.status||t.watchStatusPagamento(t.compra),t.compra.isTransacionado&&!t.compra.isTracked)try{var e=t.compra||{},a=e.Produto||{},r=e.TamanhoSelecionado||{};i.setarTracking(e.id).then(function(){g.purchaseSimple(e,a,r)})}catch(o){}}).catch(function(o){u.showToast(o||"Ops, algo de errado aconteceu"),t.erro=!0}).finally(function(){t.carregando=!1})},t.alertaEnderecoEmpty=function(){var o=r.confirm().title("Você não tem um endereço de entrega").textContent("Para iniciar sua compra é necessário definir um endereço para calcular seu frete.").ariaLabel("Sem endereço").ok("cadastrar").cancel("agora não");r.show(o).then(function(){u.irPara("enderecos/create")},function(){u.voltarPagina()})},t.carregarAnunciosParaCompra=function(){if(t.carregando=!0,!c.isLoggedIn())return u.showToast("Para comprar você precisa estar logado."),u.irPara("login"),!1;t.idUsuario=c.get().id,t.idinteresse=n.idinteresse,i.obterCompra(t.idinteresse).then(function(e){1!=(t.compra=e).status&&(u.showToast("Não é mais possível adicionar itens ao carrinho"),u.irPara("/compra/"+t.idinteresse)),t.filtro.page=0,t.filtro.amount=5,t.carregarFiltrosCarrinho(),i.obterAnunciosParaCarrinho(t.idinteresse,w()).then(function(o){t.anuncios=o.anuncios,t.temMaisAnuncios=o.temMais,0==o.anuncios.length?u.irPara("/compra/"+t.idinteresse):t.watchAlteracaoCarrinho()}).catch(function(o){u.irPara("/compra/"+e.idcompra),u.showToast(o||"Ops, algo de errado aconteceu")}).finally(function(){t.carregando=!1})}).catch(function(o){u.showToast(o||"Ops, algo de errado aconteceu"),t.erro=!0})},t.carregarFiltrosCarrinho=function(){t.carregandoFiltros=!0,i.obterFiltrosCarrinho(t.idinteresse).then(function(o){t.filtrosDisponiveis=o}).catch(function(o){u.irPara("/compra/"+t.idinteresse),u.showToast(o||"Ops, algo de errado aconteceu")}).finally(function(){t.carregandoFiltros=!1})},t.atualizarDadosCarrinho=function(){t.idinteresse=n.idinteresse,t.idinteresse&&0<t.idinteresse&&i.obterCompra(t.idinteresse).then(function(o){o.isCarrinho&&C(o,!0)}).catch(function(){})},t.watchAlteracaoCarrinho=function(){t.dialogMostrando=!1,window.stopCompra=a(function(){(t.$$destroyed||e.path().indexOf("/compra")<0)&&window.stopIntervalCompra(),angular.element(document.body).hasClass("md-dialog-is-showing")?t.dialogMostrando=!0:(t.dialogMostrando&&t.atualizarDadosCarrinho(),t.dialogMostrando=!1)},300)},t.removerItemCarrinho=function(o,e){o.removendo=!0;var a=t.compra.id;o.removendo=!0,t.atualizando=!0,i.removerItemCarrinho(a,o.id).then(function(o){t.compra.Itens.splice(e,1),C(o,!1)}).catch(function(o){u.showToast(o)}).finally(function(){o.removendo=!1,t.atualizando=!1})},t.removerItensIndisponiveis=function(o){o.removendoItensIndisponiveis=!0;var e=o.id;t.atualizando=!0,i.removerItensIndisponiveis(e).then(function(o){u.showToast("Os itens foram atualizados"),C(o,!0)}).catch(function(o){u.showToast(o)}).finally(function(){o.removendoItensIndisponiveis=!1,t.atualizando=!1})},t.verTudo=function(){t.vendoTudo=!0,t.carregarMaisAnuncios()},t.limparFiltro=function(){t.filtro={termo:"",tipoProduto:null,tamanhos:[]}},t.mostrarBusca=function(){t.filtro.tipoProduto=null,t.filtro.tamanhos=[],t.mostrandoBusca?(t.filtro.termo&&(t.filtro.termo="",t.filtrarAnuncios()),t.mostrandoBusca=!1):t.mostrandoBusca=!0},t.limparBusca=function(){t.mostrandoBusca=!1,t.filtrarAnuncios()},t.selecionarTipoProduto=function(o){o===t.filtro.tipoProduto?t.filtro.tipoProduto=null:(t.mostrandoBusca=!1,t.filtro.termo="",t.filtro.tipoProduto=o,t.filtro.tamanhos=[]),t.filtrarAnuncios()},t.selecionarTamanho=function(o){t.tamanhoEstaSelecionado(o)?t.removerTamanho(o):t.filtro.tamanhos.push(o),t.filtrarAnuncios()},t.tamanhoEstaSelecionado=function(o){for(var e=0;e<t.filtro.tamanhos.length;e++)if(o.id===t.filtro.tamanhos[e].id)return!0;return!1},t.removerTamanho=function(o){for(var e=[],a=0;a<t.filtro.tamanhos;a++){var r=t.filtro.tamanhos[a];o!==r&&e.push(r)}t.filtro.tamanhos=e},t.agendarFiltragemAnuncios=function(){window.clearTimeout(v),v=window.setTimeout(t.filtrarAnuncios,400)},t.filtrarAnuncios=function(){t.filtro.page=0,t.filtrandoAnuncios=!0,i.obterAnunciosParaCarrinho(t.idinteresse,w()).then(function(o){t.anuncios=o.anuncios,t.temMaisAnuncios=o.temMais}).catch(function(){u.showToast(err||"Ops! Alguma coisa deu errado")}).finally(function(){t.filtrandoAnuncios=!1})},t.carregarMaisAnuncios=function(){return t.filtro.page+=1,t.carregandoMaisAnuncios=!0,i.obterAnunciosParaCarrinho(t.idinteresse,w()).then(function(o){t.anuncios=t.anuncios.concat(o.anuncios),t.temMaisAnuncios=o.temMais}).catch(function(o){u.showToast(o||"Ops! Alguma coisa deu errado.")}).finally(function(){t.carregandoMaisAnuncios=!1})},t.showBotaoApagarItem=function(){return-1<e.path().indexOf("/anuncios")},t.selecionarEndereco=function(o,e){t.carregandoEnderecos=!0,t.idcompra=t.compra.id,t.idEnderecoJaSelecionado=e,r.show({controller:"CompraCtrl",preserveScope:!0,scope:t,templateUrl:"angular/app/endereco/partials/selectAddressDialog.tpl.html",parent:angular.element(document.body),clickOutsideToClose:!window.cordova}),l.obterEnderecos(o).then(function(o){t.enderecos=o}).catch(function(o){u.hideDialog(),u.showToast("Erro ao obter endereços do usuário")}).finally(function(){t.carregandoEnderecos=!1})},t.alterarEndereco=function(o,e){t.alterandoEndereco=!0,t.idcompra=o,i.alterarEndereco(o,e).then(function(o){t.compra.Endereco=o,u.showToast("Endereço atualizado"),t.carregandoOpcoesEntrega=!0,t.obterOpcoesEntrega(t.compra),t.erroOpcaoEntrega=!1,t.compra.podeEscolherTipoConfirmacao=!1}).catch(function(o){u.showToast("Erro ao atualizar endereço, tente novamente mais tarde")}).finally(function(){u.hideDialog(),t.alterandoEndereco=!1})},t.obterOpcoesEntrega=function(o){t.dadosEntrega={},t.carregandoOpcoesEntrega=!0,t.disabledOpcoesEntrega=!0,t.compra.tipoFrete=null,i.obterOpcoesEntregav3(o.id).then(function(o){t.disabledOpcoesEntrega=!1,t.dadosEntrega=o}).catch(function(o){t.erroOpcaoEntrega=!0,t.showToast(o||"Ops, não foi possível opções de entrega. Tente novamente mais tarde ou entre em contato com o suporte!")}).finally(function(){t.carregandoOpcoesEntrega=!1})},t.escolherOpcaoEntrega=function(e,o,a,r){t.disabledOpcoesEntrega=!0,(o=null==o?{}:o).tipoFrete=null==a?0:a,o.gatewayFrete=r,i.escolherOpcoaoEntrega(e.id,o).then(function(o){e.tipoFrete=o.tipoFrete,e.podeEscolherTipoConfirmacao=!0,S("frete")}).catch(function(o){t.erroOpcaoEntrega=!0}).finally(function(){t.disabledOpcoesEntrega=!1})},t.irParaAlterarServicoFrete=function(){t.compra.tipoFrete=null},t.obterLinkPagamentoExpress=function(o,e){var a=e.Endereco.formatedAddress+" - "+e.Endereco.cep,a=r.confirm().title("Tem certeza do endereço de entrega informado?").textContent(a).ariaLabel("Confirmar e ir para pagamento").targetEvent(o).ok("Sim").cancel("Não");r.show(a).then(function(){i.solicitarLinkPagamentoExpress(e.id).then(function(o){u.toTop(),t.compra=o,t.watchStatusPagamento(o),S("link-pgto-express")}).catch(function(o){u.showToast(o||"Ops, algo de errado aconteceu. Tente de outro jeito!")}).finally(function(){})},function(){})},t.solicitarCompra=function(o,e){var a=e.Endereco.formatedAddress+" - "+e.Endereco.cep,a=r.confirm().title("Tem certeza do endereço de entrega informado?").textContent(a).ariaLabel("Confirmar endereço de entrega").targetEvent(o).ok("Sim").cancel("Não");r.show(a).then(function(){t.carregando=!0,i.solicitarLinkCompra(e.id).then(function(o){t.compra=o,t.watchStatusDisponibilidade(t.compra),S("solicitar-compra")}).catch(function(o){t.carregarCompra(),u.showToast(o||"Ops, algo de errado aconteceu")}).finally(function(){t.carregando=!1})},function(){})},t.cancelarCompra=function(o,e){o=r.confirm().title("Tem certeza que quer CANCELAR a compra?").textContent("Você poderá tentar comprar novamente o produto após cancelar").ariaLabel("Cancelar a compra").targetEvent(o).ok("Sim").cancel("Não");r.show(o).then(function(){t.carregando=!0,i.cancelarCompra(e.id).then(function(o){t.irPara("/compras"),u.showToast("A compra foi cancelada e está disponível no histórico"),S("cancelar")}).catch(function(o){u.showToast(o||"Ops, algo de errado aconteceu")}).finally(function(){t.carregando=!1})},function(){})},t.desativar=function(o,e){o=r.confirm().title("Tem certeza que deseja finalizar a compra?").textContent("A compra não será apagada definitivamente. Caso tenha algum problema posteriormente entre em contato com nossa equipe.").ariaLabel("Desativar compra").targetEvent(o).ok("Sim").cancel("Não");r.show(o).then(function(){t.carregando=!0,i.desativar(e.id).then(function(o){u.irPara("compras"),u.showToast("Compra foi finalizada. Obrigado!")}).catch(function(o){u.irPara("compras"),u.showToast(o||"Ops, algo de errado aconteceu ao tentar desativar sua compra"),t.carregando=!1})},function(){})},t.verificarStatusEntrega=function(e){e.statusEntrega="🔄 Verificando status entrega",p.obterStatusAtual(e.id).then(function(o){e.statusEntrega=o.status}).catch(function(o){e.statusEntrega="Rastreio temporariamente indisponível"})},t.confirmarEntrega=function(o,e){o=r.confirm().title("Seu produto está em mãos? 📦🤲").textContent("Se sim, verifique o TAMANHO, CONDIÇÃO e CARACTERÍSTICAS do produto antes de confirmar. Após confirmar a entrega você NÃO PODERÁ INICIAR DEVOLUÇÕES!").ariaLabel("Confirmar entrega").targetEvent(o).ok("CONFIRMAR ENTREGA").cancel("DEPOIS");r.show(o).then(function(){t.carregando=!0,i.confirmarEntrega(e.id).then(function(o){t.carregando=!0,u.showToast("Por favor, avalie o vendedor! Isso é muito importante para a plataforma."),u.irPara("compra/"+e.id+"/avaliar")}).catch(function(o){u.showToast(o||"Ops, algo de errado aconteceu")}).finally(function(){t.carregando=!1})},function(){})},t.confirmarEntregav2=function(o,e){t.dadosDialogConfirmarCompra=e,t.responder=function(o){r.hide(o)},r.show({controller:"CompraCtrl",templateUrl:"angular/app/compra/partials/confirmxdialog.tpl.html",parent:angular.element(document.body),scope:t,fullscreen:!1,preserveScope:!0,clickOutsideToClose:!window.cordova}).then(function(o){!0===o&&(t.carregando=!0,i.confirmarEntrega(e.id).then(function(o){t.carregando=!0,u.showToast("Por favor, avalie o vendedor! Isso é muito importante para a plataforma."),u.irPara("compra/"+e.id+"/avaliar")}).catch(function(o){u.showToast(o||"Ops, algo de errado aconteceu")}).finally(function(){t.carregando=!1}))},function(){})},t.relatarProblema=function(o){var e=r.confirm().title("Teve algum problema?").textContent("Após relatar um problema o Droper alerta o vendedor de várias maneiras para que ele resolva seu problema o mais rápido possível.").ariaLabel("tenho um problema").ok("Sim").cancel("Não");r.show(e).then(function(){t.carregando=!0,i.relatarProblema(o.id).then(function(o){t.carregando=!0,t.carregarCompra()}).catch(function(o){u.showToast(o||"Ops, algo de errado aconteceu")}).finally(function(){t.carregando=!1})},function(){})},t.resolverFotoItem=function(o){return null!=o.dropIcon?o.dropIcon:o.linkfoto},t.resolverProblema=function(o,e){o=r.confirm().title("Deseja resolver o problema?").textContent("Após resolver o problema sua compra volta para o estado anterior.").ariaLabel("Resolver problema").targetEvent(o).ok("Sim").cancel("Não");r.show(o).then(function(){t.carregando=!0,i.resolverProblema(e.id).then(function(o){t.carregando=!0,t.carregarCompra()}).catch(function(o){u.showToast(o||"Ops, algo de errado aconteceu")}).finally(function(){t.carregando=!1})},function(){})},window.wathcherDisponibilidade,window.stopIntervalDisponibilidade=function(){angular.isDefined(window.wathcherDisponibilidade)&&(a.cancel(window.wathcherDisponibilidade),window.wathcherDisponibilidade=void 0)},t.watchStatusDisponibilidade=function(o){window.stopIntervalDisponibilidade(),window.wathcherDisponibilidade=a(function(){null!=o&&3!=o.status&&!o.isTransacionado&&(i.verificarStatusDisponivel(o.id).then(function(o){o.changed&&(window.stopIntervalDisponibilidade(),t.carregarCompra(),u.showToast("O produto está disponível para compra"))}),t.$$destroyed||e.path().indexOf("/compra")<0)&&window.stopIntervalDisponibilidade()},3e3)},window.wathcherCompra,window.stopIntervalCompra=function(){angular.isDefined(window.wathcherCompra)&&(a.cancel(window.wathcherCompra),window.wathcherCompra=void 0)},t.watchStatusPagamento=function(o){window.stopIntervalCompra(),window.wathcherCompra=a(function(){b(o),(t.$$destroyed||e.path().indexOf("/compra")<0)&&window.stopIntervalCompra()},5e3)},t.refreshStatusPagamento=function(o){b(o)},t.status=null}]).controller("AvaliacaoCompraCtrl",["$scope","$rootScope","$location","$mdDialog","$mdMedia","$routeParams","CompraService","AuthFactory","AvaliacaoService",function(e,a,o,r,t,n,i,c,s){e.carregar=function(){if(e.carregando=!0,!c.isLoggedIn())return a.showToast("Para avaliar você deve estar logado"),a.irPara("login"),!1;e.idUsuario=c.get().id,i.obterCompra(n.id).then(function(o){e.compra=o,e.vendedor=o.Produto.Vendedor}).catch(function(o){a.showToast(o||"Ops, algo de errado aconteceu"),e.erro=!0}).finally(function(){e.carregando=!1})},e.enviarAvaliacao=function(o){e.enviando=!0,e.envioSucesso=!1,null!=e.vendedor.idLoja&&(o.idLoja=e.vendedor.idLoja),null!=e.vendedor.idCliente&&(o.idClienteVendedor=e.vendedor.idCliente),o.idCliente=c.get().idCliente,i.enviarAvaliacao(e.compra.id,o).then(function(o){e.envioSucesso=!0}).catch(function(o){a.showToast(o||"Ops, algo de errado aconteceu")}).finally(function(){e.enviando=!1})}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/consignacao/list",{controller:"ConsignacaoCtrl",templateUrl:"angular/app/consignacao/partials/list.tpl.html",title:"Consignações"}).when("/consignacao/:id/view",{controller:"ConsignacaoViewCtrl",templateUrl:"angular/app/consignacao/partials/view.tpl.html",title:"Detalhes consignação"}).when("/consignacao/:id/negociar",{controller:"ConsignacaoViewCtrl",templateUrl:"angular/app/consignacao/partials/negociar.tpl.html",title:"Alterar proposta"}).when("/consignacao/:id/solicitarretirada",{controller:"ConsignacaoViewCtrl",templateUrl:"angular/app/consignacao/partials/solicitar-retirada.tpl.html",title:"Solicitar retirada"}).when("/consignacao/:id/historico",{controller:"ConsignacaoHistoricoCtrl",templateUrl:"angular/app/consignacao/partials/historico.tpl.html",title:"Histórico"}).when("/consignacao/vendidos",{controller:"ConsignacaoVendidosCtrl",templateUrl:"angular/app/consignacao/partials/vendidos.tpl.html",title:"Vendidos"})}]).controller("ConsignacaoCtrl",["$scope","$rootScope","$routeParams","$mdDialog","ConsignacaoService","AuthFactory",function(t,o,e,a,n,r){t.listaConsig=[],t.consignacoes={},t.codStatus=[],t.whitelist=["agregacaoEmAnalise","agregacaoExposto","agregacaoAlerta","agregacaoPropostaPendente"],t.amount=40,t.page=0,t.postBuscaConsignacoes={};t.EA=1,t.A=4,t.E=5,t.RE=8,t.RS=9,t.V=7,t.termoPesquisa="";var i=0;function c(o,e){t.visualizacao={categoria:o,pagina:e}}t.preCondicoes=function(){r.isLoggedIn()?t.carregarConsignacoes(!0):(o.showToast("Sessão encerrada"),o.irPara("market"))},t.agendarPesquisa=function(){window.clearTimeout(i);i=window.setTimeout(function(){t.carregarConsignacoes(!1)},600)},t.carregarConsignacoes=function(o){t.carregando=!0,o?t.carregando=!0:t.carregandoSecundario=!0,t.postBuscaConsignacoes.ordenacao="maisnovos",t.postBuscaConsignacoes.amount=t.amount,t.postBuscaConsignacoes.page=0,n.obterConsignacoesPorStatus(t.postBuscaConsignacoes).then(function(o){t.retorno=o,t.superlistas={agregacaoPropostaPendente:{sublistas:[{codStatus:"propostaPendente",status:t.retorno.propostaPendente,descricao:"Estas são as propostas recebidas para suas consignações."}],descricao:"Proposta pendente",minidescricao:"PP",bg:"purple",fg:"#fefefe",descricaoGeral:"Consignações com propostas de payout pendentes.",total:t.retorno.propostaPendente.total},agregacaoEmAnalise:{sublistas:[{codStatus:"emAnalise",status:t.retorno.emAnalise,descricao:"Estes são seus pedidos de consignação em análise, você deve aguardar até que um consultor avalie suas solicitações."}],descricao:"Em análise",minidescricao:"EA",bg:"#f1e46c",fg:"#fefefe",descricaoGeral:"Consignações em análise.",total:t.retorno.emAnalise.total},agregacaoExposto:{sublistas:[{codStatus:"exposto",status:t.retorno.exposto,descricao:"Estas são suas consignações expostas em lojas."}],descricao:"Exposto",minidescricao:"E",bg:"#0a9d22",fg:"#fefefe",descricaoGeral:"Consignações em exposição.",total:t.retorno.exposto.total},agregacaoAlerta:{sublistas:[{codStatus:"aceito",status:t.retorno.aceito,descricao:"Estas são suas consignações aceitas, você deve levar o produto até a loja para que possa ser exposto.",expandido:!1},{codStatus:"propostaRejeitada",status:t.retorno.propostaRejeitada,descricao:"Estas são suas rejeições para alteração de payout. Quando suas propostas são rejeitadas seus produtos ainda continuam expostos, porém o valor do payout original é mantido.Caso não concorde, poderá solicitar a retirada de seu produto da loja.",expandido:!1},{codStatus:"contraproposta",status:t.retorno.contraproposta,descricao:"Estas são as propostas recebidas para suas consignações.",expandido:!1},{codStatus:"retiradaSolicitada",status:t.retorno.retiradaSolicitada,descricao:"Estas são as consignações ao qual foi solicitado que sejam retiradas da loja.",expandido:!1},{codStatus:"reprovado",status:t.retorno.reprovado,descricao:"Estes são seus pedidos de consignação reprovados, visualize os detalhes para ver o motivo da rejeição.",expandido:!1}],descricao:"Alerta",minidescricao:"A",bg:"#ad4a44",fg:"#fefefe",descricaoGeral:"As consignações em alerta indicam que alguma ação deve ser feita por você. Verifique-as para mais informações.",total:t.retorno.aceito.total+t.retorno.propostaRejeitada.total+t.retorno.retiradaSolicitada.total+t.retorno.contraproposta.total+t.retorno.reprovado.total}},t.codStatus=Object.keys(t.superlistas),t.temConsignacao=!1;for(var e=0;e<t.codStatus.length;e++)if(t.superlistas[t.codStatus[e]].total){t.temConsignacao=!0,t.selecionar(t.codStatus[e]);break}}).catch(function(o){}).finally(function(){t.carregando=!1})},t.obterSublistas=function(o){return o?Object.keys(o.sublistas):[]},t.toggleSublista=function(o){for(var e=0;e<t.superlistas.agregacaoAlerta.sublistas.length;e++)t.superlistas.agregacaoAlerta.sublistas[e].codStatus===o?t.superlistas.agregacaoAlerta.sublistas[e].expandido=!t.superlistas.agregacaoAlerta.sublistas[e].expandido:t.superlistas.agregacaoAlerta.sublistas[e].expandido=!1},t.openLoja=function(o){var e=t.$new();t.idLoja=o,a.show({controller:"LojaFisicaDetalhesCtrl",templateUrl:"angular/app/consignacao/partials/lojaFisicaDetalhes.tpl.html",clickOutsideToClose:!window.cordova,parent:angular.element(document.body),scope:e,preserveScope:!1,fullscreen:!0})},t.verMais=function(a){t.carregandoMais=!0;t.statusSelecionado;var r=a.status,o={termo:t.postBuscaConsignacoes.termo,status:r.status,page:r.page+1,amount:t.amount,ordenacao:"maisNovos",statusProposta:r.statusProposta};n.obterConsignacoes(o).then(function(o){var e=(r.consignacoes||[]).concat(o.consignacoes||[]);a.status.consignacoes=e,a.status.page=r.page+1,a.status.temMais=o.temMais}).catch(function(o){alert(o.msg||o)}).finally(function(){t.carregandoMais=!1})},t.selecionar=function(o){t.statusSelecionado=o},t.selecionarSubStatus=function(o,e){t.statusSelecionado=o,t.subStatus=e,t.toggleSublista(t.subStatus)},t.isSelecionado=function(o){return t.statusSelecionado===o},t.blacklisted=function(e){return!t.whitelist.some(function(o){return o===e})},t.statusCor=function(o){return o.statusbg},t.visualizacao={categoria:1,pagina:{}},t.retorno={},t.ver=function(o){switch(o){case 1:c(o,t.retorno.emAnalise);break;case 4:c(o,t.retorno.aceito);break;case 5:c(o,t.retorno.exposto);break;case 8:c(o,t.retorno.reprovado);break;case 9:c(o,t.retorno.retiradaSolicitada);break;case 7:c(o,t.retorno.vendido)}},t.vendo=function(o){return t.visualizacao.categoria===o},t.resolveImagemProduto=function(o,e){return 0<e.indexOf("//")?e:"angular/img/default.jpg"},t.iniciarCSU=void t.preCondicoes()}]).controller("ConsignacaoViewCtrl",["$scope","$rootScope","$routeParams","$mdDialog","$mdMedia","$location","ConsignacaoService","AuthFactory","CkMasksService",function(a,r,t,e,o,n,i,c,s){a.novoPayout="",a.$mdMedia=o,a.listaFotos=[],a.fotoSelecionada={},a.preCondicoes=function(){c.isLoggedIn()||(r.showToast("Sessão encerrada"),r.irPara("market"))},a.init=function(){a.obterConsignacaoPorId()},a.initHistorico=function(){a.obterConsignacaoPorId(),a.carregarHistorico()},a.obterConsignacaoPorId=function(){a.carregando=!0,i.obterConsignacaoPorId(t.id).then(function(o){a.dadosConsignacao=o,a.fotoSelecionada.link=null,a.listaFotos=o.produto.fotoSecundarias,a.listaFotos.push({link:o.produto.fotoPrincipal,linkIcon:o.produto.fotoPrincipal})}).catch(function(o){}).finally(function(){a.carregando=!1})},a.selecionarFoto=function(o){a.fotoSelecionada=o},a.retirarConsignacao=function(){a.retirandoConsignacao=!0;var o=t.id;i.alterarStatus(o,{tipo:"consignacao",status:"retirada_solicitada"}).then(function(o){r.showToast("Consignação encerrada, por favor retirar o produto na loja."),a.dadosConsignacao=o,r.irPara("/consignacao/"+a.dadosConsignacao.id+"/view")}).catch(function(o){r.formErrorBinder(a,o),r.showToast(o.Message||o)}).finally(function(){a.retirandoConsignacao=!1})},a.excluirConsignacao=function(){a.excluindo=!0;var o=t.id;i.alterarStatus(o,{tipo:"consignacao",status:"excluido"}).then(function(o){r.showToast("Consignação encerrada."),a.dadosConsignacao=o,r.irPara("/consignacao/list")}).catch(function(o){r.formErrorBinder(a,o),r.showToast(o.Message||o)}).finally(function(){a.excluindo=!1})},a.aceitarProposta=function(){a.aceitando=!0;var o=t.id;i.aceitarProposta(o).then(function(o){r.showToast("Contraproposta aceita."),a.dadosConsignacao=o,r.irPara("/consignacao/list")}).catch(function(o){r.formErrorBinder(a,o),r.showToast(o.Message||o)}).finally(function(){a.aceitando=!1})},a.criarProposta=function(){a.criandoProposta=!0;var o=t.id,e={payout:a.novoPayout.replace(".","").replace(",",".")};i.criarProposta(o,e).then(function(o){a.dadosConsignacao=o,r.irPara("/consignacao/"+t.id+"/view")}).catch(function(o){console.error(o),r.formErrorBinder(a,o),r.showToast(o.Message||o)}).finally(function(){a.criandoProposta=!1})},a.desistirProposta=function(){a.desistindoProposta=!0,i.desistirProposta(a.dadosConsignacao.id).then(function(o){a.obterConsignacaoPorId(),r.showToast("Sua proposta de payout foi encerrada.")}).catch(function(o){console.error(o),r.formErrorBinder(a,o),r.showToast(o.Message||o)}).finally(function(){a.desistindoProposta=!1})},a.showDialogDesistirproposta=function(){var o=e.confirm().title("Desistir da proposta?").textContent("Sua proposta de alteração de payout será retirada.").ariaLabel("desistir da proposta").ok("Desistir").cancel("cancelar");e.show(o).then(function(){a.desistirProposta()},function(){})},a.showDialogRetiradaSolicitada=function(){var o=e.confirm().title("Retirar produto da loja?").textContent("A consignação deste produto será encerrada e você deverá retirá-lo da loja.").ariaLabel("Retirada solicitada").ok("retirar").cancel("cancelar");e.show(o).then(function(){a.retirarConsignacao()},function(){})},a.showDialogExcluir=function(){var o=e.confirm().title("Excluir consignacao?").textContent("Deseja realmente excluir a consignação?").ariaLabel("Excluir consignação").ok("excluir").cancel("cancelar");e.show(o).then(function(){a.excluirConsignacao()},function(){})},a.showDialogCriarProposta=function(){var o=e.confirm().title("Enviar proposta de novo preço?").textContent("A proposta entrará em análise.").ariaLabel("Renegociar consignação").ok("confirmar").cancel("cancelar");e.show(o).then(function(){a.criarProposta()},function(){})},a.maskNovoPayout=function(){var o=s.monetario(a.novoPayout);a.novoPayout!==o&&(a.novoPayout=o)},a.openLojaDialog=function(){var o=a.$new();a.idLoja=a.dadosConsignacao.idLojaFisica,e.show({controller:"LojaFisicaDetalhesCtrl",templateUrl:"angular/app/consignacao/partials/lojaFisicaDetalhes.tpl.html",clickOutsideToClose:!window.cordova,parent:angular.element(document.body),scope:o,preserveScope:!1,fullscreen:!0})},a.openDialogAceitarContraProposta=function(o){a.aceitando||(o=e.confirm().title("Aceitar contraproposta de payout?").textContent("O valor do payout de sua consignação será atualizado, esta ação não pode ser desfeita.").ariaLabel("Aceitar contraproposta").targetEvent(o).ok("Aceitar").cancel("Cancelar"),e.show(o).then(function(){a.aceitarProposta()}).catch(function(){}))},a.irParaNegociar=function(){a.aceitando||r.irPara("/consignacao/"+a.dadosConsignacao.id+"/negociar")},a.irParaRetirar=function(){a.aceitando||r.irPara("/consignacao/"+a.dadosConsignacao.id+"/solicitarretirada")},a.iniciarCSU=void a.preCondicoes()}]).controller("ConsignacaoHistoricoCtrl",["$scope","$rootScope","$routeParams","$mdMedia","ConsignacaoService","AuthFactory",function(a,e,r,o,t,n){a.historico=[],a.$mdMedia=o,a.page=0,a.amount=10,a.temMais=!1,a.preCondicoes=function(){n.isLoggedIn()?a.carregarHistorico():(e.showToast("Sessão encerrada"),e.irPara("market"))},a.obterConsignacaoPorId=function(){a.carregando=!0,t.obterConsignacaoPorId(r.id).then(function(o){a.dadosConsignacao=o}).catch(function(o){}).finally(function(){a.carregando=!1})},a.carregarHistorico=function(){a.carregandoHistorico=!0;var o=r.id;t.obterHistorico(o,a.page,a.amount).then(function(o){a.historico=o.historico,a.dadosConsignacao=o.consignacao,a.temMais=o.temMais}).catch(function(o){console.error(o),e.formErrorBinder(a,o)}).finally(function(){a.carregandoHistorico=!1})},a.verMais=function(){a.carregandoMais=!0;var o=r.id;a.page+=1,t.obterHistorico(o,a.page,a.amount).then(function(o){var e=(a.historico||[]).concat(o.historico||[]);a.historico=e,a.page+=1,a.temMais=o.temMais}).catch(function(o){console.error(o),e.formErrorBinder(a,o)}).finally(function(){a.carregandoMais=!1})},a.resolveImagemProduto=function(o,e){return 0<e.indexOf("//")?e:"angular/img/default.jpg"},a.iniciarCSU=void a.preCondicoes()}]).controller("LojaFisicaDetalhesCtrl",["$scope","$rootScope","$routeParams","$mdDialog","AppleMapKit","ConsignacaoService","AuthFactory",function(a,e,o,r,t,n,i){function c(){var o;window.mapkit?((o=document.getElementById("map"))&&!a.map&&window.mapkit&&(a.map=new mapkit.Map(o,{showsMapTypeControl:!1,showsCompass:mapkit.FeatureVisibility.Hidden}),a.carregandoMapa=!1,a.verMapa=!0,a.iniciado=!0,a.map&&(o=[],a.marcadores.loja&&(o.push(a.marcadores.loja),a.marcadores.loja=null),a.map.removeItems(o)),a.map)&&window.mapkit&&window.mapkit.Coordinate&&window.mapkit.MarkerAnnotation&&(a.lojaDetails.endereco.latitude||a.lojaDetails.endereco.longitude||(a.lojaDetails.endereco.latitude=-23.495442361961988,a.lojaDetails.endereco.longitude=-46.592228186368686),o=new mapkit.Coordinate(a.lojaDetails.endereco.latitude,a.lojaDetails.endereco.longitude),a.marcadores.loja=new mapkit.MarkerAnnotation(o,{color:"#000000",title:"Droper",subtitle:"Loja Droper"}),o=[],a.marcadores.loja&&o.push(a.marcadores.loja),a.map.showItems(o,{animate:!1,minimumSpan:new mapkit.CoordinateSpan(.03,.03)}),a.map.setCameraDistanceAnimated(7e3)),a.mapkitIniciado||mapkit.init({authorizationCallback:function(e){t.fetchJWT().then(function(o){e(o.token),a.mapkitIniciado=!0}).catch(function(o){console.error(o),a.erroMapa=!0}).finally(function(){a.carregandoMapa=!1})},language:"pt-BR"})):(a.erroMapa=!0,a.carregandoMapa=!1)}a.lojaDetails=a.lojaDetails||{},a.idLoja=a.idLoja||"",a.carregandoMapa=!1,a.verMapa=!1,a.erroMapa=!1,a.iniciado=!1,a.mapaExpandido=!1,a.map=null,a.marcadores={origem:null,destino:null,loja:null},a.init=function(){a.obterLojaFisica()},a.obterLojaFisica=function(){a.lojaDetails&&a.lojaDetails.id||(a.carregandoLojaFisica=!0,n.obterLojaFisica(a.idLoja).then(function(o){a.lojaDetails=o,a.carregarMapa()}).catch(function(o){console.error(o),e.formErrorBinder(a,o),e.showToast(o.Message||o)}).finally(function(){a.carregandoLojaFisica=!1}))},a.carregarMapa=function(){a.iniciado||(a.carregandoMapa=!0,window.mapkit?c():$.getScript(t.MAPKIT_CDN,c))},a.expandirMapa=function(){a.mapaExpandido=!a.mapaExpandido},a.verEndereco=function(){alert("Alberto verificar como será abrir compartilhamento de endereço.")}}]).controller("ConsignacaoVendidosCtrl",["$scope","$rootScope","$routeParams","$mdDialog","ConsignacaoService","AuthFactory",function(a,e,o,r,t,n){a.page=0,a.amount=20,a.temMais=!1,a.listaConsignacoes=[],a.preCondicoes=function(){n.isLoggedIn()?a.carregarConsignacoes():(e.showToast("Sessão encerrada"),e.irPara("market"))},a.carregarConsignacoes=function(){a.carregando=!0;var o={termo:"",status:[6,7],page:a.page,amount:a.amount,ordenacao:"maisNovos"};t.obterConsignacoes(o).then(function(o){a.listaConsignacoes=o.consignacoes,a.temMais=o.temMais}).catch(function(o){console.error(o),e.formErrorBinder(a,o)}).finally(function(){a.carregando=!1})},a.carregarMais=function(){a.carregandoMais=!0;var o={termo:"",status:[6,7],page:a.page+1,amount:a.amount,ordenacao:"maisNovos"};t.obterConsignacoes(o).then(function(o){var e=(a.listaConsignacoes||[]).concat(o.consignacoes||[]);a.listaConsignacoes=e,a.page+=1,a.temMais=o.temMais}).catch(function(o){console.error(o),e.formErrorBinder(a,o)}).finally(function(){a.carregandoMais=!1})},a.openLoja=function(o){var e=a.$new();a.idLoja=o,r.show({controller:"LojaFisicaDetalhesCtrl",templateUrl:"angular/app/consignacao/partials/lojaFisicaDetalhes.tpl.html",clickOutsideToClose:!window.cordova,parent:angular.element(document.body),scope:e,preserveScope:!1,fullscreen:!0})},a.statusCor=function(o){return o.statusbg},a.resolveImagemProduto=function(o,e){return 0<e.indexOf("//")?e:"angular/img/default.jpg"},a.iniciarCSU=void a.preCondicoes()}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/config",{controller:"ConfiguracaoCtrl",templateUrl:"angular/app/configuracao/partials/config.tpl.html",title:"Configurações"}).when("/config/preferencias",{controller:"ConfiguracaoCtrl",templateUrl:"angular/app/configuracao/partials/preferencias.tpl.html",title:"Configurações"}).when("/config/dispositivos",{controller:"ConfiguracaoCtrl",templateUrl:"angular/app/configuracao/partials/devices.tpl.html",title:"Configurações"}).when("/config/delete",{controller:"ConfiguracaoCtrl",templateUrl:"angular/app/configuracao/partials/deleteaccount.tpl.html",title:"Configurações - Deletar conta"})}]).controller("ConfiguracaoCtrl",["$scope","$rootScope","ConfiguracaoService",function(e,a,r){e.erro=!1,e.irParaConfig=function(){e.erro=!1,a.irPara("/config")},e.irParaPreferencias=function(){e.erro=!1,a.irPara("/config/preferencias")},e.irParaDevices=function(){e.erro=!1,a.irPara("/config/dispositivos")},e.devices=null,e.carregandoDevices=!0,e.limpandoDevices=!1,e.carregarDevices=function(){e.carregandoDispositivos=!0,r.obterDevices().then(function(o){e.devices=o}).catch(function(o){e.erro=!0,console.error(o)}).finally(function(){e.carregandoDispositivos=!1})},e.limparDevices=function(){e.limpandoDevices=!0,r.limparDevices().then(function(){a.showToast("Você foi desconectado"),a.irPara("/"),a.logoutAndExit()}).catch(function(o){e.erro=!0,console.error(o)}).finally(function(){e.limpandoDevices=!1})},e.preferencias={},e.carregandoPreferencias=!1,e.salvandoPreferencias=!1,e.carregarPreferencias=function(){e.carregandoPreferencias=!0,r.obterConfiguracao().then(function(o){e.preferencias=o}).catch(function(o){e.erro=!0,console.error(o)}).finally(function(){e.carregandoPreferencias=!1})},e.salvarPreferencias=function(){e.salvandoPreferencias=!0,r.atualizarConfiguracao(e.preferencias).then(function(){a.showToast("Preferências salvas!"),e.irParaConfig()}).catch(function(o){a.showToast("Ops! Alguma coisa deu errado"),console.error(o)}).finally(function(){e.salvandoPreferencias=!1})},e.iconeDevice=function(o){switch(o.os){case"android":return"android";case"iphone":return"phone_iphone";case"windows":return"desktop_windows";case"macintosh":return"laptop_mac"}return"laptop"},e.formatarNome=function(o){for(var e="",a=0;a<o.length;a++)e+=0===a?o[a].toUpperCase():o[a];return e},e.carregarDelecaoConta=function(){e.carregandoPreferencias=!1,a.isLogado()||(a.irPara("home"),a.showToast(""));var o=a.getLoggedUser();e.email=o.email},e.confirmarDelecao=function(o){e.deletando=!0,e.email!=o?(a.showToast("O e-mail informado é diferente do e-mail utilizado nessa conta"),e.deletando=!1):r.deleteAccount().then(function(){a.showToast("Sua conta foi desativada"),a.logoutAndExit()}).catch(function(o){a.showToast(o||"Ops! Alguma coisa deu errado"),console.error(o)}).finally(function(){e.deletando=!1})}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/mensagens",{controller:"ConversaCtrl",templateUrl:"angular/app/conversa/partials/list.tpl.html",tabControl:"Mais",title:"Mensagens"}).when("/mensagens/:id",{controller:"ConversaCtrl",templateUrl:"angular/app/conversa/partials/conversa.tpl.html",tabControl:"Mais",title:"Conversa"})}]).controller("ConversaCtrl",["$scope","$rootScope","$routeParams","$window","$location","$filter","$mdDialog","ConversaService","AuthFactory","$mdMedia","MensagemService",function(n,t,a,o,e,r,i,c,s,l,d){function u(){$("#ck-chat2--body").height(window.innerHeight)}function p(){var o,e;t.isDesktop()||t.isCordova()||!(e=(e=(o=document).cancelFullScreen||o.webkitCancelFullScreen||o.mozCancelFullScreen||o.exitFullscreen)||o.exitFullscreen||o.mozCancelFullScreen||o.webkitExitFullscreen)||e.call(o)}function f(){window.setTimeout(function(){var o=$(document.getElementById("ck-mensagem--list"));o.animate({scrollTop:o[0].scrollHeight},"fast"),t.roloutToEnd()},200)}n.preCondicoes=function(){s.isLoggedIn()||(t.irPara("mais"),t.showToast("Você precisa estar logado para ver suas conversas"))},n.index=0,n.idUsuario=s.get().id,n.$mdMedia=l,n.erro=!1,n.tipo=null,n.emissor={},n.carregar=function(){n.carregando=!0,p(),c.obterLista().then(function(o){n.conversas=o}).catch(function(o){n.erro=!0}).finally(function(){n.carregando=!1})},n.carregarPaginaConversa=function(){var o,e;n.carregando=!0,u(),!t.isDesktop()&&!t.isCordova()&&(o=document,e=o.requestFullScreen||o.webkitRequestFullScreen||o.mozRequestFullScreen||o.msRequestFullScreen)&&e.call(o),c.obterInteresse(a.id).then(function(o){n.interesse=o,n.interesse.Player=n.resolveOutroLado(o),n.carregarConversa(n.interesse.id,n.interesse.Player.iscompra?"comprador":"vendedor")}).catch(function(o){n.erro=!0})},n.resolveOutroLado=function(o){var e={};return n.idUsuario==o.dadosCliente.id?(e.nome=o.dadosProduto.Vendedor.nome,e.foto=o.dadosProduto.Vendedor.foto,e.idUsuario=o.dadosProduto.Vendedor.idUsuario,e.iscompra=!0):(e.nome=o.dadosCliente.nome,e.foto=o.dadosCliente.foto,e.idUsuario=o.dadosCliente.id,e.iscompra=!1),e},n.apagarConversa=function(o,e,a){var r=i.confirm().title("Tem certeza que deseja apagar esta conversa?").textContent("Essa conversa ficará indisponível na sua lista mas não será deletada dos nossos registros.").ariaLabel("Apagar").ok("Sim").cancel("Não");i.show(r).then(function(){e.splice(a,1),c.apagarConversa(o.id).then(function(o){}).catch(function(o){t.showToast(o||"Ops, algo de errado aconteceu ao tentar apagar esta conversa")})},function(){})},n.resolverFotoItem=function(o){if(o)return null!=o.dropIcon?o.dropIcon:o.linkfoto},n.irParaCompraOuVenda=function(o){o.Player.iscompra?t.irPara("/compra/"+o.id):t.irPara("/vendas/"+o.id)},n.resizeChatSpace=function(){window.onresize()},window.onresize=function(){u(),n.$$destroyed&&(window.onresize=null,p())},n.carregarConversa=function(o,e){n.tipo=e,n.texto="",n.carregando=!0,n.endpagination=!0,n.emissor=s.get(),n.emissor.tipoUsuario=e,n.isDesktop=t.isDesktop(),n.mensagens=[],n.page=1,n.amount=40,d.obterMensagens(o,e,n.page,n.amount).then(function(o){var e;n.mensagens=o.mensagens,n.endpagination=o.endPage,f(),n.isOnline=!0,e=setInterval(function(){d.verificarAtualizacaoMensagens(n.interesse.id,n.interesse.ticks).then(function(o){o.update&&(n.interesse.ticks=o.newticks,n.atualizarConversa()),n.isOnline=!0}).catch(function(){n.isOnline=!1}),n.$$destroyed&&clearInterval(e)},3e3)}).catch(function(o){n.erromensagens=!0}).finally(function(){n.carregando=!1})},n.carregarMensagensAntigas=function(){n.carregandomaismensagens=!0,n.page=n.page+1,d.obterMensagens(n.interesse.id,n.emissor.tipoUsuario,n.page,n.amount).then(function(o){n.endpagination=o.endPage;o=o.mensagens.reverse();angular.forEach(o,function(o,e){n.mensagens.unshift(o)})}).catch(function(o){}).finally(function(){n.carregandomaismensagens=!1})},n.atualizarConversa=function(){var o=0<n.mensagens.length?n.mensagens[n.mensagens.length-1].id:0;d.obterUltimasMensagens(n.interesse.id,o).then(function(o){var a=!1;angular.forEach(o.mensagens,function(e,o){void 0===n.mensagens.filter(function(o){return o.id===e.id})[0]&&(n.mensagens.push(e),"comprador"==n.tipo&&null!=e.idUsuarioVendedor||"vendedor"==n.tipo&&null!=e.idUsuarioComprador)&&(a=!0)}),n.interesse.ticks=o.newticks,f(),a&&t.soundAlert()}).catch(function(o){}).finally(function(){n.carregandomensagens=!0})},n.enviarMensagem=function(o,e,a){if(""==o||null==o)return!1;var r,t;$("#ck-chat--input").focus(),n.enviando=!0,"comprador"===n.tipo&&(r=n.emissor.id,t=null),"vendedor"===n.tipo&&(r=null,t=n.emissor.id),d.enviar(n.interesse.id,n.tipo,t,r,o,e,null).then(function(o){n.atualizarConversa()}).catch(function(o){}).finally(function(){n.enviando=!1}),n.texto=""},n.actionMensagem=function(o){2===o.tipo&&n.showImagePresentation(o.texto)},n.objectRender=function(o){o=JSON.parse(o);return o&&o.preco&&(o.preco=formatMoney(o.preco,2,",","")),o},n.showEnviarImagem=function(){t.showImageSelector(2e5,800,!1,"image").then(function(o){n.enviarMensagem(o,2)}).catch(function(o){console.log(o),t.showToast("Erro ao carregar foto. Tente novamente.")})},n.showImagePresentation=function(a){i.show({controller:["$scope","$rootScope",function(o,e){o.urlimagepresentation=a}],templateUrl:"angular/app/shared/ckChat/partials/imagePresentationDialog.tpl.html",clickOutsideToClose:!window.cordova,fullscreen:!0,parent:angular.element(document.body)})},n.enableControlDesktopSubmit=function(){$("textarea").keypress(function(o){13===o.which&&(n.enviarMensagem(n.texto,1),o.preventDefault())})},n.keyboardMobileControl=function(o){"focus"==o.type&&f()},n.showEnviarLink=function(){var o=i.prompt().title("Envie o link para seu cliente").placeholder("Link").ariaLabel("Link").ok("enviar").cancel("sair");i.show(o).then(function(o){n.enviarMensagem(o,3)},function(){})},n.init=void n.preCondicoes()}]),angular.module("Proj").run(["$location","$rootScope","$http",function(o,e,t){e.$on("$locationChangeStart",function(o,e,a){var r=localStorage.getItem("token");null==r||t.defaults.headers.common.Authorization||(t.defaults.headers.common.Authorization=JSON.parse(window.atob(r)))})}]).factory("AuthFactory",["$q","$http","ApiCK",function(r,t,o){var n={},i="";function e(){return localStorage.getItem("token")}function a(){return localStorage.getItem("userdata")}function c(){var a,o,e;localStorage.setItem("userdata",window.btoa((a=JSON.stringify(n))?(o=Uint16Array.from({length:a.length},function(o,e){return a.charCodeAt(e)}),o=new Uint8Array(o.buffer),e="",o.forEach(function(o){e+=String.fromCharCode(o)}),e):null))}if(e()){var s=e();if(s&&"undefined"!==s&&""!==s){if(i=JSON.parse(window.atob(e())),a()){s=window.atob(a());try{(n=JSON.parse(s)).token=i}catch(o){(n=JSON.parse(function(a){var o,e;return a?(o=Uint8Array.from({length:a.length},function(o,e){return a.charCodeAt(e)}),o=new Uint16Array(o.buffer),e="",o.forEach(function(o){e+=String.fromCharCode(o)}),e):null}(s))).token=i}}d(n)}}function l(){localStorage.setItem("token",window.btoa(JSON.stringify(i))),c()}function d(o){var e,a=r.defer();return i=(n=o).token,l(),e=i,t.defaults.headers.common.Authorization=e,a.resolve(o),a.promise}return{login:d,get:function(){return n},getToken:function(){return i},getKeypass:function(){return i},updateUser:function(e){var a=r.defer();return t.get(o+"auth/"+e).success(function(o){o.token=e,d(o),a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},isLoggedIn:function(){if(i)return!0},logout:function(){var o=r.defer();return n={},i="",localStorage.removeItem("token"),localStorage.removeItem("userdata"),o.resolve(null),o.promise},aceitouPoliticas:function(){return localStorage.getItem("aceite_politicas")},aceitarPoliticas:function(){localStorage.setItem("aceite_politicas",!0)},darkModeIsOn:function(){return"true"==localStorage.getItem("darkmode")},enableDarkMode:function(){localStorage.setItem("darkmode",!0)},disableDarkMode:function(){localStorage.setItem("darkmode",!1)}}}]),angular.module("Proj").factory("LocationBackStore",["$cookies",function(e){var a={};return{set:function(o){a=o,e.putObject("locationback",a)},get:function(){return a=e.getObject("locationback")},clear:function(){a={},e.remove("locationback")}}}]).factory("UserStore",["$cookieStore",function(o){var t={},i=[];return{setBuscaRecente:function(o){var e=localStorage.getItem("userstore"),e=(null!=(t=null!=e?(t={},JSON.parse(e)):{}).buscasRecentes&&null!=t.buscasRecentes||(t.buscasRecentes=[]),t.buscasRecentes);e.indexOf(o)<0&&null!=o&&""!=o&&" "!=o&&e.push(o),t.buscasRecentes=e,localStorage.setItem("userstore",JSON.stringify(t))},getBuscaRecente:function(){var o=localStorage.getItem("userstore");if(null==o)return null;if(null==(t=JSON.parse(o))||null==t.buscasRecentes)return null;for(var o=t.buscasRecentes.length-1,e=[],a=4<=o?o-5:0,r=o;a<=r;r--)e.push(t.buscasRecentes[r]);return e},setLojaVs:function(o){var e=!1;return null!=(t=null==(t=JSON.parse(localStorage.getItem("userstore")))?{}:t).lojasvs&&null!=t.lojasvs||(t.lojasvs=[]),t.lojasvs.indexOf(o)<0&&(t.lojasvs.push(o),e=!0),localStorage.setItem("userstore",JSON.stringify(t)),e},setProdutoVs:function(o){var e=!1;return null!=(t=null==(t=JSON.parse(localStorage.getItem("userstore")))?{}:t).produtovs&&null!=t.produtovs||(t.produtovs=[]),t.produtovs.indexOf(o)<0&&(t.produtovs.push(o),e=!0),localStorage.setItem("userstore",JSON.stringify(t)),e},setDropView:function(e,o,a,r){try{var t=localStorage.getItem("dropview"),n=(i=null==t?new Array:JSON.parse(t),!0);return 12<=i.length&&i.shift(),(n=0<i.length&&null!=i.find(function(o){return o.id==e})?!1:n)&&((t={}).icone=o,t.id=e,t.titulo=a,t.query=r,i.push(t)),localStorage.setItem("dropview",JSON.stringify(i)),i}catch(o){}},getDropView:function(o){try{return null!=(i=JSON.parse(localStorage.getItem("dropview")))&&0<i.length?i.reverse():new Array}catch(o){}},clearAll:function(){geodata={},localStorage.setItem("userstores",null)}}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/produto/:id/denunciar",{controller:"DenunciaCtrl",templateUrl:"angular/app/denuncia/partials/denuncia.tpl.html"})}]).controller("DenunciaCtrl",["$scope","$rootScope","$mdDialog","$routeParams","LojaService","DenunciaService",function(e,o,a,r,t,n){e.produto={},e.denuncia={observacao:""},e.jaDenunciou=!1,e.carregandoProduto=!1,e.verificandoDenuncia=!1,e.denunciando=!1,e.erro=!1,e.minLengthDenuncia=20,e.carregarProduto=function(){r.id?(e.carregandoProduto=!0,t.obterProduto(r.id).then(function(o){e.produto=o.produto,e.verificarDenuncia()}).catch(function(o){console.error(o),e.erro=!0}).finally(function(){e.carregandoProduto=!1})):e.erro=!0},e.verificarDenuncia=function(){e.verificandoDenuncia=!0,n.verificarDenuncia(e.produto.id).then(function(o){e.jaDenunciou=o.jaDenunciou}).catch(function(o){console.error(o),e.erro=o}).finally(function(){e.verificandoDenuncia=!1})},e.denunciar=function(){e.denunciando=!0,n.denunciar(e.produto.id,e.denuncia.observacao).then(function(){e.jaDenunciou=!0,o.showToast("Você denunciou este produto"),o.voltarPagina()}).catch(function(){}).finally(function(){e.denunciando=!1})},e.denunciaValida=function(){return e.denuncia.observacao&&e.denuncia.observacao.length>=e.minLengthDenuncia},e.carregarProduto()}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/docs",{controller:"DocumentosCtrl",templateUrl:"angular/app/documentos/partials/docs.tpl.html",title:"Documentos"}).when("/documentos",{controller:"DocumentosCtrl",templateUrl:"angular/app/documentos/partials/docs.tpl.html",title:"Documentos"})}]).controller("DocumentosCtrl",["$scope","$rootScope","DocumentosService",function(e,a,o){e.carregando=!1,e.salvando=!1,e.erro=!1,e.portador="",e.isverificado=!1,e.docs={docFrente:null,docVerso:null,docSelfie:null},e.podeEnviarDocs=!1,e.carregarDocs=function(){e.carregando=!0,o.get().then(function(o){e.docs.docFrente=o.docFrente,e.docs.docVerso=o.docVerso,e.docs.docSelfie=o.docSelfie,e.podeEnviarDocs=o.podeEnviarDocs,e.portador=o.documento,e.isverificado=o.verifiedDocument}).catch(function(o){console.error(o),e.error=!0}).finally(function(){e.carregando=!1})},e.salvarDocs=function(){e.salvando=!0,o.save(e.docs).then(function(o){a.showToast("Suas informações foram atualizadas!")}).catch(function(o){console.error(o),e.erro=!0,a.showToast("Desculpe, isso não deu certo")}).finally(function(){e.salvando=!1})},e.selecionarDocFrente=function(){e.selecionarFoto(function(o){e.docs.docFrente=o,e.salvarAutomaticamente()})},e.selecionarDocVerso=function(){e.selecionarFoto(function(o){e.docs.docVerso=o,e.salvarAutomaticamente()})},e.selecionarDocFrente=function(){e.selecionarFoto(function(o){e.docs.docFrente=o,e.salvarAutomaticamente()})},e.selecionarDocVerso=function(){e.selecionarFoto(function(o){e.docs.docVerso=o,e.salvarAutomaticamente()})},e.selecionarDocSelfie=function(){e.selecionarFoto(function(o){e.docs.docSelfie=o,e.salvarAutomaticamente()})},e.salvarAutomaticamente=function(){e.docs.docFrente&&e.docs.docVerso&&e.docs.docSelfie&&e.salvarDocs()},e.selecionarFoto=function(e){a.showImageSelector(4e5,1720,!1).then(function(o){e(o)}).catch(function(o){console.error(o),a.showToast("Desculpe! Algo deu errado")})},e.carregarDocs()}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/enderecos",{controller:"EnderecoCtrl",templateUrl:"angular/app/endereco/partials/listar.tpl.html",tabControl:"Mais",title:"Endereços"}).when("/enderecos/:idEndereco/edit",{controller:"EnderecoCtrl",templateUrl:"angular/app/endereco/partials/view.tpl.html",tabControl:"Mais",title:"Editar endereço"}).when("/enderecos/create",{controller:"EnderecoCtrl",templateUrl:"angular/app/endereco/partials/view.tpl.html",tabControl:"Mais",title:"Criar endereço"}).when("/enderecos/create/compra/:idcompra",{controller:"EnderecoCtrl",templateUrl:"angular/app/endereco/partials/view.tpl.html",tabControl:"Mais",title:"Criar endereço"})}]).controller("EnderecoCtrl",["$scope","$rootScope","$routeParams","$window","$location","$filter","$mdDialog","EnderecoService","MapsService","AuthFactory",function(t,n,e,o,a,r,i,c,s,l){t.preCondicoes=function(){l.isLoggedIn()||(n.irPara("mais"),n.showToast("Erro ao obter endereços"))},t.user=l.get(),t.obterEnderecos=function(){t.carregando=!0,c.obterEnderecos(l.get().id).then(function(o){t.enderecos=o}).catch(function(o){n.showToast("Erro ao obter endereços")}).finally(function(){t.carregando=!1})},t.carregarEndereco=function(){var o=e.idEndereco;t.carregando=!0,o?(t.tipo="edit",c.obter(l.get().id,o).then(function(o){t.dados=o}).catch(function(o){n.voltarPagina(),n.showToast("Erro ao obter endereço")}).finally(function(){t.carregando=!1})):(t.tipo="create",t.carregando=!1)},t.autoFillByCep=function(o){t.carregandoCep=!1,null!=o&&7<o.length&&(t.carregandoCep=!0,c.decodeCepAPI(t.user.id,o).then(function(o){t.dados.logradouro=o.logradouro,t.dados.bairro=o.bairro,t.dados.cidade=o.cidade,t.dados.estado=o.estado,t.dados.pais="Brasil"}).catch(function(o){n.showToast("Não encontramos seu CEP")}).finally(function(){t.carregandoCep=!1}))},t.desativar=function(o,e,a){var r=i.confirm().title("Quer mesmo excluir esse endereço?").ariaLabel("Excluir endereço").ok("Sim").cancel("Não");i.show(r).then(function(){t.carregando=!0,c.desativar(l.get().id,o).then(function(o){n.showToast("Endereço excluído com sucesso")}).catch(function(o){t.carregando=!1,n.showToast("Erro ao excluir endereço")}).finally(function(){e&&n.voltarPagina(),a&&t.obterEnderecos()})},function(){})},t.setPrincipal=function(o){t.carregando=!0,c.setprincipal(l.get().id,o).then(function(o){n.showToast(o),t.obterEnderecos()}).catch(function(o){n.voltarPagina(),n.showToast("Ops, algo de errado aconteceu. Tente mais tarde.")}).finally(function(){t.carregando=!1})},t.salvarComCoordenadas=function(e){t.salvando=!0,s.geocode(e).then(function(o){e.latitude=o.lat,e.longitude=o.lng,t.salvar(e)}).catch(function(){t.salvar(e)})},t.salvar=function(o){t.salvando=!0,c.save(l.get().id,o).then(function(o){n.isDialog()?n.hideDialog():n.voltarPagina(),n.showToast("Endereço cadastrado com sucesso")}).catch(function(o){n.formErrorBinder(t,o)}).finally(function(){t.salvando=!1})},t.showEnderecoEntrega=function(o){t.carregandoShowEnderecoEntrega=!0,i.show({controller:"EnderecoCtrl",preserveScope:!0,scope:t,templateUrl:"angular/app/endereco/partials/addressDialog.tpl.html",parent:angular.element(document.body),clickOutsideToClose:!window.cordova}),c.obterEnderecoEntrega(o).then(function(o){t.enderecoEntrega=o}).catch(function(o){n.hideDialog(),n.showToast("Erro ao obter endereço de entrega")}).finally(function(){t.carregandoShowEnderecoEntrega=!1})}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/drops",{controller:"DropCtrl",templateUrl:"angular/app/drop/partials/list.tpl.html",tabControl:"Buscar",title:"Drops"}).when("/calendario",{controller:"CalendarioCtrl",templateUrl:"angular/app/drop/partials/calendario.tpl.html",tabControl:"Buscar",title:"Calendário"}).when("/d/:id",{controller:"DropCtrl",templateUrl:"angular/app/drop/partials/dropcomplete.tpl.html",tabControl:"Busca"}).when("/d/:id/:q/old",{controller:"DropCtrl",templateUrl:"angular/app/drop/partials/drop.tpl.html",tabControl:"Busca"}).when("/d/:id/:q",{controller:"DropCtrl",templateUrl:"angular/app/drop/partials/dropV2.tpl.html",tabControl:"Drop"})}]).controller("DropCtrl",["$rootScope","$scope","$location","$window","$timeout","$mdMedia","DropService","$routeParams","$mdDialog","BuscarService","UserStore","AuthFactory","CkViewUtils","CkViewState","ckFacebookPixelService","ckTagManagerService","ckGliderHelper","ckComp","ckPreloadModel","CkHttpCache",function(i,c,o,e,a,r,s,t,n,l,d,u,p,f,m,g,h,v,w,C){c.initGraficoVendas=function(){v.load("chart.js").then(function(o){try{c.selecionarPeriodo("tudo")}catch(o){c.showGrafico=!1}})},c.$mdMedia=r,c.IMG_PLACEHOLDER="angular/img/lazy.png",c.lista=[],c.page=0,c.amount=50,c.sliderHeight=1e3,c.sliderWidth=1e3,c.tipo="drops",c.showMais=!0,c.dataSliderPrincipal={},c.dataSlider=[],c.carregandoExtraInfo=!0,c.carregandoSizeEspecifico=!1,c.carregandoModelViewer=!1,c.dropsRelacionados=[],c.dropsVisualizados=[],c.showRelacionados=!1,c.showVisualizador3dMobile=!1,c.showVisualizador3dDestop=!1,c.listapesquisa=[],c.graficoVendas="",c.dadosGrafico=[],c.listaDataGrafico=[],c.listaDataCompletaGrafico=[],c.listaMediaGrafico=[],c.listaMediaGraficoTxt=[],c.graficoExpandido=!1,c.isEletronico=!1,c.eletronicoView=!1,c.corEletronicoSelecionada={},c.modeloExtrainfo={},c.outrasCores=[],c.isLogado=u.isLoggedIn();var b=o.path();function S(){c.carregando3d=!0,c.err3d=!1;var o,r;o=c.dados.drop.modelo3d,r=function(o,e){c.modeldata.progress=o/e*100,c.$apply()},new Promise(function(e,a){C.fetch(o,{onprogress:r,ignoreCache:!0}).then(function(o){o=o.localurl;e(o)}).catch(function(o){a(o)})}).then(function(o){c.modeldata.url=o,v.load("model-viewer.min.js")}).catch(function(o){c.err3d=!0,console.error("3D FETCH",o)}).finally(function(){c.carregando3d=!1,c.$apply()})}c.carregarDrops=function(){var o;c.$on("$destroy",function(){var o={scope:c,scroll:{x:window.scrollX,y:window.scrollY},path:b};f.calendario(o)}),(o=f.calendario())&&o.changed&&o.path===b&&(f.restoreScope(o.scope,c),o.scroll&&window.setTimeout(function(){window.scroll(o.scroll.x||0,o.scroll.y||0)},300),1)||(c.tipo="drops",c.carregando=!0,c.page=0,c.amount=50,s.obterDrops(0,50).then(function(o){c.lista=o}).catch(function(o){}).finally(function(){c.carregando=!1}))},c.carregarMaisDrops=function(){c.carregandoMais=!0,c.page=c.page+1,s.obterDrops(c.page,c.amount).then(function(o){c.lista=c.lista.concat(o),o.length<c.amount&&(c.showMais=!1)}).catch(function(o){}).finally(function(){c.carregandoMais=!1})},c.carregarDrop=function(){window.scrollTo(0,0),window.onscroll=function(){var o=p.estaSendoVisto("#btn-drop-loadsearch");!c.carregando&&o&&c.subPesquisa()},window.onresize=function(){c.ajustarLarguraGrafico()},c.carregando=!0,c.erro=!1,c.isNovo=!0,c.idDrop=t.id;function e(o){c.dados=o,c.dadosBKP=angular.copy(o),i.changePageTitle(o.drop.titulo),c.carregando=!1,c.isEletronico=o.drop.isEletronico,c.eletronicoView=c.isEletronico&&!!o.drop.modelo3d&&!!o.drop.temColecaoImagens,o.drop.temColecaoImagens&&(r=o.drop.colecaoImagens[0],e=o.drop.colecaoImagens.slice(0),c.dataSliderPrincipal={src:r},angular.forEach(e,function(o,e){c.dataSlider[e]={},c.dataSlider[e].src=o}),c.eletronicoView)&&S(),c.carregarExtraInfo(o.drop),c.carregarLapses(o.drop);var e,a,r,t=o.drop;try{c.carregandoExtraInfoModelo=!0,s.carregarExtraInfoModelo(t).then(function(o){c.modeloExtrainfo=o,c.outrasCores=function(e,o){try{return(o.drops||[]).map(function(o){return{url:o.url,cor:o.cor.nome,hex:o.cor.hex,vendo:o.cor.key===e.dadosCorPrincipal.key}}).filter(function(o){return!!o.cor&&!!o.cor})}catch(o){return console.error(o),[]}}(t,c.modeloExtrainfo)}).catch(function(o){console.error(o)}).finally(function(){c.carregandoExtraInfoModelo=!1})}catch(o){console.error("EXTRAINFO",o)}window.IntersectionObserver?(a=new IntersectionObserver(function(o){o.forEach(function(o){o.isIntersecting&&(o=o.target,c.initGraficoVendas(),a.unobserve(o))})},{rootMargin:"0px",threshold:1}),r=document.querySelector("#chartVendas"),a.observe(r)):c.initGraficoVendas(),d.setDropView(c.idDrop,c.dados.drop.icone,c.dados.drop.titulo,c.dados.drop.query);try{var n=c.dados.drop;g.dropDetail("",""+n.id,n.titulo,"","","",n.nomeMarca)}catch(o){}}var o;w.hasPreloaded("drop_complete")?(o=w.get(),e(o),w.clear()):s.obterDropCompletoV5(c.idDrop).then(function(o){e(o)}).catch(function(o){c.erro=!0,c.carregando=!1})},c.observeImg=function(o){document.getElementById(o)},c.updateSlideDimensions=function(){corrigirTamanhoSlider(c.dataSlider)},c.carregarGliderOnImgLoad=function(o,e){c.gliderDropV2||o&&o.length&&("glider-img0"!==o[0].id||c.eletronicoView||(o=document.querySelector(e))&&(c.gliderDropV2=new Glider(o,{draggable:!0,slidesToScroll:1,slidesToShow:1,scrollLock:!0,resizeLock:!0,dragVelocity:.8,rewind:!0}),h.setAutoSlide(c.gliderDropV2,o,5e3)))},c.filtrarSize=function(){if(0==c.dados.sizes.length)return[];c.dados.sizes.forEach(function(a,o){a.produtosNovos=[],a.produtosUsados=[],a.produtosActive=[],a.temProdutos&&a.produtos.forEach(function(o,e){(o.isNovo?a.produtosNovos:a.produtosUsados).push(o),a.produtosActive=c.isNovo?a.produtosNovos:a.produtosUsados})})},c.changeFilter=function(){c.isNovo?c.dados.sizes=angular.copy(c.dadosBKP.sizes):c.dados.sizes=angular.copy(c.dadosBKP.sizesUsados)},c.dataSizeDialog={},c.showSizeDialog=function(o,e,a){c.carregandoSizeEspecifico=!0,c.dataSizeDialog.novos={},c.dataSizeDialog.usados={},c.dataSizeDialog.size=e,s.obterAnunciosDoTamanhoV4(e.idDrop,e.id).then(function(o){c.dataSizeDialog.novos=o.novos,c.dataSizeDialog.usados=o.usados}).finally(function(){c.carregandoSizeEspecifico=!1}),n.show({templateUrl:"angular/app/drop/partials/dropSizeDialog.tpl.html",parent:angular.element(document.body),scope:c,preserveScope:!0,clickOutsideToClose:!window.cordova})},c.pageSubPesquisa=0,c.amountSubPesquisa=12,c.totalProdutos=null,c.listapesquisa=[],c.subPesquisaAconteceu=!1,c.subPesquisaTemMais=!1,c.subPesquisa=function(){!c.dados.drop||c.pesquisando||0!=c.listapesquisa.length||c.subPesquisaAconteceu||(c.pesquisando=!0,s.obterProdutos(c.dados.drop.id,c.pageSubPesquisa,c.amountSubPesquisa).then(function(o){c.listapesquisa=o.produtos,c.totalProdutos=o.totalProdutos,c.subPesquisaTemMais=!!o.produtos.length}).finally(function(){c.pesquisando=!1,c.subPesquisaAconteceu=!0}))},c.carregarMaisSubPesquisa=function(){c.carregandoMais=!0,c.pageSubPesquisa=c.pageSubPesquisa+1,s.obterProdutos(c.dados.drop.id,c.pageSubPesquisa,c.amountSubPesquisa).then(function(o){c.listapesquisa=c.listapesquisa.concat(o.produtos),c.subPesquisaTemMais=!!o.produtos.length}).finally(function(){c.carregandoMais=!1})},c.carregarExtraInfo=function(a){c.carregarExtraInfo=!0,s.obterExtraInfo(a.id).then(function(o){null!=o.relacionados&&0<o.relacionados.length&&(c.showRelacionados=!0,c.dropsRelacionados=o.relacionados);var e,o=d.getDropView(a.id);null!=a.id&&0<a.id&&-1<(e=o.findIndex(function(o){return o.id==a.id}))&&o.splice(e,1),c.dropsVisualizados=o}).catch(function(o){c.showRelacionados=!1}).finally(function(){c.carregarExtraInfo=!1})},c.carregarLapses=function(o){s.obterLapses(o.id).then(function(o){c.temLapses=!!o&&!!o.lapses&&!!o.lapses.length})},c.showAlertSizeDialog=function(o){c.showAlertSizeDialogData={},c.showAlertSizeDialogData.totalAtivos=0,c.showAlertSizeDialogData.tamanhosDisponiveis=angular.copy(c.dados.tamanhosTipoProduto),c.showAlertSizeDialogData.tamanhosAlertasUsuarioAtivo=[],c.showAlertSizeDialogData.carregandoSizes=!0,c.isLogado&&s.obterAlertasAtivosUsuario(u.get().id,c.idDrop).then(function(o){c.showAlertSizeDialogData.totalAtivos=0,c.showAlertSizeDialogData.tamanhosAlertasUsuarioAtivo=o}).catch(function(o){c.showToast("Ops, ocorreu algum erro ao carregar seus alertas nesse drop. Tente novamente mais tarde.")}).finally(function(){c.showAlertSizeDialogData.carregandoSizes=!1});try{var e=c.dados.drop;g.notifyMeInteraction("DropView",e.id,e.titulo,e.retail)}catch(o){console.error("ANALYTICS",o)}n.show({templateUrl:"angular/app/drop/partials/dropAlertSizeDialog.tpl.html",parent:angular.element(document.body),targetEvent:o,scope:c,preserveScope:!0,clickOutsideToClose:!window.cordova})},c.toggleAlerta=function(e){var o,a,r;c.isLogado?(e.tooglando=!0,c.dados.id,o=u.get().id,a=e.id,(r={}).idDrop=c.idDrop,r.idUsuario=o,r.idTamanhoProduto=a,r.preco=null,s.toogleAlertaUsuarioDropTamanho(r).then(function(o){e.isAtivo=o.isAtivo}).catch(function(o){alert("Ops, algo de errado aconteceu! ")}).finally(function(){c.carregarExtraInfo,e.tooglando=!1,c.contarAtivos()})):i.showToast("Não é possível ligar alertas deslogado!")},c.verificarAlertaAtivo=function(o){null!=c.showAlertSizeDialogData.tamanhosAlertasUsuarioAtivo&&0<c.showAlertSizeDialogData.tamanhosAlertasUsuarioAtivo.length&&-1<c.showAlertSizeDialogData.tamanhosAlertasUsuarioAtivo.indexOf(o.id)&&(o.isAtivo=!0,c.contarAtivos())},c.contarAtivos=function(){c.showAlertSizeDialogData.totalAtivos=0,angular.forEach(c.showAlertSizeDialogData.tamanhosDisponiveis,function(o,e){1==o.isAtivo&&c.showAlertSizeDialogData.totalAtivos++})},c.obterVendasRelatorio=function(o,e){try{s.obterVendasRelatorio(c.idDrop,o,e).then(function(o){c.dadosGrafico=o;try{0<c.listaDataGrafico.length&&(c.listaDataGrafico=[],c.listaDataCompletaGrafico=[]),0<c.listaMediaGrafico.length&&(c.listaMediaGrafico=[],c.listaMediaGraficoTxt=[]);for(var e=0;e<c.dadosGrafico.length;e++)c.listaDataGrafico.push(c.dadosGrafico[e].dataFormatada),c.listaMediaGrafico.push(c.dadosGrafico[e].mediaNumerica),c.listaMediaGraficoTxt.push(c.dadosGrafico[e].mediaFormatada),c.listaDataCompletaGrafico.push(c.dadosGrafico[e].dataCompleta);if(0===c.listaMediaGrafico.length)c.isGraficoZerado=!0;else{for(var a=!0,e=0;e<c.listaMediaGrafico.length;e++)if(c.listaMediaGrafico[e]){a=!1;break}c.isGraficoZerado=a}!function(){try{var o=document.getElementById("chartVendas");c.graficoVendas&&c.graficoVendas.destroy(),c.graficoVendas=new Chart(o,{type:"line",data:{labels:c.listaDataGrafico,datasets:[{data:c.listaMediaGrafico,backgroundColor:["rgba(0, 0, 0, 0.4)"],borderColor:["rgba(0, 0, 0, 1)"],borderWidth:1,fill:!0}]},options:{responsive:!0,elements:{point:{radius:1}},interaction:{mode:"index",intersect:!1},plugins:{tooltip:{callbacks:{label:function(o){o=o.dataIndex;return c.listaMediaGraficoTxt[o]},title:function(o){o=o[0].dataIndex;return c.listaDataCompletaGrafico[o]}}},text:function(o){o=o.chart.options.interaction;return"Mode: "+o.mode+", axis: xy, intersect: "+o.intersect},legend:{display:!1}},scales:{y:{beginAtZero:!1,ticks:{callback:function(o,e,a){return"R$ "+Math.round(o).toString()},maxTicksLimit:5},grid:{display:!1}},xAxis:{ticks:{maxTicksLimit:4,maxRotation:0,minRotation:0},grid:{display:!1}}}}}),c.showGrafico=!0}catch(o){c.showGrafico=!1}}()}catch(o){c.showGrafico=!1}}).catch(function(o){}).finally(function(){c.carregandoGrafico=!1})}catch(o){c.showGrafico=!1}},c.selecionarPeriodo=function(o){try{c.carregandoGrafico=!0,c.opcoes=[{nome:"hoje",descricao:"Hoje"},{nome:"ontem",descricao:"Ontem"},{nome:"ultimasemana",descricao:"Última semana"},{nome:"ultimomes",descricao:"Último mês"},{nome:"ultimoano",descricao:"Último ano"},{nome:"tudo",descricao:"Tudo"}],c.periodo=o||"hoje",c.obterVendasRelatorio(c.periodo)}catch(o){c.showGrafico=!1}},c.expandirGrafico=function(){c.graficoExpandido=!c.graficoExpandido,c.ajustarLarguraGrafico()},c.ajustarLarguraGrafico=function(){var o,e,a=document.getElementById("grafico-vendas"),r=document.getElementById("container");a&&(r&&c.graficoExpandido?(o=(e=getComputedStyle(r)).getPropertyValue("padding-left"),e=e.getPropertyValue("padding-right"),o=parseFloat(o),e=parseFloat(e),a.style.width=r.clientWidth-o-e+"px"):a.style.width="100%")},c.modeldata={url:"",progress:0},c.toggleShowVisualizador3dMobile=function(){c.showVisualizador3dMobile=!c.showVisualizador3dMobile,c.showVisualizador3dMobile&&S()},c.toggleShowVisualizador3dDesktop=function(){c.showVisualizador3dDesktop=!c.showVisualizador3dDesktop,c.showVisualizador3dDesktop&&S()},c.dimensionarView3dDepr=function(o){var e=document.querySelector(o),o=document.querySelector(o+" model-viewer");e&&o?(e=e.clientWidth,o.style.width=e+"px",o.style.height=e+"px"):console.error("ERRO AO CARREGAR O MODELO 3D")},c.dimensionarView3d=function(o){var e=o+" model-viewer",a=null,r=null;p.esperarElemento(o,o=>0<o.clientWidth).then(function(o){return a=o,p.esperarElemento(e)}).then(function(o){r=o,a&&r&&(o=a.clientWidth,r.style.width=o+"px",r.style.height=o+"px")}).catch(function(o){})},c.retry3d=function(o){S()},c.verLapses=function(){c.exibindoLapses=!c.exibindoLapses},c.onLapsesFinish=function(){c.exibindoLapses=!1,c.$apply()},c.selecionarCorEletronico=function(o){o&&(c.corEletronicoSelecionada=o)},c.verFichaTecnica=function(o){try{n.show({controller:"FichaTecnicaCtrl",templateUrl:"angular/app/drop/partials/fichaTecnica.tpl.html",parent:angular.element(document.body),targetEvent:o,clickOutsideToClose:!window.cordova,locals:{drop:c.dados.drop,fichaTecnica:(c.modeloExtrainfo||{}).fichaTecnica}}).then(function(){})}catch(o){}},c.verMaisAnunciosDialog=function(o,e,a){n.show({controller:"DropMaisAnunciosCtrl",templateUrl:"angular/app/drop/partials/dropMaisAnuncios.tpl.html",clickOutsideToClose:!window.cordova,locals:{dialogData:{dadosDrop:c.dados,size:e,isNovo:a}}}).then(function(){})}}]).controller("GuiaTamanhoCtrl",["$rootScope","$scope","$location","$mdMedia","$routeParams","$mdDialog",function(o,e,a,r,t,n){e.showGuiaTamanhos=function(o){e.idMarcaGuiaTamanho=o,e.arrayDeTamanhosGuia=[],1!=e.idMarcaGuiaTamanho&&3!=e.idMarcaGuiaTamanho||(e.arrayDeTamanhosGuia=e.tamanhosNikeJordan),4==e.idMarcaGuiaTamanho&&(e.arrayDeTamanhosGuia=e.tamanhosAdidas),2==e.idMarcaGuiaTamanho&&(e.arrayDeTamanhosGuia=e.tamanhosAdidas),n.show({templateUrl:"angular/app/drop/partials/guiaTamanhoDialog.tpl.html",parent:angular.element(document.body),scope:e,preserveScope:!0,clickOutsideToClose:!window.cordova})},e.tamanhosNikeJordan=[{cm:"22",m:"",f:"33,5"},{cm:"22,5",m:"",f:"34"},{cm:"23",m:"",f:"35"},{cm:"23,5",m:"36",f:"35,5"},{cm:"24",m:"37",f:"36"},{cm:"24,5",m:"37,5",f:"37"},{cm:"25",m:"38",f:"37,5"},{cm:"25,5",m:"39",f:"38"},{cm:"26",m:"39,5",f:"39"},{cm:"26,5",m:"40",f:"39,5"},{cm:"27",m:"40,5",f:"40"},{cm:"27,5",m:"41",f:"40,5"},{cm:"28",m:"42",f:"41"},{cm:"28,5",m:"42,5",f:"42"},{cm:"29",m:"43",f:"42,5"},{cm:"30",m:"44",f:""},{cm:"30,5",m:"45",f:""},{cm:"31,5",m:"46",f:""},{cm:"32,5",m:"47",f:""},{cm:"33,5",m:"48",f:""}],e.tamanhosAdidas=[{cm:"22,5",m:"",f:"34"},{cm:"23",m:"",f:"35"},{cm:"24",m:"37",f:"36"},{cm:"24,5",m:"",f:"37"},{cm:"25",m:"38",f:"38"},{cm:"25,5",m:"39",f:"39"},{cm:"26,5",m:"40",f:"40"},{cm:"27,5",m:"41",f:""},{cm:"28",m:"42",f:""},{cm:"29",m:"43",f:""},{cm:"30",m:"44",f:""},{cm:"30,5",m:"45",f:""}],e.tamanhosYeezy=[{cm:"22,5",m:"",f:"34"},{cm:"23",m:"",f:"35"},{cm:"24",m:"37",f:"36"},{cm:"24,5",m:"",f:"37"},{cm:"25",m:"38",f:"38"},{cm:"25,5",m:"39",f:"39"},{cm:"26,5",m:"40",f:"40"},{cm:"27,5",m:"41",f:""},{cm:"28",m:"42",f:""},{cm:"29",m:"43",f:""},{cm:"30",m:"44",f:""},{cm:"30,5",m:"45",f:""}]}]).controller("CalendarioCtrl",["$rootScope","$scope","$location","$window","$timeout","$mdMedia","DropService","$routeParams","$mdDialog","BuscarService","UserStore","AuthFactory","CkViewUtils","CkViewState","ckFacebookPixelService","ckTagManagerService",function(o,r,e,a,t,n,i,c,s,l,d,u,p,f,m,g){r.$mdMedia=n,r.lista=[],r.page=0,r.amount=100,r.anoSelecionado=(new Date).getFullYear(),r.mesSelecionado=(new Date).getMonth()+1,r.temMais=!1,r.totalDrops=0;var h="/calendario"===e.path();r.$on("$destroy",function(){var o;h&&(o={scope:r,scroll:{x:window.scrollX,y:window.scrollY}},f.calendario(o))}),r.carregarCalendario=function(){window.onscroll=function(){p.estaSendoVisto("#trigger-calendario-paginacao")&&!r.carregandoDrops&&r.carregarMais()},r.carregando=!0;var o=f.calendario();h&&o&&o.changed?(f.restoreScope(o.scope,r),window.setTimeout(function(){window.scroll(o.scroll.x,o.scroll.y),r.scrollFiltroMeses()},300)):(i.obterDatasCalendario().then(function(o){r.dates=o,r.carregando=!1,r.scrollFiltroMeses()}).catch(function(){r.erro=!0}).finally(function(){r.carregando=!1}),r.filtrar(r.mesSelecionado,r.anoSelecionado,"maisvistos"))},r.filtrar=function(o,e,a){r.mesSelecionado=o,r.anoSelecionado=e,r.filtro=a,r.page=0,r.carregandoDrops=!0,r.drops=[],i.obterCalendarioDrops(r.page,r.amount,r.filtro,r.mesSelecionado,r.anoSelecionado).then(function(o){setTimeout(function(){r.drops=o.drops,r.$apply()},200),r.temMais=o.temMais,r.totalDrops=o.total}).catch(function(o){r.erro=!0}).finally(function(){r.carregandoDrops=!1})},r.carregarMais=function(){r.carregandoDrops=!0,r.page++,i.obterCalendarioDrops(r.page,r.amount,r.filtro,r.mesSelecionado,r.anoSelecionado).then(function(o){r.drops=r.drops.concat(o.drops),r.temMais=o.temMais}).catch(function(o){r.erro=!0}).finally(function(){r.carregandoDrops=!1})},r.scrollFiltroMeses=function(){r.$mdMedia("xs")&&7<=r.mesSelecionado&&$(document).ready(function(){$("#ck-calendar--filtro-meses").scrollLeft(1e4)})}}]).controller("FichaTecnicaCtrl",["$rootScope","$scope","$mdDialog","$mdMedia","drop","fichaTecnica",function(o,e,a,r,t,n){e.$mdMedia=r,e.drop=t||{},e.fichaTecnica=n||[],e.destaques=e.fichaTecnica.filter(o=>o.icone&&o.destacar),e.caracteristicasTecnicas=[{nome:"CÂMERA FRONTAL",descricao:"",tipo:"texto",unidade:"13 MP"},{nome:"CÂMERA TRASEIRA",descricao:"",tipo:"texto",unidade:"13 MP"},{nome:"BATERIA",descricao:"",tipo:"texto",unidade:"13 MP"},{nome:"SISTEMA OPERACIONAL",descricao:"",tipo:"texto",unidade:"IOS 14"}]}]).controller("DropMaisAnunciosCtrl",["$rootScope","$scope","$mdDialog","$mdMedia","dialogData","DropService",function(o,e,a,r,t,n){var i=t.dadosDrop,c=t.size,t=t.isNovo;e.novos={},e.usados={},e.unificado=[],e.fotos=[],e.dadosDrop=i,e.size=c,e.isNovo=t,e.carregando=!1,e.mdMedia=r,e.showListaDetalhada=!0,e.trocaExibicaoLista=function(){e.showListaDetalhada=!e.showListaDetalhada},e.carregando=!0,e.novos={},e.usados={},e.size=c,n.obterAnunciosDoTamanhoV4(c.idDrop,c.id).then(function(o){e.novos=o.novos,e.usados=o.usados,e.unificado=(o.novos.produtos||[]).concat(o.usados.produtos||[]),e.unificado.forEach(function(o){var e=o.fotosSecundarias.map(o=>o.link);o.fotos=[o.linkfoto].concat(e)}),e.lista1=[],e.lista2=[],e.isNovo?(e.lista1=e.novos.produtos,e.lista2=e.usados.produtos):(e.lista1=e.usados.produtos,e.lista2=e.novos.produtos)}).finally(function(){e.carregando=!1}),e.fecharDialogo=function(){console.log("FECHAR DIALOGO"),e.mostrando=!1,setTimeout(function(){o.hideDialog()},100)}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/erro/404",{controller:"ErroCtrl",templateUrl:"angular/app/erro/partials/erro.tpl.html",tabControl:"Mais",title:"Ops, ocorreu algum erro"}).when("/erro/loginfacebook",{controller:"ErroCtrl",templateUrl:"angular/app/erro/partials/errologinfacebook.tpl.html",tabControl:"Mais",title:"Erro ao entrar"})}]).controller("ErroCtrl",["$scope","$location",function(o,e){}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/proposta",{controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/proposta.tpl.html",tabControl:"Mais",title:"Proposta"}).when("/termos",{controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/termos.tpl.html",tabControl:"Mais",title:"Termos de uso"}).when("/termos/embed",{controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/termos.tpl.html",tabControl:"Mais",title:"Termos de uso"}).when("/privacidade",{controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/privacidade.tpl.html",tabControl:"Mais",title:"Políticas de privacidade"}).when("/get",{controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/get.tpl.html",tabControl:"Mais",title:"Termos"}).when("/about",{controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/anuncieconosco.tpl.html",tabControl:"Mais",title:"Sobre nós"}).when("/atendimento",{controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/atendimento.tpl.html",tabControl:"Mais",title:"Atendimento"}).when("/dicas",{controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/dicas.tpl.html",tabControl:"Home",title:"Dicas"}).when("/version",{controller:"VersionCtrl",templateUrl:"angular/app/geral/partials/version.tpl.html",tabControl:"Mais",title:"Version"}).when("/app/:plataforma",{controller:"VersionCtrl",templateUrl:"angular/app/geral/partials/app.tpl.html",tabControl:"Mais",title:"Baixe a app"}).when("/comofunciona",{controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/ajuda/howitworks.tpl.html",tabControl:"Mais",title:"Como o Droper funciona"}).when("/comocomprar",{controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/ajuda/comocomprar.tpl.html",tabControl:"Mais",title:"Como comprar"}).when("/compraautenticada",{controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/ajuda/compraautenticada.tpl.html",tabControl:"Mais",title:"Compra PRO"}).when("/comprapro",{controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/ajuda/compraautenticada.tpl.html",tabControl:"Mais",title:"Compra PRO"}).when("/comovender",{controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/ajuda/comovender.tpl.html",tabControl:"Mais",title:"Como vender"}).when("/envios",{controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/ajuda/envios.tpl.html",tabControl:"Home",title:"Tire suas dúvidas sobre envios"}).when("/problemas",{controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/ajuda/problemas.tpl.html",tabControl:"Mais",title:"Guia de resolução de problemas"}).when("/trocasdevolucoes",{controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/ajuda/trocas.tpl.html",tabControl:"Trocas e Devoluções",title:"Trocas e devoluções"}).when("/trocas",{controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/ajuda/trocas.tpl.html",tabControl:"Mais",title:"Trocas e devoluções"}).when("/autenticidade",{controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/ajuda/autenticidade.tpl.html",tabControl:"Mais",title:"Seu produto 100% original"}).when("/sobrenos",{controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/aboutUs.tpl.html",title:"Sobre nós"}).when("/store/shoppingcidadejardim",{controller:"ScjCtrl",templateUrl:"angular/app/geral/partials/shoppingCidadeJardins.tpl.html",title:"Droper loja"}).when("/scj",{controller:"ScjCtrl",templateUrl:"angular/app/geral/partials/shoppingCidadeJardins.tpl.html",title:"Droper loja"}).when("/linktree",{controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/linktree.tpl.html"})}]).controller("MenuCtrl",["$scope","$rootScope","$timeout","$mdSidenav",function(o,e,a,r){o.clienteislogado=!1,o.lojaislogado=!1,o.toggleLeft=function(){o.refreshSessionSidenav(),r("right").toggle()},o.refreshSessionSidenav=function(){o.clienteislogado=e.isClienteLogado(),o.lojaislogado=e.isLojaLogado()}}]).controller("GeralCtrl",["$scope","$rootScope","$location","$mdDialog","$mdMedia","mpTaxa","mpTaxaDesc","GeralService","MarketService","$mdBottomSheet","AuthFactory",function(e,a,o,r,t,n,i,c,s,l,d){e.$mdMedia=t,e.mpTaxa=n,e.mpTaxaDesc=i,e.isEmbed=-1!=o.path().indexOf("/embed"),-1!==o.path().indexOf("comovender")&&s.obterTaxa().then(function(o){e.mpTaxa=o.taxa,e.mpTaxaDesc=o.taxaApresentacao}),e.showDicas=function(){r.show({controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/dicasDialog.tpl.html",parent:angular.element(document.body),preserveScope:!0,fullscreen:!0,clickOutsideToClose:!window.cordova}).then(function(){},function(){})},e.showFormasPagamento=function(){r.show({controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/ajuda/compraFormaPagamentoDialog.tpl.html",preserveScope:!0,fullscreen:!1,clickOutsideToClose:!window.cordova}).then(function(){},function(){})},e.enviarDuvida=function(o){e.erro=!1,e.carregandoEnvio=!0,e.duvidaEnviada=!1,c.enviarDuvida(o).then(function(o){e.duvidaEnviada=!0}).catch(function(o){e.erro=!0}).finally(function(o){e.carregandoEnvio=!1})},e.showDarkModeSelect=function(){r.show({controller:"GeralCtrl",templateUrl:"angular/app/geral/partials/selectdarkmodedialog.tpl.html",parent:angular.element(document.body),preserveScope:!0,fullscreen:!1,clickOutsideToClose:!window.cordova}).then(function(){},function(){})},e.avaliacao={},a.showAvaliacaoRapida=function(o){a.avaliacaoSheetBottom={},a.avaliacaoSheetBottom=o,l.show({templateUrl:"angular/app/geral/partials/avaliacaoBottomSheet.tpl.html",controller:"GeralCtrl",preserveScope:!0,disableParentScroll:!0,clickOutsideToClose:!window.cordova}).then(function(){},function(){}),a.enviarAvaliacao=function(o){a.avaliacaoSheetBottom.enviando=!0,a.avaliacaoSheetBottom.enviadoSucesso=!1;var e={};e.estrelas=o.estrelas,o.Produto.Vendedor.isLoja?e.idLoja=o.Produto.Vendedor.idLoja:e.idClienteVendedor=o.Produto.Vendedor.idCliente,e.idCliente=d.get().idCliente,a.avaliacaoSheetBottom.enviando=!1,a.avaliacaoSheetBottom.enviadoSucesso=!0,c.enviarAvaliacao(o.id,e).then(function(o){a.avaliacaoSheetBottom.enviando=!1,a.avaliacaoSheetBottom.enviadoSucesso=!0}).catch(function(o){a.hideBottomSheet(),a.showToast(o||"Ops, algo de errado aconteceu")})}},e.isAndroid=function(){var o=navigator.userAgent.match(/Android/i);navigator.userAgent.match(/iPhone|iPad|iPod/i);return o}}]).controller("VersionCtrl",["$scope","$rootScope","$window","$routeParams","$location","$mdDialog","$mdMedia","GeralService","urlGooglePlay","urlAppStore",function(e,a,r,t,o,n,i,c,s,l){e.carregarVersao=function(){e.carregando=!0,e.platform="...",e.erro=!1,window.cordova?window.cordova.getAppVersion.getVersionNumber().then(function(o){e.version=o,e.$apply(),e.platform=window.device.platform,e.checkVersion()}):(e.carregando=!1,e.version="0.0.0",e.platform="PC")},e.checkVersion=function(){c.checkVersion().then(function(o){e.isupdated=o.updated,e.msgpdated=o.msg}).catch(function(o){}).finally(function(o){e.carregando=!1,e.erro=!0})},e.irParaAtualizacao=function(){var o=window.device.platform.toLowerCase();"android"==o&&window.open(s,"_blank"),"ios"==o&&window.open(l,"_blank")},e.redirecionarBaixarApp=function(){var o=t.plataforma.toLowerCase();"android"==o?a.isCordova()?r.open(s,"_system"):r.open(s,"_blank"):"ios"==o&&(a.isCordova()?r.open(l,"_system"):r.open(l,"_blank")),a.voltarPagina()},e.openInapp=function(){var o,e;window.cordova&&(o="","android"==(e=window.cordova.platformId)&&(o+="location=no"),"ios"==e&&(o+="location=yes"),window.cordova.InAppBrowser.open("https://droper.app","_blank",o))},e.dados={}}]).run(["GeralService","$mdToast",function(o,e){window.cordova&&document.addEventListener("deviceready",function(){window.cordova&&o.checkVersion().then(function(o){o.updated||e.show({hideDelay:5e3,position:"top right",controller:"CatalokoCtrl",templateUrl:"angular/app/geral/partials/updateAlert.tpl.html"})}).catch(function(o){})},!1)}]).controller("ScjCtrl",["$scope","$rootScope","$routeParams","GeralService","AppleMapKit","$mdMedia",function(a,o,e,r,t,n){function i(){var o;window.mapkit?((o=document.getElementById("loja-map"))&&!a.map&&window.mapkit&&(a.map=new mapkit.Map(o,{showsMapTypeControl:!1,showsCompass:mapkit.FeatureVisibility.Hidden}),a.carregandoMapa=!1,a.verMapa=!0,a.iniciado=!0,a.map&&(o=[],a.marcadores.loja&&(o.push(a.marcadores.loja),a.marcadores.loja=null),a.map.removeItems(o)),a.map)&&window.mapkit&&window.mapkit.Coordinate&&window.mapkit.MarkerAnnotation&&(o=new mapkit.Coordinate(a.dadosLojaFisica.endereco.latitude,a.dadosLojaFisica.endereco.longitude),a.marcadores.loja=new mapkit.MarkerAnnotation(o,{color:"#000000",title:"Droper Concept Store",subtitle:"Loja"}),o=[],a.marcadores.loja&&o.push(a.marcadores.loja),a.map.showItems(o,{animate:!1,minimumSpan:new mapkit.CoordinateSpan(.03,.03)}),a.map.setCameraDistanceAnimated(7e3)),a.mapKitIniciado||mapkit.init({authorizationCallback:function(e){t.fetchJWT().then(function(o){e(o.token),a.mapkitIniciado=!0}).catch(function(o){console.error(o),a.erroMapa=!0}).finally(function(){a.carregandoMapa=!1})},language:"pt-BR"})):(a.erroMapa=!0,a.carregandoMapa=!1)}a.$mdMedia=n,a.dadosLojaFisica=[],a.map=null,a.marcadores={origem:null,destino:null,loja:null},a.dadosLojaCidadeJardins=function(){a.obtendoDados=!0,r.obterShoppingCidadeJardins().then(function(o){a.dadosLojaFisica=o}).catch(function(o){console.error("Erro ao tentar obter dados",o)}).finally(function(){a.obtendoDados=!1})},a.carregarMapa=function(){a.iniciando||(a.carregandoMapa=!0,window.mapkit?i():$.getScript(t.MAPKIT_CDN,i))},a.expandirMapa=function(){a.mapaExpandido=!a.mapaExpandido},a.mapIntentGoogle=function(){a.dadosLojaFisica.endereco.latitude,a.dadosLojaFisica.endereco.longitude;var o="http://maps.google.com/?q="+a.dadosLojaFisica.enderecoMaps;window.open(o)},a.voltar=function(){o.voltarPagina()}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/evento/:id/:uri",{controller:"EventoViewCtrl",templateUrl:"angular/app/evento/partials/view.tpl.html",title:"Evento"}).when("/eventos",{controller:"EventosCtrl",templateUrl:"angular/app/evento/partials/listar.tpl.html",title:"Eventos"})}]).controller("EventoViewCtrl",["$scope","$rootScope","$routeParams","$mdMedia","$mdDialog","AuthFactory","AppleMapKit","EventoService",function(a,r,t,o,n,e,i,c){(a.$mdMedia=o)("xs");function s(){var o,e;window.mapkit?((e=document.getElementById("evento-map"))&&!a.map&&window.mapkit&&(a.map=new mapkit.Map(e,{showsMapTypeControl:!1,showsCompass:mapkit.FeatureVisibility.Hidden}),a.carregandoMapa=!1,a.verMapa=!0,a.iniciado=!0,a.map&&(e=[],a.marcadores.evento&&(e.push(a.marcadores.evento),a.marcadores.evento=null),a.map.removeItems(e)),a.map)&&window.mapkit&&window.mapkit.Coordinate&&window.mapkit.MarkerAnnotation&&(a.evento.endereco.latitude||a.evento.endereco.longitude||(a.evento.endereco.latitude=-23.495442361961988,a.evento.endereco.longitude=-46.592228186368686),e=new mapkit.Coordinate(a.evento.endereco.latitude,a.evento.endereco.longitude),o={color:"#000000",title:"Droper",subtitle:a.evento.titulo||"Evento Droper"},a.marcadores.evento=new mapkit.MarkerAnnotation(e,o),e=[],a.marcadores.evento&&e.push(a.marcadores.evento),a.map.showItems(e,{animate:!1,minimumSpan:new mapkit.CoordinateSpan(.03,.03)}),a.map.setCameraDistanceAnimated(7e3)),a.mapkitIniciado||mapkit.init({authorizationCallback:function(e){i.fetchJWT().then(function(o){e(o.token),a.mapkitIniciado=!0}).catch(function(o){console.error(o),a.erroMapa=!0}).finally(function(){a.carregandoMapa=!1})},language:"pt-BR"})):(a.erroMapa=!0,a.carregandoMapa=!1)}a.evento=null,a.carregandoMapa=!1,a.verMapa=!1,a.erroMapa=!1,a.iniciado=!1,a.mapaExpandido=!1,a.map=null,a.marcadores={origem:null,destino:null,evento:null},a.init=function(){a.obterEventoPorId(),a.evento&&(a.idEvento=a.evento.id||"")},a.obterEventoPorId=function(){a.carregandoEvento=!0;var o=t.id;c.obterEventoPorId(o).then(function(o){a.evento=o}).catch(function(o){console.error(o),r.showToast("Algo deu errado")}).finally(function(){a.carregandoEvento=!1})},a.obterEventoPorToken=function(){a.carregandoEvento=!0;var o=t.token;c.obterEventoPorTokenConvite(o).then(function(o){a.evento=o}).catch(function(o){console.error(o),r.showToast("Algo deu errado")}).finally(function(){a.carregandoEvento=!1})},a.init(),a.toogleParticipacao=function(){a.evento.estaParticipando?a.declinarEvento():a.participar()},a.participar=function(o){var e;r.isLogado()?(e=t.id,o=n.confirm().title("Confirmar participação no evento?").textContent("Será confirmada sua participação no evento "+a.evento.titulo+".").ariaLabel("Confirmar participação").targetEvent(o).ok("Sim").cancel("Não"),n.show(o).then(function(){a.confirmandoEvento=!0,c.confirmarEvento(e).then(function(o){a.evento=o,r.showToast("Participação confirmada.")}).catch(function(o){console.error(o),r.showToast("Algo deu errado.")}).finally(function(){a.confirmandoEvento=!1})},function(){})):(r.showToast("Você deve estar logado para confirmar sua participação."),r.irParaLogin())},a.declinarEvento=function(o){var e;r.isLogado()?(e=t.id,o=n.confirm().title("Cancelar participação no evento?").textContent("Será cancelada sua participação no evento "+a.evento.titulo+".").ariaLabel("Cancelar participação").targetEvent(o).ok("Sim").cancel("Não"),n.show(o).then(function(){a.declinandoEvento=!0,c.declinarEvento(e).then(function(o){a.evento=o,r.showToast("Participação removida.")}).catch(function(o){console.error(o)}).finally(function(){a.declinandoEvento=!1})},function(){})):(r.showToast("Você deve estar logado para confirmar cancelar sua participação."),r.irParaLogin())},a.enviarConviteCalendario=function(){var o;r.isLogado()?!a.enviandoConvite&&a.evento.estaParticipando&&(a.enviandoConvite=!0,o={email:r.getLoggedUser().email},c.enviarEventoParaCalendario(t.id,o).then(function(o){r.showToast("Evento enviado para seu calendário, verifique seu email.")}).catch(function(o){console.error(o),r.showToast("Aldo deu errado")}).finally(function(){})):(r.showToast("Você deve estar logado para confirmar sua participação."),r.irParaLogin())},a.carregarMapa=function(){a.iniciado||(a.carregandoMapa=!0,window.mapkit?s():$.getScript(i.MAPKIT_CDN,s))},a.expandirMapa=function(){a.mapaExpandido=!a.mapaExpandido},a.mapIntentGoogle=function(){a.evento.endereco.latitude||a.evento.endereco.longitude||(a.evento.endereco.latitude=-23.495442361961988,a.evento.endereco.longitude=-46.592228186368686);var o=a.evento.endereco.latitude+","+a.evento.endereco.longitude;window.open("https://www.google.com/maps/@?api=1&map_action=map&center="+o+"&zoom=19")},a.voltar=function(){r.voltarPagina()}}]).controller("EventosCtrl",["$scope","$rootScope","$routeParams","$mdMedia","AuthFactory","AppleMapKit","EventoService",function(e,o,a,r,t,n,i){e.eventosParticipando=[],e.eventosAbertos=[],e.temEventos=!1,e.carregando=!0,e.temMais=!1,e.showPrivados=!1,e.preCondicoes=function(){e.obterEventosAbertos(),t.isLoggedIn()?e.obterEventosParticipando():e.showPrivados=!1},e.carregarEventos=function(){e.temEventos=!0,e.carregando=!1},e.init=function(){e.obterEventos()},e.getDia=function(o){return o.substring(5,2)},e.obterEventosParticipando=function(){e.carregandoEventosParticipando=!0,i.obterConfirmacoes().then(function(o){e.eventosParticipando=o.eventos,e.temMais=o.temMais,e.showPrivados=!0}).catch(function(o){console.error(o)}).finally(function(){e.carregandoEventosParticipando=!1})},e.obterEventosAbertos=function(){e.carregandoEventosAbertos=!0,i.obterAbertos().then(function(o){e.eventosAbertos=o.eventos,e.temMais=o.temMais}).catch(function(o){console.error(o)}).finally(function(){e.carregandoEventosAbertos=!1})},e.iniciarCSU=void e.preCondicoes()}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/home",{controller:"HomeCtrl",templateUrl:"angular/app/home/partials/homev2.tpl.html",tabControl:"Home"}).when("/",{controller:"HomeCtrl",templateUrl:"angular/app/home/partials/homev2.tpl.html",tabControl:"Home"}).when("/todaslojas",{controller:"HomeCtrl",templateUrl:"angular/app/home/partials/todaslojas.tpl.html",tabControl:"Home",title:"Todas lojas"}).when("/todaslojas/:filtro",{controller:"HomeCtrl",templateUrl:"angular/app/home/partials/todaslojas.tpl.html",tabControl:"Home",title:"Todas lojas"}).when("/mais",{controller:"HomeCtrl",templateUrl:"angular/app/home/partials/mais.tpl.html",tabControl:"Mais",title:"Mais"}).when("/feed",{controller:"HomeCtrl",templateUrl:"angular/app/home/partials/feed.tpl.html",tabControl:"Home"})}]).controller("HomeCtrl",["$scope","$rootScope","$routeParams","$location","$mdDialog","$mdMedia","$window","$timeout","HomeService","BuscarService","AuthFactory","LocationBackStore","CkViewState","CkViewUtils","UserStore","ClienteService","ckGliderHelper","LapsesService","LiveService","CkHLS","SparksService","CkGlobalEvents",function(i,n,o,e,a,r,t,c,s,l,d,u,p,f,m,g,h,v,w,C,b,S){i.colecaoA={},i.colecaoB={},i.colecoes=[],i.lapsesConfig={},i.$mdMedia=r;i.cardVistosRecentemente={};var e=e.path(),P="/"===e||"/home"===e,y=null,k=null;function T(){window.onscroll=function(){f.estaSendoVisto("#trigger-home-paginacao")&&!i.carregandoMaisColecoes&&i.obterMaisColecoes(),f.estaSendoVisto("#btn-mais-produtos")&&!i.carregandoNovidade&&i.carregarMaisNovidades()}}function E(e){var o;i.loadingSlider||(i.loadingSlider=!0,o=$("#"+e),y&&y.destroy(),o.ready(function(){var o=document.getElementById(e);y=new Glider(o,{draggable:r("xs"),slidesToScroll:1,slidesToShow:1,scrollLock:!0,resizeLock:!0,dragVelocity:.8,rewind:!0,arrows:{prev:"#glider-prev-homev1",next:"#glider-next-homev1"}}),i.loadingSlider=!1,h.setAutoSlide(y,o,5e3)}))}i.carregaHome=function(){i.carregandoHome=!0,T(),o=S.sub("home_reload",function(o){var e=o.id,o=o.msg;e!==k||!o.shouldReload||i.carregandoHome||i.reloadLocked||(i.reloadLocked=!0,p.clearHome(),i.carregaHome(),window.setTimeout(function(){i.reloadLocked=!1},1e3))}),k=o,i.$mdMedia=r,i.initLapsesLocalStorage();var o,e=p.home();P&&e&&e.changed?(p.restoreScope(e.scope,i),E("glider-homev1"),window.setTimeout(function(){window.scroll(e.scroll.x,e.scroll.y)},300),i.carregarDropsVistosRecentemente(),i.podeExibirLapses()&&i.ordenarMarcas()):(i.loadPart1(),i.carregarCompraResumo(),i.opcoes=s.obterOpcoesHome()),i.carregandoHome=!1,u.set("/home")},i.$on("$destroy",function(){var o;document.onvisibilitychange=function(){},S.unsub("home_reload",k),P&&(o={scope:i,scroll:{x:window.scrollX,y:window.scrollY}},p.home(o))}),i.loadPart1=function(){return i.carregando=!0,s.obterInicioPart1().then(function(o){o.slider&&(i.dataSlider=o.slider.slider,E("glider-homev1")),i.marcas=o.marcas,i.lapsesConfig=o.lapsesConfig;var e=i.podeExibirLapses();i.podeExibirLive=!1;try{var a="true"===i.lapsesConfig.liveCordova,r="true"===i.lapsesConfig.liveWeb;(n.isCordova()?a:r)&&w.pingStream(!0).then(function(o){i.podeExibirLive=o.iniciada})}catch(o){console.error(o)}e&&i.carregarMarcasLapses(),i.produtosDestaque=o.destaques,i.lancamentos=o.lancamentos,i.bestsellers=o.bestsellers,i.topnews=o.news;a=o.colecao;i.colecaoA=a.splice(0,1)[0],i.colecaoB=a.splice(0,1)[0],i.colecoes=a,i.carregarDropsVistosRecentemente()}).catch(function(o){i.erroHomeMaster=!0}).finally(function(){i.carregando=!1})},i.page=1,i.amount=6,i.podeExibirLapses=function(){return"true"===i.lapsesConfig.lapseWeb||n.isCordova()&&"true"===i.lapsesConfig.lapseCordova},i.obterMaisColecoes=function(){i.carregandoMaisColecoes=!0,s.obterMaisColecoes(i.page,i.amount).then(function(o){0==o.itens.length&&$("#trigger-home-paginacao").remove(),i.colecoes=i.colecoes.concat(o.itens),i.page++}).catch(function(o){}).finally(function(){i.carregandoMaisColecoes=!1})},i.carregarDropsVistosRecentemente=function(){var o=m.getDropView(0);i.cardVistosRecentemente.mode=5,i.cardVistosRecentemente.drops=o,i.cardVistosRecentemente.show=null!=o&&3<o.length,i.cardVistosRecentemente.titulo="Vistos recentemente"},i.carregarCompraResumo=function(){if(d.isLoggedIn()&&"1"==d.get().tipo)return i.showResumoCompra=!1,s.obterResumoCompras().then(function(o){i.dados=o,(i.resumoCompras=o).total&&(i.showResumoCompra=!0),null!=o.semavaliacao&&n.showAvaliacaoRapida(o.semavaliacao)})},i.feedPage=-1,i.feedAmount=10,i.tipoSelecionado={},i.tamanhoSelecionado={},i.produtosNovidade=[],i.listaProdutosFavoritados=[],i.idTipo={},i.idTamanho={},i.carregarFeed=function(o,e){i.idTipo=o||{},i.idTamanho=e||{},T(),i.page=0,i.amount=10,i.carregandoNovidade=!0,i.carregando=!0,i.tipoSelecionado=o||{},i.tamanhoSelecionado=e||{};null!=i.tipoSelecionado&&0<i.tipoSelecionado.id&&n.toTop(),null!=n.homeNovidadesTamanhoSelecionado&&n.homeNovidadesTamanhoSelecionado.id!=i.tamanhoSelecionado.id&&(i.page=0),n.isLogado()&&n.getLoggedUser().id;s.obterProdutosNovidadesv2(i.page,i.amount,i.tipoSelecionado?i.tipoSelecionado.id:null,i.tamanhoSelecionado?i.tamanhoSelecionado.id:null).then(function(o){i.produtosNovidade=o}).catch(function(o){i.erro=!0}).finally(function(){i.carregandoNovidade=!1,i.carregando=!1}),l.getFiltersv2().then(function(o){i.tiposproduto=o.tipos}).catch(function(o){}).finally(function(){})},i.carregarMaisNovidades=function(){i.carregandoNovidade||(i.produtosNovidade||(i.produtosNovidade=[]),i.carregandoNovidade=!0,i.page=i.page+1,n.homeNovidadesPage=i.page,s.obterProdutosNovidadesv2(i.page,i.amount,i.tipoSelecionado?i.tipoSelecionado.id:null,i.tamanhoSelecionado?i.tamanhoSelecionado.id:null).then(function(o){i.produtosNovidade=i.produtosNovidade.concat(o)}).catch(function(o){}).finally(function(){i.carregandoNovidade=!1}))},i.obterListaFavoritadosV2=function(){i.carregandoFavoritados=!0,n.isLogado()&&!r("xs")&&s.obterListaFavoritadosV2(i.idTipo.id,i.idTamanho.id).then(function(o){i.listaProdutosFavoritados=o,i.verificarListaFavoritados()}).catch(function(o){}).finally(function(){i.carregandoNovidade=!1,i.carregandoFavoritados=!1})},i.verificarListaFavoritados=function(){if(0<i.produtosNovidade.length)for(var e=0;e<i.produtosNovidade.length;e++){var o=i.listaProdutosFavoritados.some(function(o){return o.id===i.produtosNovidade[e].id});i.produtosNovidade[e].isFavoritado=o,i.produtosNovidade[e].totalFavoritadas++}},i.verificarIsFavoritado=function(e){var o;return 0<i.listaProdutosFavoritados.length&&((o=i.listaProdutosFavoritados.find(function(o){return o.id==e.id}))&&e.totalFavoritadas++,o)},i.toggleFavoritar=function(r,t){var o;n.isLogado()?2==n.getLoggedUser().tipo?n.showToast("Você não pode favoritar esse anúncio como loja PRO"):(o=n.getLoggedUser().keypass,g.toogleFavoritarProduto(o,r.id,t).then(function(o){i.removendoFavorito=!0;var e,a=i.produtosNovidade.find(function(o){return o.id===(r||{}).id});e=r.id,i.listaProdutosFavoritados=i.listaProdutosFavoritados.filter(function(o){return o.id!==e}),t&&a?(a.isFavoritado=!1,a.totalFavoritadas--):a&&(a.isFavoritado=!0,a.totalFavoritadas++,a=r,null!=i.listaProdutosFavoritados)&&i.listaProdutosFavoritados.unshift(a)}).catch(function(o){}).finally(function(){i.removendoFavorito=!1})):n.showToast("Você deve estar logado para favoritar um anúncio")};var D=null;function A(o){return o.reduce(function(o,e){return o.spanDataCriacao>e.spanDataCriacao?o:e})}i.carregarMarcasLapses=function(){i.carregandoMarcasLapses=!0,v.obterMarcas().then(function(o){i.marcasLapses=o,i.ordenarMarcas();o=i.marcasLapses.map(function(o){return o.lapses}).map(function(o){return o.map(function(o){return o.playlist})}).flat();C.precache(o)}).catch(function(o){console.error(o)}).finally(function(){i.carregandoMarcasLapses=!1})},i.initLapsesLocalStorage=function(){v.createLocalStorageLapse()},i.statusLapse=function(o){return i.statusLapseV2(o)},i.statusLapseV1=function(o){return v.showLapseMarca(o)},i.statusLapseV2=function(e){var o,a=(i.marcasLapses||[]).find(function(o){return o.id===e});return a?(a=A(a.lapses),D=D||v.carregarHistoricoV2(),!(o=D.find(function(o){return o.idMarca===e}))||o.ultimoVisto<a.spanDataCriacao?"naoAssistido":"assistido"):"naoTemLapse"},i.ordenarMarcas=function(){i.ordenarMarcasV2()},i.ordenarMarcasV1=function(){i.marcasParaOrdenar=[];for(var o=[],e=0;e<i.marcasLapses.length;e++){var a=Math.max.apply(Math,i.marcasLapses[e].lapses.map(function(o){return o.spanDataCriacao})),a={marca:i.marcasLapses[e],tempo:a};i.marcasParaOrdenar.push(a)}var r=i.marcasParaOrdenar.sort(function(o,e){return e.tempo-o.tempo});v.setMarcas(r);for(e=0;e<r.length;e++){var t=i.marcas.find(function(o){return o.id===r[e].marca.id});t&&o.push(t)}var n=o.filter(function(o){return"assistido"===v.showLapseMarca(o.id)}),o=o.filter(function(o){return"naoAssistido"===v.showLapseMarca(o.id)}).concat(n),n=i.marcas.filter(function(e){return!i.marcasLapses.some(function(o){return o.id===e.id})}),n=o.concat(n);i.marcas=n},i.ordenarMarcasV2=function(){function o(o){return o.sort(function(o,e){return e.lapseMaisRecente.spanDataCriacao-o.lapseMaisRecente.spanDataCriacao}).map(function(o){return o.marca})}var e,a,r,t;i.marcas=(e=i.marcas,a=i.marcasLapses,r=e.filter(function(e){return a.some(function(o){return o.id===e.id})}),e=e.filter(function(e){return!a.some(function(o){return o.id===e.id})}),r=r.map(function(e){return{marca:e,lapseMaisRecente:A(a.find(function(o){return o.id===e.id}).lapses),statusLapse:i.statusLapse(e.id)}}),t=r.filter(function(o){return"assistido"===o.statusLapse}),r=r.filter(function(o){return"assistido"!==o.statusLapse}),r=o(r).concat(o(t)),t=r.map(function(e){return a.find(function(o){return e.id===o.id})}).filter(function(o){return o}),v.setMarcasV2(t),r.concat(e))},i.urlLapses=function(o){return"lapses/marca/"+o.id},i.podeExibirLive=!1;var M=null;function j(){(M=new Date).setMinutes(M.getMinutes()+15)}j(),document.onvisibilitychange=function(){var o;window.scrollY<100&&(o=new Date,M<=o)&&(i.carregandoHome=!0,y&&(j(),i.carregaHome()))}}]).controller("TutorialLojaCtrl",["$scope","$rootScope","$location","$mdDialog",function(o,e,a,r){o.carregaTutorialCadastroLoja=function(o){}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/lapses/marca/:id",{controller:"LapsesCtrlV2",templateUrl:"angular/app/lapses/partials/viewV2.tpl.html",title:"Lapses"}).when("/lapses/drop/:idDrop",{controller:"LapsesCtrlV2",templateUrl:"angular/app/lapses/partials/viewV2.tpl.html",title:"Lapses"})}]).directive("lapses",[function(){return{restrict:"E",replace:!0,scope:{directiveIdMarca:"=?idmarca",directiveIdDrop:"=?iddrop",directiveOnFinish:"=?onfinish"},templateUrl:"angular/app/lapses/partials/embedded.tpl.html",controller:"LapsesCtrlV2"}}]).controller("LapsesCtrlV2",["$scope","$rootScope","$routeParams","$location","$mdMedia","$mdDialog","LapsesService","CkTouchScreen","CkHLS",function(f,o,e,U,a,F,m,r,p){f.$mdMedia=a;var t=!!f.directiveIdMarca||!!f.directiveIdDrop,n=parseInt(t?f.directiveIdMarca:e.id),i=parseInt(t?f.directiveIdDrop:e.idDrop),g=!!n,h=!g&&!!i,c=!h,s={Video:"video",Progress:"lapse-load"},u={VND_APPLE_MPEGURL:"application/vnd.apple.mpegurl"},v={Lib:"lib",Nativo:"nativo",NaoSuportado:"nao_suportado"},w={Unico:"unico",Recorrente:"recorrente"},C={ExibicaoCard:"exibicao",EsconderCard:"esconder",AdicaoHistorico:"history",ContabilizacaoView:"view"},b={Avancar:"avancar",Voltar:"voltar",Pular:"pular",FecharCard:"fecharcard"};function S(o,e,a,r){return{tipo:o,frequencia:e,segundos:a,data:r,ultimaExecucao:null}}function l(o,e){return{tipo:o,data:e}}var d,P=null,y=null,k=null,T={},E=!1,D=[],A={waiting:!1};function N(){f.carregando=!0,$(document).ready(function(){L()}),function(){if(h)return function(a){return new Promise(function(e,o){m.obterDrop(a).then(function(o){e([o])}).catch(o)})}(i);return new Promise(function(e,o){(k=k||m.getMarcas())&&k.length?e(k):m.obterMarcas().then(function(o){e(k=o)}).catch(o)})}().then(function(o){var e=h?0:o.findIndex(function(o){return o.id===n}),a=function(){if(c)return m.carregarHistoricoV2();return[]}();f.temLapse=0<=e&&o[e].lapses&&o[e].lapses.length,function e(a,r,t){var n=function(o){e(a,r+o.offset,[])};R(a,r).then(function(o){q(o,t).then(function(o){var e=o.ctx,a=o.marca,o=(f.barras=o.marca.lapses.map(function(o,e){return e}),f.marca=o.marca,(e.timestamps[e.inicio]||[0])[0]);B(e.url,o).then(function(){M(a,e,n)}).catch(function(o){console.error("video init",o)})}).catch(function(o){console.error("ctxmarca",o)})}).catch(function(o){f.close()})}(o,e,a)}).catch(function(o){console.error(o),f.erro=o}).finally(function(){f.carregando=!1})}function R(a,r){return new Promise(function(o,e){return a?r<0||r>=a.length?e():void o(a[r]):e("lista de marcas não foi inicializada")})}function q(d,u){return new Promise(function(o,e){var r,a,t,n,i,c,s,l;T[d.id]||(a=d.lapses,n=a.map(function(o){return o.playlist}),t=(a=(r=a.map(function(o){return o.duracao/1e3}).reduce(function(o,e){return o.push(o[o.length-1]+e),o},[0])).reduce(function(o,e,a){return 0<a?o.concat([[r[a-1],r[a]]]):o},[])).reduce(function(o,e,a){var r,t,n,i=e[0],e=e[1];return g?(t=S(C.ExibicaoCard,w.Recorrente,i+3),e=S(C.EsconderCard,w.Recorrente,e-1),r=S(C.AdicaoHistorico,w.Unico,i+0),n=S(C.ContabilizacaoView,w.Unico,i+0),o.concat([t,e,r,n])):h?(t=S(C.ExibicaoCard,w.Recorrente,i+3),n=S(C.ContabilizacaoView,w.Unico,i+0),o.concat([t,n])):[]},[]),n=p.merge(n,!0).content,i=z(new TextEncoder("utf8"),n),s=0,(c=(u||[]).find(function(o){return o.idMarca===d.id}))&&0<=(l=d.lapses.findIndex(function(o){return o.spanDataCriacao>c.ultimoVisto}))&&(s=l),T[d.id]={url:i,playlist:n,eventos:t,timestamps:a,inicio:s}),o({marca:d,ctx:T[d.id]})})}function M(o,e,a,r){var t=r||{barrasProgresso:[],marca:o,marcactx:e,video:I(),currentTime:0,videostatus:{waiting:!1},card:{dados:{},exibindo:!1},end:{ended:!1,offset:0},_log:console.log},c=(t.video=t.video||I(),t.currentTime=t.video.currentTime,t),n=function(o){var a=Math.trunc(o.currentTime);return o.marcactx.timestamps.findIndex(function(o){var e=Math.trunc(o[0]),o=Math.trunc(o[1]);return e<=a&&a<o})}(c),s=c.marca.lapses[n],i=c,l=i.barrasProgresso.map(function(o){return o});for(i.barrasProgresso=i.marcactx.timestamps.map(function(o,e){var a=o[0],o=o[1];return i.currentTime<a?0:i.currentTime>o?100:(o=100*Math.min((i.currentTime-a)/(o-a),1),Math.floor(o),0<l[e]-o?l:o)}),c.video.ended&&j(c,1),c.videostatus.waiting=A.waiting,c.marcactx.eventos.forEach(function(o){var e,a=Date.now(),r=Math.trunc(c.currentTime)===Math.trunc(o.segundos),t=o.frequencia===w.Recorrente,n=!!o.ultimaExecucao,i=n&&a-o.ultimaExecucao<=1e3;if(r&&!i&&(t||!n)){switch(o.tipo){case C.AdicaoHistorico:e=c.marca,m.salvarHistoricoV2(e,s);break;case C.ContabilizacaoView:m.contabilizarView(s.id);break;case C.ExibicaoCard:c.card.dados=s.drop||{},c.card.exibindo=!!c.card.dados.id;break;case C.EsconderCard:c.card.dados={},c.card.exibindo=!1}o.ultimaExecucao=a}});0<D.length;){var d,u=D.shift();switch(u.tipo){case b.Avancar:(d=c.marcactx.timestamps[n+1])?c.video.currentTime=d[0]:j(c,1),c.card.dados={},c.card.exibindo=!1;break;case b.Pular:(d=c.marcactx.timestamps[u.data.indice])&&(c.video.currentTime=d[0]),c.card.dados={},c.card.exibindo=!1;break;case b.Voltar:(d=c.marcactx.timestamps[n-1])?c.video.currentTime=d[0]:j(c,-1),c.card.dados={},c.card.exibindo=!1;break;case b.FecharCard:c.card.exibindo=!1}}var r=t,p=!1;r.barrasProgresso.forEach(function(o,e){(e=document.getElementById("visto"+e))&&(e.style.width=o+"%")}),f.drop===r.card.dados&&f.mostrarDrop===r.card.exibindo||(f.drop=r.card.dados,f.mostrarDrop=r.card.exibindo,p=!0),f.carregandoBuffer!==r.videostatus.waiting&&(f.carregandoBuffer=r.videostatus.waiting,p=!0),p&&f.$apply(),E||t.end.ended||window.requestAnimationFrame(function(){M(o,e,a,t)}),t.end.ended&&a({offset:t.end.offset})}function j(o,e){o.end.ended=!0,o.end.offset=e}function I(){return(y=y||document.getElementById(s.Video))||{}}function L(){var o,e,a=document.getElementById("areaVideo");a&&(e=(o=window.innerHeight)/16*9,a.style.height=o+"px",a.style.width=e+"px")}function B(l,d){return new Promise(function(o,e){var a,r,t,n,i,c,s=I();switch(function(o){try{var e="Hls"in window&&window.Hls.isSupported(),a=o&&o.canPlayType(u.VND_APPLE_MPEGURL);if(e)return v.Lib;if(a)return v.Nativo}catch(o){console.error("vidmode",o)}return v.NaoSuportado}(s)){case v.Lib:n=s,i=l,c=d,new Promise(function(o,e){P&&P.detachMedia&&P.detachMedia(),(P=new Hls).on(Hls.Events.MEDIA_ATTACHED,function(){P.loadSource(i),P.on(Hls.Events.MANIFEST_PARSED,function(o,e){n.muted=f.isMutado,n.currentTime=c||0,V(n)})}),P.on(Hls.Events.Error,function(o,e){console.error("HLS",{ev:o,data:e})}),P.attachMedia(n),x(n),o()}).then(o).catch(e);break;case v.Nativo:a=s,r=l,t=d,new Promise(function(o,e){r?(a.src=r,a.currentTime=t,x(a),V(a),o()):e("não tem url")}).then(o).catch(e);break;case v.NaoSuportado:e("navegador não suportado");break;default:e("err")}})}function x(o){o.onwaiting=function(){A.waiting=!0},o.onloadeddata=function(){A.waiting=!1},o.onplaying=function(){A.waiting=!1}}function O(o){f.isMutado=o,I().muted=f.isMutado}function V(o){var e=o||I();O(!1),e.play().catch(function(){O(!0),e.play()})}function z(o,e){return"data:application/x-mpegURL;base64,"+btoa(e)}f.carregando=!1,f.erro=null,f.mdMedia=a,f.videoEstaTocando=!0,f.videoSuported=!0,f.temLapse=!1,f.isMutado=!0,f.lapses=[],f.barrasLapses=[],f.idMarca=0,f.marca={},f.barras=[],f.drop={},f.mostrarDrop=!0,f.marca=null,d=s.Video,new Promise(function(o,e){!function o(e,a,r,t){const n=t||0;const i=document.querySelector(e);if(20<n)return void r();i?a(i):window.setTimeout(()=>o(e,a,r,n+1),300)}(d,o,e)}).then(function(){N()}),f.close=function(){t?f.directiveOnFinish():o.voltarPagina()},window.onresize=L,f.irParaHome=function(){P&&P.destroy(),E=!0,o.irPara("/")},f.mutarVideo=function(){O(!f.isMutado)},f.voltar=function(){D.push(l(b.Voltar,{}))},f.avancar=function(){D.push(l(b.Avancar,{}))},f.closeCard=function(){D.push(l(b.FecharCard,{}))},f.selecionarLapseBarra=function(o){D.push(l(b.Pular,{indice:o}))},f.playOrPause=function(){var o=I();o.paused?o.play():o.pause()};function _(o){try{o.direcao;var e,a=o.distancia,r=o.brilho,t=o.finalizouTouch,n=document.querySelector("#ck-media-render")||{},i=document.querySelector("html")||{};!function(o,e){try{var a,r;if(!(o<0))a=document.getElementById("touchDiv"),r=document.querySelector("html"),a.style.position="relative",a.style.top=o+"px",a.style.left="0px",r.style.overflow="hidden",a.style.filter="brightness("+e+"%)"}catch(o){return}}(a,r),t?(160<=a?(f.voltarPagina(),f.$apply()):((e=document.getElementById("touchDiv")).style.top="0px",e.style.left="0px",e.style.filter="brightness(100%)"),i.style.overflow="hidden",n.style.backgroundColor=null):n.style.backgroundColor="rgba(24, 24, 24)"}catch(o){console.error(o)}}try{o.isCordova()&&r.listen("#touchDiv",_,!0,"top")}catch(o){}}]).controller("LapsesCtrl",["$scope","$rootScope","$routeParams","$location","$mdMedia","LapsesService","CkTouchScreen",function(l,o,e,a,r,d,t){l.mdMedia=r,l.videoEstaTocando=!0,l.videoSuported=!0,l.fecharDivCard=!0,l.temLapse=!1,l.isMutado=!0,l.lapses=[],l.barrasLapses=[],l.idMarca=0,l.marca={};var u=[],n=(l.limiteArrastarLapse=.25,!0);function i(o){var e=o||document.getElementById("video");l.setMuted(!1),e.play().catch(function(){l.setMuted(!0),e.play()})}function p(o,e,a){return a+o<=e}function f(o,e){o=document.getElementById("visto"+o);o&&(o.style.width=e+"%")}function w(o,e){return"data:application/x-mpegURL;base64,"+btoa(e)}function m(){$(document).ready(function(){$("#touchDiv").css("height",window.innerHeight+"px")});var o=window.innerHeight;areaVideo.style.width=o/16*9+"px"}function g(o,e){var a,r;l.historico=l.historico||{},o.idMarca&&o.spanDataCriacao&&(a=l.historico[o.idMarca],r=l.historico[o.idMarca]<o.spanDataCriacao,l.historico[o.idMarca],e=o.id===e[e.length-1].id,a&&!r&&!e||(l.historico[o.idMarca]=o.spanDataCriacao,d.salvarHistorico(o.idMarca,o.spanDataCriacao,e)))}l.hls=new Hls,l.carregarMarcas=function(){l.marcas=d.getMarcas(),l.marcas.length&&0<l.marcas.length?(l.idMarca=parseInt(e.id),l.initLapses()):(l.carregando=!0,l.idMarca=parseInt(e.id),d.obterMarcas().then(function(o){l.marcas=o,l.initLapses()}).catch(function(o){console.error(o)}).finally(function(){l.carregando=!1}))},l.marcas=d.getMarcas(),l.initLapses=function(){var a,o,e,r;l.marca=l.marcas.find(function(o){return o.id==l.idMarca}),l.marca&&l.marca.lapses&&l.marca.lapses.length?(l.temLapse=!0,l.lapses=l.marca.lapses,e=function(o){for(var e,o=o.lapses,a=new TextEncoder("utf8"),r=o.map(function(o){o=o.playlist;try{return JSON.parse(o)}catch(o){return null}}).filter(function(o){return o&&o.length}).map(function(o){return o[0]}),t=["#EXTM3U","#EXT-X-VERSION:3"],n={},i={},c=0;c<r.length;c++){var s,l=r[c];for(s in l.streams)n[s]=n[s]||[],n[s].push(l.streams[s])}for(e in n){for(var d=n[e],u=["#EXTM3U","#EXT-X-VERSION:3","#EXT-X-TARGETDURATION:"+d.map(function(o){return o.targetDuration}).reduce(function(o,e){return e<o?o:e}),"#EXT-X-PLAYLIST-TYPE:VOD"],p=[],f=0;f<d.length;f++){for(var m=d[f].fragments,g=[],h=0;h<m.length;h++){var v=m[h];g.push("#EXTINF:"+v.duration.toFixed(6)+","+v.title),g.push(v.url)}p.push(g.join("\n"))}u=u.join("\n")+"\n"+p.join("\n#EXT-X-DISCONTINUITY\n");i[e]=w(0,u+"\n#EXT-X-ENDLIST")}for(e in i)t.push("#EXT-X-STREAM-INF:"+e),t.push(i[e]);return t.join("\n")}(l.marca),a=document.querySelector("video"),o=w(new TextEncoder("utf8"),e),n&&(e=function(e,o){var a=d.carregarHistorico().find(function(o){return o.idMarca===e});if(!a)return 0;var r=o[o.length-1],o=o.findIndex(function(o){return o.spanDataCriacao===a.ultimoVisto});if(0!==o&&!o)return 0;if(a.ultimoVisto>=r.spanDataCriacao)return 0;return l.obterTempoVideo(o+1)}(l.marca.id,l.lapses),a.currentTime=e,n=!1),e=Hls.isSupported(),r=a.canPlayType("application/vnd.apple.mpegurl"),!e&&r?(a.src=o,i(a),l.carregarBarras()):e||r?(l.hls&&l.hls.detachMedia&&l.hls.detachMedia(),l.hls=new Hls,l.hls.on(Hls.Events.MEDIA_ATTACHED,function(){l.hls.loadSource(o),l.hls.on(Hls.Events.MANIFEST_PARSED,function(o,e){a.muted=l.isMutado,i(a),l.carregarBarras()})}),l.hls.on(Hls.Events.Error,function(o,e){}),l.hls.attachMedia(a),l.hls.on(Hls.Events.BUFFER_APPENDING,function(o,e){l.carregandoBuffer=!0}),l.hls.on(Hls.Events.BUFFER_APPENDED,function(o,e){l.carregandoBuffer=!1})):(console.error("navegador não suportado"),l.videoSuported=!1)):l.temLapse=!1},l.$on("$destroy",function(){l.hls.destroy()}),l.playOrPause=function(){l.videoEstaTocando=!l.videoEstaTocando,l.videoEstaTocando?l.play():l.pause()},l.setMuted=function(o){l.isMutado=o,video.muted=l.isMutado},l.carregarBarras=function(){var o=l.lapses||[],e=document.getElementById("video");if(e=document.getElementById("video")){e.currentTime;for(var a,r=0,t=(l.tVideoAnterior=0,l.tVideoPosterior=0,0);t<o.length;t++)f(t,0);for(var n,t=0;t<o.length;t++){var i=o[t],c=(l.lapseAtual=i,a=e.currentTime,l.lapseAtual.duracao/1e3),s=(r+=c)-c;if(p(5,a,s)&&g(i,o),!(r<=a)){f(t,Math.round(100*(c-(r-a))/c)),l.mostrarAnuncio=p(3,a,s),!function(e){u.some(function(o){return o===e})||(d.contabilizarView(e),u.push(e))}(i.id),a>=startAnuncio?l.mostrarAnuncio=!0:l.mostrarAnuncio=!1;break}f(t,100),l.fecharDivCard=!0,m()}l.tVideoAnterior=l.obterTempoVideo(t-1),l.tVideoPosterior=l.obterTempoVideo(t+1),e.currentTime>=e.duration?l.aindaTemMarca()?(n=l.marcas.findIndex(function(o){return o.id===l.idMarca}),g(o[o.length-1],o),l.idMarca=l.marcas[n+1].id,l.updateUrl(),l.initLapses()):(g(o[o.length-1],o),l.hls.destroy(),l.irParaHome(),l.$apply()):(e.onwaiting=function(){l.carregandoBuffer=!0},e.onplaying=function(){l.carregandoBuffer=!1},window.requestAnimationFrame(l.carregarBarras)),l.$evalAsync()}},l.selecionarLapseBarra=function(o){o=l.obterTempoVideo(o);video.currentTime=o},l.aindaTemMarca=function(){return l.obterIndiceMarca()<l.marcas.length-1},l.aindaTemLapse=function(){var o=l.lapses[l.lapses.length-1];return l.lapseAtual.id===o.id},l.closeCard=function(o){o.stopPropagation(),l.fecharDivCard=!1},l.temMarcaAnterior=function(){return 0<l.obterIndiceMarca()},l.obterTempoVideo=function(o){var e=0;if(o<0)return-1;for(var a=0;a<o&&a<l.lapses.length;a++)e+=l.lapses[a].duracao/1e3;return e},l.avancar=function(){var o,e,a=document.getElementById("video");a.duration;l.fecharDivCard=!0,a.paused&&l.play(),l.tVideoPosterior>=a.duration&&l.aindaTemMarca()?(o=l.obterIndiceMarca(),e=l.lapses||[],l.idMarca=l.marcas[o+1].id,l.updateUrl(),l.initLapses(),a.currentTime=0,g(e[e.length-1],e)):a.currentTime=l.tVideoPosterior},l.voltar=function(){var o,e=document.getElementById("video");l.fecharDivCard=!0,e.paused&&l.play(),l.temMarcaAnterior()||l.lapseAtual.id!==l.lapses[0].id?l.tVideoAnterior<0&&l.temMarcaAnterior()?(o=l.obterIndiceMarca(),l.idMarca=l.marcas[o-1].id,l.updateUrl(),l.initLapses(),e.currentTime=0):e.currentTime=l.tVideoAnterior:l.irParaHome()},l.obterIndiceMarca=function(){return l.marcas.findIndex(function(o){return o.id===l.idMarca})},l.carregarMarcas(),l.selecionarLapse=function(o){console.log("não implementado")},l.showVoltar=function(){if(!l.carregando&&l.marcas.length&&0<l.marcas.length)return l.temMarcaAnterior()||-1<l.tVideoAnterior},l.showAvancar=function(){if(!l.carregando&&l.marcas.length&&0<l.marcas.length)return l.aindaTemMarca()||!l.aindaTemLapse()},l.mutarVideo=function(){l.setMuted(!l.isMutado)},l.onAvancar=function(o,e){},l.onVoltar=function(o,e){},l.onTermino=function(o,e){},l.play=function(){var o=document.getElementById("video");l.videoEstaTocando=!0,o.play()},l.pause=function(){var o=document.getElementById("video");l.videoEstaTocando=!1,o.pause()},l.irParaHome=function(){l.hls&&l.hls.destroy(),o.irPara("/")},l.updateUrl=function(){o.substituirUri("lapses/marca/"+l.idMarca)},window.onresize=m(),m();t.listenV2("#touchDiv",function(o){o.direcao;var e,a,r=o.distancia,t=o.brilho,o=o.finalizouTouch;a=r,t=t,(e=document.getElementById("touchDiv")).style.position="relative",e.style.top=a+"px",e.style.filter="brightness("+t+"%)",o&&250<=r?l.irParaHome():o&&r<250&&((a=document.getElementById("touchDiv")).style.top="0px",a.style.left="0px",a.style.filter="brightness(100%)")},!0,"top")}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/live",{controller:"LiveCtrl",templateUrl:"angular/app/lapses/partials/live.tpl.html",title:"Live"})}]).controller("LiveCtrl",["$scope","$rootScope","LiveService","$mdMedia",function(c,o,e,a){c.mdMedia=a,c.fecharDivCard=!0;var r=!(c.dataUltimoCard=0),s={VND_APPLE_MPEGURL:"application/vnd.apple.mpegurl"},l={Carregando:"carregando",SemLive:"sem_live",LiveIniciada:"live_iniciada",Broadcasting:"broadcasting",Saindo:"saindo",Err:"err",ErrNavegadorNaoSuportado:"err_navegador_naosuportado"},d=(c.liveMetadataList=[],{Lib:"lib",Nativo:"nativo",NaoSuportado:"nao_suportado"}),u=(c.UIState=l,c.uiState=l.Carregando,null),t=null,n=!0,p=null;function f(o){return c.uiState===o}function m(o){c.uiState=o}function g(){return(t=t||document.querySelector("video"))||{}}function i(){e.pingStream().then(function(o){if(o){var e=o||{},a=o.playbackUrl,r=l.SemLive,t=o.ultimaAlteracaoMetadata;if(c.numEspectadores=e.numEspectadores,e.iniciada&&e.broadcasting?r=l.Broadcasting:e.iniciada&&(r=l.LiveIniciada),!f(l.Broadcasting)&&r===l.Broadcasting||p&&p!==a){var n={playbackUrl:a},i=g();switch(function(o){try{var e="Hls"in window&&window.Hls.isSupported(),a=o&&o.canPlayType(s.VND_APPLE_MPEGURL);if(e)return d.Lib;if(a)return d.Nativo}catch(o){v(o)}return d.NaoSuportado}(i)){case d.Lib:!function(a,o){v("iniciando hls.js");var e=o.playbackUrl;e?(u&&u.detachMedia(),(u=new Hls).on(Hls.Events.MEDIA_ATTACHED,function(){u.loadSource(e),u.on(Hls.Events.MANIFEST_PARSED,function(o,e){a.play()})}),u.on(Hls.Events.Error,function(o,e){if(e.fatal)switch(e.type){case Hls.ErrorTypes.NETWORK_ERROR:w("hls.js","network error"),u.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:w("hls.js","media error"),u.recoverMediaError();break;default:w("hls.js (unrecoverable)",{ev:o,data:e}),u.destroy()}}),u.on(Hls.Events.BUFFER_APPENDING,function(o,e){c.carregandoBuffer=!0}),u.on(Hls.Events.BUFFER_APPENDED,function(o,e){c.carregandoBuffer=!1}),u.attachMedia(a)):w("iniciarHLSjs()","não tem url")}(i,n);break;case d.Nativo:!function(o,e){v("iniciando nativo");e=e.playbackUrl;e?(o.src=e,o.play()):w("iniciarNativo()","não tem url")}(i,n);break;case d.NaoSuportado:m(l.ErrNavegadorNaoSuportado);break;default:m(l.Err)}}m(r),p=a,v("novo estado",r),e=t,a=!c.fecharDivCard&&0<c.dataUltimoCard,e=t!==c.dataUltimoCard,a&&e&&(c.fecharDivCard=!0),c.dataUltimoCard=t,o.metadata.length&&0<o.metadata.length&&(c.liveMetadataList=o.metadata,c.drop=c.liveMetadataList[0].conteudo)}}).catch(function(o){w("PING_STREAM",o)}).finally(function(){var o;n&&!f(l.Saindo)&&((o=g()).onwaiting=function(){c.carregandoBuffer=!0},o.onplaying=function(){c.carregandoBuffer=!1},window.setTimeout(i,2e3))})}function h(){var o=document.getElementById("areaVideo"),e=window.innerHeight,a=e/16*9;o.style.height=e+"px",o.style.width=a+"px"}function v(o,e){C(o,e,console.log)}function w(o,e){C(o,e,console.error)}function C(o,e,a){r&&a&&(o&&e?a(o,e):o&&a(o))}c.isMutado=!0,c.carregandoBuffer=!1,c.init=function(){i()},c.init(),c.irParaHome=function(){m(l.Saindo),u&&u.destroy(),n=!1,o.irPara("/")},c.isMutado=function(){return g().muted},c.toggleMute=function(){var o=g();o.muted=!o.muted},window.onresize=function(){h()},h(),c.closeCard=function(o){o.stopPropagation(),c.fecharDivCard=!1}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/lc/:idinteresse",{controller:"LegitCheckCtrl",templateUrl:"angular/app/legitcheck/partials/legitcheckResult.tpl.html",tabControl:"Buscar",title:"Legit Check by Droper"}).when("/legitcheck/code/:code",{controller:"LegitCheckCtrl",templateUrl:"angular/app/legitcheck/partials/legitcheckResult.tpl.html",tabControl:"Buscar",title:"Legit Check by Droper"}).when("/legitcheck/reader",{controller:"LegitCheckReaderCtrlV2",templateUrl:"angular/app/legitcheck/partials/readerV2.tpl.html",title:"Legit Check by Droper"})}]).controller("LegitCheckCtrl",["$scope","$rootScope","$location","$mdDialog","$mdMedia","$routeParams","CompraService","AuthFactory","LegitCheckService",function(a,o,e,r,t,n,i,c,s){a.carregar=function(){var o=n.idinteresse,e=n.code;a.carregando=!0,(null!=o&&1<o?s.obterResultadoLegitCheck(o).then(function(o){a.dados=JSON.parse(o.result),a.anuncio=o.anuncio}).catch(function(o){a.erro=!0}):s.obterResultadoLegitCheckViaCode(e).then(function(o){a.dados=JSON.parse(o.result),a.anuncio=o.anuncio}).catch(function(o){a.erro=!0})).finally(function(){a.carregando=!1})}}]).controller("LegitCheckReaderCtrlV2",["$scope","$q","$routeParams","$location","$rootScope",function(r,o,e,a,t){function n(){r.carregando=!0,QRScanner.prepare(function(o,e){r.carregando=!1,o&&(r.erroPermissao=!0,r.permitiuCamera=!1,r.errogeral=!0,console.error("QRScanner.prepare",o)),e.authorized?(r.pediuPermissao=!0,r.permitiuCamera=e.authorized,r.erroPermissao=!1,i()):e.denied?(r.errogeral=!0,r.erroPermissao=!0):(r.errogeral=!0,r.podeScanear=!1),r.removerCorBackground(),r.$apply()})}function i(){r.getStatusCamera(),QRScanner.scan(function(o,e){o?(console.error("QRScanner.scan",o),t.showToast("Ops, houve um erro de leitura. Tente novamente!")):(a.path("/legitcheck/code/"+e),a.replace(),r.$apply(),QRScanner.destroy())}),QRScanner.show(),r.removerCorBackground()}r.podeScanear=!1,r.permitiuCamera=!1,r.erroPermissao=!1,r.erroLeitura=!1,r.pediuPermissao=!1,r.errogeral=!1,r.carregando=!0,r.luzLigada=!1,r.init=function(){var o;r.podeScanear=!!window.QRScanner,t.toTop(),t.isCordova()||(r.podeScanear=!1,r.carregando=!1,r.errogeral=!0),r.podeScanear&&(n(),o=setInterval(function(){r.$$destroyed&&(clearInterval(o),window.QRScanner)&&window.QRScanner.destroy()},200))},r.init(),r.removerCorBackground=function(){$("body").attr("style","background-color: rgba(0,0,0,0) !important"),$("html").attr("style","background-color: rgba(0,0,0,0) !important")},r.pedirPermissao=function(){n()};r.toggleCamera=function(){r.getStatusCamera().then(function(o){o.canChangeCamera||t.showToast("Não foi possível trocar de câmera"),1==o.currentCamera&&QRScanner.useBackCamera(function(o,e){o?(console.error(o),t.showToast("Não foi possível trocar a câmera")):i()}),0==o.currentCamera&&QRScanner.useFrontCamera(function(o,e){o?(console.error(o),t.showToast("Não foi possível trocar a câmera")):i()})}).catch(function(o){console.error(o)}),r.removerCorBackground()},r.toggleLuz=function(){r.getStatusCamera().then(function(o){o.canEnableLight||t.showToast("Não foi possível ligar a luz do flash"),o.lightEnabled&&QRScanner.disableLight(function(o,e){o?(console.error(o),t.showToast("Não foi possível desligar a luz do flash")):(r.luzLigada=!1,r.$apply(),r.removerCorBackground())}),o.lightEnabled||QRScanner.enableLight(function(o,e){o?(console.error(o),t.showToast("Não foi possível ligar a luz do flash")):(r.luzLigada=!0,r.$apply(),r.removerCorBackground())})}).catch(function(o){console.error(o)}),r.removerCorBackground()},r.getStatusCamera=function(){var a=o.defer();return QRScanner.getStatus(function(o,e){e?(t.showToast("Ops, algo de errado aconteceu"),a.reject("Não foi possível obter o status da compra")):(o.lightEnabled&&(r.luzLigada=!0),a.resolve(o))}),a.promise},r.abrirConfiguracoes=function(){QRScanner.openSettings()}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/live/list",{controller:"LiveListCtrl",templateUrl:"angular/app/livecommerce/partials/list.tpl.html"}).when("/live/stream",{controller:"LiveBroadcastCtrl",templateUrl:"angular/app/livecommerce/partials/broadcast.tpl.html"}).when("/live",{controller:"LiveWatchCtrl",templateUrl:"angular/app/livecommerce/partials/watch.tpl.html"})}]).controller("LiveListCtrl",["$scope","LiveCommerceService","CkImageSelector",function(o,e,a){o.salas=[],o.carregando=!1,o.testarImgSelector=function(){var o=a.new().maxsize(4194304).maxwidth(2e3).iconsize(174080).iconwidth(50).iconify().multiple().secure();a.show(o).then(function(o){}).catch(function(){})}}]).controller("LiveBroadcastCtrl",["$scope","$rootScope","$mdDialog","LiveCommerceService",function(t,e,a,r){t.uiState={live:{configurando:!1,iniciando:!1,encerrando:!1,reiniciando:!1,transmitindo:!1,iniciada:!1,encerrada:!1},media:{gravando:!1},transcoder:{conectado:!1,tentandoConexao:!1},livecomm:{conectado:!1,tentandoConexao:!1}},t.erroCritico={houveErro:!1,mensagem:""},t.AutenticacaoNecessaria=1,t.Autorizado=2,t.NaoAutorizado=3,t.statusAutenticacao=t.AutenticacaoNecessaria,t.auth={pwd:""},t.autenticando=!1,t.duracao="00:00",t.qtdeEspectadores=0,t.pesquisaDrops="",t.pesquisandoDrops=!1,t.timeoutPesquisaDrops=0,t.drops=[];var n={id:0,idAplicacao:0,titulo:"Live do Droper",label:"droperlive",descricao:"Venda sua alma e compre tênis",anfitriao:"Droper Team",banner:"https://wallhaven.cc/w/oxydp9",link:"",metadata:"{}",inicioEstimado:null,fimEstimado:null,inicio:null,fim:null,inicioUnix:0,fimUnix:0,emDestaque:!(t.dropsSelecionados=[]),segredo:function(o){for(var e="",a="A".charCodeAt(),r=0;r<o;r++){var t=Math.round(26*Math.random()),n=Math.round(Math.random());e+=String.fromCharCode(a+t+32*n)}return e}(16),isAtivo:!1,foiIniciada:!1,foiEncerrada:!1,emAndamento:!1,estaPausado:!1,ivsChannel:{name:"",arn:"",streamKey:"",ingestUrl:"",playbackUrl:""}},i={available:{audio:[],video:[]},selected:{audioIdx:0,videoIdx:0}},c={livecomm:{conn:null,reconnectInterval:0,permanentementeFechado:!1},transcoder:{conn:null,reconnectInterval:0,permanentementeFechado:!1}},s=null,l=null,d=0;function u(){P().then(function(){i.selected.videoIdx=0,i.selected.audioIdx=0}),t.uiState.live.configurando=!0,r.configurarLive(n.label,n).then(function(o){n=o.data,t.uiState.live.configurando=!1,t.uiState.live.iniciada=!1,t.uiState.live.encerrada=n.foiEncerrada;try{t.$apply()}catch(o){}C(),b(),n.metadata&&(o=JSON.parse(n.metadata)).drops&&(t.dropsSelecionados=o.drops)}).catch(function(o){t.erroCritico.houveErro=!0,t.erroCritico.mensagem=o.error||"Não conseguimos configurar a live para iniciar a transmissão :(",t.uiState.live.configurando=!1})}function o(){if(s)for(var o=s.getTracks(),e=0;e<o.length;e++)o[e].stop()}function f(){if(l&&l.stop)try{l.stop(),l=null}catch(o){}}function m(){r.ajustarProporcaoCanvas("ck-live-canva","ck-live-nav-top","ck-live-nav-bottom")}function g(o){var e;o&&(d&&window.clearInterval(d),e=r.contagem(o),d=window.setInterval(function(){t.duracao=e(),t.$apply()},1e3))}function h(){t.pesquisaDrops&&(t.pesquisandoDrops=!0,r.getDrops(t.pesquisaDrops).then(function(o){t.drops=o}).catch(function(o){}).finally(function(){t.pesquisandoDrops=!1}))}function v(){return t.uiState.live.reiniciando=!0,t.uiState.live.iniciada=!1,r.resetarLive(n.id).then(function(o){n=o.data,t.uiState.live.reiniciando=!1,t.uiState.live.iniciada=!0}).catch(function(o){t.erroCritico.houveErro=!0,t.erroCritico.mensagem=o.error||"Não foi possível reiniciar a live",t.uiState.live.reiniciando=!1})}function w(){var o={drops:t.dropsSelecionados};n.metadata=JSON.stringify(o),r.alterarMetadata(n.id,n).then(function(o){}).catch(function(o){console.error("livecomm:metadata:err",o)})}function C(o){var e;t.uiState.transcoder.conectado=!1,t.uiState.transcoder.tentandoConexao=!0,n&&n.ivsChannel&&(e=r.transcoderHost()+"/"+n.ivsChannel.ingestUrl+"/"+n.ivsChannel.streamKey,c.transcoder.conn=new WebSocket(e),c.transcoder.conn.onopen=function(){c.transcoder.permanentementeFechado=!1,t.uiState.transcoder.conectado=!0,t.uiState.transcoder.tentandoConexao=!1,T(),t.rtcState.transmissaoIniciada&&k(),o&&o()},c.transcoder.conn.onmessage=function(o){},c.transcoder.conn.onerror=function(o){console.error("ws.transcoder err",o),c.transcoder.conn.close()},c.transcoder.conn.onclose=function(){t.rtcState.transmissaoIniciada&&f(),c.transcoder.permanentementeFechado||(t.uiState.transcoder.conectado=!1,t.uiState.transcoder.tentandoConexao=!0,T(),window.setTimeout(C,1e3))})}function b(){t.uiState.livecomm.conectado=!1,t.uiState.livecomm.tentandoConexao=!0;var o=r.broadcastWsEndpoint(n);c.livecomm.conn=new WebSocket(o),c.livecomm.conn.onopen=function(){t.uiState.livecomm.conectado=!0,t.uiState.livecomm.tentandoConexao=!1,T()},c.livecomm.conn.onmessage=function(e){try{var o=e,a=JSON.parse(o.data),r={name:(o={event:a.event||a.Event||"",message:a.message||a.Message||"",data:a.data||a.Data||{},watcherCount:a.watcherCount||a.WatcherCount||0}).data.name||o.data.Name||"",arn:o.data.arn||o.data.Arn||"",streamKey:o.data.streamKey||o.data.StreamKey||"",ingestUrl:o.data.ingestUrl||o.data.IngestUrl||"",playbackUrl:o.data.playbackUrl||o.data.PlaybackUrl||""};switch(o.event){case"ivschan_info":n.ivsChannel=r;break;case"watcher_count":t.qtdeEspectadores=o.watcherCount}}catch(o){console.error("Não consegui interpretar a última mensagem",e)}},c.livecomm.conn.onerror=function(o){console.error("ws.livecomm err",o),c.livecomm.conn.close()},c.livecomm.conn.onclose=function(){c.livecomm.permanentementeFechado||(t.uiState.livecomm.conectado=!1,t.uiState.livecomm.tentandoConexao=!0,T(),window.setTimeout(b,1e3))}}function S(o){return!!o&&(!o.deviceId||{deviceId:{exact:o.deviceId}})}function P(){if(t.rtcState.suportaWebRTC)return i.available.video=[],i.available.audio=[],navigator.mediaDevices.enumerateDevices().then(function(o){for(var e=0;e<o.length;e++){var a=o[e];"videoinput"===a.kind&&i.available.video.push(a),"audioinput"===a.kind&&i.available.audio.push(a)}}).catch(function(o){console.error("navigator.mediaDevices.enumerateDevices",o)})}function y(){o=i.available.video&&i.available.video.length;var o={audio:!!(i.available.audio&&i.available.audio.length)&&S(i.available.audio[i.selected.audioIdx]),video:!!o&&S(i.available.video[i.selected.videoIdx])};return navigator.mediaDevices.getUserMedia(o).then(function(o){var e;s=o,t.rtcState.possuiStream=!!s,o=s,(e=document.getElementById("stream"))&&(e.srcObject=o)}).catch(function(o){})}function k(){var o;s&&(o=document.querySelector("video"))&&(o.captureStream=o.captureStream||o.mozCaptureStream,t.rtcState.iniciandoTransmissao=!0,(l=new MediaRecorder(s,{})).addEventListener("dataavailable",function(o){c.transcoder.conn&&c.transcoder.conn.readyState===WebSocket.OPEN&&c.transcoder.conn.send(o.data)}),l.start(100),t.rtcState.iniciandoTransmissao=!1,t.rtcState.transmissaoIniciada=!0)}function T(){try{t.$apply()}catch(o){}}t.rtcState={suportaWebRTC:navigator&&navigator.mediaDevices&&RTCPeerConnection,permitiuAcessoCamera:!1,possuiStream:!1,transmissaoIniciada:!1,iniciandoTransmissao:!1},t.transcoder={rtmpUrl:"rtmps://ae45661d685f.global-contribute.live-video.net:443/app/sk_us-east-1_MUMZkeSUwMjt_v580iu93sSvwHDxiXVmXd9w4qnSuJ2",url:"wss://ctlk.co",ws:null},t.autenticar=function(){t.auth&&t.auth.pwd&&t.auth.pwd.length?(t.autenticando=!0,r.autenticarStreamer(t.auth.pwd).then(function(o){t.statusAutenticacao=t.Autorizado,u()}).catch(function(o){t.statusAutenticacao=t.NaoAutorizado}).finally(function(){t.autenticando=!1})):e.showToast("Especifique a senha para autenticar")},window.addEventListener("resize",function(o){m()},!0),window.onload=function(){m()},t.pedirPermissaoCamera=function(){y(),t.rtcState.permitiuAcessoCamera=!0},t.iniciarLive=function(){function o(){t.uiState.live.iniciada=!0,t.uiState.live.encerrada=!1}n.foiIniciada&&!n.foiEncerrada?(k(),g(n.inicioUnix),o()):n.foiEncerrada?v().then(t.iniciarLive):(t.uiState.live.iniciada=!1,t.uiState.live.iniciando=!0,r.iniciarLive(n.id).then(function(o){n=o.data,t.uiState.live.iniciando=!1,t.uiState.live.inicada=!0}).catch(function(o){t.erroCritico.houveErro=!0,t.erroCritico.mensagem=o.error||"Não conseguimos iniciar a live",t.uiState.live.iniciando=!1}).then(function(){k(),g(n.inicioUnix),o()})),t.uiState.transmitindo=!0},t.reiniciarLive=function(){v().then(function(){t.uiState.live.iniciada=!1,t.uiState.live.encerrada=!1}).catch(function(o){console.error("reinit err",o),e.showToast("Ops! Algo deu errado")})},t.showPopUp=function(o,e,a){r.showPopUp(e)},t.encerrarLive=function(){var o=a.confirm().title("Deseja encerrar a live?").ok("Sim, encerrar").cancel("Não");a.show(o).then(function(){t.uiState.live.encerrada=!1,t.uiState.live.encerrando=!0,r.encerrarLive(n.id).then(function(o){n=o.data,t.uiState.live.encerrando=!1,t.uiState.live.encerrada=!0,t.uiState.live.iniciada=!1}).catch(function(o){console.error("erro ao encerrar live"),t.erroCritico.houveErro=!0,t.erroCritico.mensagem=o.error||"Não foi possível encerrar a live",t.uiState.live.encerrando=!1})})},t.trocarCamera=function(){P().then(function(){i&&i.available&&i.available.video&&(i.selected.videoIdx=(i.selected.videoIdx+1)%i.available.video.length),o(),y().then(function(){l&&(f(),k())})})},t.toggleDrops=function(){r.togglePopup("ck-live-options--mobile_produtos")},t.toggleDropsSelecionados=function(){r.togglePopup("")},t.toggleOpcoes=function(){r.togglePopup("ck-live-options--mobile_opcoes")},t.agendarPesquisaDrops=function(){t.timeoutPesquisaDrops&&window.clearTimeout(t.timeoutPesquisaDrops);t.timeoutPesquisaDrops=window.setTimeout(h,500)},t.urlDrop=function(o){return"https://droper.app/d/"+o.id+"/"+o.query},t.selecionarDrop=function(o){t.dropsSelecionados=[o],t.toggleDrops(),w()},t.dispensarDrop=function(o){if(t.dropsSelecionados&&t.dropsSelecionados.length){for(var e=[],a=0;a<t.dropsSelecionados.length;a++)t.dropsSelecionados[a]!==o&&e.push(p);t.dropsSelecionados=e,w()}else t.dropsSelecionados=[]}}]).controller("LiveWatchCtrl",["$scope","$rootScope","$mdDialog","LiveCommerceService",function(t,r,o,a){var e,n,i,c={houveErro:!(t.uiState={live:{carregando:!1,pronto:!1,naoEncontrada:!1,temBroadcaster:!1,iniciada:!1,encerrada:!1},ws:{tentandoConexao:!1,conectado:!1},video:{carregando:!1,mostrarBtnRecarregar:!1,desabilitarBtnRecarregar:!1}}),mensagem:""},s={livecomm:{conn:null,permanentementeFechado:!1}},l={id:0,idAplicacao:0,titulo:"Live do Droper",label:"droperlive",descricao:"Venda sua alma e compre tênis",anfitriao:"Droper Team",banner:"https://wallhaven.cc/w/oxydp9",link:"",metadata:"{}",inicioEstimado:null,fimEstimado:null,inicio:null,fim:null,inicioUnix:0,fimUnix:0,emDestaque:!1,isAtivo:!1,foiIniciada:!1,foiEncerrada:!1,emAndamento:!1,estaPausado:!1,ivsChannel:{name:"",arn:"",streamKey:"",ingestUrl:"",playbackUrl:""}},d={err:null,qtdeTentativas:0,tentativasAteRecarregar:5},u=0;function f(){s&&s.livecomm&&s.livecomm.conn&&s.livecomm.conn.close&&(s.livecomm.permanentementeFechado=!0,s.livecomm.conn.close()),window.clearInterval(0),window.clearInterval(u)}function m(){a.ajustarProporcaoCanvas("ck-live-canva","ck-live-nav-top","ck-live-nav-bottom")}function g(){t.uiState.live.carregando=!0,t.uiState.live.pronto=!1,t.uiState.live.naoEncontrada=!1,a.obterLivePorLabel(l.label).then(function(o){l=o.data,t.uiState.live.carregando=!1,t.uiState.live.pronto=!0,C(),l.metadata&&w(l.metadata);try{var e,a,r;l&&l.link?(e={type:"application/x-mpegURL",src:l.link},a=function(){t.uiState.video.carregando=!1,r.src(e),r.play()},(r=window.videojs("stream",{errorDisplay:!1},a)).on("error",function(){d.err=r.error();(4!==d.err.code&&3!==d.err.code||(window.setTimeout(a,2e3),t.uiState.video.carregando=!0,d.qtdeTentativas+=1,d.qtdeTentativas>d.tentativasAteRecarregar))&&(t.uiState.video.mostrarBtnRecarregar=!0)}),r.on("play",function(){t.uiState.video.mostrarBtnRecarregar=!1,d.qtdeTentativas=0})):console.error("Não é possível iniciar vídeo: o playbackUrl não foi encontrado"),v(l.inicioUnix),h()}catch(o){}try{t.$apply()}catch(o){}}).catch(function(o){c.houveErro=!0,c.mensagem=o.error||"Não conseguimos encontrar esta live!",t.uiState.live.carregando=!1,t.uiState.live.naoEncontrada=!0})}function h(){t.uiState.ws.conectado=!1,t.uiState.ws.tentandoConexao=!0;var o=a.watchWsEndpoint(l);s.livecomm.conn=new WebSocket(o),s.livecomm.conn.onopen=function(){t.uiState.ws.conectado=!0,t.uiState.ws.tentandoConexao=!1,b()},s.livecomm.conn.onmessage=function(o){var e=o,o=JSON.parse(e.data),a={name:(e={event:o.event||o.Event||"",message:o.message||o.Message||"",data:o.data||o.Data||{},watcherCount:o.watcherCount||o.WatcherCount||0}).data.name||e.data.Name||"",arn:e.data.arn||e.data.Arn||"",streamKey:e.data.streamKey||e.data.StreamKey||"",ingestUrl:e.data.ingestUrl||e.data.IngestUrl||"",playbackUrl:e.data.playbackUrl||e.data.PlaybackUrl||""};switch(e.event){case"ivschan_info":l.ivsChannel=a;break;case"watcher_count":t.qtdeEspectadores=e.watcherCount,b();break;case"not_found":t.uiState.live.naoEncontrada=!0;break;case"metadata":w(e.data.metadata||e.data.Metadata),b();break;case"live_data":!function(o){l.titulo=o.Titulo,l.descricao=o.Descricao,l.anfitriao=o.Anfitriao,l.banner=o.Banner,l.link=o.Link,l.inicio=o.Inicio,l.inicioUnix=o.InicioUnix,l.fim=o.Fim,l.fimUnix=o.FimUnix,C(),l.fim&&(r.showToast("A live acabou"),r.voltarPagina())}(e.data),b();break;case"broadcaster_out":r.showToast((l.anfitriao||"O dono da live")+" saiu.");break;case"broadcaster_in":r.showToast((l.anfitriao||"O dono da live")+" voltou! O vídeo pode recomeçar em breve.")}},s.livecomm.conn.onerror=function(o){console.error("ws.livecomm err",o),s.livecomm.conn.close()},s.livecomm.conn.onclose=function(){s.livecomm.permanentementeFechado||(t.uiState.ws.conectado=!1,t.uiState.ws.tentandoConexao=!0,b(),window.setTimeout(h,1e3))}}function v(o){var e;o&&!u&&(e=a.contagem(o),u=window.setInterval(function(){t.duracao=e(),b()},1e3))}function w(o){o&&(l.metadata=o,(o=JSON.parse(o)).drops)&&(t.drops=o.drops,b())}function C(){l.inicio&&(t.uiState.live.iniciada=!0,v(l.inicioUnix)),l.fim&&(t.uiState.live.encerrada=!0),b()}function b(){try{t.$apply()}catch(o){}}t.drops=[],t.qtdeEspectadores=0,t.rtcState={suportaWebRTC:navigator&&RTCPeerConnection},t.fechar=function(){f(),r.voltarPagina()},t.recarregar=function(){t.uiState.video.desabilitarBtnRecarregar=!0,location.reload(!1)},t.procurandoSala=!1,t.possuiSala=!0,t.rtcState.suportaWebRTC=!0,i=g,window.videojs||$.getScript("angular/comp/video.js/dist/video.min.js",i),window.registerIVSTech||$.getScript("angular/comp/amazon-ivs-videojs-tech/amazon-ivs-videojs-tech.min.js"),i="videojs-css",document.getElementById(i)||(e=document.querySelector("head"),(n=document.createElement("link")).id=i,n.rel="stylesheet",n.type="text/css",n.href="angular/comp/video.js/dist/video-js.min.css",n.media="all",e.appendChild(n)),window.addEventListener("resize",function(o){m()},!0),window.onload=function(){m()},t.verDrop=function(o){f(),r.irPara("d/"+o.id+"/"+o.query)},t.urlDrop=function(o){return"https://droper.app/d/"+o.id+"/"+o.query},t.dispensarDrop=function(o){if(t.drops&&t.drops.length){for(var e=[],a=0;a<t.drops.length;a++)t.drops[a]!==o&&e.push(p);t.drops=e,b()}else t.drops=[]}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/u/recuperarsenha/",{controller:"LoginCtrl",templateUrl:"angular/app/login/partials/buscarconta.tpl.html",tabControl:"Mais",title:"Redefinição de senha"}).when("/u/recuperarsenha/:token",{controller:"LoginCtrl",templateUrl:"angular/app/login/partials/recuperarsenha.tpl.html",tabControl:"Mais",title:"Redefinição de senha"})}]).controller("LoginCtrl",["$scope","$rootScope","$timeout","$mdSidenav","LoginService","$routeParams",function(a,e,o,r,t,n){a.feed=1,a.enviarEmailRecuperacao=function(e){a.enviando=!0,t.enviarRecuperacaoSenha(e).then(function(o){a.feed=2,a.email=e.email}).catch(function(o){a.feed=3}).finally(function(){a.enviando=!1})},a.validarToken=function(){a.carregando=!0,t.validarTokenRecuperarSenha(n.token).then(function(o){a.email=o.email}).catch(function(o){e.showToast("Sessão de troca de senha expirou!"),e.irPara("erro/404")}).finally(function(){a.carregando=!1})},a.redefinirSenha=function(o){a.salvando=!0,t.redefinirSenha(n.token,o).then(function(o){e.showToast("Senha redefinida com sucesso"),e.irPara("entrar")}).catch(function(o){e.formErrorBinder(a,o)}).finally(function(){a.salvando=!1})}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/l/:conta",{controller:"LojaCtrl",templateUrl:"angular/app/loja/partials/loja.tpl.html",tabControl:"Busca",title:""}).when("/c/:idcliente",{controller:"VendedorCtrl",templateUrl:"angular/app/loja/partials/vendedor.tpl.html",tabControl:"Busca",title:""}).when("/produto/:idproduto/old",{controller:"ProdutoCtrl",templateUrl:"angular/app/loja/partials/produtov3.tpl.html",tabControl:"Busca"}).when("/produto/:idproduto",{controller:"ProdutoCtrl",templateUrl:"angular/app/loja/partials/produtov4.tpl.html",tabControl:"Busca"}).when("/produto/:idproduto/fotos",{controller:"ProdutoCtrl",templateUrl:"angular/app/loja/partials/produtofotos.tpl.html",tabControl:"Busca",title:"Produto | Droper"}).when("/p/:nome/:idproduto",{controller:"ProdutoCtrl",templateUrl:"angular/app/loja/partials/produtov3.tpl.html",tabControl:"Busca",title:"Produto | Droper"}).when("/l/:conta/avaliacoes",{controller:"RateCtrl",templateUrl:"angular/app/loja/partials/avaliacoes.tpl.html",tabControl:"Busca",title:"Avaliações"}).when("/c/:idcliente/avaliacoes",{controller:"RateCtrl",templateUrl:"angular/app/loja/partials/avaliacoes.tpl.html",tabControl:"Busca",title:"Avaliações"}).when("/l/:conta/avaliar",{controller:"RateCtrl",templateUrl:"angular/app/loja/partials/avaliar.tpl.html",tabControl:"Busca",title:"Avaliar loja"}).when("/comentario/:idcomentario",{controller:"ProdutoCtrl",templateUrl:"angular/app/comentario/partials/comentario.tpl.html",tabControl:"Busca",title:"Comentário"})}]).run(["$templateCache","$http",function(e,o){o.get("angular/app/loja/partials/previewProdutoDialog.tpl.html").then(function(o){e.put("previewProdutoDialog.cached.html",o.data)})}]).controller("LojaCtrl",["$scope","$rootScope","$routeParams","$location","$timeout","$mdDialog","$mdMedia","$anchorScroll","LojaService","UserStore","anchorSmoothScroll",function(n,e,a,o,r,t,i,c,s,l,d){var u;n.$mdMedia=i,n.showInputBusca=!1,n.isEletronico=!0,n.conta=a.conta,n.carregarLoja=function(){n.dadosProdutos={},n.carregandoLoja=!0,n.showInputBusca=!1;var o=a.conta;s.obterLojaPublic(o).then(function(o){n.dadosLoja=o.dadosLoja,n.dadosCategorias=o.dadosCategoria,n.carregandoLoja=!1,n.filtrarProdutoPorCategoria(o.dadosLoja.id,0,null),e.changePageTitle(n.dadosLoja.nome)}).catch(function(o){n.carregandoLoja=!1,n.carregandoProdutos=!1,e.showToast("Ops, algo de errado aconteceu. Tente novamente mais tarde!")})},n.filtrarProdutoPorCategoria=function(o,e,a){$(".ranking-category-table-btn").removeClass("chips-btn-clicked"),n.limpaProdutos();var r,t=n.showInputBusca=!1;a&&(t=!0,d.scrollTo("ranking-category-mousewheel"),(r=$(a.currentTarget)).addClass("chips-btn-clicked"),r.addClass("chips-btn-waiting")),s.obterProdutosPorCategoria(o,e).then(function(o){n.dadosLoja.totalProdutos=o.length,n.dadosProdutos=o,t&&r.removeClass("chips-btn-waiting")}).catch(function(o){}).finally(function(){n.carregandoProdutos=!1})},n.buscarProduto=function(o){u&&r.cancel(u),u=r(function(){u=null,n.carregandoProdutos=!0,s.obterProdutosPorTermo(n.dadosLoja.id,o).then(function(o){n.dadosProdutos=o}).catch(function(o){}).finally(function(){n.carregandoProdutos=!1})},700)},n.limpaProdutos=function(){n.dadosProdutos={},n.carregandoProdutos=!0},n.contaVs=function(o){l.setLojaVs(o)&&s.lojaCountVs(o).then(function(o){}).catch(function(){})},n.showInfoLoja=function(o){t.show({controller:"LojaCtrl",templateUrl:"angular/app/loja/partials/lojaInfoDialog.tpl.html",parent:angular.element(document.body),scope:n,preserveScope:!0,targetEvent:o,fullscreen:!0,clickOutsideToClose:!window.cordova}).then(function(){},function(){})},n.carregarSeguidores=function(){n.carregandoSeguidoresLoja=!0,n.seguidoresErro=!1,s.obterSeguidores(n.dadosLoja.id).then(function(o){n.seguidores=o.seguidores}).catch(function(o){n.seguidoresErro=!1}).finally(function(){n.carregandoSeguidoresLoja=!1})}}]).controller("VendedorCtrl",["$scope","$rootScope","$routeParams","$mdDialog","$mdMedia","LojaService",function(e,a,o,r,t,n){e.$mdMedia=t,e.idcliente=o.idcliente,e.carregar=function(){e.carregando=!0,n.obterVendedor(o.idcliente).then(function(o){e.dados=o,e.carregarProdutos()}).catch(function(o){e.erro=!0}).finally(function(){e.carregando=!1})},e.carregarProdutos=function(){e.carregandoProdutos=!0,n.obterProdutosVendedor(o.idcliente).then(function(o){e.produtos=o}).catch(function(){e.erro=!0}).finally(function(){e.carregandoProdutos=!1})},e.shareLink=function(o){a.showShareLink("c/"+e.idcliente,"cliente",o,e.dados.vendedor.nome,e.dados.vendedor.foto)}}]).controller("ProdutoCtrl",["$scope","$rootScope","$routeParams","$mdDialog","$location","LojaService","AuthFactory","ComentarioService","DenunciaService","UserStore","ckTagManagerService","ClienteService","$mdMedia","ckComp","CkObserver","CkMasksService","CkViewUtils",function(s,l,e,o,r,t,n,a,i,c,d,u,p,f,m,g,h){function v(o){switch(o.tipo){case"comentariosCarregados":s.comentariosCarregados=o.valor;break;case"ofertaRealizada":s.ofertaRealizada=o.valor;break;case"fazendoOferta":s.fazendoOferta=o.valor;break;case"podePerguntar":s.podePerguntar=o.valor;break;case"meuProduto":s.isMeuProduto=o.valor}s.temOferta=!0}s.$mdMedia=p,s.idUsuario=n.get().id,s.isIOS=l.isIOS(),s.showGlider=!0,s.body=null,s.abrirDivOferta=!1,s.ofertaRealizada=!1,s.temOferta=!1,s.comentariosObserver=m.new(),s.isMeuProduto=!1,s.oferta={valor:null},s.carregarProduto=function(){var a,o;f.load("jquery.zoom.js").then(function(){}),s.$root=l,s.idTamanhoSelecionado=null,s.carregandoProduto=!0,s.erroproduto=!1,s.islogado=n.isLoggedIn(),s.isCarrinho=!1,l.mensagemCompra=null,s.fotoSelecionada={},s.fotosSobrandoNaLista=0,s.comentariosObserver.onnotify(v),s.isDialog=!1,null!=e.idproduto?a=e.idproduto:null==l.showProdutoId&&null==l.showProdutoId||(a=l.showProdutoId,s.isDialog=!0,s.isCarrinho=-1<(o=r.path()).indexOf("/compra/")&&-1<o.indexOf("/anuncios")),t.obterProdutoV2(a).then(function(o){var e,r,t,n,i;function c(){var a,o=$(n);null!=o&&0<=o.length&&0<=o[0].childNodes.length&&(a=o[0].childNodes,angular.forEach(t,function(o,e){$(a[e]).css("background-image","url("+o.linkIcon+")")}))}s.produto=o.produto,s.fotoSelecionada={link:o.produto.fotoPrincipal,linkIcon:o.produto.fotoPrincipal,id:a},s.produto.fotoSecundarias.unshift(s.fotoSelecionada),s.produto.temFotosSecundarias=!0,s.produto.temMaisDe2Fotos=1<s.produto.fotoSecundarias.length,s.contarVs(a),l.changePageTitle(o.produto.nome),o=s.produto||{},e=o.Drop||{},d.productDetail("",o.id,e.id,o.nome,o.precof,e.precofRetail,o.tituloTipoProduto,o.marca||e.marca,1,""),s.body=s.isDialog?$("md-dialog-content"):$("html"),r=l.isXS()?"id-anuncio-glider-xs":"id-anuncio-glider",t=s.produto.fotoSecundarias,o=l.isXS()?"id-anuncio-glider-dots-xs":"id-anuncio-glider-dots",n="#"+o,(i=$("#"+r)).ready(function(){window.glider&&window.glider.destroy();var o=document.getElementById(r),e=parseFloat(o.getAttribute("data-slide-to-show")),e=(window.glider=new Glider(o,{draggable:!0,slidesToScroll:1,slidesToShow:e,scrollLock:!0,rewind:!0,resizeLock:!0,dots:n,dragVelocity:.8}),$(n)),a=parseFloat(e.css("padding-left").replace("px",""));c(),o.addEventListener("glider-slide-visible",function(o){var o=o.detail.slide,e=$(".glider-dots-table"),o=$("[data-index="+o+"]")[0].offsetLeft;e.animate({scrollLeft:o-a},100),window.cordova&&!l.isIOS()&&l.vibrate(5)}),o.addEventListener("glider-refresh",function(o){c()}),p("xs")||(e=$(".glider-track"),800<=$(window).height()&&(i.height(750),e.height(750)),1e3<=$(window).height()&&(i.height(900),e.height(900)))})}).catch(function(o){s.erroproduto=!0}).finally(function(){s.carregandoProduto=!1})},s.clickFotoAnuncio=function(e){var a;s.showGlider||s.body.animate({scrollTop:0},300),s.showGlider&&(a="#id-anuncio-zoom",$(a).ready(function(){var o=$("[data-zoom-index="+e+"]").offset().top-(l.isIOS()?700:100),o=(s.body.animate({scrollTop:o},500),$(a)[0].children);angular.forEach(o,function(o,e){$(o).zoom({magnify:2,on:"grab"})})})),s.showGlider=!s.showGlider},s.irParaVitrine=function(o,e,a){r.path().includes("/home")||r.path().includes("/buscar")||r.path().includes("/")?(a?l.verLoja(e):l.irPara(e),l.hideDialog()):o?l.hideDialog():a?l.verLoja(e):l.irPara(e)},s.contarVs=function(o){c.setProdutoVs(o)&&t.produtoCountVs(o)},s.carregarProdutoComentario=function(){s.carregandoProdutoComentario=!0,s.idcomentario,e.idcomentario?(s.idcomentario=e.idcomentario,s.isDialog=!1):s.isDialog=!0,a.obterProdutoComentario(s.idcomentario).then(function(o){s.produto=o.produto,s.local=o.local}).catch(function(o){s.erro=!0}).finally(function(){s.carregandoProdutoComentario=!1})},s.verAvaliacoes=function(o){o.isLoja?l.irPara("/l/"+o.url+"/avaliacoes"):l.irPara(o.url+"/avaliacoes"),l.hideDialog()},s.selecionarTamanho=function(o){s.idTamanhoSelecionado=o.id},s.irParaDrop=function(o){l.irPara("/d/"+o.id+"/"+o.query),l.hideDialog()},s.carregarProdutoFavorito=function(e){s.carregandoProdutoFavorito=!0,s.produtoFavoritado=!1,n.isLoggedIn()&&"1"==n.get().tipo&&null!=e?u.obterProdutoFavorito(n.getToken(),e.id).then(function(o){e.isFavoritado=o}).catch(function(o){}).finally(function(){s.carregandoProdutoFavorito=!1}):s.carregandoProdutoFavorito=!1},s.toggleProdutoFavorito=function(e){s.carregandoProdutoFavorito=!0,n.isLoggedIn()&&"1"==n.get().tipo?(e.isFavoritado?u.desfavoritarProduto(n.getToken(),e.id).then(function(o){e.isFavoritado=!1}).catch(function(o){}):u.favoritarProduto(n.getToken(),e.id).then(function(o){e.isFavoritado=!0}).catch(function(o){})).finally(function(){s.carregandoProdutoFavorito=!1}):(l.hideDialog(),l.showToast("Entre com seu Facebook para favoritar o produto"),l.irParaLogin())},s.verificandoDenuncia=!1,s.podeDenunciar=!1,s.denunciar=function(o){l.irPara("produto/"+o.id+"/denunciar")},s.carregarSimulacaoFrete=function(){s.produto&&s.produto.id&&(s.carregandoSimulacaoFrete=!0,t.simularFretes(s.produto.id).then(function(o){s.simulacaoFrete=o}).catch(function(o){s.erroSimulacaoFrete=o}).finally(function(){s.carregandoSimulacaoFrete=!1}))},s.fazerOferta=function(o){console.log("oferta",o),s.comentariosObserver.broadcast({tipo:"oferta",valor:o})},s.onOfertaClose=function(){s.abrirDivOferta=!1},s.onAbrirOferta=function(o){s.podePerguntar?(s.abrirDivOferta=!0,h.esperarElemento("#inputOferta").then(function(o){o.focus()}).catch(function(){})):(s.comentariosObserver.broadcast({tipo:"responder"}),l.hideDialog())},s.maskPreco=function(){var o=g.monetario(s.oferta.valor);s.oferta.valor!==o&&(s.oferta.valor=o),console.log("oferta",s.oferta)},s.temOferta=!1}]).controller("RateCtrl",["$scope","$rootScope","$mdDialog","$routeParams","$location","$mdMedia","AvaliacaoService","AuthFactory",function(a,r,t,e,o,n,i,c){a.mdMedia=n,a.idcliente=e.idcliente,a.conta=e.conta,a.carregarAvaliacoes=function(){var o;a.carregando=!0,e.conta&&(o=e.conta,a.tipo=2),e.idcliente&&(o=e.idcliente,a.tipo=1),i.obterAvaliacoes(o,a.tipo).then(function(o){a.dados=o}).catch(function(o){r.showToast("Ops, algo de errado aconteceu")}).finally(function(){a.carregando=!1})},a.showDialogAvaliacoes=function(o){var e=o.isLoja?o.idLoja:o.idCliente;a.tipo=o.isLoja?"2":"1",t.show({controller:"RateCtrl",templateUrl:"angular/app/loja/partials/avaliacoesDialog.tpl.html",fullscreen:!1,scope:a,clickOutsideToClose:!!window.cordova,preserveScope:!0}).then(function(){},function(){}),a.carregando=!0,i.obterAvaliacoes(e,a.tipo).then(function(o){a.dados=o}).catch(function(o){r.hideDialog(),r.showToast("Ops, algo de errado aconteceu")}).finally(function(){a.carregando=!1})},a.showDialogAvaliacoesDoProduto=function(o){t.show({controller:"RateCtrl",templateUrl:"angular/app/loja/partials/avaliacoesDialog.tpl.html",fullscreen:!1,scope:a,clickOutsideToClose:!!window.cordova,preserveScope:!0}).then(function(){},function(){}),a.carregando=!0,i.obterAvaliacoesDoProduto(o.id).then(function(o){a.dados=o}).catch(function(o){r.hideDialog(),r.showToast("Ops, algo de errado aconteceu")}).finally(function(){a.carregando=!1})}}]).controller("ProdutoSimulacaoCtrl",["$scope","$rootScope","$mdDialog","AuthFactory","LojaService",function(e,o,a,r,t){e.obterOpcoesParcelamento=function(o){e.carregandoOpcoes=!1,e.erro=!1,a.show({controller:"ProdutoSimulacaoCtrl",templateUrl:"angular/app/loja/partials/parcelasDialog.tpl.html",parent:angular.element(document.body),fullscreen:!1,scope:e,clickOutsideToClose:!window.cordova,preserveScope:!0}).then(function(){},function(){})}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/noticias",{controller:"NewsCtrl",templateUrl:"angular/app/news/partials/list.tpl.html",tabControl:"News",title:"Notícias"}).when("/autor/:id/:nick",{controller:"NewsCtrl",templateUrl:"angular/app/news/partials/list.tpl.html",tabControl:"News",title:"Notícias"}).when("/n/:title/:id",{controller:"NewsCtrl",templateUrl:"angular/app/news/partials/news.tpl.html",tabControl:"News",title:"Notícia"})}]).controller("NewsCtrl",["$scope","$rootScope","$window","$sce","$routeParams","$mdMedia","$location","$mdDialog","NewsService","urlSharer","HomeService","CkViewState","CkViewUtils",function(r,a,o,e,t,n,c,s,l,d,u,p,f){r.$mdMedia=n,r.isPaginaAutor=!1,r.isPaginaInicial=!1,r.showCarregaMais=!1,r.segundaNoticia=[],r.terceiraNoticia=[];var m="/noticias"===c.path();r.carregarNoticias=function(){window.onscroll=function(){var o=f.estaSendoVisto("#btn-carregar-mais");!r.carregandoMaisNoticias&&o&&r.carregarMais()},r.param=t.id||0;var o=p.noticias();m&&o&&o.changed?(p.restoreScope(o.scope,r),window.setTimeout(function(){window.scroll(o.scroll.x||0,o.scroll.y||0)},300)):(r.page=0,r.amount=10,r.top=8,0<r.param&&r.carregarAutor(r.param),r.obterNoticiasV2())},r.obterNoticiasV2=function(){r.carregando=!0,l.obterNoticiasV2(r.page,r.amount,r.top).then(function(o){o.news.length>=r.amount?r.showCarregaMais=!0:r.showCarregaMais=!1,r.noticias=o.news,r.listaTopNews=o.topnews,r.primeiraNoticia=r.noticias[0],r.segundaNoticia.push(r.noticias[1]),r.noticias.splice(0,2)}).catch(function(o){console.log(o)}).finally(function(){r.carregando=!1})},r.$on("$destroy",function(){var o;m&&(o={scope:r,scroll:{x:window.scrollX,y:window.scrollY}},p.noticias(o))}),r.carregarMais=function(){r.carregandoMaisNoticias=!0,r.page=r.page+1,l.obterNoticias(r.param,r.page,r.amount).then(function(o){o.length>=r.amount?r.showCarregaMais=!0:r.showCarregaMais=!1,r.noticias=r.noticias.concat(o)}).catch(function(o){r.page=r.page-1}).finally(function(){r.carregandoMaisNoticias=!1})},r.carregarAutor=function(o){r.isPaginaAutor=!0,r.carregandoAutor=!0,l.obterAutor(o).then(function(o){r.autor=o}).catch(function(o){a.showToast("Ops, algo de errado aconteceu")}).finally(function(){r.carregandoAutor=!1})},r.carregarAutores=function(){r.isPaginaInicial=!0,r.carregandoAutores=!0,l.obterAutores().then(function(o){r.autores=o}).catch(function(o){}).finally(function(){r.carregandoAutores=!1})},r.verNoticia=function(o,e){a.irPara("n/"+o+"/"+e)},r.carregarUltimasNoticias=function(o){l.obterUltimasNoticias(o).then(function(o){r.ultimas=o}).catch(function(o){}).finally(function(){})},r.carregarNoticia=function(){r.carregandoNoticia=!0,l.obterNoticia(t.id).then(function(o){o.corpo=a.replaceAll(o.corpo,"http://","https://"),r.dados=o,window.cordova||r.carregarDisqus(o.noticia.id),a.changePageTitle(o.noticia.titulo)}).catch(function(o){a.voltarPagina(),a.showToast("Ops, ocorreu um erro ao carregar a notícia")}).finally(function(){r.carregandoNoticia=!1})},r.carregarDisqus=function(o){window.DISQUS||$.getScript("https://cataloko.disqus.com/count.js",function(o,e,a){});var e,a;e=document,(a=e.createElement("script")).src="https://cataloko.disqus.com/embed.js",a.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(a)},r.confiarHTML=function(o){return e.trustAsHtml(o)},r.formataCorpo=function(){$(document).ready(function(){for(var o=document.getElementById("news-corpo"),e=["p","span"],a=0;a<e.length;a++)r.remove_style(e[a],o)})},r.remove_style=function(o,e){var a=e.getElementsByTagName(o);for(i=0;i<a.length;i++)a[i].removeAttribute("style")},r.shareWithWhatsapp=function(o,e){e="whatsapp://send?text="+d+"n/"+e+"/"+o;window.cordova?window.open(e,"_system"):window.open(e,"_blank")},r.shareWithFacebook=function(o,e){window.open("http://www.facebook.com/sharer.php?u="+d+"n/"+e+"/"+o)},r.resolverUrlCompartilhar=function(o,e){r.url="n/"+e+"/"+o}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/notificacoes/config",{controller:"NotificacoesCtrl",templateUrl:"angular/app/notificacao/partials/config.tpl.html",tabControl:"Mais",title:"Configuração das notificações"}).when("/notificacoes",{controller:"NotificacoesCtrl",templateUrl:"angular/app/notificacao/partials/notificacoes.tpl.html",tabControl:"Mais",title:"Notificações"})}]).controller("NotificacoesCtrl",["$scope","$rootScope","$mdMedia","NotificacaoService","AuthFactory","ClienteService",function(n,e,o,a,r,i){n.preCondicoes=function(){r.isLoggedIn()||(e.irParaLogin(),e.showToast("Para ver as notificaões você precisa estar logado"))},n.carregarNotificacoes=function(){n.page=0,n.amount=10,e.turnOffNotification(),n.carregandoNotificacoes=!0,n.showMaisButton=!1,a.obterNotificacoes(r.get().id,n.page,n.amount).then(function(o){window.cordova&&window.plugins.OneSignal&&(i.verifyPermissionOneSignal(),window.plugins.OneSignal.clearOneSignalNotifications()),n.temnotificacoes=0<o.notificacoes.length,n.showMaisButton=!(o.notificacoes.length<n.amount);var e=o.notificacoes,o=o.ultimoCheck;n.notificacoesNew=[],n.notificacoesOld=[];for(var a=new Date(o),r=0;r<e.length;r++){var t=new Date(e[r].dataCriacao);(a<t?n.notificacoesNew:n.notificacoesOld).push(e[r])}}).catch(function(o){n.erro=!0}).finally(function(){n.carregandoNotificacoes=!1})},n.carregarMaisNotificacoes=function(){n.carregandoMais=!0,n.page=n.page+1,n.amount=20,a.obterNotificacoes(r.get().id,n.page,n.amount).then(function(o){n.showMaisButton=!(o.notificacoes.length<n.amount),n.notificacoesOld=n.notificacoesOld.concat(o.notificacoes)}).catch(function(o){e.showToast("Ops, algo de errado aconteceu ao buscar mais notificações")}).finally(function(){n.carregandoMais=!1})},n.carregarConfiguracaoNotificacao=function(){n.carregando=!0,a.obterNotificacoesConfig(r.get().id).then(function(o){n.dados=o}).catch(function(o){e.showToast(o)}).finally(function(){n.carregando=!1})},n.enviarNotificacaoTeste=function(o){n.enviando=!0,a.enviarNotificacoesTeste(r.get().id,o).then(function(o){e.showToast(o)}).catch(function(o){e.showToast(o)}).finally(function(){n.enviando=!1})},n.iniciarCSU=void n.preCondicoes()}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/pagamento/:id",{controller:"PagamentoCtrl",templateUrl:"angular/app/pagamento/partials/show.tpl.html",tabControl:"Mais",title:"Pagamento"}).when("/pagamento/:id/t/:token",{controller:"PagamentoCtrl",templateUrl:"angular/app/pagamento/partials/show.tpl.html",tabControl:"Mais",title:"Pagamento"}).when("/pagamento/:id/boleto",{controller:"PagamentoCtrl",templateUrl:"angular/app/pagamento/partials/boleto.tpl.html",tabControl:"Mais",title:"Boleto"}).when("/pagamento/:id/pix",{controller:"PagamentoCtrl",templateUrl:"angular/app/pagamento/partials/pix.tpl.html",tabControl:"Mais",title:"Pix"}).when("/pagamento/:id/picpay",{controller:"PagamentoCtrl",templateUrl:"angular/app/pagamento/partials/picpay.tpl.html",tabControl:"Mais",title:"PicPay"})}]).controller("PagamentoCtrl",["$scope","$rootScope","$window","$interval","$q","$location","$mdDialog","$mdMedia","$routeParams","PagamentoService","CompraService","AuthFactory","PaymentService","ClienteService","DataValidationService","EnderecoService","DeviceService","ckTagManagerService","ckTagManagerPurchaseQueue","CkCreditCardService","clearSaleApp","CkMasksService",function(c,t,o,e,a,n,r,i,s,l,d,u,p,f,m,g,h,v,w,C,b,S){function P(){return document.getElementById("cardNumber").value.substring(0,6)}function y(o,e){200==o?(null!=e&&null!=e[0]?(c.bandeiraCartao=e[0].secure_thumbnail,c.dadosCartao.payment_method_id=e[0].id,c.dadosCartao.payment_type_id=e[0].payment_type_id):c.bandeiraCartao=null,(o=document.querySelector("input[name=paymentMethodId]"))&&(o.value=e[0].id),window.Mercadopago.getInstallments({bin:P(),amount:c.compra.precoCobrado},k)):c.bandeiraCartao=null}function k(o,e){var a=document.querySelector("#installments"),r=document.createDocumentFragment();if(a.options.length=0,null!=e&&0<e.length){c.dadosCartao.issuerId=e[0].issuer.id,c.parcelas=e[0].payer_costs;var t=new Option("Escolha o nº de parcelas...","-1"),n=e[0].payer_costs;r.appendChild(t);for(var i=0;i<n.length;i++)r.appendChild(new Option(n[i].recommended_message,n[i].installments));a.appendChild(r),a.removeAttribute("disabled"),c.mostraParcelas=!0}else c.dadosCartao.issuerId=null}function T(o){c.errors=[],c.errors.push(o)}window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!1),c.mdMedia=i,c.modo,c.fingerprint=null,c.ip=null,c.config={},c.marketplace_mode=null,c.erro=!1,c.idInteressePagina=s.id,c.picpayDisponivel=!1,c.mercadopagoCheckoutDisponivel=!1,c.boletoDisponivel=!0,c.wirecardBoletoDisponivel=!1,c.wirecardCreditSingleModeDisponivel=!1,c.gerenciaNetDisponivel=!1,c.mercadoPagoCreditDisponivel=!1,c.maxipagoDisponivel=!1,c.showConfirmacaoCliente=!1,c.precisaConfirmarNumero=!1,c.parcelasWirecard=[],c.pagarmeParcelas=[],c.wirecardIP=null,c.dadosCartao={},c.dadosBoleto={},c.dadosCliente={},c.mostraParcelas=!1,c.tela=1,c.bandeiraCartao=null,c.parcelas=[],t.isCordovaCall=!1,c.errors=[],c.navegarTelas=function(){1==c.tela?t.isCordovaCall?c.cancelarPagamento():t.voltarPagina():10==c.tela&&"credt_card"==c.modo?c.tela=2:(10!=c.tela||"boleto"!=c.modo)&&3!=c.tela&&(10!=c.tela||null==c.dadosBoleto&&null==c.dadosCartao)?11==c.tela?t.showToast("Feche esta janela"):c.tela=c.tela-1:c.tela=1},c.carregarPagamento=function(){c.carregando=!0,c.carregandoAmbiente=!0,c.tela=1;var e=s.token?(u.logout(),t.isCordovaCall=!0,s.token):u.isLoggedIn()||null!=s.token&&null!=s.token?u.get().token:(t.showToast("Para pagar você precisa estar logado."),!(c.erro=!0));f.checkToken(e).then(function(o){o.token=e,u.login(o),t.isClienteLogado()}).then(function(){return l.obterConfiguracoes(s.id).then(function(o){if(c.compra=o.compra,c.config=o,c.marketplace_mode=o.marketplaceMode,c.mercadopagoCheckoutDisponivel=o.mercadopagoCheckoutDisponivel,c.boletoDisponivel=o.boletoDisponivel,c.junoBoletoDisponivel=o.junoBoletoDisponivel,c.pagarmeSingleModeDisponivel=o.pagarmeSingleModeDisponivel,c.pagarmePixModeDisponivel=o.pagarmePixModeDisponivel,c.picpayDisponivel=o.picpayDisponivel,c.mercadoPagoCreditDisponivel=o.mercadoPagoCreditDisponivel,c.transfeeraPixDisponivel=o.transfeeraPixDisponivel,c.wirecardCreditDisponivel=o.wirecardCreditDisponivel,c.wirecardBoletoDisponivel=o.wirecardBoletoDisponivel,c.wirecardDebitoDisponivel=o.wirecardDebitoDisponivel,c.maxipagoDisponivel=o.maxipagoDisponivel,c.dadosCliente=o.cliente,c.showConfirmacaoCliente=!c.dadosCliente.estaCompleto,c.precisaConfirmarNumero=o.precisarVerificarTelefone,c.dadosCliente.temDataNascimento||(c.showConfirmacaoCliente=!0),o.temErro&&(c.erro=!0,c.erroMensagem=o.mensagemErro||"A compra está temporariamente indisponível"),7==c.compra.status)t.showToast("Essa compra já foi efetuada"),c.irParaStatusPayment(c.compra.id);else{if(!o.disponivel)throw c.compraDesabilitada=!0,"A compra está temporariamente indisponível";o.produtoDisponivel||(c.erro=!0,c.erroMensagem="O item que você está comprando está indisponível"),c.carregarFingerprint(),c.carregarIP(),c.carregarParcelamento(c.compra),c.carregarClearSale();try{var e=c.compra||{},a=e.Produto||{},r=e.TamanhoSelecionado||{};v.checkout(e.id,a.id,a.idDrop,e.statusInteresse.status,a.nome,e.precoCobrado,a.preco,a.idTipoProduto,a.idMarca,1,r.titulo)}catch(o){}}})}).catch(function(o){c.erroMensagem=o,c.erro=!0}).finally(function(){c.carregando=!1,c.carregandoAmbiente=!1})},c.carregarClearSale=function(){try{o=window,e=document,a="csdp",o.CsdpObject=a,o[a]=o[a]||function(){(o[a].q=o[a].q||[]).push(arguments)},o[a].l=+new Date,r=e.createElement("script"),t=e.getElementsByTagName("script")[0],r.async=1,r.src="//device.clearsale.com.br/p/fp.js",t.parentNode.insertBefore(r,t),csdp("app",b),csdp("sessionid",u.getToken())}catch(o){console.error("cs",o)}var o,e,a,r,t},c.erroAction=function(){t.isCordovaCall?t.showToast("Feche esta janela e tente novamente"):null!=c.compra&&0<c.compra.id?t.irPara("compra/"+c.compra.id):t.irPara("compras")},c.escolherModoPagamento=function(o,e){c.modo=o,c.dadosCartao.amount=c.compra.precoCobrado,c.dadosCartao.docType="CPF","credit_card"==o||"wc_credit_card"==o||"wc_credit_card_sm"==o||"pg_credit_card"==o||"maxipago_credit_card"===o?c.precisaConfirmarNumero?c.showVerificarPhone():(c.tela=2,c.dadosBoleto={}):"boleto"==o||"picpay"==o||"mercadopagocheckout"==o||"pix"==o||"pix_pg"==o?(c.dadosCartao={},u.get(),c.dadosBoleto.nome=c.dadosCliente.nomeLegal,c.dadosBoleto.email=c.dadosCliente.email,c.dadosBoleto.docNumber=c.dadosCliente.cpf,c.dadosBoleto.docType="CPF",c.dadosBoleto.dataNascimentoDia=c.dadosCliente.dataNascimentoDia,c.dadosBoleto.dataNascimentoMes=c.dadosCliente.dataNascimentoMes,c.dadosBoleto.dataNascimentoAno=c.dadosCliente.dataNascimentoAno,c.tela=3):t.showToast("Modo de pagamento inválido")},c.resolveMeioDePagamento=function(){var o={};return o.descricaoModoCompra=c.dadosCartao.descricaoModoCompra,o.modo=c.modo,c.salvando=!1,o},c.cancelarPagamento=function(){t.isCordovaCall?window.ref?window.ref.close():c.showToast("Somente feche essa janela"):c.irPara("compra/"+c.compra.id)},c.salvarDadosCliente=function(o){o.dataNascimento=m.validarDataNascimento(o.dataNascimentoDia,o.dataNascimentoMes,o.dataNascimentoAno),null==o.dataNascimento?c.singleError="Data de nascimento inválida":(c.salvandoCliente=!0,f.editar(o.idCliente,o).then(function(o){c.dadosCliente=o,c.showConfirmacaoCliente=!1,c.salvandoCliente=!1,u.updateUser(u.getToken()).then(function(o){});try{var e=c.compra||{},a=e.Produto||{},r=e.TamanhoSelecionado||{};v.checkoutProfile(e.id,a.id,a.idDrop,e.statusInteresse.status,a.nome,e.precoCobrado,a.preco,a.idTipoProduto,a.idMarca,1,r.titulo)}catch(o){}}).catch(function(o){c.salvandoCliente=!1,t.formErrorBinder(c,o),t.showToast("Valide os dados")}))},c.showConfirmacaoDadosCliente=function(){c.showConfirmacaoCliente=!0},c.carregarFingerprint=function(){$.getScript("https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js",function(o,e,a){"success"==e&&(console.log("FINGERPRINT SDK LOADED..."),FingerprintJS.load().then(function(o){o.get().then(function(o){c.fingerprint=o.visitorId,c.$apply()})}))})},c.carregarIP=function(){h.getDeviceInfo().then(function(o){c.ip=o.ip}).catch(function(o){})},c.carregarParcelamento=function(o){l.obterParcelamento(o.id).then(function(o){c.pagarmeParcelas=o.pagarmeParcelas,c.maxipagoParcelas=o.maxipagoParcelas})},c.setarDadosCartao=function(){},c.mudaCardNumber=function(o){var e;o=o,e=P(),o&&"keyup"==o.type?6<=e.length&&window.Mercadopago.getPaymentMethod({bin:e},y):setTimeout(function(){6<=e.length&&window.Mercadopago.getPaymentMethod({bin:e},y)},100)},c.mudarParcela=function(o,e){var a=$("#installments");null!=a[0].selectedOptions&&(c.dadosCartao.descricaoModoCompra=a[0].selectedOptions[0].text)},c.enviarDados=function(){try{if(c.salvando=!0,!l.validationCpfCnpj(c.dadosCartao.docType,c.dadosCartao.docNumber))throw"O número do "+c.dadosCartao.docType+" é inválido";if(null==c.dadosCartao.installments||c.dadosCartao.installments<1)throw"Escolha uma opção de parcelamento";var o=l.validarDataNascimento(c.dadosCartao.dataNascimentoDia,c.dadosCartao.dataNascimentoMes,c.dadosCartao.dataNascimentoAno);if(null==o)throw"A data de nascimento o do titular é inválida";c.dadosCartao.data=o;var e=document.querySelector("#pay");l.mp_CriarTokenCartao(window.Mercadopago,e).then(function(o){c.tela=10,c.dadosCartao.token=o.id,window.scrollTo(0,0),D("cartaocredito")}).catch(function(o){c.errors=l.mp_validateFormErrors(c.errors,o)}).finally(function(){c.salvando=!1})}catch(o){T(o),c.salvando=!1}},c.confirmarPagamentoViaCartao=function(){c.confirmando=!0,l.mp_finalizarCompraCartao(c.compra.id,c.dadosCartao.token,c.dadosCartao.email,c.dadosCartao.docType,c.dadosCartao.docNumber,c.dadosCartao.installments,c.dadosCartao.nomeTitular,c.dadosCartao.data,c.dadosCartao.issuerId,c.dadosCartao.payment_method_id,c.dadosCartao.payment_type_id,c.dadosCartao.idEndereco).then(function(o){t.showToast("O pagamento foi detectado"),1==t.isCordovaCall?(c.tela=11,c.carregando=!0,l.obterCompra(s.id).then(function(o){c.compra=o}).catch(function(o){c.erro=!0}).finally(function(){c.carregando=!1})):t.irPara("/compra/"+c.compra.id)}).catch(function(o){c.erro=!0,c.erroMensagem=o,t.showToast(o),c.confirmando=!1})},c.gerarBoleto=function(){c.gerando=!0;var o=l.obterServiceModes(),o=c.wirecardBoletoDisponivel?o.MODE_WC:o.MODE_JUNO;l.gerarBoleto(c.compra.id,c.dadosBoleto.docType,c.dadosBoleto.docNumber,c.dadosBoleto.email,c.dadosBoleto.nome,c.dadosBoleto.data,c.dadosBoleto.telefone,o).then(function(o){t.irPara("/pagamento/"+c.compra.id+"/boleto")}).catch(function(o){c.erro=!0,t.showToast(o),c.gerando=!1})},c.confirmarDadosBoleto=function(){c.dadosBoleto.docType="CPF",c.dadosBoleto.email=c.dadosCliente.email;var o=l.validarDataNascimento(c.dadosBoleto.dataNascimentoDia,c.dadosBoleto.dataNascimentoMes,c.dadosBoleto.dataNascimentoAno);null==o?T("A data de nascimento é inválida"):(c.dadosBoleto.data=o,l.validationCpfCnpj(c.dadosBoleto.docType,c.dadosBoleto.docNumber)?(window.scrollTo(0,0),c.tela=10,D("pix")):T("O número do "+c.dadosBoleto.docType+" é inválido"))},c.enviarDadosBoleto=function(o){c.enviandoDadosBoleto=!0,l.enviarDadosBoleto(c.compra.id,o).then(function(o){t.showToast("Boleto enviado")}).catch(function(o){t.showToast("Não foi possível enviar! Tente outra forma")}).finally(function(){c.enviandoDadosBoleto=!1})},c.carregarDadosBoleto=function(){c.carregando=!0,l.obterCompra(s.id).then(function(o){c.compra=o,c.dadosBoleto.email=u.get().email,c.dadosBoleto.url=c.compra.statusVenda.boletoUrl,c.dadosBoleto.barcode=c.compra.statusVenda.boletoBarcode,7==c.compra.status&&(t.showToast("Essa compra já recebeu um pagamento. Não pague novamente!"),c.erro=!0)}).catch(function(o){t.showToast(o),c.erro=!0}).finally(function(){c.carregando=!1})},c.toogleDadosEnderecoFormCartao=function(o){o?c.dadosCartao.idEndereco=null:c.obterEnderecos(!0)},c.obterEnderecos=function(o){o&&(c.carregandoEndereco=!0),g.obterEnderecos(u.get().id).then(function(o){c.enderecos=o}).catch(function(o){t.showToast("Erro ao obter endereços")}).finally(function(){c.carregandoEndereco=!1})},c.showAdicionarEndereco=function(o){r.show({controller:"EnderecoCtrl",templateUrl:"angular/app/endereco/partials/view.tpl.html",fullscreen:!0,preserveScope:!0,clickOutsideToClose:!window.cordova,parent:angular.element(document.body)}).then(function(){c.obterEnderecos(!0)},function(){})},c.carregarDadosPix=function(){c.carregando=!0,l.obterCompra(s.id).then(function(o){c.compra=o,c.qrcode="data:image/jpeg;base64,"+c.compra.statusVenda.qrCode,c.payload=c.compra.statusVenda.payLoadUrl,c.tela=1,c.compra.isTransacionado?c.irParaStatusPayment(o.id):c.watchStatusPagamento(o)}).catch(function(o){t.showToast(o),c.erro=!0}).finally(function(){c.carregando=!1})},c.gerarPix=function(){c.gerando=!0,l.gerarPix(c.compra.id,c.dadosBoleto.docType,c.dadosBoleto.docNumber,c.dadosBoleto.email,c.dadosBoleto.nome,c.dadosBoleto.data,t.isCordovaCall,c.marketplace_mode,c.fingerprint).then(function(o){t.irPara("/pagamento/"+c.compra.id+"/pix")}).catch(function(o){c.erro=!0,t.showToast(o),c.gerando=!1})},c.toogleDadosUsarioNoFormCartao=function(o){o?(c.dadosCartao.nomeTitular=c.dadosCliente.nomeLegal,c.dadosCartao.docNumber=c.dadosCliente.cpf,c.dadosCartao.diaNascimento=c.dadosCliente.dataNascimentoDia,c.dadosCartao.mesNascimento=c.dadosCliente.dataNascimentoMes,c.dadosCartao.anoNascimento=c.dadosCliente.dataNascimentoAno,c.dadosCartao.telefone=c.dadosCliente.telefone):(c.dadosCartao.nomeTitular=null,c.dadosCartao.telefone=null,c.dadosCartao.dataNascimento=null,c.dadosCartao.diaNascimento=null,c.dadosCartao.mesNascimento=null,c.dadosCartao.anoNascimento=null,c.dadosCartao.email=null,c.dadosCartao.docNumber=null)},c.pagarmeMudaCardNumber=function(o){c.resolverBandeiraNumero(c.dadosCartao.cardNumber)},c.resolverBandeiraNumero=function(o){o=C.match(o);o?null!=(o=l.resolverCardBrand(o.id))&&(c.bandeiraCartao=o):c.bandeiraCartao=null},c.resolverImagemBandeira=function(o){return l.resolverCardBrand(o)},c.pagarmeCriptografarCartao=function(){try{if(c.salvando=!0,!l.validationCpfCnpj(c.dadosCartao.docType,c.dadosCartao.docNumber))throw"O número do "+c.dadosCartao.docType+" é inválido";if(null==c.dadosCartao.installments||c.dadosCartao.installments<1)throw"Escolha uma opção de parcelamento";e=c.dadosCartao,(a={}).card_holder_name=e.cardholderName,a.card_expiration_date=""+e.cardExpirationMonth+e.cardExpirationYear,a.card_number=e.cardNumber,a.card_cvv=e.securityCode;var o=a;l.pagarmeGerarHashCC(o).then(function(o){c.dadosCartao.token=o,c.tela=10,window.scrollTo(0,0),D("cartaocredito")}).catch(function(o){throw o}).finally(function(){c.salvando=!1})}catch(o){T(o),c.salvando=!1}var e,a},c.pagarmeMudarParcelamento=function(o){o=document.getElementById(o),o=o.options[o.selectedIndex].innerHTML;c.dadosCartao.descricaoModoCompra=o},c.pagarmeFinalizarCompraCartao=function(){c.confirmando=!0;var o=parseInt(c.dadosCartao.diaNascimento),e=parseInt(c.dadosCartao.mesNascimento),a=parseInt(c.dadosCartao.anoNascimento),a=new Date(a,e-1,o);l.pagarmeFinalizarCompraCartao(c.compra.id,c.dadosCartao.token,c.dadosCartao.email,c.dadosCartao.docType,c.dadosCartao.docNumber,c.dadosCartao.installments,c.dadosCartao.nomeTitular,c.dadosCartao.telefone,c.dadosCartao.data,c.dadosCartao.idEndereco,"credit_card",c.marketplace_mode,c.fingerprint,c.ip,c.dadosCartao.salvarCartao,a).then(function(o){c.irParaStatusPayment(c.compra.id)}).catch(function(o){c.erro=!0,c.confirmando=!1,c.erroMensagem=o,t.showToast(o)})},c.showPagarCartaoSalvo=function(o){c.dadosCartao.cardId=null,c.dadosCartao.cardCvv=null,c.dadosCartao.installments=null,c.dadosCartao.securityCode=null,c.cartaoSalvo=o,r.show({preserveScope:!0,scope:c,templateUrl:"angular/app/pagamento/partials/cartaoSalvoDialog.tpl.html",parent:angular.element(document.body),focusOnOpen:!1,clickOutsideToClose:!window.cordova})},c.confirmarCartaoSalvo=function(o,e){c.dadosCartao.cardId=o,c.dadosCartao.cardCvv=e.securityCode,c.modo="pg_credit_card_saved",c.dadosCartao.amount=c.compra.precoCobrado,c.dadosCartao.installments=e.installments,c.dadosCartao.nomeTitular=c.dadosCliente.nomeLegal,c.dadosCartao.docNumber=c.dadosCliente.cpf,c.dadosCartao.docType="CPF",c.dadosCartao.email=c.dadosCliente.email,c.dadosCartao.diaNascimento=c.dadosCliente.dataNascimentoDia,c.dadosCartao.mesNascimento=c.dadosCliente.dataNascimentoMes,c.dadosCartao.anoNascimento=c.dadosCliente.dataNascimentoAno,c.dadosCartao.telefone=c.dadosCliente.telefone,c.dadosBoleto={},c.tela=10,window.scrollTo(0,0),t.hideDialog()},c.pagarmeFinalizarComCartaoSalvo=function(){c.confirmando=!0;var o=parseInt(c.dadosCartao.diaNascimento),e=parseInt(c.dadosCartao.mesNascimento),a=parseInt(c.dadosCartao.anoNascimento);new Date(a,e-1,o);l.pagarmeFinalizarCompraCartaoSalvo(c.compra.id,c.dadosCartao.cardId,c.dadosCartao.cardCvv,c.dadosCartao.email,c.dadosCartao.docType,c.dadosCartao.docNumber,c.dadosCartao.installments,c.marketplace_mode,c.fingerprint,c.ip).then(function(o){c.irParaStatusPayment(c.compra.id)}).catch(function(o){c.erro=!0,c.confirmando=!1,c.erroMensagem=o,t.showToast(o)})},c.excluirCartaoSalvo=function(a){c.excluindoCartaoSalvo=!0,l.pagarmeExcluirCartaoSalvo(a.id).then(function(o){var e;t.showToast("Cartão excluído com sucesso"),t.hideDialog(),c.excluindoCartaoSalvo=!1,0<c.config.cartoesSalvos.length&&(e=c.config.cartoesSalvos.indexOf(a),c.config.cartoesSalvos.splice(e,1)),0==c.config.cartoesSalvos.length&&(c.config.temCartaoSalvo=!1)}).catch(function(o){c.excluindoCartaoSalvo=!0})},c.maxipagoSetarDadosCartao=function(){},c.showPagarCartaoSalvo=function(o){c.dadosCartao.cardId=null,c.dadosCartao.cardCvv=null,c.dadosCartao.installments=null,c.dadosCartao.securityCode=null,c.cartaoSalvo=o,r.show({preserveScope:!0,scope:c,templateUrl:"angular/app/pagamento/partials/cartaoSalvoMaxiPagoDialog.tpl.html",parent:angular.element(document.body),focusOnOpen:!1,clickOutsideToClose:!window.cordova})},c.maxipagoToogleDadosUsarioNoFormCartao=function(o){o?(c.dadosCartao.nomeTitular=c.dadosCliente.nomeLegal,c.dadosCartao.docNumber=c.dadosCliente.cpf,c.dadosCartao.diaNascimento=c.dadosCliente.dataNascimentoDia,c.dadosCartao.mesNascimento=c.dadosCliente.dataNascimentoMes,c.dadosCartao.anoNascimento=c.dadosCliente.dataNascimentoAno,c.dadosCartao.telefone=c.dadosCliente.telefone):(c.dadosCartao.nomeTitular=null,c.dadosCartao.telefone=null,c.dadosCartao.dataNascimento=null,c.dadosCartao.diaNascimento=null,c.dadosCartao.mesNascimento=null,c.dadosCartao.anoNascimento=null,c.dadosCartao.email=null,c.dadosCartao.docNumber=null)},c.maxipagoMudaCardNumber=function(o){c.maxipagoResolverBandeiraNumero(c.dadosCartao.cardNumber)},c.maxipagoResolverBandeiraNumero=function(o){o=C.match(o);o?null!=(o=l.resolverCardBrand(o.id))&&(c.bandeiraCartao=o):c.bandeiraCartao=null},c.maxipagoResolverImagemBandeira=function(o){return l.resolverCardBrand(o)},c.maxipagoCriptografarCartao=function(){try{if(c.salvando=!0,!l.validationCpfCnpj(c.dadosCartao.docType,c.dadosCartao.docNumber))throw"O número do "+c.dadosCartao.docType+" é inválido";if(null==c.dadosCartao.installments||c.dadosCartao.installments<1)throw"Escolha uma opção de parcelamento";e=c.dadosCartao,(a={}).card_holder_name=e.cardholderName,a.card_expiration_date=""+e.cardExpirationMonth+e.cardExpirationYear,a.card_number=e.cardNumber,a.card_cvv=e.securityCode;var o=a;l.maxipagoGerarHashCC(o).then(function(o){c.dadosCartao.token=o,c.tela=10,window.scrollTo(0,0),D("cartaocredito")}).catch(function(o){throw console.log(o),o}).finally(function(){c.salvando=!1})}catch(o){T(o),c.salvando=!1}var e,a},c.maxipagoMudarParcelamento=function(o){o=document.getElementById(o),o=o.options[o.selectedIndex].innerHTML;c.dadosCartao.descricaoModoCompra=o},c.maxipagoFinalizarCompraCartao=function(){c.confirmando=!0;var o=parseInt(c.dadosCartao.diaNascimento),e=parseInt(c.dadosCartao.mesNascimento),a=parseInt(c.dadosCartao.anoNascimento),a=new Date(a,e-1,o);l.maxipagoFinalizarCompraCartao(c.compra.id,c.dadosCartao.token,c.dadosCartao.email,c.dadosCartao.docType,c.dadosCartao.docNumber,c.dadosCartao.installments,c.dadosCartao.nomeTitular,c.dadosCartao.telefone,c.dadosCartao.data,c.dadosCartao.idEndereco,"credit_card",c.marketplace_mode,c.fingerprint,c.ip,c.dadosCartao.salvarCartao,a,c.dadosCartao.cardNumber,c.dadosCartao.cardExpirationMonth,c.dadosCartao.cardExpirationYear,c.dadosCartao.securityCode,!0).then(function(o){c.irParaStatusPayment(c.compra.id)}).catch(function(o){c.erro=!0,c.confirmando=!1,c.erroMensagem=o,t.showToast(o)})},c.maxipagoShowPagarCartaoSalvo=function(o){c.dadosCartao.cardId=null,c.dadosCartao.cardCvv=null,c.dadosCartao.installments=null,c.dadosCartao.securityCode=null,c.cartaoSalvo=o,r.show({preserveScope:!0,scope:c,templateUrl:"angular/app/pagamento/partials/cartaoSalvoMaxiPagoDialog.tpl.html",parent:angular.element(document.body),focusOnOpen:!1,clickOutsideToClose:!window.cordova})},c.maxipagoConfirmarCartaoSalvo=function(o,e){c.dadosCartao.cardId=o,c.dadosCartao.cardCvv=e.securityCode,c.modo="maxipago_credit_card_saved",c.dadosCartao.amount=c.compra.precoCobrado,c.dadosCartao.installments=e.installments,c.dadosCartao.nomeTitular=c.dadosCliente.nomeLegal,c.dadosCartao.docNumber=c.dadosCliente.cpf,c.dadosCartao.docType="CPF",c.dadosCartao.email=c.dadosCliente.email,c.dadosCartao.diaNascimento=c.dadosCliente.dataNascimentoDia,c.dadosCartao.mesNascimento=c.dadosCliente.dataNascimentoMes,c.dadosCartao.anoNascimento=c.dadosCliente.dataNascimentoAno,c.dadosCartao.telefone=c.dadosCliente.telefone,c.dadosBoleto={},c.tela=10,window.scrollTo(0,0),t.hideDialog()},c.maxipagoFinalizarComCartaoSalvo=function(){c.confirmando=!0,l.maxipagoFinalizarCompraCartaoSalvo(c.compra.id,c.dadosCartao.cardId,c.dadosCartao.cardCvv,c.dadosCartao.email,c.dadosCartao.docType,c.dadosCartao.docNumber,c.dadosCartao.installments,c.marketplace_mode,c.fingerprint,c.ip).then(function(o){c.irParaStatusPayment(c.compra.id)}).catch(function(o){c.erro=!0,c.confirmando=!1,c.erroMensagem=o,t.showToast(o)})},c.maxipagoExcluirCartaoSalvo=function(a){c.excluindoCartaoSalvo=!0,l.maxipagoExcluirCartaoSalvo(a.id).then(function(o){var e;t.showToast("Cartão excluído com sucesso"),t.hideDialog(),c.excluindoCartaoSalvo=!1,0<c.config.maxipagoCartoesSalvos.length&&(e=c.config.maxipagoCartoesSalvos.indexOf(a),c.config.maxipagoCartoesSalvos.splice(e,1)),0==c.config.maxipagoCartoesSalvos.length&&(c.config.temCartaoSalvo=!1)}).catch(function(o){c.excluindoCartaoSalvo=!0})},c.showVerificarCC=function(){var o=c.resolveMeioDePagamento().modo;c.config.precisarVerificarCartao&&-1!==o.indexOf("credit_card")&&(c.validacaoCC_erromsg=null,r.show({preserveScope:!0,scope:c,templateUrl:"angular/app/pagamento/partials/verifyCCDialog.tpl.html",parent:angular.element(document.body),focusOnOpen:!1,clickOutsideToClose:!1}))},c.preVerificarCartaoCredito=function(){console.log("preVerificarCartaoCredito");var o={},e=parseInt(c.dadosCartao.diaNascimento),a=parseInt(c.dadosCartao.mesNascimento),r=parseInt(c.dadosCartao.anoNascimento),r=new Date(r,a-1,e);o.id=c.compra.id,o.IdEndereco=c.dadosCartao.idEndereco,o.DataNascimento=r,o.nome=c.dadosCartao.nomeTitular,o.telefoneCodigoNacional="+55",o.telefone=c.dadosCartao.telefone,o.DocumentType=c.dadosCartao.docType,o.DocumentNumber=c.dadosCartao.docNumber,o.marketplace_mode=c.marketplace_mode,o.paymentMethod="credit_card",null!=c.dadosCartao.cardId?(o.cardId=c.dadosCartao.cardId,o.cardCvv=c.dadosCartao.cardCvv):(o.token=c.dadosCartao.token,o.cardNumber=c.dadosCartao.cardNumber,o.cardExpiration=c.dadosCartao.cardExpirationMonth+"/"+c.dadosCartao.cardExpirationYear,o.CardCvv=c.dadosCartao.securityCode),l.validarCC_precapturar(c.compra.id,o).then(function(o){c.validacaoCC_token=o.token,c.ccTela=3}).catch(function(o){c.ccTela=0,console.log(o)})},c.validarPrecoVerificacaoCartaoCredito=function(o){c.validacaoCC_validando=!0,c.valorCCVerificacao=null,(c.validacaoCC_erromsg=null)==o?(c.validacaoCC_erromsg="Informe um valor",c.validacaoCC_validando=!1):(o=parseFloat(o.replaceAll(",",".")))<=0||1<=o?(c.validacaoCC_erromsg="Por favor, informe um valor válido",c.validacaoCC_validando=!1):l.validarCC_verificarvalor(c.compra.id,o,c.validacaoCC_token).then(function(o){console.log(o),c.ccTela=4}).catch(function(o){console.log(o),c.validacaoCC_erromsg=o,c.ccTela=0}).finally(function(){c.validacaoCC_validando=!1})},c.showVerificarPhone=function(){r.show({preserveScope:!0,scope:c,templateUrl:"angular/app/pagamento/partials/smsPrecisaConfirmarPhoneDialog.tpl.html",parent:angular.element(document.body),focusOnOpen:!1,clickOutsideToClose:!window.cordova})},c.irParaStatusPayment=function(o){c.tela=11,c.carregando=!0,l.obterCompra(o).then(function(o){(c.compra=o).isTransacionado?o.isTracked||A():c.watchStatusPagamento(o)}).catch(function(o){c.erro=!0}).finally(function(){c.carregando=!1})},c.fecharEContinuar=function(){t.isCordovaCall||window.cordova?window.ref?window.ref.close():c.showToast("Somente feche essa janela"):c.irPara("compra/"+c.compra.id)},c.resolverFotoItem=function(o){return null!=o.dropIcon?o.dropIcon:o.linkfoto},window.wathcherPagamento=null,window.stopIntervalPagamento=function(){angular.isDefined(window.wathcherPagamento)&&(e.cancel(window.wathcherPagamento),window.wathcherPagamento=void 0)},c.watchStatusPagamento=function(r){window.stopIntervalPagamento(),window.wathcherPagamento=e(function(){null==(e=r)||e.isTransacionado?window.stopIntervalPagamento():d.syncCompra(e.id).then(function(o){(o.mudouAlgo||null!=E&&E!=o.status.status)&&(E=o.status.status,t.showToast("O pagamento foi detectado"),c.irParaStatusPayment(e.id),o.isTransacionado&&!o.isTracked&&A(),o.isTransacionado)&&o.isTracked&&window.stopIntervalPagamento(),null!=o.status&&(E=o.status.status)});var e,o=c.$$destroyed,a=n.path().indexOf("/pagamento");(o||a<0)&&window.stopIntervalPagamento()},1e4)};var E=null;function D(o){try{var e=c.compra||{},a=e.Produto||{},r=e.TamanhoSelecionado||{};v.checkoutPayment(o,e.id,a.id,a.idDrop,e.statusInteresse.status,a.nome,e.precoCobrado,a.preco,a.idTipoProduto,a.idMarca,1,r.titulo)}catch(o){}}function A(){try{var o=c.compra||{},e=o.Produto||{},a=o.TamanhoSelecionado||{};d.setarTracking(o.id).then(function(){v.purchaseSimple(o,e,a)})}catch(o){}}c.showInfo=function(o,e,a){r.show(r.alert().clickOutsideToClose(!0).title(e).textContent(a).ariaLabel("Informações para compra").ok("OK").targetEvent(o))},c.maskPreco=function(){var o=S.monetario(c.valorCCVerificacao);c.valorCCVerificacao!==o&&(c.valorCCVerificacao=o)}}]).filter("cpf",function(){return function(o){o+="";return o=o.length<=11?(o=(o=(o=o.replace(/\D/g,"")).replace(/(\d{3})(\d)/,"$1.$2")).replace(/(\d{3})(\d)/,"$1.$2")).replace(/(\d{3})(\d{1,2})$/,"$1-$2"):o}}).filter("tel",function(){return function(o){o+="";return o=11===(o=o.replace(/\D/g,"")).length?o.replace(/^(\d{2})(\d{5})(\d{4})/,"($1) $2-$3"):o.replace(/^(\d{2})(\d{4})(\d{4})/,"($1) $2-$3")}}),angular.module("Proj").config(["$routeProvider",function(o){o.when("/raffle/:id",{controller:"RaffleCtrl",templateUrl:"angular/app/raffle/partials/viewV2.tpl.html"}).when("/raffle",{controller:"RaffleCtrl",templateUrl:"angular/app/raffle/partials/viewV2.tpl.html"})}]).controller("RaffleCtrl",["$scope","$rootScope","$mdMedia","$routeParams","$mdDialog","RaffleService",function(r,e,o,a,t,n){function i(){r.carregando=!0,n.get(a.id).then(function(o){r.sorteio=o,r.fim=new Date(r.sorteio.dataHoraFim),r.comeco=new Date(r.sorteio.dataHoraInicio),r.relogio.progresso=l(),r.initTimer(),r.isComecou=r.agora>=r.comeco&&r.agora<=r.fim,r.isEncerrou=r.agora>=r.fim,r.isAguardando=r.agora<r.comeco}).catch(function(o){console.error(o)}).finally(function(){r.carregando=!1})}function c(o,c,s,l){function d(o){return o+"px"}o=document.querySelector(o);new ResizeObserver(function(){var o,e,a,r,t=document.querySelector(c),n=document.querySelector(s),i=document.querySelector(l);t&&n&&i&&(o=t.clientWidth,t=t.clientHeight,a=o/(e=i.viewBox.baseVal).width,e=t/e.height,a=o-(r=i.getBBox()).width*a,r=t-r.height*e,i.style.width=d(o+a),i.style.height=d(t+r),n.style.width=d(o+a),n.style.height=d(t+r),n.style.left=d(-a/2),n.style.top=d(-r/2))}).observe(o)}function s(){r.inicio=new Date,r.inicio>=r.fim&&(r.isComecou=!1,r.isEncerrou=!0),r.inicio>=r.fim&&window.clearInterval(r.intervalo);var o=Math.abs(r.fim-r.inicio);r.segundos=o/1e3,r.horas=parseInt(r.segundos/3600),r.segundos=r.segundos%3600,r.minutos=parseInt(r.segundos/60),r.segundos=parseInt(r.segundos)%60,r.relogio.progresso=l(),r.inicio>=r.comeco&&r.inicio<=r.fim&&(r.isAguardando=!1,r.isComecou=!0),r.$apply()}function l(){var o=r.fim,e=r.comeco,o=Math.abs(o-e),a=new Date;if(e<=a)return Math.abs(a-e)/o*100}r.model="https://droper-media.s3.amazonaws.com/dunklowDraco.gltf",r.relogio={progresso:0,geom:{diametro:0,diametroDesk:0,left:0,top:0}},i(),r.estaLogado=e.isLogado(),r.$mdMedia=o,r.tamanhoSelecionado={},r.usuarioCpf="12345678901",r.agora=new Date,r.fim=new Date,r.comeco=new Date,r.isParticiparClicked=!1,r.uiState={isParticiparClicked:!1},r.tamanhos=[34,35,36,37,38,39,40,41,42,43,44,45],r.iniciarRelogioMobile=function(){c("#clock-container-sm","#clock-img-sm","#clock-sm","#clock-sm svg")},r.iniciarRelogioDesktop=function(){c("#clock-container","#clock-img","#clock","#clock svg")},r.initRelogio=function(){r.atualizarGeometriaRelogio()},r.initTimer=function(){r.intervalo=window.setInterval(s,1e3)},r.selecionarTamanho=function(o){r.tamanhoSelecionado==o.tituloTamanho?(r.tamanhoSelecionado={},r.sorteioParticipacao={}):(r.tamanhoSelecionado=o.tituloTamanho,r.criarSorteioItem(o.id))},r.cpfMask=function(){r.cpf=r.sorteio.cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4")},r.criarSorteioItem=function(o){r.sorteioParticipacao={idSorteioItem:o}},r.criarParticipacao=function(){r.criandoParticipacao=!0,n.criarParticipacao(r.sorteio.id,r.sorteioParticipacao).then(function(o){e.showToast("Participação registrada."),r.sorteio.participacao=o,r.uiState.isParticiparClicked=!1,i()}).catch(function(o){e.showToast("Não foi possível resgistrar sua inscrição."),console.error(o)}).finally(function(){r.criandoParticipacao=!1})},r.removerParticipacao=function(){r.removendoParticipacao=!0,n.removerParticipacao(r.sorteio.id).then(function(o){e.showToast("Sua participação foi removida."),i()}).catch(function(o){console.error(o)}).finally(function(){r.removendoParticipacao=!1})},r.openRegrasDialog=function(){var o=r.$new();t.show({controller:"RaffleCtrl",templateUrl:"angular/app/raffle/partials/regrasDialog.tpl.html",parent:angular.element(document.body),scope:o,preserveScope:!0,fullscreen:!1,clickOutsideToClose:!window.cordova}).then(function(){},function(){})}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/segmentos/:url/marcas",{controller:"SegmentoListCtrl",templateUrl:"angular/app/segmento/partials/list.tpl.html",title:"Segmentos"})}]).controller("SegmentoListCtrl",["$scope","$rootScope","$routeParams","AuthFactory","ColecionavelService",function(e,a,o,r,t){e.init=function(){e.obterMarcas()},e.voltarHome=function(){a.irPara("/")},e.listaMarcas=[],e.verMarca=function(o){o&&a.irPara("marca/"+o)},e.obterMarcas=function(){e.carregandoMarcas=!0,t.obterMarcas(o.url).then(function(o){e.listaMarcas=o.marcas}).catch(function(o){console.error(o)}).finally(function(){e.carregandoMarcas=!1})}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/sparks",{controller:"SparksCtrl",templateUrl:"angular/app/sparks/partials/sparks.tpl.html",title:"Spark",tabControl:"Spark"}).when("/sparksv2",{controller:"SparksCtrlV2",templateUrl:"angular/app/sparks/partials/sparks.tpl.html",title:"Spark",tabControl:"Spark"})}]).controller("SparksCtrl",["$scope","$rootScope","$compile","SparksService","CkHttpCache","ckComp","CkViewState","CkHLS","CkGlobalState","CkGlobalEvents","CkViewUtils",function(d,u,s,t,l,e,r,p,V,o,a){var U="application/vnd.apple.mpegurl",f="lib",m="nativo",g="nao_suportado",h={Lapse:"lapse",News:"news"},n=10,i=0,v=[],c=0,w=[],C=null,b=!1,S={maisAntigo:0,maisRecente:0},P=null,y={waiting:!1},k={right:0,left:0};function T(){d.overlayObserver.broadcast(y.waiting?"videowaiting":"videoplaying")}function F(){if((c=Math.min(c+1,v.length-1))+4>=v.length&&(d.carregandoMais=!0,t.getSparks(i+1,n,S).then(function(o){v=v.concat(o.sparks),i+=1}).catch(function(o){}).finally(function(){d.carregandoMais=!1})),0<c&&M(w[c-1]),A(w[c]),O(v[c]),E(1),5<c){var o=1;if(v||v.length)for(var e=k.left,a=0;a<o&&!(e+a>=v.length);a+=1){var r=w[e+a];r&&(r.hls&&r.hls.destroy(),w[e+a]=null,C.removeSlide(0)),k.left+=1}}}function N(){if(c=Math.max(0,c-1),A(w[c]),M(w[c+1]),D(1),5<c&&5<k.right-c){var o=1;if(v||v.length)for(var e=k.right,a=0;a<o;a+=1){var r=e-a;if(e-a<0||r>=v.length)break;var t=w[r];t&&(t.hls&&t.hls.destroy(),w[r]=null,C.removeSlide(C.slides.length-1)),--k.right}}}function E(o){if(!v||!v.length)return Promise.resolve();for(var e=k.right,a=[],r=0;r<o&&!(e+r>=v.length);r+=1)w[e+r]?k.right+=1:a.push(I(e+r));return Promise.all(a).then(function(o){o.forEach(function(o){C&&C.appendSlide(o.container),k.right+=1})})}function D(o){if(!v||!v.length)return Promise.resolve();var e=k.left,a=[];if(!(e<0)){for(var r=0;r<o&&!(e-r<0);r+=1)w[e-r]?--k.left:a.push(I(e-r));Promise.all(a).then(function(o){o.forEach(function(o){C&&C.prependSlide(o.container),--k.left})})}}function A(o){if(o)switch(o.spark.tipo){case h.Lapse:var e=o.video;e.loop=!0,e.muted=d.isMutado,b||(j(e,!1),b=!0),e.play().catch(function(){j(e,!0),e.play()});break;case h.News:}}function M(o){if(o)switch(o.spark.tipo){case h.Lapse:o.video.pause(),o.video.currentTime=0;break;case h.News:}}function R(l){return new Promise(function(o,e){var a,r,t,n,i=function(o){try{var e="Hls"in window&&window.Hls.isSupported(),a=o&&o.canPlayType(U);if(e)return f;if(a)return m}catch(o){log(o)}return g}(l.video),c=p.merge([l.spark.dados.playlist],!0),s=(c=c.content,"data:application/x-mpegURL;base64,"+btoa(c));switch(l.urlMedia=s,i){case f:t=l,n=s,new Promise(function(o,e){t.hls&&t.hls.destroy(),t.hls=new window.Hls;var a=t.hls;a.on(Hls.Events.MEDIA_ATTACHED,function(){a.loadSource(n),a.on(Hls.Events.MANIFEST_PARSED,function(o,e){t.video.muted=d.isMutado,u.isCordova()&&(t.video.play(),t.video.pause(),t.video.currentTime=0),t.video.onloadedmetadata=function(){L(t.video)}})}),a.on(Hls.Events.Error,function(o,e){}),a.attachMedia(t.video),$(t.video),o()}).then(o).catch(e);break;case m:a=l,r=s,new Promise(function(o,e){r?(a.video.src=r,a.video.load(),L(a.video),$(a.video),o()):e("não tem url")}).then(o).catch(e);break;case g:e("navegador não suportado");break;default:e("err")}})}function $(o){o.onwaiting=function(){y.waiting=!0,T()},o.onloadeddata=function(){y.waiting=!1,T()},o.onplaying=function(){y.waiting=!1,T()}}function j(o,e){d.isMutado=e,o.muted=d.isMutado,d.overlayObserver.broadcast(d.isMutado?"mute":"unmute")}function I(i){var c=v[i];return c?new Promise(function(a,e){var t,o,r,n={spark:c,idSpark:"spark"+i,idVideo:"video"+i,idImg:"img"+i,container:null,video:null,img:null,urlConteudo:c.url,urlMedia:null,hls:null};switch((w[i]=n).container=document.createElement("div"),n.container.id=n.idSpark,n.container.classList.add("swiper-slide"),n.container.classList.add("spark-mediapage"),c.tipo){case h.Lapse:n.video=function(o){var e=document.createElement("video");e.id=o,e.playsInline=!0,e.muted=d.isMutado,e.loop=!0,u.isCordova()&&u.isAndroid()&&(e.poster="/angular/img/sparks/poster-sparks.png");return e.classList.add("spark-video"),e}(n.idVideo),R(n).then(function(){n.container.appendChild(n.video);o=n,(e=document.createElement("spark-video-overlay")).setAttribute("temDrop",!!o.spark.dados.idDrop),e.setAttribute("marca",o.spark.dados.nomeMarca),e.setAttribute("titulo",o.spark.dados.dropTitulo),e.setAttribute("preco",o.spark.dados.dropPriceDisplay),e.setAttribute("url",o.spark.url),e.setAttribute("urlMarca","/marca/"+o.spark.dados.urlMarca),e.setAttribute("mutado",d.isMutado),e.setAttribute("observer","overlayObserver"),e.setAttribute("isapplemobile",d.isAppleSafari);var o=e,e=angular.element(n.container),o=angular.element(o);e.append(o),s(e)(d),a(n)}).catch(function(o){e(o)});break;case h.News:n.img=(o=n.idImg,(r=document.createElement("div")).id=o,r.classList.add("spark-imgdiv"),r),t=n,new Promise(function(o,e){var a=t.spark.dados.imagem,r=l.get(a).localurl;t.urlMedia=r||a,t.img.style.background="url("+t.urlMedia+")",o()}).then(()=>{o=n,(e=document.createElement("spark-img-overlay")).setAttribute("titulo",o.spark.dados.titulo),e.setAttribute("url",o.spark.dados.url),e.setAttribute("observer","overlayObserver"),e.setAttribute("isapplemobile",d.isAppleSafari);var o=e,e=angular.element(n.container),o=angular.element(o);n.container.appendChild(n.img),e.append(o),s(e)(d),a(n)}).catch(function(o){e(o)});break;default:e("tipo inválido de spark")}}):Promise.resolve()}function L(o){var e=o.videoWidth,a=o.videoHeight;e<a&&e/a<=.6?o.classList.add("spark-video-fullheight"):o.classList.add("spark-video-fullwidth")}function q(){C.allowTouchMove=!1}function B(){F(),C.allowTouchMove=!0}function z(){C.allowTouchMove=!1}function _(){N(),C.allowTouchMove=!0}function x(){r.sparks({scope:{sparkAtual:c,sparks:v,page:i}})}function O(o){t.view(o),t.salvarHistorico(o)}d.UIState={Carregando:"loading",Exibindo:"show",ErroCritico:"_err_critical",ErroEfemero:"_err_ephemeral"},d.carregando=!1,d.carregandoMais=!1,d.erro=!1,d.isMutado=!0,d.primeiroAcesso=!1,d.overlayObserver={muted:!0,muted:function(){return d.isMutado},child:[],subscribe:function(o){o&&"function"==typeof o&&this.child.push(o)},broadcast:function(e){this.child.forEach(function(o){o(e)})},notify:function(o,e){switch(o){case"mute":var a=w[c].video;a&&j(a,!d.isMutado);break;case"close":x(),u.voltarPagina();break;case"see":a=(e||{}).url;a&&(a=a,x(),u.irPara(a))}}},d.$on("$destroy",function(){o.unsub("spark",P)}),P=o.sub("spark",function(o){o.id;o.msg.swipeBack&&(x(),u.voltarPagina())}),d.isAppleSafari=u.isIOS()&&/Safari/i.test(navigator.userAgent)&&!u.isCordova(),new Promise(function(e,a){!function(){var o=r.sparks();if(o.changed)return c=o.scope.sparkAtual||0,v=o.scope.sparks||[],i=o.scope.page,!0;return!1}()?(d.carregando=!0,i=0,t.getSparks(0,n,S).then(function(o){v=o.sparks,e()}).catch(function(o){d.erro=o,a()}).finally(function(){d.carregando=!1,d.temSparks=0<v.length})):(r.sparks({scope:{}}),e(),d.temSparks=0<v.length)}).then(function(){return o={direction:"vertical",loop:!1,grabCursor:!0,resistanceRatio:.3,navigation:{prevEl:"#spark-desktop-nav-prev",nextEl:"#spark-desktop-nav-next"}},e.load("swiper.js").then(function(){return e.load("swiper.css")}).then(function(){(C=new window.Swiper(".swiper",o)).on("slideNextTransitionStart",q),C.on("slideNextTransitionEnd",B),C.on("slidePrevTransitionStart",z),C.on("slidePrevTransitionEnd",_)}).catch(function(){d.erro="Erro ao carregar recursos"});var o}).then(function(){var e;S=t.obterHistorico(),w=Array(v.length).fill(null),k.left=c,k.right=c,E(4).then(function(){D(3),A(w[c]),O(v[c])}),e="visitou-spark",localStorage.getItem(e)||a.esperarElemento("#spark-animacao-tutorial").then(function(o){localStorage.setItem(e,!0),o.classList.add("spark-animacao-tutorial-display")}).catch(function(){}),u.globalState.marcarSparkComoAssistido()}).catch(function(o){console.error("ERRO CRÍTICO",o),d.erro=!0,d.$apply()})}]).controller("SparksCtrlV2",["$scope","$rootScope","$compile","SparksService","CkHttpCache","ckComp","CkViewState","CkHLS","CkGlobalState","CkGlobalEvents",function(p,f,m,t,V,e,r,U,F,o){var n,N={VND_APPLE_MPEGURL:"application/vnd.apple.mpegurl"},g={Lib:"lib",Nativo:"nativo",NaoSuportado:"nao_suportado"},h={Lapse:"lapse",News:"news",ErroConexao:"err_conn"},i=10,v=7,R=4e3,c=0,s=[],w=[],l={maisAntigo:0,maisRecente:0},a=null,d=!1,u=0,C=v,b=null,S=null,P={start:0},y={waiting:!1},k={erroConexao:!1,temMais:!1};function T(){p.overlayObserver.broadcast(y.waiting?"videowaiting":"videoplaying")}function E(r){return new Promise(function(e,a){p.carregandoMais=!0;var o=r;!r&&k.erroConexao?a("conn_err"):t.getSparks(c,i,l,!1,o).then(function(o){s=s.filter(o=>o.tipo!==h.ErroConexao).concat(o.sparks),c+=1,k.temMais=o.temMais,k.erroConexao=!1,e()}).catch(function(o){r?p.overlayObserver.broadcast("recover_failed"):((s=s.filter(o=>o.tipo!==h.ErroConexao)).push({tipo:h.ErroConexao,isErro:!0}),k.erroConexao=!0),a()}).finally(function(){p.carregandoMais=!1})})}function D(o){var e,a;if(o)switch(o.tipo){case h.Lapse:e=o.video,(a=e)&&(a.loop=!0,a.muted=p.isMutado,d||(x(a,!1),d=!0),a.play().catch(function(){x(a,!0),a.play()}));break;case h.News:}}function A(o){if(o)switch(o.tipo){case h.Lapse:o.video.pause(),o.video.currentTime=0;break;case h.News:}}function M(d,u){return new Promise(function(o,e){for(var a=Math.trunc(v/2),r=d.start-a,t=d.start+a,n=(r<0&&(r=0,t=v-1),r>u.length-v&&(r=u.length-v),t>=u.length&&(t=u.length-1),d.start-r),i=[],c=[],s=r;s<=t;s+=1){var l=function(d,u){d=d||{tipo:h.ErroConexao};return new Promise(function(a,e){var t,l,r={spark:d,indice:u,isErro:!1,tipo:d.tipo,idSpark:"spark"+u,idVideo:"video"+u,idImg:"img"+u,container:null,video:null,img:null,urlConteudo:d.url,urlMedia:null,hls:null},n=I(r),o=w[n];if(o)a(o);else switch(r.container=document.createElement("div"),r.container.id=r.idSpark,r.container.classList.add("swiper-slide"),r.container.classList.add("spark-mediapage"),d.tipo){case h.Lapse:r.video=function(o){var e=document.createElement("video");e.id=o,e.playsInline=!0,e.muted=p.isMutado,e.loop=!0,f.isCordova()&&f.isAndroid()&&(e.poster="/angular/img/sparks/poster-sparks.png");return e.classList.add("spark-video"),e}(r.idVideo),l=r,new Promise(function(o,e){var a,r,t,n,i=function(o){try{var e="Hls"in window&&window.Hls.isSupported(),a=o&&o.canPlayType(N.VND_APPLE_MPEGURL);if(e)return g.Lib;if(a)return g.Nativo}catch(o){log(o)}return g.NaoSuportado}(l.video),c=U.merge([l.spark.dados.playlist],!0),s=(c=c.content,"data:application/x-mpegURL;base64,"+btoa(c));switch(l.urlMedia=s,i){case g.Lib:t=l,n=s,new Promise(function(o,e){t.hls&&t.hls.destroy(),t.hls=new window.Hls;var a=t.hls;a.on(Hls.Events.MEDIA_ATTACHED,function(){a.loadSource(n),a.on(Hls.Events.MANIFEST_PARSED,function(o,e){t.video.muted=p.isMutado,f.isCordova()&&(t.video.play(),t.video.pause(),t.video.currentTime=0),t.video.onloadedmetadata=function(){z(t.video)}})}),a.on(Hls.Events.Error,function(o,e){}),a.attachMedia(t.video),L(t.video),o()}).then(o).catch(e);break;case g.Nativo:a=l,r=s,new Promise(function(o,e){r?(a.video.src=r,a.video.load(),z(a.video),L(a.video),o()):e("não tem url")}).then(o).catch(e);break;case g.NaoSuportado:e("navegador não suportado");break;default:e("err")}}).then(function(){r.container.appendChild(r.video);o=r,(e=document.createElement("spark-video-overlay")).setAttribute("temDrop",!!o.spark.dados.idDrop),e.setAttribute("marca",o.spark.dados.nomeMarca),e.setAttribute("titulo",o.spark.dados.dropTitulo),e.setAttribute("preco",o.spark.dados.dropPriceDisplay),e.setAttribute("url",o.spark.url),e.setAttribute("urlMarca","/marca/"+o.spark.dados.urlMarca),e.setAttribute("mutado",p.isMutado),e.setAttribute("observer","overlayObserver"),e.setAttribute("isapplemobile",p.isAppleSafari);var o=e,e=angular.element(r.container),o=angular.element(o);e.append(o),m(e)(p),w[n]=r,a(r)}).catch(function(o){e(o)});break;case h.News:r.img=(i=r.idImg,(c=document.createElement("div")).id=i,c.classList.add("spark-imgdiv"),c),t=r,new Promise(function(o,e){var a=t.spark.dados.imagem,r=V.get(a).localurl;t.urlMedia=r||a,t.img.style.background="url("+t.urlMedia+")",o()}).then(()=>{o=r,(e=document.createElement("spark-img-overlay")).setAttribute("titulo",o.spark.dados.titulo),e.setAttribute("url",o.spark.dados.url),e.setAttribute("observer","overlayObserver"),e.setAttribute("isapplemobile",p.isAppleSafari);var o=e,e=angular.element(r.container),o=angular.element(o);r.container.appendChild(r.img),e.append(o),m(e)(p),w[n]=r,a(r)}).catch(function(o){e(o)});break;case h.ErroConexao:r.container.id="spark-err",r.isErro=!0;var i=document.createElement("spark-err-overlay"),c=(i.setAttribute("observer","overlayObserver"),angular.element(r.container)),s=angular.element(i);c.append(s),m(c)(p),w[n]=r,a(r);break;default:e("tipo inválido de spark")}})}(u[s],s);l.then(function(o){i[o.indice-r]=o}),c.push(l)}Promise.all(c).then(function(){o({pages:i,current:n,start:r,end:t})}).catch(function(o){e(o)})})}function q(){var r,t;r=P,t=s,new Promise(function(e,a){var o=angular.copy(r);o.start+=1,M(o,t).then(function(o){e({pages:$(o.pages),current:o.current,start:o.start,end:o.end,viewOffset:1})}).catch(function(o){a(o)})}).then(function(o){var e=o.pages,a=(o.viewOffset,o.start),r=o.end,o=o.current,t=e[0],o=e[o],n=e[e.length-1];u<a&&(S.removeSlide(0),S.appendSlide(e[e.length-1].container)),s.length-P.start<i&&E(!1),A(b),D(o),j(e,w),u=a,C=r,b=o,P.start+=1})}function B(){var r,t;r=P,t=s,new Promise(function(e,a){var o=angular.copy(r);--o.start,M(o,t).then(function(o){e({pages:$(o.pages),current:o.current,start:o.start,end:o.end,viewOffset:-1})}).catch(function(o){a(o)})}).then(function(o){var e=o.pages,a=(o.viewOffset,o.start),r=o.end,o=o.current,t=e[0],n=e[o],i=e[e.length-1];r<C&&(S.removeSlide(S.slides.length-1),S.prependSlide(e[0].container)),A(b),D(e[o]),j(e,w),u=a,C=r,b=n,--P.start})}function $(o){var e=o.filter(o=>o.isErro),o=o.filter(o=>!o.isErro),a={},e=(e.forEach(function(o){a[o.tipo]||(a[o.tipo]=o)}),Object.keys(a).map(o=>a[o]));return o.concat(e)}function j(a,r){Object.keys(r).filter(o=>o).map(o=>({key:o,value:r[o]})).forEach(function(o){var e=o.key,o=o.value;a.some(o=>I(o)===e)||((o=o).hls&&(o.hls.destroy(),o.hls=null),delete r[e])})}function I(o){return o.indice+","+o.tipo}function L(o){o.onwaiting=function(){y.waiting=!0,T()},o.onloadeddata=function(){y.waiting=!1,T()},o.onplaying=function(){y.waiting=!1,T()}}function z(o){var e=o.videoWidth,a=o.videoHeight;e<a&&e/a<=.6?o.classList.add("spark-video-fullheight"):o.classList.add("spark-video-fullwidth")}function x(o,e){p.isMutado=e,o.muted=p.isMutado,p.overlayObserver.broadcast(p.isMutado?"mute":"unmute")}function _(){S.allowTouchMove=!1}function H(){q(),S.allowTouchMove=!0}function G(){S.allowTouchMove=!1}function K(){B(),S.allowTouchMove=!0}function O(){r.sparks({scope:{sparkAtual:P.start,sparks:s,temSparks:0<s.length,page:c}})}p.carregando=!1,p.temSparks=!1,p.overlayObserver={muted:!0,muted:function(){return p.isMutado},child:[],subscribe:function(o){o&&"function"==typeof o&&this.child.push(o)},broadcast:function(e){this.child.forEach(function(o){o(e)})},notify:function(o,e){switch(o){case"mute":var a=(b||{}).video;a&&x(a,!p.isMutado);break;case"close":O(),f.voltarPagina();break;case"see":a=(e||{}).url;a&&(a=a,O(),f.irPara(a));break;case"recover":E(!(S.allowTouchMove=!1)).then(function(){return M(P,s)}).then(function(o){for(var e=o.pages,a=(o.viewOffset,o.start),r=o.end,o=o.current,t=e[0],n=e[o],i=e[e.length-1],c=S.activeIndex,s=S.slides.length-S.activeIndex,l=0;l<c;l++)S.removeSlide(0);for(l=0;l<s;l++)S.removeSlide(S.slides.length-1);for(l=o;0<=l;l--)S.prependSlide(e[l].container);for(l=o;l<e.length;l++)S.appendSlide(e[l].container);A(b),D(n),j(e,w),u=a,C=r,b=n,S.allowTouchMove=!0}).catch(function(o){S.allowTouchMove=!0,console.error("RECOVER_ERR",o)})}}},p.$on("$destroy",function(){o.unsub("spark",a)}),l=t.obterHistorico(),a=o.sub("spark",function(o){o.id;o.msg.swipeBack&&(O(),f.voltarPagina())}),p.isAppleSafari=f.isIOS()&&/Safari/i.test(navigator.userAgent)&&!f.isCordova(),new Promise(function(a,e){p.carregando=!0,t.getSparks(0,i,l).then(function(o){var e=function(){var o=r.sparks();{var e;if(o.changed)return P.start=o.scope.sparkAtual||0,s=o.scope.sparks||[],c=o.scope.page,p.temSparks=o.scope.temSparks,o=!!s&&!!s.length,e=p.temSparks&&!!P.start&&0<=P.start&&P.start<s.length,o&&e}return!1}();if(e&&(r.sparks({scope:{}}),o.sparks.map(o=>o.dataUnix).reduce((o,e)=>o<e?e:o)<=s.map(o=>o.dataUnix).reduce((o,e)=>o<e?e:o)))return void a();s=o.sparks,c=1,p.temSparks=s&&s.length,k.erroConexao=!1,k.temMais=o.temMais,a(s)}).catch(function(o){k.erroConexao=!0,e()}).finally(function(){p.carregando=!1})}).then(function(){return o={direction:"vertical",loop:!1,grabCursor:!0,resistanceRatio:.3,navigation:{prevEl:"#spark-desktop-nav-prev",nextEl:"#spark-desktop-nav-next"}},e.load("swiper.js").then(function(){return e.load("swiper.css")}).then(function(){(S=new window.Swiper(".swiper",o)).on("slideNextTransitionStart",_),S.on("slideNextTransitionEnd",H),S.on("slidePrevTransitionStart",G),S.on("slidePrevTransitionEnd",K)}).catch(function(){p.erro="Erro ao carregar recursos"});var o}).then(function(){return M(P,s)}).then(function(o){console.log("Eu sei que errei"),S.allowTouchMove=!1,n=o.pages,u=o.start,C=o.end;for(var o=o.current,e=n[o],a=o;a<n.length;a++)S.appendSlide(n[a].container);for(a=o-1;0<=a;a--)S.prependSlide(n[a].container);D(b=e),o=e,t.view(o.spark),t.salvarHistorico(o.spark),e="visitou-spark",o=document.getElementById("spark-wrapper"),!localStorage.getItem(e)&&o&&(S.allowTouchMove=!1,window.setTimeout(function(){S.allowTouchMove=!0},R),o.classList.add("spark-animation-tutorial"),localStorage.setItem(e,!0)),f.globalState.temSparkNovo=!1,S.allowTouchMove=!0})}]),angular.module("Proj").directive("sparkVideoOverlay",[function(){return{restrict:"E",replace:!0,scope:{marca:"@",titulo:"@",preco:"@",url:"@",urlmarca:"@",temdrop:"@",isapplemobile:"@",observer:"="},templateUrl:"angular/app/sparks/partials/overlayVideo.tpl.html",controller:"SparksOverlayCtrl"}}]).directive("sparkImgOverlay",[function(){return{restrict:"E",scope:{titulo:"@",url:"@",urlmarca:"@",isapplemobile:"@",observer:"="},templateUrl:"angular/app/sparks/partials/overlayImg.tpl.html",controller:"SparksOverlayCtrl"}}]).directive("sparkErrOverlay",[function(){return{restrict:"E",scope:{observer:"="},templateUrl:"angular/app/sparks/partials/overlayErr.tpl.html",controller:"SparksOverlayCtrl"}}]).controller("SparksOverlayCtrl",["$scope","$rootScope",function(e,o){e.muted=e.observer.muted(),e.showBody=!0,e.loadingVideo=!0,e.recovering=!1,e.safePadding="true"===e.isapplemobile,e.mute=function(){e.observer.notify("mute")},e.close=function(){e.observer.notify("close")},e.closeBody=function(){e.showBody=!1},e.verConteudo=function(o){e.observer.notify("see",{url:o})},e.recoverErr=function(){e.recovering=!0,e.observer.notify("recover")},e.observer.subscribe(function(o){switch(o){case"mute":e.muted=!0;break;case"unmute":e.muted=!1;break;case"videowaiting":e.loadingVideo=!0,e.$apply();break;case"videoplaying":e.loadingVideo=!1,e.$apply();break;case"recover_success":break;case"recover_failed":e.recovering=!1,e.$apply()}})}]),angular.module("Proj").service("MarketService",["$http","$q","ApiCK","$request",function(o,e,t,n){return{get:function(){return n.get(t+"market")},verificarPendencias:function(o){return n.get(t+"usuarios/"+o+"/pendencias")},salvarPin:function(o,e){var a={};return a.pin=e,n.put(t+"usuarios/"+o+"/pin",a)},verificarPin:function(o,e){var a={};return a.pin=e,n.post(t+"usuarios/"+o+"/pin/check",a)},verificarPinv2:function(o,e){var a={};return a.pin=e,n.post(t+"usuarios/"+o+"/pin/checkv2",a)},resetarPin:function(o){return n.put(t+"usuarios/"+o+"/pin/reset",null)},verificarUsuarioTemPin:function(o){return n.get(t+"usuarios/"+o+"/pin/existe")},enviarVerificacaoEmail:function(o,e){return n.post(t+"usuarios/"+o+"/email/enviarverificacao",{email:e})},verificarEmail:function(o){return n.post(t+"usuarios/email/verificar/"+o)},obterSaldo:function(o){return n.get(t+"usuarios/"+o+"/saldo/geral")},obterTaxa:function(){return n.get(t+"usuarios/taxa")},obterRelatorioVendasComparadas:function(o,e,a){var r="";return e&&(r+="&de="+e),a&&(r+="&ate="+a),n.get(t+"usuario/relatorio/vendas/comparado?periodo="+o+r)},obterTaxaDetalhada:function(){return n.get(t+"usuarios/taxa/detalhado")}}}]),angular.module("Proj").service("BuscarService",["$http","$q","ApiCK","$request",function(o,e,a,r){return{search:function(o,e){return(e=null==e?{}:e).termo=o,r.post(a+"search",e)},getFilters:function(){return r.get(a+"search/filters")},getFiltersv2:function(){return r.get(a+"search/filtros")},getFiltersV3:function(){return r.get(a+"search/v2/filtros")},getMarca:function(o){return r.get(a+"marcas/"+o)},getMarcaEModelo:function(o,e){return r.get(a+"marca/"+o+"/modelo/"+e)},contabilizarClickTermoPesquisa:function(o){return r.post(a+"marcas/termospesquisa/"+o+"/click")},contabilizarClickMarcaEModelo:function(o,e){return r.post(a+"marca/"+o+"/modelo/"+e+"/vs")},enviarTermoBuscaGa:function(o){try{var e="/buscar?termo="+o;window.cordova&&window.ga?window.ga.trackView(e,"",!1):gtag("event","page_view",{page_location:e,page_title:title})}catch(o){return o}},searchV3:function(o){return r.post(a+"search/v3",o||{})},searchV3DropPagination:function(o,e){return r.post(a+"search/v2/drops?page="+e,o||{})},obterSugestoes:function(){return r.get(a+"search/sugestoes")}}}]),angular.module("Proj").service("AppleSignService",["$q","ApiCK",function(o,e){return{login:function(){var e=o.defer();if(window.cordova)try{!function(){var t=o.defer();try{window.cordova.plugins.SignInWithApple.signin({requestedScopes:[0,1]},function(o){var e=o.user,a=o.email,r="Sem nome",e=(null!=o.fullName&&(r=null!=o.fullName.givenName?o.fullName.givenName:"Sem nome"),o=r,r=a,(a={}).idsocial=e,a.nome=o,a.email=r,a.siglaredesocial="apple",a);t.resolve(e)},function(o){t.reject()})}catch(o){t.reject("Erro ao carregar a SDK do Google")}return t.promise}().then(function(o){e.resolve(o)}).catch(function(o){e.reject("Erro ao autenticar conta do Google",o)})}catch(o){e.reject("Erro ao autenticar conta da Apple")}return e.promise}}}]),angular.module("Proj").service("ClienteService",["$http","$q","ApiCK","$request",function(r,t,n,a){function i(){try{window.plugins.OneSignal.getDeviceState(function(o){var e;o.hasOwnProperty("permissionStatus")?(null!=(e=o).permissionStatus.status&&2!=e.permissionStatus.status&&(0!=e.permissionStatus.status&&1!=e.permissionStatus.status||(console.warn("IOS > This device does NOT accept notifications"),window.plugins.OneSignal.promptForPushNotificationsWithUserResponse(function(o){})),e.permissionStatus.status),null!=e.permissionStatus.state&&(e.permissionStatus.state,2==e.permissionStatus.state)&&(console.warn("ANDROID > This device does NOT accept notifications"),alert("Seu dispositivo não está recebendo notificações. Ative as notificações nas configurações do seu dispositivo"))):o.hasNotificationPermission||window.plugins.OneSignal.promptForPushNotificationsWithUserResponse(function(o){console.log("NOTIFICATIONS ACCEPTED",o)})})}catch(o){console.error("ONE SIGNAL > erro ao solicitar",o)}}return{auth:function(o){var e=t.defer();return r.get(n+"cliente/"+o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},checkToken:function(o,e){var a=t.defer();return r.post(n+"auth/"+o,e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},obter:function(o){return a.get(n+"clientes/"+o)},obterPreferenciasTamanho:function(){return a.get(n+"usuarios/preferencias/check")},obterTamanhosDisponiveis:function(){return a.get(n+"usuarios/preferencias/tamanhosdisponiveis")},selecionarTamanhoTenis:function(o,e){return a.put(n+"usuarios/"+o+"/preferencias/tamanhostenis/"+e)},editar:function(o,e){return a.put(n+"clientes/"+o,e)},verificarTelefone:function(o){return a.get(n+"usuarios/"+o+"/telefone")},editarTelefone:function(o,e){return a.put(n+"usuarios/"+o+"/telefone",e)},convertFbAt:function(o){var e=t.defer();return r.post(n+"auth/social/accesstoken",{accesstoken:o}).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},postGoogleUser:function(o){var e=t.defer();return r.post(n+"auth/social/google",o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},postAppleUser:function(o){var e=t.defer();return r.post(n+"auth/social/apple",o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},authEmail:function(o){return a.post(n+"auth",o)},checkSeguindoLoja:function(o,e){var a=t.defer();return r.get(n+"cliente/"+o+"/loja/"+e+"/seguir/check").success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},checkinLoja:function(o,e){var a=t.defer();return r.get(n+"cliente/"+o+"/loja/"+e+"/seguir").success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},checkoutLoja:function(o,e){var a=t.defer();return r.delete(n+"cliente/"+o+"/loja/"+e+"/seguir/checkout").success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},obterLojasSeguidas:function(o){var e=t.defer();return r.get(n+"cliente/"+o+"/lojas").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},favoritarProduto:function(o,e){var a=t.defer();return r.get(n+"cliente/"+o+"/produtos/"+e+"/favorito").success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},obterProdutosFavoritos:function(o){var e=t.defer();return r.get(n+"cliente/"+o+"/produtosfavoritos").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterProdutoFavorito:function(o,e){var a=t.defer();return r.get(n+"cliente/"+o+"/produtosfavoritos/"+e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},desfavoritarProduto:function(o,e){var a=t.defer();return r.delete(n+"cliente/"+o+"/produtos/"+e+"/favorito").success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},toogleFavoritarProduto:function(o,e,a){return a?this.desfavoritarProduto(o,e):this.favoritarProduto(o,e)},checkFollowAutor:function(o,e){var a=t.defer();return r.get(n+"cliente/"+o+"/administrador/"+e+"/favorito/check").success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},followAutor:function(o,e){var a=t.defer();return r.post(n+"cliente/"+o+"/administrador/"+e+"/favorito").success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},unfollowAutor:function(o,e){var a=t.defer();return r.delete(n+"cliente/"+o+"/administrador/"+e+"/favorito").success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},updateOneSignal:function(e){var a=t.defer();try{window.cordova?window.plugins.OneSignal.getDeviceState(function(o){o=n+"cliente/"+e+"/onesignal/"+o.userId;r.put(o).success(function(o){i(),a.resolve(o)}).error(function(o){a.reject(o)})}):a.reject()}catch(o){console.error("ONESIGNAL > window.cordova or window.plugin.Onesignal is not available"),a.reject(o)}return a.promise},verifyPermissionOneSignal:function(){i()}}}]),angular.module("Proj").service("FacebookService",["$http","$q","ApiCK",function(o,a,e){return{login:function(){var e=a.defer(),o=["public_profile","email"];return window.cordova||window.facebookConnectPlugin?window.facebookConnectPlugin.login(o,function(o){"connected"===o.status?e.resolve(o):(console.error("FB_ERR(facebookConnectPlugin.login)a",o),e.reject())},function(o){console.error("window.facebookConnectPLugin.login",o),e.reject()}):window.FB.login(function(o){"connected"===o.status?e.resolve(o):e.reject()},{scope:o.toString()}),e.promise}}}]).run(["facebookID","$location","$rootScope","AuthFactory",function(o,e,a,r){function t(){FB.init({appId:o,cookie:!0,xfbml:!1,version:"v5.0"}),n()}function n(){window.cordova?window.facebookConnectPlugin.getLoginStatus(function(o){"connected"!==o.status&&i(o)},function(o){console.error("FB_ERR(restoreSession)",o)}):window.FB.getLoginStatus(function(o){"connected"!==o.status&&i(o)})}function i(o){null===localStorage.getItem("token")||"not_authorized"!==o.status&&"expiresIn "!==o.status&&"reauthorize_required_in "!==o.status||(r.logout(),a.irParaLogin(),a.showToast("Sua sessão do Facebook foi desconectada do Droper. Por favor, entre novamente!"))}var c,s,l;window.cordova?document.addEventListener("deviceready",function(){window.facebookConnectPlugin&&n()},!1):window.FB?t():(c=document,s="facebook-jssdk",l=c.getElementsByTagName("script")[0],c.getElementById(s)||((c=c.createElement("script")).id=s,c.src="https://connect.facebook.net/pt_BR/sdk.js#xfbml=1&version=v5.0&appId="+o,l.parentNode.insertBefore(c,l),c.onload=function(){t()}))}]),angular.module("Proj").service("GoogleService",["$q","ApiCK",function(r,o){function t(o,e,a,r){var t={};return t.idsocial=o,t.nome=e,t.fotoperfil=a,t.email=r,t.siglaredesocial="google",t}return{login:function(){var a=r.defer();if(window.cordova)try{!function(){var e=r.defer();window.plugins&&window.plugins.googleplus||e.reject("O plugin de login com o Google não foi instalado corretamente!");try{window.plugins.googleplus.login({webClientId:"980328679455-hesf5joaals7r7sar54l6448365f7bm5.apps.googleusercontent.com",offline:!0},function(o){o=t(o.userId,o.displayName,o.imageUrl,o.email);window.plugins.googleplus.disconnect(function(o){}),e.resolve(o)},function(o){e.reject(o)})}catch(o){e.reject(o)}return e.promise}().then(function(o){a.resolve(o)}).catch(function(o){console.error(o),a.reject("Erro ao autenticar conta do Google",o)})}catch(o){console.error(o),a.reject("Erro ao autenticar conta do Google")}else try{!function(){var o=r.defer();window.gapi?o.resolve("loaded"):$.getScript("https://apis.google.com/js/platform.js").done(function(){o.resolve("loaded")}).fail(function(){o.reject("Erro ao carregar a SDK do Google")});return o.promise}().then(function(o){var e;e=r.defer(),gapi.load("auth2",function(){gapi.auth2.init({client_id:"980328679455-nes6iviipgo94g9sd63ucreqr28ovpjp.apps.googleusercontent.com"}).signIn().then(function(o){o=o.getBasicProfile(),o=t(o.getId(),o.getName(),o.getImageUrl(),o.getEmail());e.resolve(o)}).catch(function(o){e.reject(o)})}),e.promise.then(function(o){a.resolve(o)}).catch(function(o){console.error(o),alert("Ocorreu alguma falha na tentatica de conectar sua conta do Google. Verifique se não existe solicitação de abertura de popUp!"),a.reject("Erro ao autenticar conta do Google")})}).catch(function(o){a.reject("Erro ao autenticar conta do Google")})}catch(o){a.reject("Erro ao autenticar conta do Google")}return a.promise}}}]),angular.module("Proj").service("ColecaoService",["ApiCK","$http","$request",function(e,o,a){return{obterVitrine:function(o){return a.get(e+"colecao/"+o+"/vitrine")}}}]),angular.module("Proj").service("ComentarioService",["ApiCK","$request",function(n,i){return{obterComentariosProduto:function(o,e,a,r){return null!=r?i.get(n+"produtos/"+o+"/perguntas/"+r):i.get(n+"produtos/"+o+"/perguntas/"+e+"/"+a)},obterNovasRespostas:function(o,e){return i.get(n+"perguntas/"+o+"/comentarios/novos/"+e)},enviarPergunta:function(o,e,a,r,t){return i.post(n+"perguntas",{idCliente:e,idProduto:o,texto:a,isPublico:r,isDenuncia:!1,tipo:t})},responderPergunta:function(o,e,a){return i.post(n+"perguntas/"+o+"/respostas",{idPergunta:o,texto:e,tipo:a})},apagarResposta:function(o){return i.delete(n+"respostas/"+o)},apagarPergunta:function(o){return i.delete(n+"perguntas/"+o)},obterProdutoComentario:function(o){return i.get(n+"perguntas/"+o+"/produto")}}}]),angular.module("Proj").service("CompraService",["$http","$q","ApiCK","$request",function(n,i,c,r){return{obterCompras:function(){return r.get(c+"compras")},obterHistoricoCompras:function(){return r.get(c+"compras/history")},iniciarCompra:function(o,e,a){o=c+"produtos/"+o+"/compras/iniciar?";return null!=e&&(o=o+"idtamanho="+e),r.post(o=null!=a?o+"&idcarrinho="+a:o)},obterCompra:function(o){return r.get(c+"compras/"+o)},obterOpcoesEntrega:function(o){return r.get(c+"compras/"+o+"/frete")},obterOpcoesEntregav2:function(o){return r.get(c+"compras/"+o+"/fretev2")},obterOpcoesEntregav3:function(o){return r.get(c+"compras/"+o+"/fretev3")},recalcularLoggi:function(o,e,a){return r.patch(c+"compras/"+o+"/frete/loggi?"+("lat="+e+"&lng="+a),{})},escolherOpcoaoEntrega:function(o,e){var a={};return a.idEnderecoOrigem=e.idEnderecoOrigem,a.servico=e.servico,a.precof=e.precof,a.tipoFrete=e.tipoFrete,a.prazoDiaMinimo=e.prazoDiaMinimo,a.prazoDiaMaximo=e.prazoDiaMaximo,a.gatewayFrete=e.gateway||e.gatewayFrete,a.droperToClient=e.droperToClient,r.post(c+"compras/"+o+"/frete",a)},alterarEndereco:function(o,e){return r.put(c+"compras/"+o+"/enderecos/"+e)},solicitarLinkCompra:function(o){return r.get(c+"compras/"+o+"/solicitar")},solicitarLinkPagamentoExpress:function(o){return r.get(c+"compras/"+o+"/express/gerar?advanced=false")},cancelarCompra:function(o){return r.delete(c+"compras/"+o)},desativar:function(o){return r.delete(c+"compras/"+o+"/desativar")},verificarStatusDisponivel:function(o){return r.get(c+"compras/"+o+"/status")},confirmarEntrega:function(o){return r.put(c+"compras/"+o+"/entregue")},relatarProblema:function(o){return r.put(c+"compras/"+o+"/problema")},resolverProblema:function(o){return r.put(c+"compras/"+o+"/problema/resolver")},enviarAvaliacao:function(o,e){return r.post(c+"compras/"+o+"/avaliar",e)},obterResultadoLegitCheck:function(o){return r.get(c+"interesses/"+o+"/legitcheck/result")},obterResultadoLegitCheckViaCode:function(o){return r.get(c+"interesses/"+o+"/legitcheck/resultbycode")},syncCompra:function(o){return console.log("id da compra",o),r.get(c+"interesses/"+o+"/syncpayment")},obterAnunciosParaCarrinho:function(o,e){return r.post(c+"compras/"+o+"/carrinho/anuncios",e)},obterFiltrosCarrinho:function(o){return r.get(c+"compras/"+o+"/carrinho/anuncios/filtros")},removerItemCarrinho:function(o,e){return r.delete(c+"compras/"+o+"/carrinho/"+e)},removerItensIndisponiveis:function(o){return r.delete(c+"compras/"+o+"/carrinho/removerindisponiveis")},obterDadosTracking:function(o){return r.get(c+"compras/"+o+"/tracking")},setarTracking:function(o){return r.patch(c+"compras/"+o+"/tracking",{})},obterInteresse:function(o,e){var a=i.defer(),r=c+"interesse",t={};return t.idproduto=o,t.idcliente=e,n.patch(r,t).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},obterVenda:function(o){var e=i.defer();return n.get(c+"interesse/"+o+"/venda").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterTodosInteresses:function(){var e=i.defer();return n.get(c+"interesses").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterMensagensNaoLidas:function(){var e=i.defer();return n.get(c+"interesses/mensagensx/naolidas").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise}}}]),angular.module("Proj").service("ConsignacaoService",["$http","$q","ApiCK","$request",function(o,e,t,n){return{obterConsignacoes:function(o){return n.post(t+"consignacao/busca",o)},obterConsignacoesPorStatus:function(o){return n.post(t+"consignacao/busca/porstatus",o)},obterConsignacaoPorId:function(o){return n.get(t+"consignacao/"+o)},alterarStatus:function(o,e){return n.patch(t+"consignacao/"+o+"/status",e)},criarProposta:function(o,e){return n.post(t+"consignacao/"+o+"/proposta",e)},aceitarProposta:function(o){return n.patch(t+"consignacao/"+o+"/aceite",{})},obterHistorico:function(o,e,a){var r="";return null===e&&void 0===e||(r+="?page="+e),null===a&&void 0===a||(r+="&amount="+a),n.get(t+"consignacao/"+o+"/historico"+r)},obterLojaFisica:function(o){return n.get(t+"lojafisica/"+o)},desistirProposta:function(o){return n.delete(t+"consignacao/"+o+"/proposta")}}}]),angular.module("Proj").service("ConfiguracaoService",["ApiCK","$request",function(o,e){var a=o+"usuario/config";return{obterConfiguracao:function(){return e.get(a+"/preferencias")},atualizarConfiguracao:function(o){return e.put(a+"/preferencias",o)},obterDevices:function(){return e.get(a+"/devices")},limparDevices:function(){return e.delete(a+"/devices")},deleteAccount:function(){return e.delete(a+"/deleteaccount")}}}]),angular.module("Proj").service("ConversaService",["ApiCK","$request",function(e,a){return{obterLista:function(){return a.get(e+"conversas")},obterInteresse:function(o){return a.get(e+"conversas/"+o)},apagarConversa:function(o){return a.delete(e+"conversas/"+o)}}}]).service("MensagemService",["$http","$q","ApiCK","$request",function(l,d,u,e){return{obterMensagens:function(o,e,a,r){var t=d.defer();return l.get(u+"interesses/"+o+"/mensagens/"+a+"/"+r).success(function(o){t.resolve(o)}).error(function(o){t.reject(o)}),t.promise},obterUltimasMensagens:function(o,e){var a=d.defer();return l.get(u+"interesses/"+o+"/mensagens/last/"+e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},verificarAtualizacaoMensagens:function(o,e){var a=d.defer();return l.get(u+"interesses/"+o+"/mensagens/verifylastupdate/"+e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},enviar:function(o,e,a,r,t,n,i){var c=d.defer(),o=u+"interesses/"+o+"/mensagens",s={};return s.texto=t,s.tipo=n,s.objeto=i,s.idusuariocomprador=r,s.idusuariovendedor=a,l.post(o,s).success(function(o){c.resolve(o)}).error(function(o){c.reject(o)}),c.promise},obterLinkPagamento:function(o,e){var a=d.defer(),r={};return r.preco=angular.copy(e),r.preco=r.preco.replace(",","."),l.post(u+"interesses/"+o+"/mercadopago/gerarlink",r).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},obterPrecoFrete:function(o,e){var a=d.defer();return l.post(u+"interesses/"+o+"/frete/calculo",e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},obterPacotePadrao:function(o){return e.get(u+"interesses/"+o+"/frete/pacote")}}}]),angular.module("Proj").service("DenunciaService",["ApiCK","$request",function(a,r){return{verificarDenuncia:function(o){return r.get(a+"usuarios/denuncias/produtos/"+o)},denunciar:function(o,e){return r.post(a+"denuncias",{idProduto:o,descricao:e})},responder:function(o,e){return r.patch(a+"denuncias/"+o+"/resposta",{resposta:e})}}}]),angular.module("Proj").service("DocumentosService",["ApiCK","$request",function(o,e){var a=o+"usuarios/docs";return{get:function(){return e.get(a)},save:function(o){return e.put(a,o)}}}]),angular.module("Proj").service("EnderecoService",["$http","$q","ApiCK","AuthFactory","$request",function(r,t,n,o,a){return{decodeCepAPI:function(o,e){return a.get(n+"usuarios/"+o+"/enderecos/cepautocomplete/"+e)},obterEnderecos:function(o){var e=t.defer();return r.get(n+"usuarios/"+o+"/enderecos").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obter:function(o,e){var a=t.defer();return r.get(n+"usuarios/"+o+"/enderecos/"+e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},save:function(o,e){var a=t.defer(),o=n+"usuarios/"+o+"/enderecos";return e.id?r.put(o+"/"+e.id,e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}):((e=angular.copy(e)).id=0,e.idBairro=0,r.post(o,e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)})),a.promise},desativar:function(o,e){var a=t.defer();return r.delete(n+"usuarios/"+o+"/enderecos/"+e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},setprincipal:function(o,e){var a=t.defer();return r.put(n+"usuarios/"+o+"/enderecos/"+e+"/principal").success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},obterEnderecoEntrega:function(o){var e=t.defer();return r.get(n+"interesses/"+o+"/enderecoentrega").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise}}}]),angular.module("Proj").service("DropService",["ApiCK","$http","$q","$request",function(c,n,i,s){return{pesquisar:function(o){var e=i.defer();return null==o||o.length<5?e.reject():n.get(c+"drops/pesquisar/"+o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterDrops:function(o,e){return s.get(c+"drops/"+o+"/"+e)},pesquisarDropsPaginado:function(o,e,a){var r=i.defer();return null==o||0===e&&o.length<5?r.reject():n.get(c+"drops/pesquisar/"+o+"/page/"+e+"/amount/"+a).success(function(o){r.resolve(o)}).error(function(o){r.reject(o)}),r.promise},obterDropCompleto:function(o){return s.get(c+"drops/"+o+"/anuncios")},obterDropCompletoV3ponto1:function(o){return s.get(c+"drops/v3/"+o+"/anuncios")},obterDropCompletoV2:function(o){var e=i.defer(),o="drops/v2/"+o+"/anuncios",a=c+o;return Krip("/api/"+o).then(function(o){n.get(a,{headers:{"x-drpr-stamp":o}}).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)})}).catch(function(o){e.reject(o)}),e.promise},obterDropCompletoV3:function(o){var e=i.defer(),o="drops/v3/"+o+"/anuncios",a=c+o;return Krip("/api/"+o).then(function(o){n.get(a,{headers:{"x-drpr-stamp":o}}).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)})}).catch(function(o){e.reject(o)}),e.promise},obterDropCompletoV3:function(o){var e=i.defer(),o="drops/v3/"+o+"/anuncios",a=c+o;return Krip("/api/"+o).then(function(o){n.get(a,{headers:{"x-drpr-stamp":o}}).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)})}).catch(function(o){e.reject(o)}),e.promise},obterDropCompletoV5:function(o){var e=i.defer(),o="drops/v5/"+o+"/anuncios",a=c+o;return Krip("/api/"+o).then(function(o){n.get(a,{headers:{"x-drpr-stamp":o}}).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)})}).catch(function(o){e.reject(o)}),e.promise},obterAnunciosDoTamanhoV3:function(o,e,a){var r=i.defer(),o="drops/v3/"+o+"/anuncios/"+e+"?isnovo="+a,t=c+o;return Krip("/api/"+o).then(function(o){n.get(t,{headers:{"x-drpr-stamp":o}}).success(function(o){r.resolve(o)}).error(function(o){r.reject(o)})}).catch(function(o){r.reject(o)}),r.promise},obterAnunciosDoTamanhoV4:function(o,e){var a=i.defer(),o="drops/v4/"+o+"/anuncios/"+e,r=c+o;return Krip("/api/"+o).then(function(o){n.get(r,{headers:{"x-drpr-stamp":o}}).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)})}).catch(function(o){a.reject(o)}),a.promise},obterCalendario:function(o,e){return s.get(c+"drops/calendar"+o+"/"+e)},obterExtraInfo:function(o){return s.get(c+"drops/"+o+"/extrainfo")},obterAlertasAtivosUsuario:function(o,e){return s.get(c+"usuarios/"+o+"/drops/"+e+"/alertastamanhos")},toogleAlertaUsuarioDropTamanho:function(o){return s.post(c+"alertastamanhos",o)},obterProdutos:function(o,e,a){return s.get(c+"drops/"+o+"/produtos/"+e+"/"+a)},obterPreco:function(o){return s.get(c+"drops/"+o+"/detalhes/preco")},obterValorDeMercado:function(o){return s.get(c+"drops/"+o+"/valormercado")},obterVendasRelatorio:function(o,e,a){e=null!=e?"periodo="+e+"&":"";return s.get(c+"drops/"+o+"/vendas/relatorio?"+(e=null==a&&void 0===a?e:e+"tamanho="+a))},obterDatasCalendario:function(){return s.get(c+"calendar/dates")},obterCalendarioDrops:function(o,e,a,r,t){var n=c+"calendar",i={};return i.page=o,i.amount=e,i.filtro=a,i.mes=r,i.ano=t,s.post(n,i)},obterLapses:function(o){return s.get(c+"lapse/drops/"+o)},carregarExtraInfoModelo:function(o){return o&&o.idModelo?(o=c+"/modelo/"+o.idModelo+"/extrainfo",s.get(o)):Promise.resolve({})}}}]),angular.module("Proj").service("GeralService",["$http","$q","ApiCK","$request",function(t,o,n,a){return{checkVersion:function(){var e,a,r=o.defer();return window.cordova?window.cordova.getAppVersion.getVersionNumber().then(function(o){a=o,e=window.device.platform.toLowerCase();o=function(o,e,a){for(var r=o.indexOf(e);-1<r;)r=(o=o.replace(e,a)).indexOf(e);return o}(a,".","-");t.get(n+"app/checkversion/"+e+"/"+o).success(function(o){r.resolve(o)}).error(function(o){r.reject(o)})}):r.reject("NO_MOBILE"),r.promise},verifyNotifications:function(){return a.get(n+"usuarios/alerta")},enviarDuvida:function(o){return a.post(n+"usuarios/duvidas",o)},verificarEstaComprando:function(){return a.get(n+"usuarios/estacomprando")},enviarAvaliacao:function(o,e){return a.post(n+"compras/"+o+"/avaliar",e)},obterShoppingCidadeJardins:function(){return a.get(n+"lojasfisicas/scj/cal")}}}]),angular.module("Proj").service("EventoService",["ApiCK","$request","$http",function(r,t,o){return{obterEventoPorId:function(o){return t.get(r+"eventos/"+o)},obterEventoPorTokenConvite:function(o){return t.get(r+"eventos/"+o)},confirmarEvento:function(o){return t.patch(r+"eventos/"+o+"/confirmacao")},declinarEvento:function(o){return t.patch(r+"eventos/"+o+"/declinacao")},obterConfirmacoes:function(o,e){var a="",o=(o&&(a=a+"?page="+o),r+"eventos/confirmacoes"+(a=e?a+"&amount="+e:a));return t.get(o)},obterAbertos:function(o,e){var a="",o=(o&&(a=a+"?page="+o),r+"eventos/abertos"+(a=e?a+"&amount="+e:a));return t.get(o)},enviarEventoParaCalendario:function(o,e){return t.post(r+"eventos/"+o+"/calendario",e)}}}]),angular.module("Proj").service("HomeService",["$http","$q","ApiCK","$request",function(o,e,n,i){return{obterInicio:function(){return i.getWithCache(n+"home")},obterInicioPart1:function(){return i.get(n+"homev2")},obterMaisColecoes:function(o,e){return i.get(n+"homev2/"+o+"/"+e)},obterProdutosNovidades:function(o,e,a,r,t){a=a&&a.id?a.id:0,r=r&&r.id?r.id:0,o=n+"produtos/novidades/"+o+"/"+e+"?tipoproduto="+a+"&tamanho="+r;return i.get(o=t?o+"&idusuario="+t:o)},obterProdutosNovidadesv2:function(o,e,a,r,t){o=n+"produtos/novidadesv2/"+o+"/"+e+"?";return a&&(o=o+"tipoproduto="+a),r&&(o=o+"&tamanho="+r),i.get(o=t?o+"&idusuario="+t:o)},obterListaFavoritados:function(){return i.get(n+"produtos/favoritados")},obterListaFavoritadosV2:function(o,e){var a=n+"produtos/favoritos/v2";return o&&(a=a+"/?tipoproduto="+o),i.get(a=e?a+"&tamanho="+e:a)},obterResumoCompras:function(){return i.getWithCache(n+"compras/resumo")},obterOpcoesHome:function(){return[{icon:"qr_code_scanner",url:"/legitcheck/reader",name:"Ler tag"},{icon:"arrow_upward",url:"/anunciar",name:"Anunciar"},{icon:"chat_bubble",url:"/mensagens",name:"Mensagens"},{icon:"shopping_cart",url:"/compras",name:"Compras"},{icon:"local_offer",url:"/market",name:"Market"},{icon:"show_chart",url:"/vendas",name:"Vendas"},{icon:"favorite",url:"/favoritos",name:"Favoritos"},{icon:"extension",url:"/comofunciona",name:"Como funciona"}]}}}]),angular.module("Proj").service("LapsesService",["$http","$q","ApiCK","$request",function(o,e,a,r){var t=[],n=[],i="naoAssistido",c="assistido",s="naoTemLapse";return{obterLapsePorMarcaId:function(o){return r.get(a+"marca/"+o+"/lapses")},obterMarcas:function(){return r.get(a+"lapse/marcas")},obterDrop:function(o){return r.get(a+"lapse/drops/"+o)},getLapses:function(){return t},setLapses:function(o){t=o},getMarcas:function(){return n},setMarcas:function(o){n=o.map(function(o){return o.marca});for(var e=[],a=[],r=0;r<n.length;r++)("naoAssistido"===this.showLapseMarca(n[r].id)?e:a).push(n[r]);n=e.concat(a)},setMarcasV2:function(o){n=o},createLocalStorageLapse:function(){window.localStorage.getItem("marcaIdList")||window.localStorage.setItem("marcaIdList","")},setMarcaOnLocalStorage:function(e){var o=window.localStorage.getItem("marcaIdList");this.convertToList().some(function(o){return o==e})||window.localStorage.setItem("marcaIdList",o+(e+","))},showLapseMarca:function(e){var o,a=this.carregarHistorico()||[],r=this.getMarcas(),t=a.find(function(o){return o.idMarca===e}),n=r.find(function(o){return o.id===e}),t=(n&&t&&(o=n.ultimaDataCriacao>t.ultimoVisto,this.salvarHistorico(e,t.ultimoVisto,n.ultimaDataCriacao,!o)),a.some(function(o){return o.idMarca===e&&o.isAssistido})),n=r.some(function(o){return o.id===e});return!t&&n?i:t&&n?c:n?void 0:s},convertToList:function(){var o=(window.localStorage.getItem("marcaIdList")||"").split(",");return""===o[o.length-1]&&o.pop(),o},clearLocalStorageLapses:function(){window.localStorage.removeItem("marcaIdList")},salvarHistorico:function(e,o,a){try{var r=this.carregarHistorico()||[],t=r.find(function(o){return o.idMarca===e}),n=(t&&t.ultimoVisto<o&&(t.isAssistido=a,t.ultimoVisto=o),t||r.push({idMarca:e,ultimoVisto:o,isAssistido:a}),JSON.stringify(r));window.localStorage.setItem("lapses-history",n)}catch(o){console.error(o)}},carregarHistorico:function(){try{var o=window.localStorage.getItem("lapses-history");return JSON.parse(o)||[]}catch(o){return[]}},salvarHistoricoV2:function(e,o){try{var a=this.carregarHistoricoV2()||[],r=a.find(function(o){return o.idMarca===e.id}),t=(r?o.spanDataCriacao>r.ultimoVisto&&(r.ultimoVisto=o.spanDataCriacao):a.push(this.construirHistoricoV2(e,o)),JSON.stringify(a));window.localStorage.setItem("lapses-historyv2",t)}catch(o){console.error(o)}},carregarHistoricoV2:function(){try{var o=window.localStorage.getItem("lapses-historyv2");return JSON.parse(o)||[]}catch(o){return[]}},construirHistoricoV2:function(o,e){return{idMarca:o.id,ultimoVisto:e.spanDataCriacao}},contabilizarView:function(o){return r.post(a+"lapse/view/"+o,{})}}}]),angular.module("Proj").service("LiveService",["ApiCK","ApiLapse","$http","$q","$request",function(o,a,r,t,e){var n=null;return{pingStream:function(o){n=n||function(){for(var o="",e=0;e<32;e++){var a=75*Math.random()+48;o+=String.fromCharCode(a)}return o}();var e=t.defer(),o=o?{}:{headers:{"live-session":n}};return r.get(a+"live",o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise}}}]),angular.module("Proj").service("LegitCheckService",["ApiCK","$request",function(e,a){return{obterResultadoLegitCheck:function(o){return a.get(e+"interesses/"+o+"/legitcheck/result")},obterResultadoLegitCheckViaCode:function(o){return a.get(e+"interesses/"+o+"/legitcheck/resultbycode")}}}]),angular.module("Proj").service("LiveCommerceService",["ApiCK","$http","$q",function(o,a,r){var c={host:"ctlk.co",transcoder:"transcoder.ctlk.co",ssl:!0,appkey:"droper",debug:!0};function e(o){return c.ssl?"wss://"+o:"ws://"+o}function t(e,n,i){return new Promise(function(a,r){var o,t=new XMLHttpRequest;t.open(e,(o=n,c.ssl?"https://"+o:"http://"+o),!0),t.setRequestHeader("LISA-App",c.appkey),t.setRequestHeader("Content-Type","application/json"),c.appkey||warn("você precisa especficar o appkey antes de realizar requisições"),t.onreadystatechange=function(){var o,e;t.readyState===t.DONE&&(o=200<=t.status&&t.status<300,e=function(o){try{return{success:!0,data:JSON.parse(o)}}catch(o){return{success:!1,data:{error:"não foi possível ler resposta JSON",details:o.message}}}}(t.responseText),(o&&e.success?a:r)(e.data,t.status))},t.send(JSON.stringify(i))})}return{profile:c,crypt:function(){return t("GET",c.host+"/api/v1/utils",{})},livesIniciadas:function(){return t("GET",c.host+"/api/v1/apps/"+c.appkey+"/lives/iniciadas",{})},livesEncerradas:function(){return t("GET",c.host+"/api/v1/apps/"+c.appkey+"/lives/encerradas",{})},criarLive:function(o){return t("POST",c.host+"/api/v1/apps/"+c.appkey+"/lives",o)},obterLivePorId:function(o){return t("GET",c.host+"/api/v1/lives/"+o,live)},obterLivePorLabel:function(o){return t("GET",c.host+"/api/v1/apps/"+c.appkey+"/lives/"+o,{})},configurarLive:function(o,e){return t("PATCH",c.host+"/api/v1/apps/"+c.appkey+"/lives/"+o,e)},editarLive:function(o,e){return t("PUT",c.host+"/api/v1/lives/"+o,e)},iniciarLive:function(o){return t("PATCH",c.host+"/api/v1/lives/"+o+"/inicio",{})},encerrarLive:function(o){return t("PATCH",c.host+"/api/v1/lives/"+o+"/encerramento",{})},alterarMetadata:function(o,e){return t("PATCH",c.host+"/api/v1/lives/"+o+"/metadata",e)},resetarLive:function(o){return t("PATCH",c.host+"/api/v1/lives/"+o+"/reset",{})},broadcastWsEndpoint:function(o){return e(c.host+"/api/ws/v1/live/"+o.id+"/broadcast")},watchWsEndpoint:function(o){return e(c.host+"/api/ws/v1/live/"+o.id+"/watch")},transcoderHost:function(){return e(c.transcoder)},subscribe:function(o,e){return t("POST",c.host+"/api/v1/events/live/"+o+"/sub",e)},ping:function(o,e){return t("POST",c.host+"/api/v1/events/live/"+o+"/sub/"+e.id+"/ping",{})},autenticarStreamer:function(o){var e=r.defer();return"123456"===o?e.resolve(":)"):e.reject(":("),e.promise},getDrops:function(o){var e=r.defer();return a.get("https://service.cataloko.com/api/drops/pesquisar/"+o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},ajustarProporcaoCanvas:function(o,e,a){var r=0<window.innerWidth?window.innerWidth:screen.width,r=(0<window.innerHeight?window.innerHeight:screen.height)<=r,o=document.getElementById(o);r&&(o.style.height="100vh",o.style.width="56.25vh",o.style.borderRadius="0px",r=document.getElementById(e),o=document.getElementById(a),r&&(r.style.position="inherit"),o)&&(o.style.position="inherit")},togglePopup:function(o){var e,o=document.getElementById(o);o&&(e="block"===o.style.display,o.style.display=e?"none":"block")},openPopup:function(o){chElemDisplay(o,"block")},closePopup:function(o){chElemDisplay(o,"none")},chElemDisplay:function(o,e){o=document.getElementById(o);o&&(o.style.display=e)},contagem:function(a){function r(o){return o<10?"0"+o:o}return function(){var o=Math.round(Date.now()/1e3)-a,e=Math.floor(o/60);return r(e)+":"+r(o%60)}}}}]),angular.module("Proj").service("LoginService",["$http","$q","ApiCK","$request",function(o,e,a,r){return{enviarRecuperacaoSenha:function(o){return r.post(a+"usuario/recuperarsenha/enviar",o)},validarTokenRecuperarSenha:function(o){return r.get(a+"usuario/recuperarsenha/validar/"+o)},redefinirSenha:function(o,e){return r.post(a+"usuario/recuperarsenha/redefinir/"+o,e)}}}]),angular.module("Proj").service("LojaService",["$http","$q","ApiCK","$request",function(n,i,c,a){return{obterProdutosLoja:function(){var e=i.defer();return n.get(c+"auth").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterLoja:function(o){var e=i.defer();return n.get(c+"lojas/"+o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterLojaPublic:function(o){var e=i.defer();return n.get(c+"lojas/"+o+"/public").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterLojaPorId:function(o){var e=i.defer();return n.get(c+"lojas/"+o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterProduto:function(o){var e=i.defer();return n.get(c+"produtos/"+o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterProdutoV2:function(o){var e=i.defer(),o="produtos/v2/"+o,a=c+o;return Krip("/api/"+o).then(function(o){n.get(a,{headers:{"x-drpr-stamp":o}}).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)})}).catch(function(o){e.reject(o)}),e.promise},obterProdutosPorCategoria:function(o,e){var a=i.defer();return n.get(c+"lojas/"+o+"/categoria/"+e+"/produtos").success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},obterProdutosPorTermo:function(o,e){var a=i.defer();return n.get(c+"lojas/"+o+"/produtos/"+e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},obterProdutoOpcoesParcelamento:function(o){return a.get(c+"produtos/"+o+"/compras/parcelamento")},iniciarChat:function(o,e){var a=i.defer(),r=c+"interesse",t={};return t.idProduto=o,t.idCliente=e,n.patch(r,t).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},lojaCountVs:function(o){var e=i.defer();return n.get(c+"lojas/"+o+"/vs").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterSeguidores:function(o){var e=i.defer();return n.get(c+"lojas/"+o+"/seguidores").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},produtoCountVs:function(o){var e=i.defer();return n.get(c+"produtos/"+o+"/vs").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},produtoRegEngajamento:function(o,e){var a=i.defer();return n.get(c+"produtos/"+o+"/engajamento/tipo/"+e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},obterVendedor:function(o){return a.get(c+"clientes/"+o+"/vendedor")},obterProdutosVendedor:function(o){return a.get(c+"clientes/"+o+"/vendedor/produtos")},simularFrete:function(o){return a.get(c+"produtos/"+o+"/simulacao")},simularFretes:function(o){return a.get(c+"produtos/"+o+"/frete")},simularFreteComCep:function(o,e){return a.get(c+"produtos/"+o+"/simulacoes/frete/"+e)}}}]).service("AvaliacaoService",["ApiCK","$request",function(a,r){return{obterAvaliacoes:function(o,e){return r.get(a+"avaliacoes/"+o+"/tipo/"+e+"/v2")},obterAvaliacoesDoProduto:function(o){return r.get(a+"avaliacoes/produto/"+o)}}}]).service("anchorSmoothScroll",[function(){this.scrollTo=function(o){var e=self.pageYOffset||(document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop||0),a=function(o){var o=document.getElementById(o),e=o.offsetTop,a=o;for(;a.offsetParent&&a.offsetParent!=document.body;)a=a.offsetParent,e+=a.offsetTop;return e}(o),o=e<a?a-e:e-a;if(o<100)scrollTo(0,a);else{var r=Math.round(o/100),t=(20<=r&&(r=20),Math.round(o/25)),n=e<a?e+t:e-t,i=0;if(e<a)for(var c=e;c<a;c+=t)setTimeout("window.scrollTo(0, "+n+")",i*r),a<(n+=t)&&(n=a),i++;else for(c=e;a<c;c-=t)setTimeout("window.scrollTo(0, "+n+")",i*r),(n-=t)<a&&(n=a),i++}}}]),angular.module("Proj").service("NewsService",["$http","$q","ApiCK",function(n,i,c){return{obterNoticias:function(o,e,a){var r=i.defer();return n.get(c+"noticias/"+o+"/"+e+"/"+a).success(function(o){r.resolve(o)}).error(function(o){r.reject(o)}),r.promise},obterNoticiasV2:function(o,e,a){var r=i.defer(),t="",o=(null!=o&&(t=t+"page="+o+"&"),null!=e&&(t=t+"amount="+e+"&"),c+"noticias?"+(t=null!=a?t+"top="+a:t));return n.get(o).success(function(o){r.resolve(o)}).error(function(o){r.reject(o)}),r.promise},obterNoticia:function(o){var e=i.defer();return n.get(c+"noticias/"+o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterUltimasNoticias:function(o){var e=i.defer();return n.get(c+"noticias/"+o+"/relacionados").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterAutores:function(){var e=i.defer();return n.get(c+"noticias/autores/ranking").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterAutor:function(o){var e=i.defer();return n.get(c+"noticias/autores/"+o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise}}}]),angular.module("Proj").service("NotificacaoService",["$request","ApiCK",function(r,t){return{obterNotificacoes:function(o,e,a){return r.get(t+"usuarios/"+o+"/notificacoes?page="+e+"&amount="+a)},verifyNotifications:function(){return r.get(t+"usuarios/alerta")},obterNotificacoesConfig:function(o){return r.get(t+"usuarios/"+o+"/notificacoes/configuracoes")},enviarNotificacoesTeste:function(o,e){return r.post(t+"usuarios/"+o+"/notificacoes/testes/"+e)}}}]),angular.module("Proj").service("PagamentoService",["$http","$q","ApiCK","$request","$interval","pagarMeCripto",function($http,$q,ApiCK,$request,$interval,pagarMeCripto){var modes={MODE_JUNO:1,MODE_MP:2,MODE_PIP:3,MODE_WC:4,MODE_PG:12,MODE_TRF_PIX:11,MODE_MAXIPAGO:13},mpErrosCollection=[{code:"106",description:"Não pode efetuar pagamentos a usuários de outros países"},{code:"109",description:"Parcelamento indisponível, escolha outro cartão ou outra forma de pagamento!"},{code:"126",description:"Não conseguimos processar seu pagamento"},{code:"129",description:"Essa forma de pagamento não processa o valor selecionado"},{code:"145",description:"Não conseguimos processar seu pagamento"},{code:"150",description:"Você não pode efetuar pagamentos"},{code:"151",description:"Você não pode efetuar pagamentos"},{code:"160",description:"Não conseguimos processar seu pagamento"},{code:"204",description:"Forma de pagamento indisponível. Escolha outro cartão ou outra forma de pagamento"},{code:"801",description:"Você efetuou um pagamento no mesmo valor alguns minutos atrás. Tente novamente em alguns minutos!"},{code:"default",description:"Não conseguimos processar seu pagamento"},{code:"205",description:"Digite o número do seu cartão"},{code:"208",description:"Escolha um mês"},{code:"209",description:"Escolha um ano"},{code:"212",description:"Informe seu documento"},{code:"213",description:"Informe seu documento"},{code:"214",description:"Informe seu documento"},{code:"220",description:"Informe seu banco emissor"},{code:"221",description:"Digite o nome e sobrenome"},{code:"224",description:"Digite o código de segurança"},{code:"E301",description:"Há algo de errado com esse número de cartão"},{code:"E302",description:"Confira o código de segurança"},{code:"316",description:"Por favor, digite um nome válido"},{code:"322",description:"Confira seu documento"},{code:"323",description:"Confira seu documento"},{code:"324",description:"Confira seu documento"},{code:"325",description:"Confira o mês de expiração"},{code:"326",description:"Confira o ano de expiração"}];function validarCpf(o){if(11!=o.length||"00000000000"==o||"11111111111"==o||"22222222222"==o||"33333333333"==o||"44444444444"==o||"55555555555"==o||"66666666666"==o||"77777777777"==o||"88888888888"==o||"99999999999"==o)return!1;for(var e=0,a=0;a<9;a++)e+=parseInt(o.charAt(a))*(10-a);var r=11-e%11;if((r=10!=r&&11!=r?r:0)!=parseInt(o.charAt(9)))return!1;for(a=e=0;a<10;a++)e+=parseInt(o.charAt(a))*(11-a);return(r=10!=(r=11-e%11)&&11!=r?r:0)==parseInt(o.charAt(10))}function validarCNPJ(cnpj){var valida=new Array(6,5,4,3,2,9,8,7,6,5,4,3,2),dig1=new Number,dig2=new Number,exp="/.|-|//g",digito=(cnpj=cnpj.toString().replace(exp,""),new Number(eval(cnpj.charAt(12)+cnpj.charAt(13))));for(i=0;i<valida.length;i++)dig1+=0<i?cnpj.charAt(i-1)*valida[i]:0,dig2+=cnpj.charAt(i)*valida[i];return dig1=dig1%11<2?0:11-dig1%11,dig2=dig2%11<2?0:11-dig2%11,10*dig1+dig2!=digito?!1:!0}function resolveErroMercadoPago(e){var o=mpErrosCollection.find(function(o){return o.code==e});return null!=o&&null!=o.description?o.description:null}function resolverCardBrand(o){return"amex"==(o=null!=o&&2<o.length?o.toLowerCase():o)||"americanexpress"==o?"angular/img/cardbrands/amex.png":"elo"==o?"angular/img/cardbrands/elo.png":"visa"==o?"angular/img/cardbrands/visa.png":"mastercard"==o?"angular/img/cardbrands/master.png":"hipercard"==o?"angular/img/cardbrands/hipercard.png":"diners"==o||"dinersclub"==o?"angular/img/cardbrands/diners.png":"discover"==o?"angular/img/cardbrands/discovery.png":"aura"==o?"angular/img/cardbrands/aura.png":"jcb"==o||"jcb_15"==o||"jcb_16"==o?"angular/img/cardbrands/jbc.png":null}return{obterCompra:function(o){return $request.get(ApiCK+"compras/"+o)},obterConfiguracoes:function(o){return $request.get(ApiCK+"compras/"+o+"/pagar/configuracao")},obterServiceModes:function(){return modes},resolverCardBrand:function(o){return resolverCardBrand(o)},gerarLinkPagamentoMercadoPago:function(o,e,a,r,t,n){if(null==r||null==e||null==a)throw"Alguns dados estão faltando";var i={};return i.email=r,i.documentType=e,i.documentNumber=a,i.installments=1,i.paymentMethod="mercadopagocheckout",i.nome=t,i.isCordova=n,$request.post(ApiCK+"compras/"+o+"/pagar/mercadopagocheckout",i)},enviarDadosBoleto:function(o,e){return $request.post(ApiCK+"compras/"+o+"/pagar/boleto/enviarpara/"+e)},validationCpfCnpj:function(o,e){return null!=o&&null!=e&&("CPF"==o?validarCpf(e):"CNPJ"==o&&validarCNPJ(e))},validarDataNascimento:function(o,e,a){var r,o=parseInt(o),e=parseInt(e),a=parseInt(a);return!(o<1||31<o||e<1||12<e||a<1920||a>(new Date).getFullYear()-15||(r=new Date(a,e-1,o),a=Date.parse(r),0!=isNaN(a)))?r:null},obterParcelamento:function(o){return $request.get(ApiCK+"compras/"+o+"/pagar/parcelamentos")},mp_finalizarCompraCartao:function(o,e,a,r,t,n,i,c,s,l,d,u){var p={};if(null==e||null==a||null==n)throw"Alguns dados estão faltando";return p.token=e,p.email=a,p.documentType=r,p.documentNumber=t,p.installments=n,p.paymentMethod="credit_card",p.data=c,p.nome=i,p.issuerId=s,p.paymentMethodId=l,p.paymentMethodType=d,p.mode=2,p.idEndereco=u,$request.post(ApiCK+"compras/"+o+"/pagar",p)},mp_monstarSdk:function(o,e){var a=$q.defer();try{isprod?window.junoSdk=new DirectCheckout(e):window.junoSdk=new DirectCheckout(e,!1),null!=window.junoSdk._publicToken&&a.resolve(window.junoSdk)}catch(o){a.reject("Ops, aconteceu algum erro inesperado :(")}return a.promise},mp_validateFormErrors:function(a,o){return a=[],null!=o&&null!=o.cause&&0<o.cause.length&&o.cause.forEach(function(o,e){null!=o&&null!=o.code&&(o=resolveErroMercadoPago(o.code))&&a.push(o)}),null!=o&&0<o.length&&a.push(o),a},mp_ObterTiposDocumento:function(o){return o.getIdentificationTypes()},mp_CriarTokenCartao:function(o,e){var a=$q.defer();try{o.createToken(e,function(o,e){200!=o&&201!=o?a.reject(e):a.resolve(e)})}catch(o){a.reject("Ocorreu algum erro ao processar seu cartão. Entre em contato com o suporte!")}return a.promise},obterDadosPix:function(o,e,a,r,t,n,i){if(null==r||null==e||null==a)throw"Alguns dados estão faltando";var c={};return c.email=r,c.documentType=e,c.documentNumber=a,c.installments=1,c.paymentMethod="pix",c.nome=t,c.data=n,c.isCordova=i,$request.post(ApiCK+"compras/"+idcompra+"/pagar/pix",c)},gerarPix:function(o,e,a,r,t,n,i,c,s){if(null==r||null==e||null==a)throw"Alguns dados estão faltando";var l={};return l.email=r,l.documentType=e,l.documentNumber=a,l.installments=1,l.paymentMethod="pix",l.nome=t,l.data=n,l.isCordova=i,l.fingerprint=s,l.Mode=11,$request.post(ApiCK+"compras/"+o+"/pagar/pix",l)},pagarmeGerarHashCC:function(e){var a=$q.defer();try{pagarme.client.connect({encryption_key:pagarMeCripto}).then(function(o){return o.security.encrypt(e)}).then(function(o){a.resolve(o)})}catch(o){a.reject("Confira os dados do cartão de crédito informado")}return a.promise},pagarmeFinalizarCompraCartao:function(o,e,a,r,t,n,i,c,s,l,d,u,p,f,m,g){var h={};return h.token=e,h.email=a,h.documentType=r,h.documentNumber=t,h.installments=n,h.data=s,h.nome=i,h.paymentMethod=d,h.telefone=c,h.telefoneCodigoNacional="+55",h.idEndereco=l,h.mode=modes.MODE_PG,h.marketplaceMode=u,h.fingerprint=p,h.ip=f,h.salvarCartao=m||!1,h.dataNascimento=g,$request.post(ApiCK+"compras/"+o+"/pagar",h)},pagarmeFinalizarCompraCartaoSalvo:function(o,e,a,r,t,n,i,c,s,l){var d={};return d.cardid=e,d.cardCvv=a,d.email=r,d.documentType=t,d.documentNumber=n,d.installments=i,d.paymentMethod="credit_card",d.mode=modes.MODE_PG,d.marketplaceMode=c,d.fingerprint=s,d.ip=l,d.salvarCartao=!1,$request.post(ApiCK+"compras/"+o+"/pagar",d)},pagarmeExcluirCartaoSalvo:function(o){return $request.delete(ApiCK+"usuarios/pagarme/cartoes/"+o)},maxipagoGerarHashCC:function(o){return new Promise(function(o,e){o("")})},maxipagoFinalizarCompraCartao:function(o,e,a,r,t,n,i,c,s,l,d,u,p,f,m,g,h,v,w,C,b){var S={};return S.token=e,S.email=a,S.documentType=r,S.documentNumber=t,S.installments=n,S.data=s,S.nome=i,S.paymentMethod=d,S.telefone=c,S.telefoneCodigoNacional="+55",S.idEndereco=l,S.mode=modes.MODE_MAXIPAGO,S.marketplaceMode=u,S.fingerprint=p,S.ip=f,S.salvarCartao=m||!1,S.dataNascimento=g,b&&(S.cardNumber=h,S.cardExpiration=v+"/"+w,S.cardCvv=C),$request.post(ApiCK+"compras/"+o+"/pagar",S)},maxipagoFinalizarCompraCartaoSalvo:function(o,e,a,r,t,n,i,c,s,l){var d={};return d.cardid=e,d.cardCvv=a,d.email=r,d.documentType=t,d.documentNumber=n,d.installments=i,d.paymentMethod="credit_card",d.mode=modes.MODE_MAXIPAGO,d.marketplaceMode=c,d.fingerprint=s,d.ip=l,d.salvarCartao=!1,$request.post(ApiCK+"compras/"+o+"/pagar",d)},maxipagoExcluirCartaoSalvo:function(o){return $request.delete(ApiCK+"usuarios/maxipago/cartoes/"+o)},validarCC_precapturar:function(o,e){return $request.post(ApiCK+"compras/"+o+"/cc/preprocessar",e)},validarCC_verificarvalor:function(o,e,a){var r={};return r.token=a,r.valor=e,$request.post(ApiCK+"compras/"+o+"/cc/preprocessar/verify",r)}}}]),angular.module("Proj").service("RaffleService",["ApiCK","$request","$http",function(a,r,o){return{get:function(o){return r.get(a+"sorteios/"+o)},criarParticipacao:function(o,e){return r.post(a+"sorteios/"+o+"/participacao",e)},removerParticipacao:function(o){return r.delete(a+"sorteios/"+o+"/participacao")}}}]),angular.module("Proj").service("ColecionavelService",["$http","$q","ApiCK","$request",function(o,e,a,r){return{obterMarcas:function(o){return r.get(a+"segmento/"+o)},obterMarcasPorSegmento:function(){return r.get(a+"segmento/marcas")}}}]),angular.module("Proj").service("SparksService",["ApiCK","ApiLapse","$request","CkHLS","CkHttpCache",function(n,o,i,t,c){return{getSparks:function(o,e,a,r,t){o=n+"sparks?pg="+o+"&n="+e,e=!!r,r=a||this.obterHistorico(),a=(r.maisAntigo||0===r.maisAntigo)&&(r.maisRecente||0===r.maisRecente);return!e&&a&&(o+="&maisantigo="+r.maisAntigo+"&maisrecente="+r.maisRecente),t&&(o+="&retry=true"),i.get(o)},getPrecache:function(o){var e=n+"sparks/precache",a=this.obterHistorico(),r=(a.maisAntigo||0===a.maisAntigo)&&(a.maisRecente||0===a.maisRecente);return!o&&r&&(e+="?maisantigo="+a.maisAntigo+"&maisrecente="+a.maisRecente),i.get(e)},view:function(o){try{var e=n+"sparks/"+o.tipo+"/"+o.dados.id+"/view";return i.patch(e,{})}catch(o){console.error(o)}},obterHistorico:function(){try{var o=localStorage.getItem("sparks-history");if(o)return JSON.parse(o)}catch(o){console.error("GET sparks-history",o)}return{maisAntigo:null,maisRecente:null}},salvarHistorico:function(o){try{var e=o.dataUnix,a=this.obterHistorico(),r=a.maisAntigo||0,t=a.maisRecente||0,n={maisAntigo:r?Math.min(e,r):e,maisRecente:t?Math.max(e,t):e},i=JSON.stringify(n);localStorage.setItem("sparks-history",i)}catch(o){console.error("SAVE sparks-history",o)}},precache:function(o){var r=this.getPrecache(o);return new Promise(function(e,a){r.then(function(o){o.sparks.forEach(function(o){"lapse"===o.tipo&&t.precache(o.dados.playlist),"news"===o.tipo&&c.fetch(o.dados.imagem)}),e(o)}).catch(function(o){console.error("SPARKS PRECACHE",o),a(o)})})}}}]),angular.module("Proj").directive("ckLojaads",["$http","$q","CkImgToColorFactory",function(o,e,i){return{restrict:"EA",scope:{dados:"<"},controller:["$scope","$http","$q","ApiCK",function(a,r,t,n){a.carregaLoja=function(){var e,o;e=t.defer(),o=n+"ads/lojas/randomico",r.get(o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise.then(function(o){a.dados=o,i.getPrimaryColor(a.dados.loja.fotoperfil).then(function(o){a.dados.background=o}).catch(function(){a.dados.background="#000"})}).catch(function(o){})},a.init=void a.carregaLoja()}],templateUrl:"angular/app/shared/ckAds/partials/lojahomeads.tpl.html"}}]).directive("ads",function(){return{link:function(o,e,a){var r,t=document.createElement("iframe"),e=(e[0].appendChild(t),t.width=o.largura,t.height=o.altura,t.style="border: none;",""),n='<html style="overflow:hidden;"><body style="margin:0px; padding:0px;">',i="</body></html>";{var c;"spider"==o.platform&&((r=t.contentDocument.createElement("script")).src="http://venom.spider.ad?id=56984",r.type="text/javascript","vitrine"==o.type&&(e=n+'<div id = "divSpdVitrineAds"></div> '+$(r)[0].outerHTML+i),"script"==o.type)&&((c=t.contentDocument.createElement("script")).src=o.src,c.type="text/javascript",e=n+$(c)[0].outerHTML+$(r)[0].outerHTML+i)}"infolinks"==o.platform&&((r=t.contentDocument.createElement("script")).src="http://resources.infolinks.com/js/infolinks_main.js",r.type="text/javascript","inarticle"==o.type)&&(e=n+'<script type="text/javascript">var infolinks_pid = 3104841;var infolinks_wsid = 0;<\/script>'+$(r)[0].outerHTML+'<input type="hidden" name="IL_IN_ARTICLE">'+i);t.srcdoc=e},restrict:"EA",scope:{platform:"@",type:"@",src:"@",altura:"@",largura:"@"}}}),angular.module("Proj").directive("ckChat",function(){return{restrict:"EA",scope:{interesse:"=",tipo:"="},controller:"ChatCtrl",templateUrl:"angular/app/shared/ckChat/partials/conversa.tpl.html"}}).controller("ChatCtrl",["$scope","$rootScope","$routeParams","$mdDialog","MensagemService","AuthFactory",function(o,e,a,r,t,n){o.init=void o.carregarConversa(o.interesse.id,o.tipo)}]),angular.module("Proj").service("ckComp",[function(){var a={},r={OK:"ok",OK_CACHED:"ok_cached",ERR:"err",ERR_COMP_NOT_FOUND:"err_comp_not_found",ERR_ASSERT:"err_assertion"};function o(n,o){var i=r,c=a,e=o||function(){return!1};return"function"!=typeof e?(console.error("[ckComp.js][script()] Parâmetro isLoaded deve ser undefined ou uma função"),Promise.reject(i.ERR_ASSERT)):function(){return new Promise(function(r,t){e()?r(i.OK_CACHED):$.getScript(n,function(o,e,a){"success"===e?(c[n]=!0,r(i.OK)):t(i.ERR)})})}}var t,n,i,e={"clipboard.js":o("angular/comp/clipboardjs/src/clipboard.js",function(){return window.ClipboardJS}),"jquery.zoom.js":o("https://cdnjs.cloudflare.com/ajax/libs/jquery-zoom/1.7.11/jquery.zoom.js",function(){return $().zoom}),"chart.js":o("angular/comp/chartjs/chart.min.js",function(){return window.Chart}),"model-viewer.min.js":(t="https://ajax.googleapis.com/ajax/libs/model-viewer/3.0.1/model-viewer.min.js",n=r,"function"!=typeof(i=function(){customElements&&customElements.get("model-viewer")}||function(){return!1})?(console.error("[ckComp.js][script()] Parâmetro isLoaded deve ser undefined ou uma função"),Promise.reject(n.ERR_ASSERT)):function(){return new Promise(function(o,e){var a;i()?o(n.OK_CACHED):((a=document.createElement("script")).type="module",a.src=t,document.body.appendChild(a),o(n.OK))})}),"swiper.js":o("angular/comp/swiper/swiper-bundle.min.js",function(){return window.Swiper}),"swiper.css":o("angular/comp/swiper/swiper-bundle.min.css",function(){return!0})};return{load:function(o){o=e[o];return o?o():Promise.reject(r.ERR_COMP_NOT_FOUND)},status:r}}]),angular.module("Proj").directive("ckComentario",function(){return{restrict:"EA",scope:{produtoid:"=",perguntaid:"=",observer:"=?",tipoprodutoid:"=?"},controller:"ComentarioCtrl",templateUrl:"angular/app/shared/ckComentario/partials/comentarios.tpl.html"}}).directive("ckOferta",function(){return{restrict:"EA",scope:{produtoid:"=",perguntaid:"=",produto:"=",skipload:"@",onclose:"&"},controller:"ComentarioCtrl",templateUrl:"angular/app/shared/ckComentario/partials/oferta.tpl.html"}}).controller("ComentarioCtrl",["$scope","$rootScope","$routeParams","$mdDialog","ComentarioService","AuthFactory","CkMasksService",function(n,t,o,r,i,c,e){function s(o){switch(o.tipo){case"oferta":n.enviarProposta(o.valor);break;case"responder":n.minhaPergunta&&t.irPara("comentario/"+n.minhaPergunta.id)}}n.meuIdUsuario=c.get().id,n.showBotaoCarregarMais=!1,n.closeCardOferta=!0,n.isComentarioUnico=!1,n.idUltimoComentario=null,n.jaTemOferta=!1,n.taxa=null,n.precoAnuncio=(n.produto||{}).precof||0,n.idproduto=n.produtoid||0,n.observer=n.observer||{notify:()=>{},sub:()=>{}},n.oferta={valor:""},n.carregarComentarios=function(o,e,a){if(n.carregandocomentarios=!0,n.islogado=c.isLoggedIn(),null==a?(n.page=0,n.amount=5,n.idproduto=o):n.isComentarioUnico=!0,!n.islogado)return n.carregandocomentarios=!1,n.observer.notify({tipo:"podePerguntar",valor:!0}),n.observer.notify({tipo:"comentariosCarregados",valor:!0}),n.observer.notify({tipo:"meuProduto",valor:!1}),!1;n.observer.sub(s),i.obterComentariosProduto(o,n.page,n.amount,a).then(function(o){n.perguntas=o.perguntas,n.podePerguntar=o.podePerguntar,n.precoAnuncio=o.precoAnuncio,n.minhaPergunta=o.minhaPergunta,n.taxa=o.taxa,n.taxaStr=o.taxaStr,n.observer.notify({tipo:"podePerguntar",valor:n.podePerguntar}),n.observer.notify({tipo:"comentariosCarregados",valor:!0}),n.observer.notify({tipo:"meuProduto",valor:o.meuProduto}),n.sugestoes=function(o,e){e&&(o=o.filter(o=>!o.tiposProduto||o.tiposProduto.split(";").some(o=>o===String(e))));return o}(o.sugestoes,e),null!=o.minhaPergunta&&n.perguntas.unshift(o.minhaPergunta),n.showBotaoCarregarMais=o.perguntas.length>=n.amount,n.isComentarioUnico&&1==o.perguntas.length&&n.syncRespostas(o.perguntas[0]),10<o.perguntas.length&&t.roloutToEnd()}).catch(function(o){n.isComentarioUnico&&n.mostrarErro(o)}).finally(function(){n.carregandocomentarios=!1})},n.carregarMaisComentarios=function(){n.carregandoMaisComentarios=!0,n.page=n.page+1,i.obterComentariosProduto(n.idproduto,n.page,n.amount).then(function(o){n.perguntas=n.perguntas.concat(o.perguntas),n.showBotaoCarregarMais=o.perguntas.length>=n.amount}).catch(function(o){t.showToast("Algo de errado aconteceu!")}).finally(function(){n.carregandoMaisComentarios=!1})},n.enviarComentario=function(o,e,a,r){return n.isComentarioUnico?n.enviarResposta(n.perguntas[0],o,e,a,r):n.isComentarioUnico?(t.ckComentarioAction=0,!1):n.enviarPergunta(n.idproduto,o,e,a,r)},n.enviarPergunta=function(o,e,a,r,t){return n.enviando=!0,i.enviarPergunta(o,c.get().idCliente,e,!0,a).then(function(o){n.podePerguntar=!1,null!=n.perguntas&&0!=n.perguntas.length||(n.perguntas=[]),n.perguntas.push(o);try{r&&r()}catch(o){}}).catch(function(o){n.mostrarErro(o);try{t&&t()}catch(o){}}).finally(function(){n.enviando=!1})},n.enviarResposta=function(o,e,a,r,t){return n.enviando=!0,i.responderPergunta(o.id,e,a).then(function(e){null==o.Respostas&&(o.Respostas=[]),void 0===o.Respostas.filter(function(o){return e.id===o.id})[0]&&o.Respostas.push(e),o.showResponder=!1,o.textoResposta="",n.isComentarioUnico;try{r&&r()}catch(o){}}).catch(function(o){n.mostrarErro(o);try{t&&t()}catch(o){}}).finally(function(){n.enviando=!1})},n.enviarProposta=function(o){if(!o)return n.mostrarErro("Informe um valor válido"),null;o=o.replaceAll(".","");n.observer.notify({tipo:"fazendoOferta",valor:!0});try{var e=o.replace(",","."),a=parseFloat(e);if(a<15)return n.mostrarErro("A oferta não pode ser menor do que R$ 15,00"),null;var r=.3*n.precoAnuncio;if(a>n.precoAnuncio+r||a<n.precoAnuncio-r)return n.mostrarErro("A oferta deve ser de no mínimo 70% do valor do anúncio"),n.observer.notify({tipo:"fazendoOferta",valor:!1}),null}catch(o){return n.mostrarErro("Informe um valor válido"),null}n.enviarComentario("Faz por R$ "+o+"?",2,function(){n.observer.notify({tipo:"ofertaRealizada",valor:!0}),n.observer.notify({tipo:"fazendoOferta",valor:!1})},function(){n.observer.notify({tipo:"fazendoOferta",valor:!1})}).finally(function(){n.observer.notify({tipo:"fazendoOferta",valor:!1})}),n.oferta.valor=""},n.maskPreco=function(){var o=e.monetario(n.oferta.valor);n.oferta.valor!==o&&(n.oferta.valor=o)},n.mostrarErro=function(o){angular.element(document.body).hasClass("md-dialog-is-showing")?alert(o||"Ops, algo de errado aconteceu"):t.showToast(o||"Ops, algo de errado aconteceu")},n.showMostrarApagarRespota=function(o){o.Perfil.id==c.get().id&&(o.showDelete=!0)},n.showMostrarApagarPergunta=function(o){o.idUsuarioVendedor!=c.get().id&&o.idUsuarioCliente!=c.get().id||(o.showDelete=!0)},n.apagarResposta=function(a,r){r.apagando=!0,i.apagarResposta(r.id).then(function(o){t.showToast("Comentário deletado");var e=a.Respostas.indexOf(r);a.Respostas.splice(e,1)}).catch(function(o){t.showToast(o||"Ops, algo de errado aconteceu ao apagar o comentário")}).finally(function(){r.apagando=!1})},n.apagarPergunta=function(a){var o;function e(){i.apagarPergunta(a.id).then(function(o){var e;t.showToast("Pergunta apagada"),n.isComentarioUnico?t.voltarPagina():(e=n.perguntas.indexOf(a),n.perguntas.splice(e,1))}).catch(function(o){t.showToast(o||"Ops, algo de errado aconteceu ao apagar o comentário")}).finally(function(){a.showDelete=!0})}a.showDelete=!1,n.isComentarioUnico?(o=r.confirm().title("Você quer mesmo apagar essa pergunta?").textContent("Essa ação não poderá mais ser desfeita").ariaLabel("Apagar pergunta").ok("sim").cancel("não"),r.show(o).then(function(){e()},function(){})):e()},n.syncRespostas=function(a){var o=setInterval(function(){null!=a.Respostas&&0<a.Respostas.length&&(n.idUltimoComentario=a.Respostas[a.Respostas.length-1].id,i.obterNovasRespostas(a.id,n.idUltimoComentario).then(function(o){0<o.novasrespostas.length&&(angular.forEach(o.novasrespostas,function(e,o){void 0===a.Respostas.filter(function(o){return o.id===e.id})[0]&&a.Respostas.push(e)}),n.idUltimoComentario=a.Respostas[a.Respostas.length-1].id,10<a.Respostas.length&&t.roloutToEnd(),t.soundAlert())}).catch(function(o){})),n.$$destroyed&&clearInterval(o)},9e3);n.$$destroyed&&clearInterval(o)},n.calcularTaxa=function(o){return t.calcularTaxa(o,n.taxa)},n.init=void(n.skipload||n.carregarComentarios(n.produtoid,n.tipoprodutoid,n.perguntaid)),n.teste=!1}]),angular.module("Proj").service("CkCreditCardService",[function(){function i(o,e,a){var r={};return r.id=o,r.name=e,r.iins=a,r}function o(o,e){var a="number"==typeof o;return a&&"number"==typeof e?[o,e]:a?[o,o]:[-1,-1]}var c=[i("visa","Visa",[o(4)]),i("mastercard","MasterCard",[o(51,55),o(2221,2720)]),i("dinersclub","Diners Club International",[o(36)]),i("americanexpress","American Express",[o(34),o(37)]),i("jcb","JCB",[o(3528,3589)])];return{match:function(o){for(var e=0,a=o?o.length:0,r=0;r<a;r++){var t=parseInt(o[r]);if(!t)break;var t=10*e+t,n=function(o){if(o&&"number"==typeof o){for(var e=0;e<c.length;e++)for(var a=c[e],r=a.iins,t=0;t<r.length;t++){var n=r[t],i=n[0]||-1,n=n[1]||-1;if(i<=o&&o<=n)return a}return null}}(t);if(n)return n;e=t}return i("unknown","Desconhecido")}}}]),angular.module("Proj").service("CkCrypto",["ApiCK","$request",function(o,a){var r=o+"crypto/handshake";function t(o){o=function(o){for(var e=window.atob(o),o=new ArrayBuffer(e.length),a=new Uint8Array(o),r=0;r<e.length;r++)a[r]=e.charCodeAt(r);return o}(o.PublicKey.Data);window.crypto.subtle.importKey("spki",o,{name:"RSA-OAEP",hash:"SHA-256"},!1,["encrypt"]).then(function(o){}).catch(function(o){console.error(o)})}return{init:function(){return new Promise(function(o,e){$.getScript("angular/comp/forge/forge.min.js",o)})},encrypt:function(o){return new Promise(function(o,e){a.get(r).then(function(o){t(o)}).then(function(o){new Promise(function(o,e){})}).catch(function(o){e("houve um erro ao estabelecer comunicação segura")})})}}}]),angular.module("Proj").run(["$rootScope","AuthFactory",function(e,a){function o(){return $("LINK[href*='dark.css']")}e.initDarkMode=function(){var o=e.isLoadedOnHTML();a.darkModeIsOn()?o||e.enableDarkMode():o&&e.disableDarkMode()},e.darkModeStatus=function(){return a.darkModeIsOn()},e.toogleDarkMode=function(){e.isLoadedOnHTML()?e.disableDarkMode():e.enableDarkMode()},e.isLoadedOnHTML=function(){return 0<o().length},e.enableDarkMode=function(){$('<link rel="stylesheet" href="angular/css/dark.css" type="text/css" />').appendTo("body"),a.enableDarkMode()},e.disableDarkMode=function(){o().remove(),a.disableDarkMode()},e.initDarkMode()}]),angular.module("Proj").service("DataValidationService",["ApiCK","$request",function(ApiCK,$request){return{validarDataNascimento:function(o,e,a){var r,o=parseInt(o),e=parseInt(e),a=parseInt(a);return!(o<1||31<o||e<1||12<e||a<1920||(r=new Date(a,e-1,o),a=Date.parse(r),0!=isNaN(a)))?r:null},validarData:function(o,e,a){var o=parseInt(o),e=parseInt(e),a=parseInt(a);return!(o<1||31<o||e<1||12<e||(a=new Date(a,e-1,o),e=Date.parse(a),0!=isNaN(e)))?a:null},validarCpf:function(o){if(11!=o.length||"00000000000"==o||"11111111111"==o||"22222222222"==o||"33333333333"==o||"44444444444"==o||"55555555555"==o||"66666666666"==o||"77777777777"==o||"88888888888"==o||"99999999999"==o)return!1;for(var e=0,a=0;a<9;a++)e+=parseInt(o.charAt(a))*(10-a);var r=11-e%11;if((r=10!=r&&11!=r?r:0)!=parseInt(o.charAt(9)))return!1;for(a=e=0;a<10;a++)e+=parseInt(o.charAt(a))*(11-a);return(r=10!=(r=11-e%11)&&11!=r?r:0)==parseInt(o.charAt(10))},validarCNPJ:function(cnpj){var valida=new Array(6,5,4,3,2,9,8,7,6,5,4,3,2),dig1=new Number,dig2=new Number,exp="/.|-|//g",digito=(cnpj=cnpj.toString().replace(exp,""),new Number(eval(cnpj.charAt(12)+cnpj.charAt(13))));for(i=0;i<valida.length;i++)dig1+=0<i?cnpj.charAt(i-1)*valida[i]:0,dig2+=cnpj.charAt(i)*valida[i];return dig1=dig1%11<2?0:11-dig1%11,dig2=dig2%11<2?0:11-dig2%11,10*dig1+dig2!=digito?!1:!0}}}]),angular.module("Proj").service("DeviceService",["$http","$q","ApiCK","$request","$interval","$routeParams",function(o,r,e,a,t,n){var i={options:[],header:[navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor,window.opera],dataos:[{name:"Windows Phone",value:"Windows Phone",version:"OS"},{name:"Windows",value:"Win",version:"NT"},{name:"iPhone",value:"iPhone",version:"OS"},{name:"iPad",value:"iPad",version:"OS"},{name:"Kindle",value:"Silk",version:"Silk"},{name:"Android",value:"Android",version:"Android"},{name:"PlayBook",value:"PlayBook",version:"OS"},{name:"BlackBerry",value:"BlackBerry",version:"/"},{name:"Macintosh",value:"Mac",version:"OS X"},{name:"Linux",value:"Linux",version:"rv"},{name:"Palm",value:"Palm",version:"PalmOS"}],databrowser:[{name:"Chrome",value:"Chrome",version:"Chrome"},{name:"Firefox",value:"Firefox",version:"Firefox"},{name:"Safari",value:"Safari",version:"Version"},{name:"Internet Explorer",value:"MSIE",version:"MSIE"},{name:"Opera",value:"Opera",version:"Opera"},{name:"BlackBerry",value:"CLDC",version:"CLDC"},{name:"Mozilla",value:"Mozilla",version:"Mozilla"}],init:function(){var o=this.header.join(" ");return{os:this.matchItem(o,this.dataos),browser:this.matchItem(o,this.databrowser)}},matchItem:function(o,e){for(var a,r,t,n=0,i=0,n=0;n<e.length;n+=1)if(new RegExp(e[n].value,"i").test(o)){if(a=new RegExp(e[n].version+"[- /:;]([\\d._]+)","i"),t="",r=(r=o.match(a))&&r[1]?r[1]:r)for(r=r.split(/[._]+/),i=0;i<r.length;i+=1)t+=0===i?r[i]+".":r[i];else t="0";return{name:e[n].name,version:parseFloat(t)}}return{name:"unknown",version:0}}};function c(o){var e,a,r,t={};return t.identificador=(r=window.navigator,e=window.screen,a=r.mimeTypes.length,(a+=r.userAgent.replace(/\D+/g,""))+r.plugins.length+(e.height||"")+(e.width||"")+(e.pixelDepth||"")),t.title=(a=i.init(),r="",(r+=a.os.name+" ")+a.os.version+" "+a.browser.name+" "),t.ip=o.ip,t.cidade=o.city,t.estado=o.region,t.pais=o.country_code||"X",t}function s(){var e=r.defer();return o.get("https://ipapi.co/json/").success(function(o){o=c(o);e.resolve(o)}).error(function(o){console.error("result",o),e.reject(o)}),e.promise}function l(){var e=r.defer(),o=window.cordova,a=window.plugins&&window.plugins.OneSignal&&window.plugins.OneSignal.getDeviceState;if(o&&a)try{window.plugins.OneSignal.getDeviceState(function(o){e.resolve(o.userId)})}catch(o){e.resolve(null)}else e.resolve(null);return e.promise}return{getDeviceInfo:s,getOneSignal:l,isIG:function(){return"IGShopping"===n.utm_source},getDevice:function(){var e=r.defer(),a={};return s().then(function(o){a=o,l().then(function(o){a.idOneSignal=o,e.resolve(a)})}).catch(function(){e.resolve(a)}),e.promise}}}]),angular.module("Proj").directive("ckEmptyAlert",function(){return{restrict:"EA",scope:{msg:"@",icon:"@",iconsize:"@",margintop:"@"},templateUrl:"angular/app/shared/ckEmptyAlert/partials/alert.tpl.html"}}),angular.module("Proj").service("ckFacebookPixelService",function(){return{customEvent:function(o,e){fbq&&fbq("trackCustom",o,e)},pageView:function(){fbq&&fbq("track","PageView")},addToCart:function(o){fbq&&fbq("track","AddToCart",o)},completeRegistration:function(o){fbq&&fbq("track","CompleteRegistration",o)},contact:function(){fbq&&fbq("track","Contact")},initiateCheckout:function(o){fbq&&fbq("track","InitiateCheckout",o)},purchase:function(o){fbq&&fbq("track","Purchase",o)},search:function(o){fbq&&fbq("track","Search",{search_string:o})},lead:function(o){fbq&&fbq("track","lead",o)},viewContent:function(o,e){fbq&&fbq("track","ViewContent",{content_category:o,content_name:e})},addPaymentInfo:function(o){fbq&&fbq("track","AddPaymentInfo",o)},customizeProduct:function(){fbq&&fbq("track","CustomizeProduct")}}}),angular.module("Proj").factory("ckGliderHelper",["$rootScope",function(o){return{setAutoSlide:function(o,e,a){var r=a,t=-1,n=!1;function i(){clearTimeout(t),t=setTimeout(function(){n||o.scrollItem((o.slide+1)%o.slides.length)},r)}e.addEventListener("glider-animated",function(){o.animate_id,n||i()}),e.addEventListener("mouseover",function(){n=!0,clearTimeout(t)}),e.addEventListener("mouseout",function(){n=!1,o.animate_id,i()}),i()}}}]),angular.module("Proj").service("CkGlobalEvents",[function(){var t={};function n(o){return{title:o,subs:[]}}function i(o,e){return{id:e||function(){for(var o="a".charCodeAt(0),e="z".charCodeAt(0),a="A".charCodeAt(0),r="Z".charCodeAt(0),t="0".charCodeAt(0),n="9".charCodeAt(0),i=[],c="",s=o;s<=e;s+=1)i.push(s);for(s=a;s<=r;s+=1)i.push(s);for(s=t;s<=n;s+=1)i.push(s);for(s=0;s<16;s+=1)c+=i[Math.round(16*Math.random()-1)];return c}(),onmsg:o}}return{pub:(o,e)=>{return a=e,(o=t[e=o]||n(e)).subs.forEach(function(o){(o.onmsg||function(){})({id:o.id,msg:a})}),void(t[e]=o);var a},sub:(o,e,a)=>{return e=e,r=t[o=o]||n(o),e=i(e,a),r.subs.push(e),t[o]=r,e.id;var r},unsub:(o,e)=>{return a=e,(o=t[e=o]||n(e)).subs=o.subs.filter(o=>o.id!==a),void(t[e]=o);var a}}}]),angular.module("Proj").service("CkGlobalState",["ColecionavelService","SparksService",function(o,t){function e(){return{data:null,expiracao:null,error:null}}var n=e(),i=e();function a(o){return Date.now()+60*o*1e3}function c(o){return Date.now()>o}return{segmentos:{load:function(){var r=a(30);return new Promise(function(e,a){!n.data||c(n.expiracao)?o.obterMarcasPorSegmento().then(function(o){n.data=o,n.expiracao=r,e(n.data)}).catch(function(o){n.error=o,a(o)}):e(n.data)})},data:()=>n.data,expirou:()=>c(n.expiracao)},precacheSparks:{load:function(){var r=a(60);return new Promise(function(e,a){!i.data||c(i.expiracao)?t.precache(!1).then(function(o){i.data=o,i.expiracao=r,e(i.data)}).catch(function(o){i.error=o,a(o)}):e(i.data)})},data:()=>i.data,expirou:()=>c(i.expiracao)}}}]),angular.module("Proj").service("CkHLS",["CkHttpCache",function(c){function a(o,e){var o=o.map(function(o){return JSON.parse(o)}).filter(function(o){return o&&o.length}).map(function(o){return o[0]}),r=["#EXTM3U","#EXT-X-VERSION:3"],o=o.map(function(o){return s(o,e)});t={},n={},o.forEach(function(o){o.streams.forEach(function(o){var e=t[o.rendition],a=n[o.rendition];t[o.rendition]=e||[],t[o.rendition].push(o.frags),n[o.rendition]=a||0,n[o.rendition]=a>o.targetDuration?a:o.targetDuration})});({streams:Object.keys(t).map(function(o){return{rendition:o,targetDuration:n[o],frags:t[o]}})}).streams.forEach(function(o){var e=o.rendition;a=["#EXTM3U","#EXT-X-VERSION:3","#EXT-X-TARGETDURATION:"+(o=o).targetDuration,"#EXT-X-PLAYLIST-TYPE:VOD"].join("\n"),o=o.frags.map(function(o){return o.map(function(o){return"#EXTINF:"+o.duration.toFixed(6)+","+o.title+"\n"+o.url}).join("\n")}).join("\n#EXT-X-DISCONTINUITY\n");var a=i(a+"\n"+o+"\n#EXT-X-ENDLIST");r.push("#EXT-X-STREAM-INF:"+e),r.push(a)});var t,n,o=r.join("\n");return{url:i(o),content:o}}function o(i,c){return new Promise(function(o,e){var a,r=c||1,t="string"==typeof i,n=i&&i.map;t||n?(n=(t?[i]:i).map(function(o){return JSON.parse(o)}).filter(function(o){return o&&o.length}).map(function(o){return o[0]}).map(function(o){return s(o,!1)}),a={},n.forEach(function(o){o.streams.forEach(function(o){a[o.rendition]=a[o.rendition]||[],a[o.rendition].push(o)})}),function o(e,a,r,t,n){var i=n||0;if(i>=e.length)return void r();n=e[i];n=n.map(function(o){return l(o,a)});Promise.all(n).then(function(){o(e,a,r,t,i+1)}).catch(function(o){console.error(o)})}(Object.keys(a).map(function(o){return a[o]}).slice(0,4),r,o,e)):e("não é possível realizar o precache do dado informado")})}function s(o,n){var a=o.streams||{};return{streams:Object.keys(a).map(function(o){var e=a[o];return{rendition:o,targetDuration:e.targetDuration,frags:e.fragments.map(function(o){return e=n,a=(o=o).duration||0,r=o.title||"",o=o.url||"",t=c.get(o),{duration:a,title:r,url:(e?t.localurl:o)||o};var e,a,r,t})}})}}function l(n,i){return new Promise(function(a,e){for(var r={rendition:n.rendition,frags:n.frags.map(function(o){return{duration:o.duration,title:o.tjtle,url:o.url}})},o=[],t=0;t<i&&t<n.frags.length;t++)o.push(c.fetch(n.frags[t].url));Promise.all(o).then(function(o){for(var e=0;e<o.length;e++)r.frags[e].url=o[e].localurl;a(r)}).catch(function(o){e(o)})})}function i(o){return"data:application/x-mpegURL;base64,"+window.btoa(o)}return{merge:a,precache:o,test:function(e){return o(e).then(function(){var o=a(e,!0);console.log(o)}).catch(function(o){console.log(o)})}}}]),angular.module("Proj").directive("ckHoldButton",["$parse","$rootScope","$q","$interval",function(s,o,l,d){var u,p;return o.holdButtonAction=function(o,e,a,r){o.then(function(o){r&&e(a)},function(o){},function(o){})},{restrict:"A",priority:10,link:function(i,e,c){e.on("mousedown",function(o){var e,a,r,t,n;e=i,o=o,r=s((a=c).ckHoldButton),a=a.ckHoldButtonDelay&&s(a.ckHoldButtonDelay)(e)||600,t=0,n=a/10,u=l.defer(),p=d(function(){t++,u.notify((t+1)/n),t===n&&u.resolve()},10,n),"function"==typeof r&&r(e,{$promise:u.promise,$event:o})}),e.on("mouseup",function(o){(o=o).preventDefault(),d.cancel(p),u&&(u.reject(o),"touchend"==o.type)&&1==u.promise.$$state.status&&o.stopPropagation()}),e.on("touchstart",function(o){e.mousedown()}),e.on("touchend",function(o){e.mouseup()})}}}]),angular.module("Proj").directive("ckHomeCard",function(){return{restrict:"EA",scope:{card:"="},controller:["$scope","$rootScope","$mdMedia",function(o,e,a){o.$mdMedia=a,null!=o.card&&3==o.card.mode&&(o.line1=o.card.drops.slice(0,5),o.line2=o.card.drops.slice(5,10),o.line3=o.card.drops.slice(10,15)),o.scrollLeftExhibition=function(e,a){setTimeout(function(){var o=$(document.getElementById("ck-card-exhibition-line"+e+"-"+a));o&&(o[0].scrollLeft=100)},100)}}],templateUrl:"angular/app/shared/ckHomeCard/partials/card.tpl.html"}}),angular.module("Proj").directive("ckHomeCollection",["$http","$q",function(o,e){return{restrict:"EA",scope:{collection:"=",title:"@",mt:"@",mb:"@",showdates:"="},controller:["$scope","$rootScope","$mdMedia",function(o,e,a){o.$mdMedia=a,o.collection1=[],o.collection2=[],o.collection3=[],null!=o.collection&&0<o.collection.length&&(a=o.collection.length,o.collection1=o.collection.slice(0,5),5<a&&(o.collection2=o.collection.slice(5,10)),10<a)&&(o.collection3=o.collection.slice(10,15))}],templateUrl:"angular/app/shared/ckHomeCollection/partials/collection.tpl.html"}}]),angular.module("Proj").service("CkHttpCache",[function(){var d={},u={mimetype:null,ignoreCache:!1,onprogress:(o,e)=>{}};return{fetch:function(s,l){return new Promise(function(a,e){var r,t,o,n,i,c;d[s]?a(d[s]):(r=new XMLHttpRequest,t=l||{},n=(o=o=>t[o]||u[o])("mimetype"),i=o("ignoreCache"),c=o("onprogress")||(()=>{}),r.onload=function(){var o=r.getResponseHeader("Content-Type")||n||"",e=r.response,e=new Blob([e],{type:o}),o=window.URL.createObjectURL(e),e={arraybuffer:r.response,localurl:o};i||(d[s]=e),a(e)},r.onprogress=function(o){c(o.loaded,o.total)},r.onerror=function(o){e(o)},r.responseType="arraybuffer",r.open("GET",s,!0),r.send())})},get:function(o){return d[o]||{arraybuffer:null,localurl:null}},rm:function(o){d[o]=null},cleanAll:function(){d={}}}}]),angular.module("Proj").factory("CkImgToColorFactory",["$http","$q",function(o,e){return{getPrimaryColor:function(o){var i,c=e.defer();return o?((i=document.createElement("img")).crossOrigin="Anonymous",i.setAttribute("src",o),i.addEventListener("load",function(){var o,e,a=new Vibrant(i).swatches(),r="#000",t=0;for(e in a)a.hasOwnProperty(e)&&a[e]&&t<(o=a[e].getPopulation())&&(r=a[e].getHex(),t=o);var n=r;c.resolve(n)})):c.reject("Imagem não corresponde"),c.promise}}}]),angular.module("Proj").service("ckDivBackgroundImgLazyLoad",["$timeout",function(o){function a(e,a){o(500).then(function(){var o;e&&a?(o=a.ckLazyLoad,e.src=o):e&&(o=(o=e.attributes["ck-lazy-load"])?o.value:"",e.style.backgroundImage="url("+o+")")})}var r={id:"intersection",observer:new IntersectionObserver(function(o,e){o.forEach(function(o){o.isIntersecting&&(a(o=o.target),e.unobserve(o))})}),observe:function(o,e){o&&this.observer.observe(o)},unobserve:function(o){this.observer.unobserve(o)}},t={id:"eager",observe:function(o,e){o&&a(o,e)}};return{observe:function(o,e){var a;o&&(a="IntersectionObserver"in window,null!=window.cordova&&window.cordova,(a?r:t).observe(o,e))}}}]).directive("ckLazyLoad",["ckImgLazyLoad","ckDivBackgroundImgLazyLoad",function(t,n){return{restrict:"A",compile:function(){return{post:function(o,e,a){var r=e[0];if(r)switch(r.tagName){case"IMG":t.observe(r,a);break;case"DIV":n.observe(r,a)}}}}}}]),angular.module("Proj").service("ckImgLazyLoad",["$timeout",function(o){function a(e,a){o(500).then(function(){var o;e&&a?(o=a.ckLazyLoad,e.src=o):e&&(o=(o=e.attributes["ck-lazy-load"])?o.value:"",e.src=o)})}var t={id:"intersection",observer:new IntersectionObserver(function(o,e){o.forEach(function(o){o.isIntersecting&&(a(o=o.target),e.unobserve(o))})}),observe:function(o,e){o&&this.observer.observe(o)},unobserve:function(o){this.observer.unobserve(o)}},n={id:"eager",observe:function(o,e){o&&a(o,e)}};return{observe:function(o,e){var a,r;o&&(a="IntersectionObserver"in window,r=null!=window.cordova&&"undenfined"!=window.cordova,(a&&!r?t:n).observe(o,e))}}}]),angular.module("Proj").factory("CkImgToColorFactory",["$http","$q",function(o,e){return{getPrimaryColor:function(o){var i,c=e.defer();return o?((i=document.createElement("img")).crossOrigin="Anonymous",i.setAttribute("src",o),i.addEventListener("load",function(){var o,e,a=new Vibrant(i).swatches(),r="#000",t=0;for(e in a)a.hasOwnProperty(e)&&a[e]&&t<(o=a[e].getPopulation())&&(r=a[e].getHex(),t=o);var n=r;c.resolve(n)})):c.reject("Imagem não corresponde"),c.promise}}}]),angular.module("Proj").service("CkImgUtils",[function(){function m(o,e){return{msg:o,err:e}}function g(o){var e=o&&o.canvas&&o.ctx,a=e&&o.canvas instanceof HTMLCanvasElement,e=e&&o.ctx instanceof CanvasRenderingContext2D;return a&&e}return{createRenderer:function(r){return new Promise(function(o,e){try{var a;r&&r.getContext?((a=r.getContext("2d"))&&a.drawImage||e(m("não foi possível construir corretamente contexto para o canvas")),o({renderer:{canvas:r,ctx:a}})):e(m("canvasElem não é um objeto canvas válido"))}catch(o){e(m("erro crítico",o))}})},loadFromURL:function(r,t){return new Promise(function(o,e){if(g(r))try{var a=new Image;a.onload=function(){r.canvas.width=a.width,r.canvas.height=a.height,r.ctx.drawImage(a,0,0),o({renderer:r,img:a})},a.onerror=function(o){e(m("erro ao carregar imagem",o))},a.crossOrigin="",a.src=t}catch(o){e(m("erro crítico",o))}else e("o renderer está inconsistente")})},lumaAVG:function(u,p,f){return new Promise(function(o,e){if(g(u))if(d=(a=p).x||0===a.x,r=a.y||0===a.y,t=a.w||0===a.w,a=a.h||0===a.h,d&&r&&t&&a){for(var a,r,t,n=f||this.LumaF.W3C_relativeLuminance,i=u.ctx.getImageData(p.x,p.y,p.w,p.h),c=0,s=0;s<i.data.length;s+=4){var l=n(i.data[s],i.data[s+1],i.data[s+2],i.data[s+3]);if("number"!=typeof l)return void e(m("não foi possível interpretar o resultado da função luma"));c+=l}var d=i.data.length/4;o({renderer:u,avg:c/d})}else e("o objeto Rectangle passado não está no formato correto");else e("o renderer está inconsistente")})},rect:function(o,e,a,r){return{x:o,y:e,w:a,h:r}},LumaF:{W3C_relativeLuminance:function(o,e,a){function r(o){return o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4)}return.2126*r(o/255)+.7152*r(e/255)+.0722*r(a/255)},rec709:function(o,e,a){return.2126*o+.7152*e+.0722*a}},ColorF:{thresholdBoWContrast:function(o,e){return(e||186)<o?0:1},W3C_BoWContrast:function(o){return 1.05/(o+.05)<(o+.05)/.05?0:1}}}}]),angular.module("Proj").service("AppleMapKit",["$q","$request","GeoApiUrl","$rootScope",function(r,t,n,o){var o=o.isCordova()?"local":"site",e="https://cdn.apple-mapkit.com/mk/5.x.x/mapkit.js",a=n+"/mapkit/token?agent="+o;return{MAPKIT_CDN:e,init:function(){return(o=r.defer()).resolve(),o.promise;var o},geocode:function(o){var e=r.defer(),a=n+"/mapkit/geocode",o={logradouro:o.logradouro,numero:o.numero,cep:o.cep,cidade:o.cidade,estado:o.estado,pais:o.pais};try{t.post(a,o).then(function(o){o.resultados&&o.resultados.length?(o={nome:(o=o.resultados[0]).nome,descricao:"geo.cataloko.com/api/v1/mapkit",lat:o.centro.lat,lng:o.centro.lng},e.resolve(o)):e.reject("nenhum resultado encontrado")}).catch(e.reject)}catch(o){e.reject(o)}return e.promise},fetchJWT:function(){return t.get(a)}}}]),angular.module("Proj").factory("AppleMapKitMapProvider",["$q","$request",function(i,r){var t="http://localhost:5000/api/v1/mapkit/token?agent=local";function a(){var o=i.defer();return window.mapkit?o.resolve():$.getScript("https://cdn.apple-mapkit.com/mk/5.x.x/mapkit.js",function(){!function(){var a=i.defer();if(mapkit)return mapkit.init({authorizationCallback:function(e){r.get(t).then(function(o){e(o.token),a.resolve()}).catch(a.reject)},language:"pt"}),a.promise;a.reject()}().then(o.resolve).catch(o.reject)}),o.promise}return{init:a,geocode:function(o){var e=i.defer();return a().then(function(){!function(o){var e,a,r,t=i.defer(),n=(n=o.logradouro,e=o.numero,a=o.bairro,r=o.cep,n+", "+e+". "+a+", "+o.cidade+" - "+o.estado+", "+r+", "+o.pais);if(mapkit&&mapkit.Geocoder)return(new mapkit.Geocoder).lookup(n,function(o,e){o||!e.results.length?t.reject(o||"Não veio nenhum resultado"):t.resolve((o=e.results[0],e={nome:o.name,descricao:"",lat:-1,lng:-1},o.coordinate&&(e.lat=o.coordinate.latitude,e.lng=o.coordinate.longitude),e))}),t.promise;t.reject("MapKit não foi carregado corretamente")}(o).then(e.resolve).catch(e.reject)}).catch(e.reject),e.promise}}}]).service("MapsService",["AppleMapKitMapProvider",function(o){var e=o;return{init:function(){return e.init()},geocode:function(o){return e.geocode(o)}}}]),angular.module("Proj").factory("OSM",["$q","$request",function(a,o){return{init:function(){var o=a.defer();return o.resolve(),o.promise},geocode:function(o){var e=a.defer();return e.reject("GeoServices.OSM ainda não implementado"),e.promise}}}]),angular.module("Proj").service("CkMasksService",["$rootScope","AuthFactory",function(o,e){return{monetario:function(o){try{var e=function(o){if(!o)return"";for(var e="",a="0".charCodeAt(0),r="9".charCodeAt(0),t=0;t<o.length;t+=1){var n=o.charCodeAt(t),i=o.charAt(t);a<=n&&n<=r&&(e+=i)}return e}((o||"").toString()).replaceAll(".","").replaceAll(",",""),a=parseInt(e||"0000"),r=Math.floor(a/100),t=Math.floor(a%100),n="",i=0;for(0===(c=r)&&(n="0");0<c;){var n=c%10+(n=0<i&&i%3==0?"."+n:n),c=Math.floor(c/10);i+=1}return n+=",",t<10&&(n+="0"),n+=t}catch(o){return console.error("CkMasksService.monetario",o),"0,00"}},intToRGB:function(o){}}}]),angular.module("Proj").service("CkObserver",[function(){return{new:function(o){function e(e){a=a.filter(o=>o!==e)}var a=[],r=()=>{};return{broadcast:function(e){a.forEach(o=>o(e))},onnotify:function(o){r=o},subscriber:{sub:function(o){e(o),a.push(o)},unsub:e,notify:function(o){r(o)}}}}}}]),angular.module("Proj").directive("ckPageTopNavigation",function(){return{restrict:"EA",scope:{title:"@",showBack:"=",showLoading:"@",statusLoading:"=",hideBar:"@",onBack:"&?"},templateUrl:"angular/app/shared/ckPageTopNavigation/partials/topnavigation.tpl.html",controller:["$scope","$rootScope",function(o,e){o.voltar=function(){o.onBack?o.onBack():e.voltarPagina()}}]}}),angular.module("Proj").service("ckPreloadModel",[function(){function e(){return"CkPreloadModel"in window?window.CkPreloadModel||{data:null}:{}}return{hasPreloaded:function(o){return e().type===o},get:function(){return e().model||{}},clear:function(){window.CkPreloadModel={data:null}}}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/qrreader",{controller:"QrCodeReaderCtrl",templateUrl:"angular/app/shared/ckQrCodeReader/partials/qrreader.tpl.html"})}]).controller("QrCodeReaderCtrl",["$scope","$q","$routeParams","$rootScope",function(r,t,o,n){r.inicializando=!1,r.erro=!1;var i;r.init=function(){r.inicializando=!0,i=o.r||o.redirect,function(){var o=t.defer();if(!window.Instascan)try{$.getScript("angular/comp/wrtcAdapter/adapter.min.js",function(){$.getScript("angular/comp/instascan/instascan.min.js",function(){o.resolve()})})}catch(o){console.error("EXTLIB",o),r.erro=!0}return o.promise}().then(function(){var e,o,a;e=t.defer(),o=document.querySelector("#qrreader-preview"),(a=new Instascan.Scanner(o)).addListener("scan",function(o){i&&n.irPara(i)}),Instascan.Camera.getCameras().then(function(o){o&&o.length?(a.start(o[0]),a.scan(),r.$on("destroy",function(){a.stop()}),e.resolve()):(r.erro=!0,console.error("nenhuma câmera encontrada"))}).catch(function(o){console.error(o),r.erro=!0}),e.promise.then(function(){r.inicializando=!1})})},r.init()}]),angular.module("Proj").directive("ckShareContent",[function(){return{restrict:"AE",scope:{content:"<content",type:"<type"},controller:"CkShareContentCtrl",templateUrl:"angular/app/shared/ckShareContent/partials/share.tpl.html"}}]).controller("CkShareContentCtrl",["$scope","$rootScope","ckComp",function(o,e,a){a.load("clipboard.js").then(function(){window.clipboard=new ClipboardJS("#ck-btn-copy"),window.clipboard.on("success",function(o){$("#showShareStatusLink").text("Copiado").css("color","green")}),window.clipboard.on("error",function(o){$("#showShareStatusLink").text("Não foi possível copiar").css("color","red")})}),o.content=e.resolveUrlSharer(o.content,o.type)}]),angular.module("Proj").controller("SmsVerificationCtrl",["$scope","$rootScope","$mdDialog","$mdMedia","ClienteService","AuthFactory","SmsVerificationService",function(a,e,r,o,t,n,i){a.dados={},a.mdMedia=o,a.reload=!1,a.tela=1,e.showVerificarCodigo=a.showVerificarCodigo,a.showVerificarCodigo=function(o){a.carregandoTelefone=!0,a.reload=o,a.houveAlteracao=!1,n.isLoggedIn()?(a.idusuario=n.get().id,r.show({preserveScope:!0,scope:a,templateUrl:"angular/app/shared/ckSmsVerification/partials/smsDialog.tpl.html",parent:angular.element(document.body),focusOnOpen:!1,clickOutsideToClose:!window.cordova}),t.verificarTelefone(n.get().id).then(function(o){null==o.codigo&&(o.codigo="+55"),a.carregandoTelefone=!1,a.dados.codigo=o.codigo,a.dados.telefone=o.telefone}).catch(function(){e.showToast("Não foi possível carregar seu telefone"),e.hideDialog(),a.carregandoTelefone=!1})):e.showToast("Você deve estar logado para verificar seu número")},a.editarTelefone=function(o){a.salvandoTelefone=!0,a.houveAlteracao?t.editarTelefone(a.idusuario,o).then(function(o){a.enviarCodigoSms(),a.salvandoTelefone=!1}).catch(function(o){e.showToast(o||"Ops, algo de errado aconteceu"),a.salvandoTelefone=!1}):(a.salvandoTelefone=!1,a.enviarCodigoSms())},a.registrarAlteracao=function(){a.houveAlteracao=!0},a.enviarCodigoSms=function(){a.tela=2,a.enviandoCodigo=!0,a.pinStart(),i.enviarCodigo(a.idusuario).then(function(o){}).catch(function(o){console.error(o),a.singleError=o||"",a.tela=0}).finally(function(){a.enviandoCodigo=!1})},a.pinReady=!1,a.focused=null,a.pin,a.data={},a.data.one=null,a.data.two=null,a.data.tree=null,a.data.four=null,$("#pin1").focus();a.pinStart=function(){a.pinInput1=$("#pin1"),a.pinInput2=$("#pin2"),a.pinInput3=$("#pin3"),a.pinInput4=$("#pin4"),a.pinInput1.focus()},a.controlePreDigito=function(o){var e=parseInt(o.target.value);0<=e&&e<=9&&o.preventDefault()},a.controlePinForm=function(o){var e;if(13==o.originalEvent.keyCode&&(e=document.getElementById("formsubmit"),$timeout(function(){angular.element(e).triggerHandler("click")},0)),null!=o&&8==o.originalEvent.keyCode){if("pin1"==a.focused)return o.preventDefault(),void(a.data.one=null);if("pin2"==a.focused)return o.preventDefault(),a.pinInput1.focus(),a.focused=document.activeElement.attributes.id.value,a.verificarPinPronto(),void(a.data.two=null);if("pin3"==a.focused)return o.preventDefault(),a.pinInput2.focus(),a.focused=document.activeElement.attributes.id.value,a.verificarPinPronto(),void(a.data.tree=null);if("pin4"==a.focused)return o.preventDefault(),a.pinInput3.focus(),a.focused=document.activeElement.attributes.id.value,a.verificarPinPronto(),void(a.data.four=null)}else null!=a.data.one&&null==a.data.two?(a.data.two=null,a.data.tree=null,a.data.four=null,a.pinInput2.focus()):null!=a.data.one&&null!=a.data.two&&null==a.data.tree?(a.data.tree=null,a.data.four=null,a.pinInput3.focus()):null!=a.data.one&&null!=a.data.two&&null!=a.data.tree&&null==a.data.four&&a.pinInput4.focus(),a.focused=document.activeElement.attributes.id.value;a.verificarPinPronto()},a.verificarPinPronto=function(){null!=a.data.one&&null!=a.data.one&&null!=a.data.two&&null!=a.data.two&&null!=a.data.tree&&null!=a.data.tree&&null!=a.data.four&&null!=a.data.four?(a.pin=a.data.one.toString()+a.data.two.toString()+a.data.tree.toString()+a.data.four.toString(),a.mensagem=null,a.pinReady=!0):(a.pinReady=!1,a.pin=null)},a.verificarPinCode=function(){a.verificando=!0,i.verificarCodigo(a.idusuario,a.pin).then(function(o){a.tela=3,a.reload&&e.recarregarPagina()}).catch(function(o){console.error(o),a.singleError=o||"",a.tela=0}).finally(function(){a.verificando=!1})}}]),angular.module("Proj").service("SmsVerificationService",["ApiCK","$request",function(a,r){return{verificarCodigo:function(o,e){return r.post(a+"usuarios/"+o+"/telefone/pin/verificar/"+e,null)},enviarCodigo:function(o){return r.post(a+"usuarios/"+o+"/telefone/pin/enviar",null)}}}]),angular.module("Proj").controller("StatusPayCtrl",["$scope","$rootScope","$mdDialog","StatusPayService","AuthFactory",function(e,o,a,r,t){e.show=function(o){a.show({controller:"StatusPayCtrl",parent:angular.element(document.body),scope:e,preserveScope:!0,fullscreen:!0,templateUrl:"angular/app/shared/ckStatusPay/partials/listStatusDialog.tpl.html",clickOutsideToClose:!window.cordova}),e.load(o)},e.load=function(o){e.carregandoDetalhesPagamento=!0,e.erroDetalhesPagamento=!1,r.obter(o).then(function(o){e.detalhesPagamento=o.transacao,e.detalhesPagamentoStatus=o.status}).catch(function(o){e.erroDetalhesPagamento=!0,e.errorMessage=o||"Ops, algo de errado aconteceu"}).finally(function(){e.carregandoDetalhesPagamento=!1})}}]).service("StatusPayService",["ApiCK","$request",function(e,a){return{obter:function(o){return a.get(e+"interesses/"+o+"/pagamento/detalhes")}}}]),angular.module("Proj").directive("ckStatusRastreio",function(){return{restrict:"EA",scope:{idinteresse:"=",tipo:"=",interesse:"="},controller:["$scope","$mdDialog","RastreioService",function(e,o,a){e.obterRastreio=function(){e.carregandoStatusRastreio=!0,a.obterStatusAtual(e.idinteresse).then(function(o){e.objeto=o}).catch(function(o){e.statusErro=!0}).finally(function(){e.carregandoStatusRastreio=!1})}}],templateUrl:"angular/app/shared/ckStatusRastreio/partials/status.tpl.html"}}).controller("RastreioCtrl",["$scope","$rootScope","$mdDialog","RastreioService","AuthFactory",function(a,r,t,e,o){a.showDetalhesRastreio=function(o,e){t.show({controller:"RastreioCtrl",parent:angular.element(document.body),targetEvent:e,scope:a,preserveScope:!0,templateUrl:"angular/app/shared/ckStatusRastreio/partials/listStatusDialog.tpl.html",clickOutsideToClose:!window.cordova}),a.carregarListaStatus(o)},a.carregarListaStatus=function(o){a.carregandoListaRastreio=!0,e.obterListaStatusV2(o).then(function(o){a.codigoRastreio=o.codigo,a.gateway=o.gateway,null==o.rastreio?(a.erro=!0,a.textoErro="O rastreio do pacote "+o.codigo+" não está disponível"):a.lista=o.rastreio}).catch(function(o){a.textoErro=o||"Não foi possível rastrear o pacote",a.erro=!0}).finally(function(){a.carregandoListaRastreio=!1})},a.resolveStatusIcone=function(o){return!o||null==o||null==(o=o.toLowerCase())?"local_shipping":-1<o.indexOf("entregue")?"done":-1<o.indexOf("postado")?"send":"local_shipping"},a.irParaLocalPacote=function(o){var e=null!=o.local?o.local:"",o=null!=o.city?o.city:"",e=r.replaceAllOnArray(e,[" ","/","&"],"+"),o=r.replaceAllOnArray(o,[" ","/","&"],"+");r.irParaLocalizacao("https://www.google.com/maps/search/"+e+"+"+o+"/")}}]).controller("RastreioLoggiCtrl",["$scope","$rootScope","$mdDialog","idInteresse","AppleMapKit","RastreioService",function(t,a,o,r,n,i){t.carregandoMapa=!1,t.verMapa=!1,t.erroMapa=!1,t.erroRastreio=!1,t.rastreando=!1,t.iniciado=!1,t.mapaExpandido=!1,t.rastreio=null,t.map=null,t.marcadores={origem:null,destino:null,entregador:null};var c=0;function e(){mapkit?(mapkit.init({authorizationCallback:function(e){n.fetchJWT().then(function(o){e(o.token)}).catch(function(o){console.error(o),t.erroMapa=!0}).finally(function(){t.carregandoMapa=!1})},language:"pt-BR"}),t.map||window.mapkit&&(t.map=new mapkit.Map("map",{showsMapTypeControl:!1,showsCompass:mapkit.FeatureVisibility.Hidden}),t.carregandoMapa=!1,t.verMapa=!0,l())):(t.erroMapa=!0,t.carregandoMapa=!1,console.error("MAPKIT","window.mapkit não existe"))}function s(){return window.mapkit&&window.mapkit.Coordinate&&window.mapkit.MarkerAnnotation}function l(){var o,e,a,r;t.map&&(e=[],t.marcadores.entregador&&(e.push(t.marcadores.entregador),t.marcadores.entregador=null),t.map.removeItems(e)),t.map&&s()&&(e=t.marcadores.origem,a=t.marcadores.destino,r=t.marcadores.entregador,o=d(),!e&&u(o.origem)&&(e=new mapkit.Coordinate(o.origem.lat,o.origem.lng),t.marcadores.origem=new mapkit.MarkerAnnotation(e,{color:"#000000",title:"Retirada",subtitle:"Seu pacote será retirado aqui"})),!a&&u(o.destino)&&(e=new mapkit.Coordinate(o.destino.lat,o.destino.lng),t.marcadores.destino=new mapkit.MarkerAnnotation(e,{color:"#000000",title:"Entrega",subtitle:"Você receberá aqui"})),!r)&&u(o.entregador)&&(a=new mapkit.Coordinate(o.entregador.lat,o.entregador.lng),t.marcadores.entregador=new mapkit.MarkerAnnotation(a,{color:"#0000ff",title:"Mensageiro",subtitle:"Seu pacote está aqui"})),t.map&&t.marcadores&&s()&&(r=[],t.marcadores.origem&&r.push(t.marcadores.origem),t.marcadores.destino&&r.push(t.marcadores.destino),t.marcadores.entregador&&r.push(t.marcadores.entregador),t.map.showItems(r,{animate:!1}))}function d(){var o;return t.rastreio?((o={origem:null,destino:null,entregador:null}).entregador={lat:t.rastreio.latitudeEntregador,lng:t.rastreio.longitudeEntregador},t.rastreio.remetente&&(o.origem={lat:t.rastreio.remetente.latitude,lng:t.rastreio.remetente.longitude}),t.rastreio.destinatario&&(o.destino={lat:t.rastreio.destinatario.latitude,lng:t.rastreio.destinatario.longitude}),o):[]}function u(o){return o&&o.lat&&o.lng}!function e(){if(!r)return;t.rastreando=!0;return i.rastrearLoggi(r).then(function(o){t.rastreio=o,t.rastreio.latitudeEntregador=Math.cos(Date.now())/10-23.58533,t.rastreio.longitudeEntregador=Math.sin(Date.now())/10-46.66388,l();t.rastreio.statusFinal||t.rastreio.statusErro;c=window.setTimeout(function(){e()},2e3)}).catch(function(o){t.erroRastreio=!0,console.error(o),t.rastreio&&a.showToast("Desculpe, houve algum erro")}).finally(function(){t.rastreando=!1})}(),t.close=function(){window.clearTimeout(c),o.hide()},t.carregarMapa=function(){t.iniciado||(t.carregandoMapa=!0,t.iniciado=!0,window.mapkit?e():$.getScript(n.MAPKIT_CDN,e))},t.expandirMapa=function(){t.mapaExpandido=!t.mapaExpandido}}]).service("RastreioService",["ApiCK","$mdDialog","$request",function(e,a,r){return{obterStatusAtual:function(o){return r.get(e+"interesses/"+o+"/rastrear/atual")},obterListaStatus:function(o){return r.get(e+"interesses/"+o+"/rastrearnativo")},rastrearLoggi:function(o){return r.get(e+"interesses/"+o+"/rastreio/loggi")},obterListaStatusV2:function(o){return r.get(e+"interesses/"+o+"/rastrear/v2")},exibirRastreioLoggi:function(o,e){e={controller:"RastreioLoggiCtrl",templateUrl:"angular/app/shared/ckStatusRastreio/partials/rastreioLoggi.tpl.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!window.cordova,fullscreen:!0,locals:{idInteresse:o}};return a.show(e)}}}]),angular.module("Proj").service("ckTagManagerPurchaseQueue",["CompraService","ckTagManagerService",function(t,i){var r=[];function n(o,e){var a,o={id:o,ev:e};a=o,r.some(function(o){o.id,a.id})||r.push(a),l(),s(o)}function c(e){r=r.filter(function(o){o.id,e.id}),l()}function s(n){function r(){window.setTimeout(function(){s(n)},3e4)}if(n)if(n.id)try{t.obterDadosTracking(n.id).then(function(o){var e=o.err&&"not_found"===o.err,a=o.isTransacionado,o=o.isTracked;e||(o?c(n):a?t.setarTracking(n.id).then(function(){var o=n.event;try{var e=o||{},a=e.compra,r=e.produto,t=e.tamanho;i.purchase(a.id,r.id,r.idDrop,a.statusInteresse.status,r.nome,a.precoCobrado,r.preco,r.idTipoProduto,r.idMarca,1,t.titulo,a.id,a.precoApresentacao,"",a.precoFrete,"","")}catch(o){}c(n)}):r())}).catch(function(){r()})}catch(o){r()}else c(n)}function l(){var o=JSON.stringify(r);localStorage.setItem("gtag_queue",o)}return{init:function(){var o=localStorage.getItem("gtag_queue");if((r=JSON.parse(o)||[]).length)for(var e=0;e<r.length;e++)s(r[e])},add:function(o,e,a){n(o.id,{compra:o,produto:e,tamanho:a})}}}]),angular.module("Proj").service("ckTagManagerService",["$rootScope",function(t){function n(o){return{id:""+o}}function v(o,e,a,r,t,n,i,c,s){return{id:o,sku:""+e,name:a,price:(""+r).replace(",","."),category:n,brand:i,quantity:""+c,variant:s}}function w(o,e,a){return{id:""+o,status:e,products:a}}function i(o,e,a,r){return{pagePath:o,name:e,area:"b2c",segment:"ecommerce",category:a,subCategory:r,environment:window.cordova?t.isIOS()?"app-ios":"app-android":t.isDesktop()?"site-desktop":"site-mobile",platform:"v1"}}return{sanitize:function(o){return null!==o&&""!==o?o.toString().toLowerCase().replace(/ +/g," ").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9.:, ]/g,"").replaceAll(" ","-"):""},sanitizeObj:function(o){for(var e=Object.keys(o),a={},r=0;r<e.length;r++)"string"==typeof o[e[r]]&&(a[e[r]]=this.sanitize(o[e[r]])),"object"==typeof o[e[r]]&&(a[e[r]]=o[e[r]]);return a},sanitizeArray:function(o){for(var e=[],a=0;a<o.length;a++){var r=this.sanitizeObj(o[a]);e.push(r)}return e},encriptarUsuario:function(o){return o},encriptarDados:function(o){var e=$q.defer(),o=o+"$1r$bN8St5v$BqRwxdaTxl5/vh3e.Ros-&dGI0oPQ-$(fsq)TBl28{&^!l#7Nfu7",o=(new TextEncoder).encode(o);return crypto.subtle.digest("SHA-256",o).then(function(o){o=Array.from(new Uint8Array(o)).map(function(o){o.toString(16).padStart(2,"0")}).join("");e.resolve(o)}).catch(function(o){e.reject(o)}),e.promise},pageViewGlobal:function(o,e,a,r,t){window.dataLayer=window.dataLayer||[];e=this.sanitize(e),a=this.sanitize(a),r=this.sanitize(r);window.dataLayer.push({event:"pageView",page:i(o,e,a,r),user:n(t)})},notifyMeInteraction:function(o,e,a,r){window.dataLayer=window.dataLayer||[];o=this.sanitize(o),e="avise-me:"+e+":"+this.sanitize(a);window.dataLayer.push({event:"interaction",interaction:{component:"card",action:"click-button",step:o,description:e,value:100*r}})},productDetail:function(o,e,a,r,t,n,i,c,s,l){window.dataLayer=window.dataLayer||[];e=v(e,a,r,t,0,i,c,s,l),a=this.sanitizeObj(e);window.dataLayer.push({event:"productDetail",ecommerce:{detail:{actionField:{list:o},products:new Array(a)}}})},dropDetail:function(o,e,a,r,t,n,i){window.dataLayer=window.dataLayer||[];i=i,n=n;e={id:""+e,name:a,price:(""+t).replace(",","."),brand:i,category:n,variant:""},a=this.sanitizeObj(e);window.dataLayer.push({event:"dropDetail",ecommerce:{detail:{actionField:{list:o},products:new Array(a)}}})},addToCart:function(o,e,a,r,t,n,i,c,s,l,d){window.dataLayer=window.dataLayer||[];e=v(e,a,t,n,0,c,s,l,d),a=this.sanitizeObj(e),t=w(o,r,new Array(a)),n=this.sanitizeObj(t);window.dataLayer.push({event:"addToCart",ecommerce:{currencyCode:"BRL",cart:n,add:{products:new Array(a)}}})},continueClickButton:function(){window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"interaction",interaction:{component:"cart",action:"click-button",step:"checkout",description:"continuar",value:0}})},cartChange:function(o){window.dataLayer=window.dataLayer||[];o=this.sanitize(o);window.dataLayer.push({event:"interaction",interaction:{component:"cart",action:"click-button",step:"checkout",description:o}})},checkoutProfile:function(o,e,a,r,t,n,i,c,s,l,d){window.dataLayer=window.dataLayer||[];e=v(e,a,t,n,0,c,s,l,d),a=this.sanitizeObj(e),t=w(o,r,new Array(a)),n=this.sanitizeObj(t);window.dataLayer.push({event:"checkoutProfile",ecommerce:{checkout:{actionField:{step:2},cart:n,products:new Array(a)}}})},checkout:function(o,e,a,r,t,n,i,c,s,l,d){window.dataLayer=window.dataLayer||[];e=v(e,a,t,n,0,c,s,l,d),a=this.sanitizeObj(e),t=w(o,r,new Array(a));this.sanitizeObj(t);window.dataLayer.push({event:"checkout",ecommerce:{checkout:{actionField:{step:4},products:new Array(a)}}})},checkoutPayment:function(o,e,a,r,t,n,i,c,s,l,d,u){window.dataLayer=window.dataLayer||[];this.sanitize(o);a=v(a,r,n,i,0,s,l,d,u),r=this.sanitizeObj(a),n=w(e,t,new Array(r));this.sanitizeObj(n);window.dataLayer.push({event:"checkoutPayment",ecommerce:{checkout:{actionField:{step:4,option:o},products:new Array(r)}}})},purchaseSimple:function(o,e,a){try{var r=o||{},t=e||{},n=a||{};this.purchase(r.id,t.id,t.idDrop,r.statusInteresse.status,t.nome,r.precoCobrado,t.preco,t.idTipoProduto,t.idMarca,1,n.titulo,r.id,r.precoApresentacao,"",r.precoFrete,"","")}catch(o){console.log("GTM ERROR > ",o)}},purchase:function(o,e,a,r,t,n,i,c,s,l,d,u,p,f,m,g,h){window.dataLayer=window.dataLayer||[];f=f,m=m,g=g,h=h;u={id:""+u,revenue:(""+p).replace(",","."),tax:(""+f).replace(",","."),shipping:(""+m).replace(",","."),coupon:g,option:h},p=this.sanitizeObj(u),f=v(e,a,t,n,0,c,s,l,d),m=this.sanitizeObj(f),g=w(o,r,new Array(m));this.sanitizeObj(g);window.dataLayer.push({event:"purchase",ecommerce:{purchase:{actionField:p,products:new Array(m)}}})},searchInteraction:function(o){window.dataLayer=window.dataLayer||[];o=this.sanitize(o);window.dataLayer.push({event:"interaction",interaction:{component:"search",action:"click:search",description:o,value:0}})},searchResult:function(o,e,a,r,t){window.dataLayer=window.dataLayer||[];o=i(o,e,a,r),e={},e.pagePath=o.pagePath,e.name=this.sanitize(o.name),e.area=o.area,e.segment=o.segment,e.category=this.sanitize(o.category),e.subCategory=this.sanitize(o.subCategory),e.environment=o.environment,e.platform=o.platform,a=n(t);window.dataLayer.push({event:"pageView",page:e,user:{id:a}})}}}]),angular.module("Proj").service("CkTouchScreen",["$rootScope",function(o){var t="",n=.7;function i(o){return{top:o.targetTouches[0].pageY,left:o.targetTouches[0].pageX}}function c(e){return function(o){1<o.touches.length||"touchend"==o.type&&0<o.touches.length||(e.dadosTouch=function(o,e){var a=0,r=100,o=i(o);a="top"===e.direcao?o.top-e.touchInicial.top:o.left-e.touchInicial.left;e.reduzirBrilho&&(r=function(o,e){var a=0;a="top"===t?o.elementoContainer.clientHeight:o.elementoContainer.clientWidth;return 100-e/(a*n)*100}(e,a));return{diferencaPosicao:a,brilho:r}}(o,e),o={event:o,direcao:e.direcao,distancia:e.dadosTouch.diferencaPosicao,brilho:e.dadosTouch.brilho,finalizouTouch:!1,touchInicial:e.touchInicial},e.callback(o))}}return{listen:function(o,e,a,r){var t,n,o={elementoContainer:document.querySelector(o),touchInicial:{},direcao:r,reduzirBrilho:a,callback:e,dadosTouch:{}};o.elementoContainer&&(o.elementoContainer.ontouchmove=c(o),o.elementoContainer.ontouchcancel=function(o){},o.elementoContainer.ontouchend=(n=o,function(o){o={event:o,direcao:n.direcao,distancia:n.dadosTouch.diferencaPosicao,brilho:n.dadosTouch.brilho,finalizouTouch:!0};n.callback(o)}),o.elementoContainer.ontouchstart=(t=o,function(o){t.touchInicial=i(o)}))}}}]),angular.module("Proj").directive("ckUploadImage",["$compile",function(o){return{restrict:"AE",scope:{myDirectiveVar:"=ngModel",maxsize:"=maxsize",maxwidth:"=maxwidth",protegido:"=protegido",format:"=format"},templateUrl:"angular/app/shared/ckUploadImage/partials/template.tpl.html",replace:!0,controller:"CkUploadImageCtrl"}}]).controller("CkUploadImageCtrl",["$scope","$rootScope","MultimidiaService",function(i,c,s){i.isImage=!0,i.uploadFileError=!1,i.uploadFileLoaded=!1,i.uploadImageLoaded=!1,i.carregando=!1,i.linkReturn=null,i.errorMessage=null,i.iniciarImageEngine=(i._format=null==i.format?"image/*":"file"==i.format?"*/*":"certificado"==i.format?".pbx, .p12":"image/*",i.isImage=null==i.format||"undefined"==i.format||"image"==i.format,window.loadImage||$.getScript("angular/comp/loadImage/load-image.all.min.js",function(o,e,a){}),window.piexif||$.getScript("angular/comp/piexifjs/piexif.js"),void(window.AWS||$.getScript("https://sdk.amazonaws.com/js/aws-sdk-2.780.0.min.js",function(o,e,a){}))),i.previewMultimidia=function(o){o.protegido?i.resolverMidiaProtegida(o):i.previewImagem=o},i.resolverMidiaProtegida=function(o){o={Bucket:"droper-personal",Key:o.key};window.s3SDK.getObject(o,function(o,e){e=new Blob([e.Body],{type:"image/png"}),e=URL.createObjectURL(e);i.previewImagem={filename:e},i.$apply()})},i.usarMultimidia=function(o){i.myDirectiveVar=o},i.removerPreview=function(){delete i.previewImagem},i.uploadDeImagem=function(o,e){i.carregando=!0,i.uploadFileError=!1,i.porcentagemCarregamento=0;var a=i.maxwidth,r=i.maxsize,t=i.protegido,n=$(o).get(0).files[0];i.isImage?s.readEXIF(n).then(function(e){e?e["0th"][piexif.ImageIFD.Orientation]=1:console.warn("EXIF FAIL"),s.editImageOrientation(n,a).then(function(o){s.refactorSize(o,a,r,e).then(function(o){s.uploads3(o,t,!0).then(function(o){i.uploadImageLoaded=!0,i.previewMultimidia(o)},null,function(o){i.porcentagemCarregamento=o}).catch(function(o){i.uploadFileError=!0,i.errorMessage="Erro ao carregar imagem. Tente novamente mais tarde!"}).finally(function(){i.carregando=!1})}).catch(function(o){console.error(o),i.errorMessage=o,i.uploadFileError=!0,i.carregando=!1})}).catch(function(o){console.error(o),i.errorMessage=o,i.uploadFileError=!0,i.carregando=!1})}).catch(function(o){throw console.error(o),i.uploadFileError=!0,i.carregando=!1,o}):s.uploads3(n,t,i.isImage).then(function(o){i.uploadFileLoaded=!0,i.linkReturn=o},null,function(o){i.porcentagemCarregamento=o}).catch(function(o){i.uploadFileError=!0,c.showToast("Ocorreu uma falha ao carregar arquivo. Tente novamente mais tarde.")}).finally(function(){i.carregando=!1})}}]),angular.module("Proj").service("MultimidiaService",["$http","$q","staticUrl","ApiCK","$request","CkImageRepositoryService",function(e,n,r,o,a,t){function p(){var o=new Date;return o.getUTCDate().toString()+(o.getUTCMonth()+1).toString()+o.getFullYear().toString()+o.getUTCHours().toString()+o.getUTCMinutes().toString()+o.getUTCSeconds().toString()+o.getUTCMilliseconds().toString()}function f(o){for(var e=(0<=o.split(",")[0].indexOf("base64")?atob:unescape)(o.split(",")[1]),a=new Uint8Array(e.length),r=0;r<e.length;r++)a[r]=e.charCodeAt(r);return new Blob([a],{type:o.split(",")[0].split(":")[1].split(";")[0]})}return{upload:function(o){var e=n.defer(),a=new FormData;return a.append("file",o),$.ajax({type:"POST",url:r,data:a,contentType:!1,processData:!1,cache:!1,success:function(o){o={filename:o[0].Path};e.resolve(o)},error:function(o){e.reject(o)}}),e.promise},uploads3:function(c,s,l){var d=n.defer(),o=t.getBuckets,u=l?o.Linode:s?o.DroperMedia:o.DroperPersonal;try{e.get(u.KeyFile).success(function(o){var e=o.ak,o=o.sc,a=((new FormData).append("file",c),u.BucketName),r=u.ACL;if(17e5<c.size)throw"A imagem não pode ter mais que 1.5 Megabytes";if(null==c.type||""==c.type)throw"Tipo de arquivo inválido";var t=null==(t=c.type)?"jpg":t.slice(2+(t.lastIndexOf("/")-1>>>0)),n="",n=(l?(i="webp"==t||"jpg"==t||"jpeg"==t||"png"==t?t:"jpg",p()+"."+i):p()+"."+t).trim(),i=(AWS.config.update({secretAccessKey:o,accessKeyId:e,httpOptions:{xhrAsync:!0}}),{}),t=(u.S3Endpoint&&(i.endpoint=new AWS.Endpoint(u.S3Endpoint)),window.s3SDK=new AWS.S3(i),{ACL:r,Body:c,Bucket:a,Key:n}),o=window.s3SDK.upload(t);d.notify(1),o.on("httpUploadProgress",function(o){o=o.loaded/o.total,o=parseFloat(100*o).toFixed(0);d.notify(o)}).send(),o.promise().then(function(o){o={filename:o.Location,key:o.Key,protegido:s};d.resolve(o)}).catch(function(o){throw"Algo de errado aconteceu ao fazer upload da imagem"})}).error(function(o){d.reject(o)})}catch(o){d.reject(o)}return d.promise},getS3Object:function(a,r){var t=n.defer();try{e.get(o+"usuarios/aws/s3").success(function(o){var e=o.ak,o=o.sc,o=(AWS.config.update({secretAccessKey:o,accessKeyId:e,httpOptions:{xhrAsync:!0}}),window.s3SDK=new AWS.S3,{Bucket:a,Key:r}),e=window.s3SDK.getObject(o);t.notify(1),e.on("httpUploadProgress",function(o){o=o.loaded/o.total,o=parseFloat(100*o).toFixed(0);t.notify(o)}).send(),e.promise().then(function(o){var e={};e.filename=o.Location,t.resolve(e)}).catch(function(o){throw"Algo de errado aconteceu ao fazer upload da imagem"})}).error(function(o){t.reject(o)})}catch(o){t.reject(o)}return t.promise},editImageOrientation:function(o,e){var a=n.defer();try{window.loadImage(o,function(o){null!=o&&"error"==o.type?a.reject("Tipo de imagem não suportada"):a.resolve(o)},{orientation:!0,maxWidth:e,canvas:!0})}catch(o){a.reject(o)}return a.promise},refactorSize:function(o,s,l,d){var u=n.defer(),p=new Image;return p.src=o.toDataURL("image/jpeg"),p.onload=function(){var o,e=$(p),a=1,r=document.createElement("canvas"),t=r.getContext("2d");do{var n=s/a,i=e[0].height/(e[0].width/n),c=(r.width=n,r.height=i,t.drawImage(p,0,0,r.width,r.height),r.toDataURL("image/jpeg")),n=f(c).size}while(a++,l<n);o=null!=d?(o=piexif.dump(d),f(piexif.insert(o,c))):f(c),u.resolve(o)},u.promise},readEXIF:function(o){var e=new FileReader,a=n.defer();return e.onload=function(o){try{var e=piexif.load(o.target.result);a.resolve(e)}catch(o){a.resolve(null)}},e.readAsDataURL(o),a.promise}}}]),angular.module("Proj").service("CkImageRepositoryService",["$q","$http","ApiCK",function(r,e,o){var t={DroperMedia:{BucketName:"droper-media",ACL:"public-read",S3Endpoint:null,KeyFile:o+"usuarios/aws/s3"},DroperPersonal:{BucketName:"droper-personal",ACL:null,S3Endpoint:null,KeyFile:o+"usuarios/aws/s3"},Linode:{BucketName:"droper-media",ACL:"public-read",S3Endpoint:"us-southeast-1.linodeobjects.com",KeyFile:o+"usuarios/aws/linode"}},d=t.Linode,u=t.DroperPersonal;function n(){var o=r.defer(),e=window.setTimeout(function(){o.reject("Não foi possível carregar AWS"),window.AwsLoaded=!1},2e4);return window.AWS?o.resolve():(window.AwsLoaded=!0,$.getScript("https://sdk.amazonaws.com/js/aws-sdk-2.780.0.min.js",function(){clearTimeout(e),o.resolve()})),o.promise}function i(c,s){var l=r.defer(),o=angular.copy(s?u:d);try{e.get(o.KeyFile).success(function(o){var e,a,r=s?u:d,t=o.ak,o=o.sc,n=((new FormData).append("file",c),r.BucketName),i=r.ACL;17e5<c.size?l.reject("A imagem não pode ter mais que 1.5 Megabytes"):(a="png"==(a=null==(a=c.type)?"jpg":a.slice(2+(a.lastIndexOf("/")-1>>>0)))||"webp"==a?a:"jpg",e=((e=new Date).getUTCDate().toString()+(e.getUTCMonth()+1).toString()+e.getFullYear().toString()+e.getUTCHours().toString()+e.getUTCMinutes().toString()+e.getUTCSeconds().toString()+e.getUTCMilliseconds().toString()+"."+a).trim(),AWS.config.update({secretAccessKey:o,accessKeyId:t,httpOptions:{xhrAsync:!0}}),a={},r.S3Endpoint&&(a.endpoint=new AWS.Endpoint(r.S3Endpoint)),window.s3SDK=new AWS.S3(a),o={ACL:i,Body:c,Bucket:n,Key:e},t=window.s3SDK.upload(o),l.notify(.01),t.on("httpUploadProgress",function(o){l.notify(o.loaded/o.total)}).send(),t.promise().then(function(o){o={filename:o.Location,key:o.Key,secured:s};l.resolve(o)}).catch(function(o){console.error("error ",o),l.reject("Algo de errado aconteceu ao fazer upload da imagem")}))}).error(function(o){l.reject(o)})}catch(o){l.reject(o)}return l.promise}return{init:n,uploads3:function(o,e){var a=r.defer();return n().then(function(){return i(o,e)}).then(function(o){o={url:o.filename,key:o.key,secured:o.secured};a.resolve(o)},function(o){a.reject(o)},function(o){a.notify(o)}),a.promise},fetchSecured:function(e){var a=r.defer();return n().then(function(){return o=e,a=r.defer(),o={Bucket:t.DroperPersonal.BucketName,Key:o},window.s3SDK.getObject(o,function(o,e){e=new Blob([e.Body],{type:"image/png"}),e=URL.createObjectURL(e);a.resolve(e)}),a.promise;var o,a}).then(function(o){a.resolve(o)}).catch(function(o){a.reject(o)}),a.promise},fetch:function(o){var e=r.defer();return o.secured?this.fetchSecured(o.key):(e.resolve(o.url),e.promise)},getBuckets:t}}]),angular.module("Proj").directive("ckImageSelector",[function(){return{restrict:"AE",scope:{maxsize:"<maxsize",maxwidth:"<maxwidth",iconsize:"<iconsize",iconwidth:"<iconwidth",max:"<max",iconify:"<iconify",secured:"<secured",multiple:"<multiple",onconfirm:"<onselect",map:"<map",isDialog:"<isdialog"},templateUrl:"angular/app/shared/ckUploadImageV2/partials/imageUploader.tpl.html",replace:!0,controller:"CkImageSelectorCtrl"}}]).service("CkImageSelector",["$mdDialog",function(r){return{new:function(){return{_maxsize:102400,_maxwidth:1e3,_iconify:!1,_iconsize:0,_iconwidth:0,_max:1,_multiple:!1,_secured:!1,_map:function(o){return o},_targetEvent:null,maxsize:function(o){return this._maxsize=o,this},maxwidth:function(o){return this._maxwidth=o,this},iconify:function(){return this._iconify=!0,this},iconsize:function(o){return this._iconsize=o,this},iconwidth:function(o){return this._iconwidth=o,this},max:function(o){return this._max=o,this},map:function(o){return this._map=o,this},multiple:function(){return this._multiple=!0,this},secure:function(){return this._secured=!0,this},targetEvent:function(o){return this._targetEvent=o,this}}},show:function(o){return a={maxsize:(e=o)._maxsize,maxwidth:o._maxwidth,iconsize:o._iconsize,iconwidth:o._iconwidth,max:o._max,iconify:o._iconify,multiple:o._multiple,secured:o._secured,map:o._map,isDialog:!0},e={templateUrl:"angular/app/shared/ckUploadImageV2/partials/imageUploaderDialog.tpl.html",targetEvent:o._targetEvent,locals:a,bindToController:!0,preserveScope:!0,clickOutsideToClose:!1,controller:["$scope",function(o){o.config=this}]},r.show(e);var e,a}}}]).controller("CkImageSelectorCtrl",["$scope","$rootScope","$q","$mdDialog","CkMultimidiaServiceV2","CkImageRepositoryService",function(u,o,e,a,s,c){var r={View:1,PreProcessing:2,Uploading:3,PostProcessing:4,Initializing:5,PreProcessingErr:10,UploadingErr:11,PostProcessingErr:12,InitializingErr:13},t=1,n=2,i=4,l=t&n&i;function p(o){return c.uploads3(o,u.secured)}function d(o){u.uiState=o}function f(a){return new Promise(function(o,e){o(a)})}function m(o,e){for(var a=[],r=0;r<o.length;r++){var t=o[r];a.push(e(t))}return a}function g(o,e){l|i&&console.log(o,e)}function h(o,e){l|t&&console.error(o,e)}u.UIState=r,u.viewingImage=null,u.images=[],u.uiState=r.View,u.partialProgress={},u.totalProgress=0,u.progressListener=e.defer(),u.errUploadAll=!1,u.nErrUpload=0,u.alert="",u.maxsize=u.maxsize||307200,u.maxwidth=u.maxwidth||800,u.iconsize=u.iconsize||102400,u.iconwidth=u.iconwidth||70,u.max=u.max||1,u.secured=u.secured||!1,u.isDialog=u.isDialog||!1,u.map=u.map||function(o){return o},u.onchange=u.onchange||function(){},u.iconify=u.iconify||u.iconsize&&u.iconwidth||!1,u.multiple=u.multiple||u.max&&1<u.max||!1,g("SCOPE",u),u.showFileSelector=function(){var o=document.getElementById("imageUploaderV2");o.multiple=!!u.multiple,o.onchange=function(){u.onFilesSelected(o.files)},o.click()},u.onFilesSelected=function(o){var e;o&&o.length&&(u.alert="",e=[o[0]],u.multiple&&(e=o),u.images.length+e.length>u.max?(u.alert="Selecione no máximo "+u.max+" fotos",u.$apply()):(d(r.Initializing),u.setupProgressListener(),u.initialize().then(function(){return d(r.PreProcessing),u.preprocessImages(e)},function(o){h("FATAL_INIT",o),d(r.InitializingErr)}).then(function(o){return g("IMGPROCESS",o),o&&o.length?(d(r.Uploading),u.uploadBlobs(o)):f(null)},function(o){h("FATAL_IMGPROCESS",o),d(r.PreProcessingErr),u.$apply()}).then(function(o){return g("IMGUPLOAD",o),o&&o.length?(d(r.PostProcessing),u.$apply(),u.postprocessImages(o)):f(null)},function(o){h("FATAL_IMGUPLOAD",o),d(r.UploadingErr),u.$apply()}).then(function(o){var e=function(o){var e=[];if(!o||!o.length)return[];for(var a=0;a<o.length;a++){var r=o[a];r&&e.push(r)}return e}(o);g("IMGPOSTPROC",e),e&&e.length&&(u.viewingImage=e[0],u.images=u.images.concat(e),u.triggerChanges()),u.errUploadAll=0===e.length,u.nErrUpload=o.length-e.length,d(r.View),u.$apply()},function(o){h("FATAL_POSTPROC",o),d(r.PostProcessingErr),u.$apply()}).catch(function(o){h("FATAL",o)})))},u.initialize=function(){var o=s.init(),e=c.init();return Promise.all([o,e])},u.preprocessImages=function(i){for(var o=[],c=0;c<i.length;c++){var e=new Promise(function(a,o){var r,t,e,n=i[c];n?(r={name:n.name,blob:null},t={name:"icon_"+n.name,blob:null},e=s.processImage(n,u.maxwidth,u.maxsize).catch(function(o){return h("IMG_PREPROC",r.name+": "+o),null}),n=function(o){if(u.iconify)return s.processImage(o,u.iconwidth,u.iconsize);return f(null)}(n).catch(function(o){return h("IMG_PREPROC",t.name+": "+o),null}),Promise.all([e,n]).then(function(o){var e=o[0],o=o[1];r.blob=e,t.blob=o,a(r.blob?{img:r,icon:t}:null)}).catch(function(o){h("IMG_PREPROC",o),a(null)})):a(null)});o.push(e)}return Promise.all(o)},u.uploadBlobs=function(l){for(var o=[],d=0;d<l.length;d++){var e=new Promise(function(a,o){var e,r,t,n,i,c,s=l[d];s?(e=f({url:null,key:null,secured:!1}),r=f({url:null,key:null,secured:!1}),t=s.img.blob,n=s.icon.blob,i=s.img.name,c=s.icon.name,t&&(e=p(t)),n&&(r=p(n)),e=e.then(function(o){return o},function(o){return h("IMG_UPLOAD",o),null},function(o){u.notifyProgress(i,o||1)}),r=r.then(function(o){return o},function(o){return h("ICON_UPLOAD",o),null},function(o){u.notifyProgress(c,o||1)}),Promise.all([e,r]).then(function(o){var e=o[0],o=o[1];a(e?{img:e,icon:o}:null)}).catch(function(o){h("UPLOAD",o),a(null)})):a(null)});o.push(e)}return Promise.all(o)},u.postprocessImages=function(o){for(var e=[],a=function(e){return function(o){return{url:e.url,key:e.key,secured:e.secured,postprocUrl:o}}},r=function(e){return function(o){return h(e,o),null}},t=0;t<o.length;t++){var n,i=o[t];i?(n=i.img,i=i.icon,n?(n=c.fetch(n).then(a(n)).catch(r("POSTPROC_IMG")),i=c.fetch(i).then(a(i)).catch(r("POSTPROC_ICON")),n=Promise.all([n,i]).then(function(o){var e=o[0],o=o[1];return e?{img:e,icon:o}:null}),e.push(n)):e.push(f(null))):e.push(f(null))}return Promise.all(e)},u.setupProgressListener=function(){u.totalProgress=1,u.partialProgress=function(o){for(var e={},a=o,r=Object.keys(a),t=0;t<r.length;t++){var n=r[t],i=a[n];i&&i<1&&(e[n]=upload)}return e}(u.partialProgress),u.progressListener=e.defer(),u.progressListener&&u.progressListener.promise&&u.progressListener.promise.then(function(){},function(){},function(o){var e=o.name,o=o.progress;u.partialProgress[e]=o,u.totalProgress=Math.floor(100*function(o){var e=Object.keys(o);if(!e||!e.length)return 1;for(var a=0,r=0;r<e.length;r++){var t=e[r],t=o[t];a+=t}return a/e.length}(u.partialProgress))})},u.notifyProgress=function(o,e){u.progressListener&&u.progressListener.notify&&u.progressListener.notify({name:o,progress:e})},u.viewImage=function(o){u.viewingImage=o},u.rmViewingImage=function(){var o=u.viewingImage,e=u.images;if(o)if(u.alert="",e&&e.length){if(1===e.length)u.viewingImage=null,u.images=[];else{for(var a=[],r=0;r<e.length;r++){var t,n=e[r];n===o?(t=(r+1)%e.length,t=u.images[t],u.viewingImage=t):a.push(n)}u.images=a}u.triggerChanges()}else u.viewingImage=null},u.getPreviewUrl=function(o){return(o=o&&o.img)&&(o.postprocUrl||o.url)||""},u.getIconUrl=function(o){var e;return o?(e=o.img,(o=o.icon)?o.postprocUrl||o.url||"":e.postprocUrl||e.url||""):""},u.useImages=function(){var o;a&&a.hide&&(o=m(u.images,u.map),a.hide(o))},u.closeDialog=function(){a&&a.cancel&&a.cancel()},u.triggerChanges=function(){var o;u.onchange&&(o=m(u.images,u.map),u.onchange(o))}}]),angular.module("Proj").service("CkMultimidiaServiceV2",["ApiCK","$request","$q",function(o,e,i){function c(){var o,e,a=i.defer();return window.loadImage&&!0?a.resolve():(o=function(){window.loadImage&&window.piexif&&(a.resolve(),window.clearTimeout(e))},e=window.setTimeout(function(){a.reject("Não foi possível carregar os componentes para processar a imagem")},2e4),window.loadImage||$.getScript("angular/comp/loadImage/load-image.all.min.js",o),window.piexif||$.getScript("angular/comp/piexifjs/piexif.js",o)),a.promise}function g(o){for(var e=(0<=o.split(",")[0].indexOf("base64")?atob:unescape)(o.split(",")[1]),o=o.split(",")[0].split(":")[1].split(";")[0],a=new Uint8Array(e.length),r=0;r<e.length;r++)a[r]=e.charCodeAt(r);return new Blob([a],{type:o})}return{init:c,processImage:function(r,t,e){var a=i.defer(),n=null;return c().then(function(){return o=r,e=new FileReader,a=i.defer(),e.onload=function(o){try{var e=piexif.load(o.target.result);a.resolve(e)}catch(o){console.warn("ERRO EXIF",o),a.resolve(null)}},e.readAsDataURL(o),a.promise;var o,e,a}).then(function(o){o&&((e=o["0th"])[piexif.ImageIFD.Orientation],e[piexif.ImageIFD.Orientation]=1),n=o;var e=r,o=t,a=i.defer();try{window.loadImage(e,function(o){a.resolve(o)},{orientation:!0,maxWidth:o,canvas:!0})}catch(o){a.reject(o)}return a.promise}).then(function(o){return o=o,d=t,u=e,p=n,f=i.defer(),(m=new Image).src=o.toDataURL("image/jpeg"),m.onload=function(){try{var o,e,a=$(m),r=1,t=document.createElement("canvas"),n=t.getContext("2d");do{var i=d/r,c=a[0].height/(a[0].width/i),s=(t.width=i,t.height=c,n.drawImage(m,0,0,t.width,t.height),t.toDataURL("image/jpeg")),l=g(s).size}while(r++,u<l);e=null!=p?(o=piexif.dump(p),g(piexif.insert(o,s))):g(s),f.resolve(e)}catch(o){f.reject(o)}},f.promise;var d,u,p,f,m}).then(function(o){return a.resolve(o),a.promise}).catch(a.reject),a.promise}}}]),angular.module("Proj").factory("CkViewState",[function(){function e(){return{scroll:{x:0,y:0},scope:{},changed:!1,ignoreWrites:0}}var a=e(),r=e(),t=e(),n=e(),i=e(),c=e(),s=e();function l(o,e){for(var a=Object.keys(o),r={},t=0;t<a.length;t++){var n=a[t],i=o[n],c="$"===n[0],s="function"==typeof i,l=0<=(e||[]).indexOf(n);c||s&&!l||(r[n]=i)}return r}return{home:function(o){return o&&a.ignoreWrites<=0?(a.scroll=o.scroll,a.scope=l(o.scope,o.saveFunctions),a.changed=!0):o&&0<a.ignoreWrites&&--a.ignoreWrites,a},clearHome:function(){(a=e()).ignoreWrites=1},noticias:function(o){if(!o)return r;r.scroll=o.scroll,r.scope=l(o.scope,o.saveFunctions),r.changed=!0},busca:function(o){if(!o)return t;t.scroll=o.scroll,t.scope=l(o.scope,o.saveFunctions),t.path=o.path,t.changed=!0},calendario:function(o){if(!o)return n;n.scroll=o.scroll,n.scope=l(o.scope,o.saveFunctions),n.path=o.path,n.changed=!0},vendas:function(o){if(!o)return i;i.scroll=o.scroll,i.scope=l(o.scope,o.saveFunctions),i.path=o.path,i.changed=!0},anuncios:function(o){if(!o)return c;c.scroll=o.scroll,c.scope=l(o.scope,o.saveFunctions),c.path=o.path,c.changed=!0},sparks:function(o){if(!o)return s;s.scroll=o.scroll,s.scope=l(o.scope,o.saveFunctions),s.path=o.path,s.changed=!0},clearSparks:function(o){(s=e()).ignoreWrites=o||0},restoreScope:function(o,e){for(var a=Object.keys(o),r=0;r<a.length;r++){var t=a[r];e[t]=o[t]}}}}]),angular.module("Proj").service("CkViewUtils",[function(){return{estaSendoVisto:function(o,e){var a,e=!!e,o=document.querySelector(o);return!(!o||(o=o.getBoundingClientRect(),a=window.innerHeight,o.y<0))&&(e?o.y<a:o.y+o.height<a)},esperarElemento:function(r,o,e,a){var t=e||0,n=o||(()=>!0),i=a||this.esperarElemento||(()=>{});return new Promise(function(o,e){var a=document.querySelector(r);a&&n(a)?o(a):10<t?e():window.setTimeout(function(){i(r,n,t+1,i).then(o).catch(e)},300)})}}}]),angular.module("Proj").controller("CkPaymentWatcher",["$location","CompraService","Environment",function(i,a,e){var r="[CkPaymentWatcher]",c={idCompra:0,statusCompra:null,path:null,intervalMs:0,watching:!1,onnotify:()=>!1,timeout:null};function s(...o){"dev"===e&&console.log(r,...o)}return{watch:function(o,e){function n(){s("pinging..."),a.syncCompra(c.idCompra).then(function(o){var e=o.mudouAlgo,a=c.statusCompra&&c.statusCompra!==o.status.status,r=e||a,t=i.path()!==c.path,t=r||t,r=(o.status&&(c.statusCompra=o.status.status),{pgtoDetectado:r,mudouAlgo:e,mudouStatus:a,statusCompra:o.status.status,vaiEncerrar:t});return t?s("ending."):c.timeout=window.setTimeout(n,c.intervalMs),r})}c.idCompra=o,c.path=i.path(),c.intervalMs=e.intervalMs||5e3,c.onnotify=e.onnotify||(()=>!1),c.watching=!0,s("watch started"),c.timeout=window.setTimeout(n,c.intervalMs)}}}]),angular.module("Proj").factory("$request",["$http","$q",function(r,t){return{get:function(o){var e=t.defer();return r.get(o).then(function(o){e.resolve(o.data)},function(o){e.reject(o.data)}),e.promise},getWithCache:function(o){var e=t.defer();return r.get(o,{cache:!0}).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},post:function(o,e){var a=t.defer();return r.post(o,e).then(function(o){a.resolve(o.data)},function(o){a.reject(o.data)}),a.promise},put:function(o,e){var a=t.defer();return r.put(o,e).then(function(o){a.resolve(o.data)},function(o){a.reject(o.data)}),a.promise},patch:function(o,e){var a=t.defer();return r.patch(o,e).then(function(o){a.resolve(o.data)},function(o){a.reject(o.data)}),a.promise},delete:function(o){var e=t.defer();return r.delete(o).then(function(o){e.resolve(o.data)},function(o){e.reject(o.data)}),e.promise}}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/anuncio/produto/:idproduto/stock",{controller:"AnuncioMarketEstoqueCtrl",templateUrl:"angular/app/market/anuncio/partials/stock.tpl.html",tabControl:"Market",title:"Controle de estoque"}).when("/anunciar/type/:tipousuario/old",{controller:"AnuncioMarketCtrl",templateUrl:"angular/app/market/anuncio/partials/criar.tpl.html",tabControl:"Market",title:"Market"}).when("/consignar/type/:tipousuario",{controller:"AnuncioMarketCtrl",templateUrl:"angular/app/market/anuncio/partials/criar.tpl.html",tabControl:"Market",title:"Consignação"}).when("/anunciar/type/:tipousuario/produto/:idproduto/editar/old",{controller:"AnuncioMarketCtrl",templateUrl:"angular/app/market/anuncio/partials/editar.tpl.html",tabControl:"Market",title:"Market"}).when("/consignar/type/:tipousuario/produto/:idproduto/editar",{controller:"AnuncioMarketCtrl",templateUrl:"angular/app/market/anuncio/partials/editar.tpl.html",tabControl:"Market",title:"Market"}).when("/anunciar/type/:tipousuario/produto/:idproduto/dadosopcionais/tipo/:tipo",{controller:"AnuncioMarketCtrl",templateUrl:"angular/app/market/anuncio/partials/optional.tpl.html",tabControl:"Market",title:"Market"}).when("/anunciar",{controller:["$rootScope",function(o){o.irParaAnunciar()}],template:"<div></div>",tabControl:"Busca",title:"Buscar"}).when("/anuncios",{controller:["$rootScope","AuthFactory",function(o,e){e.isLoggedIn()?0<e.get().idCliente?o.irPara("/market/cliente/produtos"):o.irPara("/market/loja/produtos"):o.irPara("market")}],template:"<div></div>",tabControl:"Market",title:"Market"}).when("/market/anuncios",{controller:"AnunciosCtrl",templateUrl:"angular/app/market/anuncio/partials/list.tpl.html",tabControl:"Market",title:"Anúncios"}).when("/anunciar/type/:tipousuario",{controller:"AnuncioCreateCtrl",templateUrl:"angular/app/market/anuncio/partials/criarv2.tpl.html",tabControl:"Market",title:"Market"}).when("/anunciar/type/:tipousuario/produto/:idproduto/editar",{controller:"AnuncioCreateCtrl",templateUrl:"angular/app/market/anuncio/partials/editarv2.tpl.html",tabControl:"Market",title:"Market"})}]).controller("AnuncioMarketEstoqueCtrl",["$scope","$rootScope","$timeout","$routeParams","$mdDialog","AnuncioMarketService","AuthFactory",function(r,e,o,a,t,n,i){r.dados={},r.tamanhosNaoSelecionados=[],r.idProduto=0,r.carregar=function(){r.carregando=!0,r.erro=!1,r.idProduto=a.idproduto,n.obterDetalhesEstoque(r.idProduto).then(function(o){r.dados=o,r.showAddSize=o.tipoProduto.temTamanhos}).catch(function(o){e.showToast("Erro ao carregar dados de estoque do anúncio"),e.voltarPagina(),r.erro=!0}).finally(function(){r.carregando=!1})},r.adicionarQuantidade=function(o){o.quantidade<100&&o.quantidade++},r.removerQuantidade=function(o){0<o.quantidade&&o.quantidade--},r.removerTamanhoGrade=function(o){o=r.dados.tamanhosSelecionados.indexOf(o);r.dados.tamanhosSelecionados.splice(o,1)},r.showAdicionarTamanhoGrade=function(){r.tamanhosNaoSelecionados=r.obterTamanhosNaoSelecionados(),r.showAddSizeSpace=!0},r.colocaNovoTamanhoGrade=function(o){r.showAddSizeSpace=!1;var e={quantidade:1};e.idTamanhoProduto=o.id,e.isAtivo=!0,e.titulo=o.titulo,e.tituloUs=o.tituloUs,r.dados.tamanhosSelecionados.push(e)},r.hideShowAddSizeSpace=function(){r.showAddSizeSpace=!1},r.obterTamanhosNaoSelecionados=function(){var o,a=[];return 0==r.dados.tamanhosSelecionados.length?a=r.dados.tipoProduto.Tamanhos:(o=r.dados.tipoProduto.Tamanhos,angular.forEach(o,function(e,o){null==r.dados.tamanhosSelecionados.find(function(o){return o.idTamanhoProduto==e.id})&&a.push(e)},[]),a)},r.salvarDados=function(o){r.salvando=!0,n.editarEstoque(r.idProduto,o).then(function(o){e.irPara("/market/anuncios")}).catch(function(o){e.showToast(o||"Ops, algo de errado aconteceu ao carregar dados de estoque do anúncio"),r.erro=!0}).finally(function(){r.salvando=!1})},r.irParaEdicaoAnuncio=function(){var o="anunciar/type/"+(0<i.get().idCliente?1:2)+"/produto/"+r.idProduto+"/editar";e.irPara(o)}}]).controller("AnuncioMarketCtrl",["$scope","$rootScope","$timeout","$routeParams","$mdDialog","$location","CkMasksService","AppleMapKit","AnuncioMarketService","CategoriaService","AuthFactory","DropService","CkImageSelector","mpTaxa",function(t,n,o,e,i,a,r,c,s,l,d,u,p,f){t.isConsignacao=-1<a.path().indexOf("consignar"),t.mpTaxa=f,window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!1),t.condicoesDisponiveis=[{text:"NOVO com tag (DSWT)",value:1},{text:"NOVO (SEM USO)",value:2},{text:"SEMI-NOVO (9.5/10)",value:3},{text:"USADO (9/10)",value:4},{text:"USADO (8/10)",value:5},{text:"USADO (7/10)",value:6}],t.boxDisponiveis=[{text:"Box original",value:1},{text:"Box replace",value:2},{text:"Box danificada",value:3},{text:"Sem box",value:4}],t.preCondicoes=function(){d.isLoggedIn()||(n.irPara("market"),n.showToast("Sessão encerrada"))},t.objectIndexOf=function(e,o){return null==o||0==o.length?-1:o.findIndex(function(o){return o.idTamanhoProduto==e.idTamanhoProduto})},t.objectToggle=function(o,e){var a={},o=(a.idTamanhoProduto=o,a.quantidade=1,t.objectIndexOf(a,e));-1<o?e.splice(o,1):e.push(a)},t.existeNoArray=function(o,e){var a={};return a.idTamanhoProduto=o,-1<t.objectIndexOf(a,e)},t.alterarImagem=function(){n.showImageSelector(32e4,1200).then(function(o){t.dadosProduto.linkfoto=o}).catch(function(o){n.showToast("Erro ao atualizar wallpaper")})},t.selecionarPacotePadrao=function(o){t.dadosProduto.peso=o.Peso,t.dadosProduto.altura=o.Altura,t.dadosProduto.comprimento=o.Comprimento,t.dadosProduto.largura=o.Largura},t.abrirDialogModoViagem=function(){i.show({templateUrl:"angular/app/market/anuncio/partials/dialog/modoViagemDialog.tpl.html",clickOutsideToClose:!window.cordova,parent:angular.element(document.body),fullscreen:!1})},t.dropSelected=null,t.precoDrop=null,t.carregandoPrecoDrop=!1,t.pesquisarDropPorTermo=function(o){return t.dadosProduto.nome=o,u.pesquisar(o,0)},t.dropSelecionarItem=function(o){null!=o&&(t.dadosProduto.nome=o.titulo,t.dadosProduto.idDrop=o.id,t.dropSelected=o)},t.dropApagarSelecionado=function(){t.dadosProduto.idDrop=null,t.dropSelected=null,t.precoDrop=null},t.showSelected=function(){return null!=t.dropSelected&&null!=t.dropSelected},t.carregarPrecoDrop=function(o){t.carregandoPrecoDrop=!0,u.obterPreco(o).then(function(o){t.precoDrop=o}).catch(function(){t.precoDrop=null}).finally(function(){t.carregandoPrecoDrop=!1})},t.carregarValorMercadoDrop=function(o){o&&o.id&&(t.carregandoPrecoDrop=!0,u.obterValorDeMercado(o.id).then(function(o){t.valorMercadoDrop=o.valorMercado}).catch(function(o){console.error("VALOR_MERCADO",o),t.valorMercadoDrop=null}).finally(function(){t.carregandoPrecoDrop=!1}))},t.showAjudaFreteGratis=function(){i.show({templateUrl:"angular/app/market/anuncio/partials/dialog/ajudaFreteGratisDialog.tpl.html",clickOutsideToClose:!window.cordova,parent:angular.element(document.body),fullscreen:!1})},t.showAjudaFreteSeguro=function(){i.show({templateUrl:"angular/app/market/anuncio/partials/dialog/ajudaFreteComSeguro.tpl.html",clickOutsideToClose:!window.cordova,parent:angular.element(document.body),fullscreen:!1})},t.carregarNovoAnuncio=function(){t.configurando=!0,s.obterConfiguracaoAnuncio().then(function(o){t.tiposProduto=o.tiposProduto,t.condicoes=o.condicoes,t.selecionandoTipoProduto=!0,t.tipoAnunciante=e.tipousuario,t.dadosProduto={},t.dadosProduto.linkfoto="https://droper-media.us-southeast-1.linodeobjects.com/1862022175626785.webp",t.dadosProduto.TamanhoProdutoSelecao=[],t.dadosProduto.peso=null,t.dadosProduto.altura=null,t.dadosProduto.largura=null,t.dadosProduto.comprimento=null,t.dadosProduto.isFreteSeguro=!0,t.configurando=!1,t.obterLojas()}).catch(function(o){n.showToast("Erro ao carregar criação de anúncio"),n.voltarPagina()})},t.carregarConfiguracaoAnuncio=function(o){t.selecionandoTipoProduto=!1,t.pacotes=o.opcoesPacote,t.tipoProdutoTitulo=o.titulo,t.tamanhosDisponiveis=o.Tamanhos,t.dadosProduto.TamanhoProdutoSelecao=[],t.dadosProduto.idDrop=null,t.temTamanhos=o.temTamanhos,t._tipoProduto=o},t.carregaCategoriasProduto=function(){return t.carregandoCategoriasDisponiveis=!0,t.categoriasDisponiveis={},l.obterCategorias(d.get().idLoja).then(function(o){t.categoriasDisponiveis=o,t.mostrarPrimeiraCategoria=0==o.length}).finally(function(){t.carregandoCategoriasDisponiveis=!1})},t.salvarProduto=function(o){t.salvandoDadosProduto=!0,t.erroConsignacaoSemEmpresa=!1;var e=d.get().id;"1"===t.tipoAnunciante?o.idCliente=d.get().idCliente:"2"===t.tipoAnunciante&&(o.idLoja=d.get().idLoja),t.isConsignacao?t.salvarConsignacao():s.salvarProduto(e,o,t.tipoAnunciante).then(function(o){t.dadosProduto.id=o.id,n.showToast("Anúncio cadastrado com sucesso!"),n.irPara("anunciar/type/"+t.tipoAnunciante+"/produto/"+t.dadosProduto.id+"/dadosopcionais/tipo/criacao"),t.salvandoDadosProduto=!1}).catch(function(o){var o=(o.Message||o).split(),e=o.filter(o=>!o.startsWith("#")).join(" ");-1!==o.filter(o=>o.startsWith("#")).indexOf("#consig_sem_empresa")&&(t.erroConsignacaoSemEmpresa=!0,alert("VOCÊ NÃO TEM EMPRESA")),t.salvandoDadosProduto=!1,n.formErrorBinder(t,e),n.showToast(e)})},t.carregarEdicao=function(){t.carregandoEdicao=!0,t.tipoAnunciante=e.tipousuario,s.obterProduto(e.idproduto).then(function(o){t.dadosProduto=o.produto,t.dadosProduto.linkfoto=o.produto.fotoPrincipal,t.nomesearch=o.produto.nome,t.isConsignacao=t.isConsignacao||o.produto.isConsignacao,t.carregarEdicaoTamanhos(o.produto.idTipoProduto,o.produto.TamanhoProdutoSelecao),t.dropSelected=o.produto.Drop}).catch(function(o){n.showToast("Ops, algo de errado aconteceu")}).finally(function(o){t.carregandoEdicao=!1})},t.carregarEdicaoTamanhos=function(o,a){t.carregandoInputTamanhoSelecao=!0,s.obterTipoProduto(o).then(function(o){t._tipoProduto=o,t.pacotes=o.opcoesPacote,t.temTamanhos=o.temTamanhos,t.tamanhosDisponiveis=o.Tamanhos,t.dadosProduto.TamanhoProdutoSelecao=[];for(var e=0;a.length>e;e++)t.objectToggle(a[e].id,t.dadosProduto.TamanhoProdutoSelecao)}).catch(function(o){}).finally(function(){t.carregandoInputTamanhoSelecao=!1})},t.salvarEdicao=function(o){t.salvandoEdicaoDadosProduto=!0,t.isConsignacao?t.editarConsignacao(o):s.salvarEdicao(o,t.tipoAnunciante).then(function(o){n.showToast("Anúncio editado com sucesso"),n.irPara("/market/anuncios")}).catch(function(o){t.salvandoEdicaoDadosProduto=!1,n.showToast("Verifique os erros"),n.formErrorBinder(t,o)})},t.syncCondicao=function(o,e){return parseInt(o.value)==parseInt(e)},t.fotosTenisLegenda=[{foto:"angular/img/market/externo.png",legenda:"Adicione uma foto das laterais externas"},{foto:"angular/img/market/lateralinterno.png",legenda:"Adicione uma foto das laterais internas"},{foto:"angular/img/market/heel.png",legenda:"Adicione uma foto do salto"},{foto:"angular/img/market/sole.png",legenda:"Adicione uma foto dos solados"},{foto:"angular/img/market/tag.png",legenda:"Adicione uma foto tag interna"},{foto:"angular/img/market/caixa.png",legenda:"Adicione uma foto da caixa"}],t.fotosSmartphoneLegenda=[{foto:"angular/img/market/tela.png",legenda:"Adicione uma foto da tela"},{foto:"angular/img/market/conector.png",legenda:"Adicione uma foto dos conectores"},{foto:"angular/img/market/camera.png",legenda:"Adicione uma foto da câmera"},{foto:"angular/img/market/botaoonoff.png",legenda:"Adicione uma foto do botão de liga/desliga"},{foto:"angular/img/market/botoesvolume.png",legenda:"Adicione uma foto dos botões de aumentar e baixar o volume"},{foto:"angular/img/market/riscos.png",legenda:"Adicione uma foto dos riscos da tela"},{foto:"angular/img/market/bateria.png",legenda:"Adicione uma foto da página da saúde da bateria"}],t.carregarAnuncioOptional=function(){t.carregandoAnuncioOptional=!0,t.tipoAnunciante=e.tipousuario,s.obterProduto(e.idproduto).then(function(o){t.dadosProduto=o.produto,t.tipoGerenciamento=e.tipo}).catch(function(o){n.showToast("Ops, algo de errado aconteceu")}).finally(function(){t.carregandoAnuncioOptional=!1})},t.adicionarMidia=function(e){n.showImageSelector(3e5,800).then(function(o){t.carregandoNovaMidia=!0,t.salvarMidiaAdicional(e,o)}).catch(function(o){t.carregandoNovaMidia=!1,n.showToast(o||"Ops, algo de errado aconteceu ao adicionar uma mídia")})},t.adicionarMuitasMidias=function(e){var o=p.new().maxsize(614400).maxwidth(800).iconsize(81920).iconwidth(70).max(10).map(function(o){return{img:o.img?o.img.url:"",icon:o.icon?o.icon.url:""}});p.show(o).then(function(o){t.salvarMuitasMidiasAdicionais(e,o)}).catch(function(){})},t.recarregaMidias=function(){s.obterProduto(e.idproduto).then(function(o){t.carregandoNovaMidia=!1,t.dadosProduto.fotoSecundarias.concat(o.produto.fotoSecundarias)})},t.salvarMidiaAdicional=function(o,e){s.salvarMidiaProduto(o,e).then(function(o){t.dadosProduto.fotoSecundarias.push(o)}).catch(function(o){n.showToast(o||"Ops, algo de errado aconteceu ao adicionar uma mídia")}).finally(function(){t.carregandoNovaMidia=!1})},t.salvarMuitasMidiasAdicionais=function(o,e){t.carregandoNovaMidia=!0,s.salvarMuitasMidiasProduto(o,e).then(function(o){var e=t.dadosProduto.fotoSecundarias;t.dadosProduto.fotoSecundarias=e.concat(o)}).catch(function(o){console.error("MIDIAS",o),n.showToast(o||"Ops, algo de errado aconteceu ao adicionar estas fotos")}).finally(function(){t.carregandoNovaMidia=!1})},t.excluirMidia=function(o,e,a,r){a=i.confirm().title("Exclusão").textContent("Você tem certeza que quer excluir essa foto?").ariaLabel("Excluir mídia").targetEvent(a).ok("Sim").cancel("Não");i.show(a).then(function(){t.dadosProduto.fotoSecundarias.splice(r,1),s.excluirMidiaProduto(e,o).then(function(o){n.showToast("Foto excluída"),t.recarregaMidias()}).catch(function(o){n.showToast("Erro ao excluir foto. Tente novamente mais tarde.")})},function(){})},t.isTamanhoRelevante=function(o){return"36"===o.titulo},t.scrollAteTamanho=function(o){!t.scrollTamanhosIniciado&&1&&(t.scrollTamanhosIniciado=n.scrollToItem(".ck-produto__tamanho--space",".ck-produto__tamanho--table-button--last",6,o,-25,"horizontal"))},t.iniciarCSU=void t.preCondicoes(),t.listaLojas=[],t.selecionarLoja=function(o){t.lojaSelecionada=o,t.temLojaSelecionada=!0},t.isStepConsignacao=function(){return!t.isConsignacao||!(!t.isConsignacao||!t.temLojaSelecionada)},t.salvarConsignacao=function(){t.salvandoDadosProduto=!0;var o={idLojaFisica:t.lojaSelecionada.id,produto:t.dadosProduto};s.criarConsignacao(o).then(function(o){n.showToast("Pedido de consignação registrado"),n.irPara("anunciar/type/"+t.tipoAnunciante+"/produto/"+o.produto.id+"/dadosopcionais/tipo/criacao")}).catch(function(o){var o=(o.Message||o).split(" "),e=o.filter(o=>!o.startsWith("#")).join(" ");-1!==o.filter(o=>o.startsWith("#")).indexOf("#consig_sem_empresa")?t.erroConsignacaoSemEmpresa=!0:(n.formErrorBinder(t,e),n.showToast(e)),t.salvandoDadosProduto=!1}).finally(function(){t.salvandoDadosProduto=!1})},t.editarConsignacao=function(o){t.salvandoEdicaoDadosProduto=!0;var e={id:o.idConsignacao,produto:o};s.editarConsignacao(e.id,e).then(function(o){n.showToast("Pedido de consignação editado."),n.irPara("/consignacao/"+e.id+"/view")}).catch(function(o){n.formErrorBinder(t,o),n.showToast(o.Message||o)}).finally(function(){t.salvandoEdicaoDadosProduto=!1})},t.objectIndexOf2=function(e,o){return null==o||0==o.length?-1:o.findIndex(function(o){return o.idTamanhoProduto==e.idTamanhoProduto})},t.objectToggle2=function(o,e){var a={},o=(a.idTamanhoProduto=o,a.quantidade=1,t.objectIndexOf2(a,e));0!==e.length&&e.splice(o,1),e.push(a)},t.existeNoArray2=function(o,e){var a={};return a.idTamanhoProduto=o,-1<t.objectIndexOf(a,e)},t.obterLojas=function(){t.carregandoLojas=!0,s.obterLojas().then(function(o){t.listaLojas=o.lojas}).catch(function(o){n.formErrorBinder(t,o),n.showToast(o.Message||o)}).finally(function(){t.carregandoLojas=!1})},t.openLojaDialog=function(o){var e=t.$new();t.lojaDetails=o,i.show({controller:"LojaFisicaDetalhesCtrl",templateUrl:"angular/app/consignacao/partials/lojaFisicaDetalhes.tpl.html",clickOutsideToClose:!window.cordova,parent:angular.element(document.body),scope:e,preserveScope:!1,fullscreen:!1})},t.maskNovoPayout=function(){var o=r.monetario(t.dadosProduto.preco);t.dadosProduto.preco!==o&&(t.dadosProduto.preco=o,t.precoNum=t.str2num(o))},t.str2num=function(o){try{if(o&&o.length)return parseFloat(o.replaceAll(".","").replace(",","."))}catch(o){return 0}},t.onPrecoChange=function(){t.precoNum=t.str2num(t.dadosProduto.preco||"")}}]).controller("AnunciosCtrl",["$scope","$rootScope","$location","$mdMedia","$routeParams","$mdDialog","ListaProdutosClienteService","AnuncioMarketService","AuthFactory","$mdBottomSheet","$timeout","CkViewState",function(l,a,o,e,r,t,n,i,d,c,s,u){var p=null,f=(l.A=1,l.E=2,l.AA=3,l.AF=4,l.I=5,l.$mdMedia=e,l.produtos={},l.modoViagem=!1,l.erro="",l.buscarInativos=!1,l.salvandoModoViagem=!1,l.termoPesquisa="",0),e=(l.visualizacao={categoria:1,pagina:{}},o.path()),m="market/anuncios"===e||"/market/anuncios"==e;function g(o,e){l.visualizacao={categoria:o,pagina:e}}function h(o,e,a){for(var r=null,t=[],n=0;n<e.produtos.length;n++){var i=e.produtos[n];i.id===o?r=i:t.push(i)}return r&&(a.produtos=[r].concat(a.produtos),a.total+=1,e.produtos=t,--e.total,1)}l.preCondicoes=function(){var o;d.isLoggedIn()?(o=u.anuncios(),m&&o&&o.changed?(u.restoreScope(o.scope,l),window.setTimeout(function(){window.scroll(o.scroll.x,o.scroll.y),new Promise(function(c,o){function s(e){return Object.keys(e).filter(function(o){return e[o]&&e[o].total}).map(function(o){return{key:o,total:e[o].total}})}var e=d.get();l.carregandoSecundario=!0,i.listarProdutos(e.id,p,l.termoPesquisa).then(function(o){for(var e=s(l.produtos),a=s(o),r=o.usuarioEmModoViagem,t=(l.modoViagem,0);t<a.length;t++){var n=a[t],i=e.find(function(o){return o.key===n.key});if(n.total!==i.total){0;break}}l.produtos=o,l.modoViagem=o.usuarioEmModoViagem,l.ver(l.visualizacao.categoria),c({alterou:!0,dados:o})}).catch(function(o){c({alterou:!1})}).finally(function(){l.carregandoSecundario=!1})})},300)):l.carregaProdutos(!0)):(a.showToast("Sessão encerrada"),a.irPara("market"))},l.$on("$destroy",function(){var o;m&&(o={scope:l,scroll:{x:window.scrollX,y:window.scrollY}},u.anuncios(o))}),l.carregaProdutos=function(o){o?l.carregando=!0:l.carregandoSecundario=!0;o=d.get();i.listarProdutos(o.id,p,l.termoPesquisa).then(function(o){l.produtos=o,l.modoViagem=o.usuarioEmModoViagem,l.taxaPlataforma=o.taxaPlataforma,g(1,l.produtos.aprovados)}).catch(function(o){l.erro=o}).finally(function(){l.carregando=!1,l.carregandoSecundario=!1})},l.agendarPesquisa=function(){window.clearTimeout(f);f=window.setTimeout(function(){l.carregaProdutos(!1)},600)},l.ver=function(o){switch(o){case 1:g(1,l.produtos.aprovados);break;case 2:g(2,l.produtos.reprovados);break;case 3:g(3,l.produtos.aguardandoAprovacao);break;case 4:g(4,l.produtos.aguardandoFotos);break;case 5:g(5,l.produtos.inativos)}},l.vendo=function(o){return l.visualizacao.categoria===o},l.desativarProduto=function(e){i.alterarStatus(e,"inativo").then(function(o){h(e,l.visualizacao.pagina,l.produtos.inativos)||l.carregaProdutos(),a.showToast("Anúncio desativado!")})},l.ativarProduto=function(e){i.ativarProduto(e).then(function(o){h(e,l.produtos.inativos,l.produtos.aguardandoAprovacao)||l.carregaProdutos(),a.showToast("Anúncio reativado!")}).catch(function(o){a.showToast(o)})},l.irParaEditarPreco=function(o,e){l.dialogEditPreco(o,e)},l.dialogEditPreco=function(o,e){o={controller:"AnuncioEditPrecoCtrl",templateUrl:"angular/app/market/anuncio/partials/dialog/edicaoPrecoDialogV2.tpl.html",parent:angular.element(document.body),targetEvent:o,clickOutsideToClose:!window.cordova,fullscreen:!1,locals:{produto:e,taxaPlataforma:l.taxaPlataforma}};t.show(o).then(function(o){},function(){})},l.cancel=function(){t.cancel()},l.excluirAnuncio=function(o){i.excluirAnuncio(o.id).then(function(o){l.carregaProdutos(),a.showToast("Anúncio excluído permanentemente")})},l.toogleProdutosStatus=function(){"ativos"===l.statusmostrando?(l.produtos=l.produtosInativos,l.statusmostrando="inativos"):(l.statusmostrando="ativos",l.produtos=l.produtosAtivos)},l.toogleVendidoStatus=function(o,e){n.toogleStatusVendido(o,e).then(function(o){l.carregaProdutos(),a.showToast(o)}).catch(function(o){a.showToast(o)})},l.toogleVisualizacaoStatusRegistro=function(){l.buscarInativos=!l.buscarInativos,l.carregaProdutos()},l.resolveImagemProduto=function(o,e){return 0<e.indexOf("//")?e:"angular/img/default.jpg"},l.btncolor=function(o){return l.vendo(o)?"md-primary":"md-secondary"},l.exibirDialogModoViagem=function(o){o={controller:"AnuncioModoViagemDialogCtrl",templateUrl:"angular/app/market/anuncio/partials/dialog/modoViagemDialog.tpl.html",parent:angular.element(document.body),targetEvent:o,clickOutsideToClose:!window.cordova,fullscreen:!1,locals:{usuarioEmModoViagem:l.modoViagem}};t.show(o).then(function(o){l.modoViagem=o},function(){})},l.desabilitarModoViagem=function(){l.desabilitandoModoViagem=!0,i.setModoViagem(!1).then(function(o){l.modoViagem=!1,a.showToast("Você não está mais no modo viagem")}).catch(function(o){a.showToast(o)}).finally(function(){l.desabilitandoModoViagem=!1})},l.iniciarCSU=void l.preCondicoes()}]).controller("AnuncioEditPrecoCtrl",["$scope","$rootScope","$mdDialog","$routeParams","AnuncioMarketService","CkMasksService","produto","taxaPlataforma",function(e,a,r,o,t,n,i,c){e.produtoOriginal=i,e.dadosProduto={id:i.id,preco:i.preco,condicao:i.condicao,Drop:i.Drop,TamanhoProdutoSelecao:i.TamanhoProdutoSelecao},e.taxaText=(100*c).toString(),e.salvando=!1,l();{e.carregandoDadosDeMercado=!0;var i=e.dadosProduto.Drop||{},s=(s=e.dadosProduto.TamanhoProdutoSelecao||[]).map(o=>o.id);let o=null;1<=e.dadosProduto.condicao&&(o="novo"),3<=e.dadosProduto.condicao&&(o="usado"),i.id?t.obterDadosMercadoDoDrop(i.id,s,o).then(function(o){e.dadosDeMercado=o}).catch(function(o){}).finally(function(){e.carregandoDadosDeMercado=!1}):e.carregandoDadosDeMercado=!1}function l(){var o=e.dadosProduto.preco.replaceAll(".","");e.precoComTaxaAplicada=a.calcularTaxa(o,c)}e.salvarEdicaoPreco=function(){e.salvando=!0;var o=(e.dadosProduto.preco||"").replaceAll(".","");t.editarPreco(e.dadosProduto.id,o).then(function(o){e.produtoOriginal.preco=e.dadosProduto.preco,a.showToast("Anúncio editado com sucesso"),r.hide()}).catch(function(o){a.showToast(o),a.formErrorBinder(e,o)}).finally(function(){e.salvando=!1})},e.maskPreco=function(){var o=n.monetario(e.dadosProduto.preco);e.dadosProduto.preco!==o&&(e.dadosProduto.preco=o),l()}}]).controller("AnuncioModoViagemDialogCtrl",["$scope","$rootScope","$mdDialog","AnuncioMarketService","usuarioEmModoViagem",function(o,a,r,t,e){o.modoViagem=!!e,o.salvando=!1,o.setModoViagem=function(e){o.salvando=!0,t.setModoViagem(e).then(function(o){e?a.showToast("Agora você está no modo viagem"):a.showToast("Você não está mais no modo viagem"),r.hide(e)}).catch(function(o){a.showToast(o)}).finally(function(){o.salvando=!1})}}]).controller("AnuncioCreateCtrl",["$scope","$rootScope","$location","$mdMedia","$routeParams","$mdDialog","AnuncioMarketService","AuthFactory","CkMasksService","CkViewUtils",function(d,r,o,e,a,t,n,i,c,s){console.info("ANUNCIAR [applemarket]"),d.mdMedia=e,d.isConsignacao=-1<o.path().indexOf("consignar"),d.tipoAnunciante=a.tipousuario,d.isEdit=a.idproduto;const l=!1,u={Cliente:"1",Loja:"2"},p={Novo:"novo",Usado:"usado"},f={ComoFunciona:"comofunciona",EscolhendoTipo:"escolhendotipo",EscolhendoDrop:"escolhendodrop",PreenchendoForm:"form",Erro:"erro"};d.UIState=f,d.Condicao=p,d.uiState=f.ComoFunciona,d.iniciando=!1,d.buscandoDrop=!1,d.carregandoDadosDeMercado=!1,d.enviandoFoto=!1,d.formconfig={},d.temDrops=!0,d.drops=[],d.dropsPage=0,d.categorias=[],d.tiposProdutosDisponiveis=[],d.possiveisAvarias=[],d.dadosDeMercado=null,d.precoComTaxaAplicada=null,d.categoriaSelecionada=null,d.dropSelecionado=null,d.tipoProdutoSelecionado=null,d.grupoCondicaoSelecionada=null,d.condicaoSelecionada=null,d.boxSelecionada=null,d.categoriaSelecionada=null,d.tamanhosSelecionados=[],d.avariasSelecionadas=[],d.dadosProduto={isFreteSeguro:!0},d.nBoxSelecionada=null;let m=d.nTipoProdutoSelecionado=null;e=h();function g(o){d.uiState=o}function h(){return window.localStorage.getItem("exibirComoVender")}function v(){d.drops=[],d.dropsPage=0,d.temDrops=!0,d.dropQuery=null}function w(o){d.temDrops=!0,d.dropQuery=o;var e=((d.categoriaSelecionada||{}).tiposProduto||[]).map(o=>o.id).reduce((o,e)=>o+","+e,"");n.searchDrop(o,e,d.dropsPage).then(function(o){d.drops=(d.drops||[]).concat(o.drops),d.temDrops=d.drops&&d.drops.length,d.temMaisDrops=o.temMais,d.dropsPage+=1,y("> PAGE",o)}).catch(function(o){r.showToast(o),console.error(o)}).finally(function(){d.buscandoDrop=!1,d.vendoMaisDrops=!1})}function C(){d.carregandoDadosDeMercado=!0;var e=d.dropSelecionado||{},a=d.tamanhosSelecionados||[],r=(d.categoriaSelecionada,d.grupoCondicaoSelecionada||{}),t=r===p.Novo,r=r===p.Usado;if(e.id){let o=null;t?o="novo":r&&(o="usado"),n.obterDadosMercadoDoDrop(e.id,a,o).then(function(o){y("> DADOS DE MERCADO",d.dadosDeMercado=o)}).catch(function(o){}).finally(function(){d.carregandoDadosDeMercado=!1})}}function b(){var o=function(){var o=i.get(),e={idCliente:null,idLoja:null};d.tipoAnunciante===u.Cliente&&(e.idCliente=o.idCliente);d.tipoAnunciante===u.Loja&&(e.idLoja=o.idLoja);return e}(),e=d.dadosProduto||{},a=d.dropSelecionado||{},r=d.tipoProdutoSelecionado||{},t=d.tamanhosSelecionados||[];return{id:e.id,idTipoProduto:r.id,idDrop:a.id,idCliente:o.idCliente,idLoja:o.idLoja,nome:a.titulo||e.nome,descricao:e.descricao,linkfoto:e.linkfoto,condicao:e.condicao,preco:(e.preco||"").replaceAll(".",""),statusBox:e.statusBox,peso:e.peso,altura:e.altura,largura:e.largura,comprimento:e.comprimento,precoCusto:e.precoCusto,isFreteSeguro:e.isFreteSeguro,permiteEntregaGratis:e.permiteEntregaGratis,comprovanteCompra:e.comprovanteCompra,TamanhoProdutoSelecao:t.map(o=>({idTamanhoProduto:o,quantidade:1}))}}function S(o,e){var a=i.get().id,r=d.tipoAnunciante;return n.salvarProdutoV3(a,o,r,e)}function P(o,e){var a=d.lojaSelecionada||{};n.criarConsignacao({idLojaFisica:a,produto:o})}function y(o,...e){l&&(e&&e.length?console.log(o,...e):console.log(o))}e&&(e=new Date(parseInt(e)),o=new Date,e<=o?window.localStorage.removeItem("exibirComoVender"):g(f.EscolhendoTipo)),d.iniciando=!0,n.obterFormConfig().then(function(o){d.formconfig=o,d.categorias=o.categorias,d.isEdit&&d.carregarEdicao(),y("> FORMCONFIG",o)}).catch(function(o){g(f.Erro)}).finally(function(){d.iniciando=!1}),d.irParaEstado=g,d.voltarEstado=function(){switch(d.uiState){case f.ComoFunciona:case f.EscolhendoTipo:r.voltarPagina();break;case f.EscolhendoDrop:d.dadosDeMercado=null,d.categoriaSelecionada=null,v(),g(f.EscolhendoTipo);break;case f.PreenchendoForm:d.dropSelecionado=null,d.dadosDeMercado=null,d.tipoProdutoSelecionado=null,d.grupoCondicaoSelecionada=null,d.condicaoSelecionada=null,d.boxSelecionada=null,d.tamanhosSelecionados=[],d.avariasSelecionadas=[],d.dadosProduto={},g(f.EscolhendoDrop)}},d.continuarCadastro=function(){var o;h()||(o=(o=new Date).setDate(o.getDate()+30),window.localStorage.setItem("exibirComoVender",o)),g(f.EscolhendoTipo)},d.selecionarCategoria=function(o){d.categoriaSelecionada=o,d.tipoProdutoSelecionado=null,(o=d.categoriaSelecionada||{})&&g(d.UIState.EscolhendoDrop),y("> CATEGORIA",d.categoriaSelecionada)},d.buscarDrop=function(o){window.clearTimeout(m),m=window.setTimeout(function(){d.buscandoDrop=!0,v(),w(o)},600)},d.verMaisDrops=function(){d.vendoMaisDrops=!0,w(d.dropQuery)},d.selecionarDrop=function(e,o){var a=((d.categoriaSelecionada||{}).tiposProduto||[]).find(o=>o.id===e.idTipoProduto),a=(d.dropSelecionado=e,d.tipoProdutoSelecionado=a,d.tiposProdutosDisponiveis=[],y("DROP SELECIONADO",d.dropSelecionado),d.dropSelecionado&&g(f.PreenchendoForm),(a||{}).possiveisAvarias||[]),r=(e||{}).listaPossiveisAvarias||[];d.possiveisAvarias=a.concat(r).map(o=>({desc:o})),o||C(d.dropSelecionado),y("> DROP",d.dropSelecionado),y("> TIPOPRODUTO",d.tipoProdutoSelecionado),y("> POSSIVEIS AVARIAS",d.possiveisAvarias)},d.selecionarAvulso=function(){var o=(d.categoriaSelecionada||{}).tiposProduto||[];d.dropSelecionado=null,d.tipoProdutoSelecionado=null,d.tiposProdutosDisponiveis=o,g(f.PreenchendoForm),y("> AVULSO")},d.selecionarTipoProduto=function(o){d.tipoProdutoSelecionado=o,d.tamanhosSelecionados=[]},d.selecionarTamanho=function(e,o){var a=(d.categoriaSelecionada||{}).tamanhoUnico||!1,r=(d.tamanhosSelecionados=d.tamanhosSelecionados||[],d.isTamanhoSelecionado(e));r?d.tamanhosSelecionados=d.tamanhosSelecionados.filter(o=>o!==e.id):a?d.tamanhosSelecionados=[e.id]:d.tamanhosSelecionados.push(e.id),o||C()},d.isTamanhoSelecionado=function(e){return(d.tamanhosSelecionados||[]).some(o=>o===e.id)},d.selecionarGrupoCondicao=function(o){d.grupoCondicaoSelecionada=o,d.dadosProduto.condicao=null,C(d.dropSelecionado)},d.isGrupoCondicaoSelecionada=function(o){return d.grupoCondicaoSelecionada===o},d.selecionarBox=function(o){y("BOX",o),d.dadosProduto.box=o,d.nBoxSelecionada=o},d.adicionarAvaria=function(e){d.isAvariaAdicionada(e)?d.avariasSelecionadas=d.avariasSelecionadas.filter(o=>o.desc!==e.desc):d.avariasSelecionadas.push(e)},d.isAvariaAdicionada=function(e){return d.avariasSelecionadas.some(o=>o.desc===e.desc)},d.enviarFoto=function(){d.enviandoFoto=!1,r.showImageSelector(3e5,800).then(function(o){d.enviandoFoto=!0,d.dadosProduto.linkfoto=o}).catch(function(o){d.enviandoFoto=!1,r.showToast(o||"Ops, algo de errado aconteceu ao adicionar uma mídia")})},d.maskPreco=function(){var o=c.monetario(d.dadosProduto.preco),o=(d.dadosProduto.preco!==o&&(d.dadosProduto.preco=o),d.dadosProduto.preco.replaceAll(".",""));d.precoComTaxaAplicada=r.calcularTaxa(o,d.categoriaSelecionada.fTaxa)},d.showListaAvarias=function(){var o=d.formconfig.habilitarPossiveisAvariasNaEdicao&&d.isGrupoCondicaoSelecionada(p.Usado),e=d.possiveisAvarias.length&&0<d.possiveisAvarias.length;return o&&e},d.salvar=function(){var o,e,a;d.podeSalvar()?(o=b(),e=(d.avariasSelecionadas||[]).map(o=>o.desc),a=d.isConsignacao?P:S,y("SALVANDO",o),d.salvando=!0,a(o,e).then(function(o){r.showToast("Anúncio cadastrado com sucesso!"),r.irPara("anunciar/type/"+d.tipoAnunciante+"/produto/"+o.id+"/dadosopcionais/tipo/criacao")}).catch(function(o){r.formErrorBinder(d,o),r.showToast(o.Message||o)}).finally(function(){d.salvando=!1})):r.showToast("Revise os dados")},d.podeSalvar=function(){var o=b(),e=d.categoriaSelecionada||{},a=(d.tipoProdutoSelecionado||{}).tamanhos||[],a=a&&a.length,r=e.precoMinimo||15,t=e.precoMaximo||1e5,n=!!o.idTipoProduto,i=!!o.nome,c=!!o.preco,s=!!o.linkfoto,l=!!o.condicao,e=!!o.statusBox||!e.precisaInformarBox,a=!a||!!o.TamanhoProdutoSelecao&&0<o.TamanhoProdutoSelecao.length,o=function(o){try{if(o&&o.length)return parseFloat(o.replaceAll(".","").replace(",","."))}catch(o){return 0}}(o.preco);return n&&i&&c&&s&&l&&e&&a&&(r<=o&&o<=t)},d.carregarEdicao=function(){d.carregandoEdicao=!0,d.tipoAnunciante=a.tipousuario,n.obterProduto(a.idproduto).then(function(o){y("PRODUTO EDIÇÃO ",o),d.dadosProduto=o.produto,d.dadosProduto.linkfoto=o.produto.fotoPrincipal,d.dropSelected=o.produto.Drop;for(var e,o=function(e){for(let o=0;o<d.categorias.length;o++)if(d.categorias[o].tiposProduto.some(function(o){return o.id===e.idTipoProduto}))return d.categorias[o]}(d.dadosProduto),a=(d.selecionarCategoria(o),d.dadosProduto.Drop&&d.selecionarDrop(d.dadosProduto.Drop,!0),d.dadosProduto.condicao),o=(d.categoriaSelecionada||{}).condicoes||{novos:[],usados:[]},r=o.novos.some(o=>o.numero===a),r=(o.usados.some(o=>o.numero===a),d.grupoCondicaoSelecionada=r?p.Novo:p.Usado,o=d.categoriaSelecionada.tiposProduto,e=d.dadosProduto.idTipoProduto,o.find(function(o){return o.id===e})),t=(d.selecionarTipoProduto(r),d.dadosProduto.TamanhoProdutoSelecao),n=0;n<t.length;n++)d.selecionarTamanho(t[n],!0);o=d.dadosProduto.avarias,d.avariasSelecionadas=(o||[]).map(o=>({desc:o})),s.esperarElemento(".btn-anuncio-tamanho-last").then(function(o){var e=document.querySelector("#sizes-scroll-container"),a=document.querySelector(".btn-anuncio-tamanho-selected");e&&a&&(a=(a.getBoundingClientRect()||{}).x||0,e.scrollTo(a-50,0))}).catch(function(){}),C(d.dropSelecionado)}).catch(function(o){r.showToast("Ops, algo de errado aconteceu"),g(f.Erro)}).finally(function(o){d.carregandoEdicao=!1})},d.salvarEdicao=function(){d.salvandoEdicaoDadosProduto=!0;var o=b(d.dadosProduto),e=(d.avariasSelecionadas||[]).map(o=>o.desc);n.salvarEdicaoV3(o,d.tipoAnunciante,e).then(function(o){r.showToast("Anúncio editado com sucesso"),r.irPara("/market/anuncios")}).catch(function(o){d.salvandoEdicaoDadosProduto=!1,r.showToast("Verifique os erros"),r.formErrorBinder(d,o)})},d.showAjudaFreteGratis=function(){t.show({templateUrl:"angular/app/market/anuncio/partials/dialog/ajudaFreteGratisDialog.tpl.html",clickOutsideToClose:!window.cordova,parent:angular.element(document.body),fullscreen:!1})},d.showAjudaFreteSeguro=function(){t.show({templateUrl:"angular/app/market/anuncio/partials/dialog/ajudaFreteComSeguro.tpl.html",clickOutsideToClose:!window.cordova,parent:angular.element(document.body),fullscreen:!1})},d.selecionarComprovante=function(){r.showImageSelector(0,0,!0,"file").then(function(o){d.dadosProduto.comprovanteCompra=o}).catch(function(o){console.error(o),r.showToast("Desculpe! Algo deu errado")})}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/market/wc/confirm",{controller:"ContaWirecardCtrl",templateUrl:"angular/app/market/contawirecard/partials/confirm.tpl.html",tabControl:"Market",title:"Confirmação de dados de vendedor"}).when("/market/wc/account",{controller:"ContaWirecardCtrl",templateUrl:"angular/app/market/contawirecard/partials/account.tpl.html",tabControl:"Market",title:"Dados para Nota Fiscal"}).when("/market/wc/empresa",{controller:"ContaWirecardCtrl",templateUrl:"angular/app/market/contawirecard/partials/empresaform.tpl.html",tabControl:"Market",title:"Criando empresa"}).when("/market/wc/empresa/:id",{controller:"ContaWirecardCtrl",templateUrl:"angular/app/market/contawirecard/partials/empresaform.tpl.html",tabControl:"Market",title:"Editando empresa"})}]).controller("ContaWirecardCtrl",["$scope","$rootScope","$routeParams","$location","AuthFactory","ContaWirecardService","$mdDialog","DataValidationService",function(a,r,o,e,t,n,i,c){a.isCliente=!1,a.preCondicoes=function(){t.isLoggedIn()?(0<t.get().idCliente&&(a.isCliente=!0),a.idusuario=t.get().id):(r.voltarPagina(),r.showToast("Você não está logado"))},a.jaTemContaWirecard=!1,a.carregarDetalhesConta=function(){a.carregandoconta=!0,n.obterResumoCadastro(a.idusuario).then(function(o){o.pendencias.temContaWirecard&&(a.jaTemContaWirecard=!0),a.pendencias=o.pendencias,a.conta=o.conta}).catch(function(o){a.erro=!0,r.showToast("Ocorreu um erro ao carregar seus dados. Tente novamente mais tarde!")}).finally(function(){a.carregandoconta=!1})},a.confirmar=function(){a.salvando=!0,n.syncCadastro(a.idusuario).then(function(o){r.showToast("Pronto! Agora você pode continuar anunciando no Droper"),r.irPara("market")}).catch(function(o){r.showToast(o||"Ocorreu um erro ao confirmar seus dados. Verifique seus dados e tente novamente!")}).finally(function(){a.salvando=!1})},a.apagarEmpresa=function(){a.apagandoEmpresa=!0,n.apagarEmpresa(a.idusuario).then(function(o){r.showToast("Dados da empresa excluídos"),r.irPara("market")}).catch(function(o){r.showToast("Ocorreu um erro ao apagar os dados da empresa. Tente novamente mais tarde!")}).finally(function(){a.apagandoEmpresa=!1})},a.carregarDetalhesContaWirecard=function(){a.carregandocontawirecard=!0,n.obterCadastroWirecard(a.idusuario).then(function(o){o.pendencias.temContaWirecard||(a.erro=!0,r.showToast("Você ainda não confirmou sua conta de vendedor. Atualize seu aplicativo e se o erro persistir entre em contato com o suporte!"),r.irPara("market")),a.conta=o.conta,a.temEmpresa=null!=o.conta.company}).catch(function(o){a.erro=!0,alert("Ocorreu um erro ao carregar seus dados de nota fiscal. Tente novamente mais tarde!")}).finally(function(){a.carregandocontawirecard=!1})},a.carregarEmpresa=function(){a.isEdit=!1,a.carregandoconta=!0,a.erro=!1,n.obterEmpresa(a.idusuario).then(function(o){o.temEmpresa&&(a.isEdit=!0),a.dados=o.empresa}).catch(function(o){a.erro=!0}).finally(function(){a.carregandoconta=!1})},a.salvarEmpresa=function(o){a.singleError="";var e=c.validarData(o.dataAberturaDia,o.dataAberturaMes,o.dataAberturaAno);null==e?a.singleError="A data de abertura é inválida":(o.dataAbertura=e,c.validarCNPJ(o.cnpj)?(a.salvando=!0,n.atualizarEmpresa(a.idusuario,o).then(function(o){r.irPara("market/wc/confirm")}).catch(function(o){r.formErrorBinder(a,o),r.showToast("Valide os dados")}).finally(function(){a.salvando=!1})):a.singleError="O CNPJ é inválido")},a.preCondicoes()}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/market/fiscal",{controller:"FiscalCtrl",templateUrl:"angular/app/market/fiscal/partials/show.tpl.html",tabControl:"Market",title:"Confirmação de dados fiscais"}).when("/market/fiscal/empresa",{controller:"FiscalCtrl",templateUrl:"angular/app/market/fiscal/partials/empresaform.tpl.html",tabControl:"Market",title:"Criando empresa"}).when("/market/fiscal/empresa/:id",{controller:"FiscalCtrl",templateUrl:"angular/app/market/fiscal/partials/empresaform.tpl.html",tabControl:"Market",title:"Editando empresa"})}]).controller("FiscalCtrl",["$scope","$rootScope","$routeParams","$location","AuthFactory","FiscalService","$mdDialog","DataValidationService",function(a,r,o,e,t,n,i,c){a.isCliente=!1,a.dados={},a.preCondicoes=function(){t.isLoggedIn()?(0<t.get().idCliente&&(a.isCliente=!0),a.idusuario=t.get().id):(r.voltarPagina(),r.showToast("Você não está logado"))},a.carregarDetalhesConta=function(){a.carregandoconta=!0,n.obterDadosFiscais(a.idusuario).then(function(o){a.conta=o}).catch(function(o){a.erro=!0,r.showToast("Ocorreu um erro ao carregar seus dados. Tente novamente mais tarde!")}).finally(function(){a.carregandoconta=!1})},a.carregarEmpresa=function(){a.isEdit=!1,a.carregandoconta=!0,a.erro=!1,n.obterEmpresa(a.idusuario).then(function(o){o.temEmpresa?(a.isEdit=!0,a.dados=o.empresa):a.dados={}}).catch(function(o){a.erro=!0}).finally(function(){a.carregandoconta=!1})},a.salvarEmpresa=function(o){a.singleError="";var e=c.validarData(o.dataAberturaDia,o.dataAberturaMes,o.dataAberturaAno);null==e?a.singleError="A data de abertura é inválida":(o.dataAbertura=e,c.validarCNPJ(o.cnpj)?(a.salvando=!0,n.atualizarEmpresa(a.idusuario,o).then(function(o){r.irPara("market/fiscal")}).catch(function(o){console.error(o),r.formErrorBinder(a,o),r.showToast("Valide os dados")}).finally(function(){a.salvando=!1})):a.singleError="O CNPJ é inválido")},a.apagarEmpresa=function(){a.apagandoEmpresa=!0,n.apagarEmpresa(a.idusuario).then(function(o){r.showToast("Dados da empresa excluídos"),r.irPara("market")}).catch(function(o){r.showToast("Ocorreu um erro ao apagar os dados da empresa. Tente novamente mais tarde!")}).finally(function(){a.apagandoEmpresa=!1})},r.selecionarCertificado=function(){r.showImageSelector(0,0,!0,"file").then(function(o){a.dados.certificado=o}).catch(function(o){console.error(o),r.showToast("Desculpe! Algo deu errado")})},a.preCondicoes()}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/market/pg/bankaccount/create",{controller:"PagarmeBankAccountCtrl",templateUrl:"angular/app/market/pagarme/partials/formbankaccount.tpl.html",tabControl:"Market",title:"Market"}).when("/market/pg/view",{controller:"PagarmeViewCtrl",templateUrl:"angular/app/market/pagarme/partials/view.tpl.html",tabControl:"Market",title:"Market"}).when("/market/pg/transfer",{controller:"PagarmeSaqueCtrl",templateUrl:"angular/app/market/pagarme/partials/saque.tpl.html",tabControl:"Market",title:"Market"}).when("/market/pg/history",{controller:"PagarmeHistoricoCtrl",templateUrl:"angular/app/market/pagarme/partials/historico.tpl.html",tabControl:"Market",title:"Market"})}]).controller("PagarmeViewCtrl",["$scope","$rootScope","AuthFactory","PagarmeService",function(e,a,o,r){e.carregandoSaldo=!1,e.carregandoConta=!1,e.podeSacar=!1,e.showReceber=!1,e.recebedor=null,e.conta=null,e.recebiveisALiberar=null,e.erroConta=null,e.erroSaldo=null,e.saldoRealClicks=0,e.iniciar=function(){o.isLoggedIn()?(e.idusuario=o.get().id,e.carregarSaldo(),e.carregarContaRecebedor()):(a.voltarPagina(),a.showToast("Você não está logado"))},e.carregarContaRecebedor=function(){e.carregandoConta=!0,r.obterContaRecebedor().then(function(o){(e.recebedor=o)&&(e.conta=o.contaBancaria),e.conta&&o.instituicaoBancaria&&(e.conta.nomeBanco=o.instituicaoBancaria.nome)}).catch(function(o){e.erroConta=o}).finally(function(){e.carregandoConta=!1})},e.carregarSaldo=function(){e.carregandoSaldo=!0,r.obterSaldo().then(function(o){e.saldo=o}).catch(function(o){e.saldoerro=o}).finally(function(){e.carregandoSaldo=!1})},e.carregarAReceber=function(){e.carregandoRecebiveis=!0,r.obterAReceber().then(function(o){e.recebiveisALiberar=o,e.showAReceber=!0}).catch(function(o){e.showAReceber=!1,console.error(o),a.showToast("Ops, houve um erro ao obter seu saldo a liberar")}).finally(function(){e.carregandoRecebiveis=!1})},e.obterSaldoReal=function(){r.obterSaldoReal().then(function(o){e.saldoReal={disponivel:o.available.amount/100,aReceber:o.waiting_funds.amount/100,transferido:o.transferred.amount/100,idrecipient:o.idrecipient}}).catch(function(o){e.saldoerro=o}).finally(function(){})},e.clickViewSaldoReal=function(){e.saldoRealClicks+=1,4===e.saldoRealClicks&&e.obterSaldoReal()},e.irParaHistoricoSaques=function(){a.showToast("Isto ainda não está disponível")},e.iniciar()}]).controller("PagarmeBankAccountCtrl",["$scope","$rootScope","$mdMedia","$mdDialog","$routeParams","AuthFactory","PagarmeService",function(e,a,o,r,t,n,i){e.mdMedia=o,e.dados={},e.carregando=!1,e.salvando=!1,e.sucesso=!1,e.preCondicoes=function(){n.isLoggedIn()?(e.isCliente="1"===n.get().tipo,e.idusuario=n.get().id):(a.showToast("Você deve estar logado"),a.irPara("/mais"))},e.carregaFormBanco=function(){e.sucesso=!1,e.carregando=!0,i.obterContaRecebedor().then(function(o){e.carregando=!1,e.recebedor=o,e.dados=o.contaBancaria||{},e.dados.nomeLegal=o.contaDroper.nomeLegal,e.dados.documentType=o.contaDroper.documentType,e.dados.documentNumber=o.contaDroper.documentNumber,e.selecionado=o.instituicaoBancaria}).catch(function(o){e.carregando=!1,a.voltarPagina(),a.showToast("Ops, algum dado de vendedor está corrompido ou inexistente. Entre em contato com suporte! #USER "+e.idusuario)})},e.pesquisarInstituicaoBancaria=function(o){return i.pesquisarInstituicao(o)},e.salvarContaBancaria=function(o){e.salvando=!0,i.salvarConta(o).then(function(o){a.voltarPagina(),a.showToast("Seus dados foram salvos!")}).catch(function(o){console.error("SAVE",o),a.formErrorBinder(e,o),a.showToast(o||"Desculpe, isso não deu certo")}).finally(function(){e.salvando=!1})},e.iniciarCSU=void e.preCondicoes()}]).controller("PagarmeSaqueCtrl",["$scope","$rootScope","$mdMedia","$mdDialog","AuthFactory","$timeout","PagarmeService",function(t,e,o,a,r,n,i){t.mdMedia=o,t.taxaSaque=0,t.diasUteisSaque=3,t.carregandoRecebiveis=!0,t.carregandoConta=!0,t.realizandoSaque=!1,t.saqueSucesso=!1,t.sacou=!1,t.recebiveis=[],t.recebedor=null,t.conta=null,t.erroRecebiveis=null,t.erroConta=null,t.errorMessage=null,t.dadosSaque={idInteresses:[]},t.iniciar=function(){r.isLoggedIn()?t.carregar():(e.showToast("Você não está logado"),e.voltarPagina())},t.carregar=function(){t.carregarConta(),t.carregarRecebiveis()},t.carregarConta=function(){t.carregandoConta=!0,i.obterContaRecebedor().then(function(o){t.recebedor=o,t.conta=o.contaBancaria,t.taxaSaque=o.taxaSaque,t.taxaSaqueFormatada=o.taxaSaque.toFixed(2).replace(".",",")}).catch(function(o){t.erroConta=o,console.error(o),e.showToast("Desculpe, algo deu errado"),e.voltarPagina()}).finally(function(){t.carregandoConta=!1})},t.carregarRecebiveis=function(){t.carregandoRecebiveis=!0,i.obterRecebiveis().then(function(o){t.recebiveis=o,t.temRecebiveis=o&&o.length}).catch(function(o){t.temRecebiveis=!1,console.error(o),e.showToast("Desculpe, algo deu errado"),e.voltarPagina()}).finally(function(){t.carregandoRecebiveis=!1})},t.possuiRecebiveisSelecionados=function(){var o=t.recebiveisSelecionados();return o&&o.length},t.recebiveisSelecionados=function(){for(var o=t.recebiveis,e=[],a=0;a<o.length;a++){var r=o[a];r.selecionadoParaSaque&&e.push(r.idInteresse)}return e},t.realizarSaque=function(){t.realizandoSaque=!0,t.sacou=!1,t.dadosSaque.idInteresses=t.recebiveisSelecionados(),i.realizarSaque(t.dadosSaque).then(function(o){e.showToast("Saque realizado com sucesso!"),t.saqueSucesso=!0}).catch(function(o){t.saqueSucesso=!1,t.errorMessage=o,e.showToast(o||"Ops, houve um erro inesperado"),console.error(o)}).finally(function(){t.realizandoSaque=!1,t.sacou=!0})},t.totalSaque=function(){for(var o=0,e=t.recebiveis,a=0;a<e.length;a++){var r=e[a];r.selecionadoParaSaque&&(o+=r.valorAReceber)}return o},t.totalSaqueFormatado=function(){var o=t.totalSaque()-t.taxaSaque;return o<=0?"0,00":o.toFixed(2).replace(".",",")},t.irParaFormContaBancaria=function(){e.irPara("/market/pg/bankaccount/create")},t.iniciar()}]).controller("PagarmeHistoricoCtrl",["$scope","$rootScope","PagarmeService",function(e,o,a){e.historico=[],e.carregando=!1,e.erro=null,e.carregar=function(){e.carregando=!0,a.obterHistoricoSaque().then(function(o){e.historico=o}).catch(function(o){e.erro=o}).finally(function(){e.carregando=!1})},e.showAlert=function(o){alert("Em caso de problemas informe esse número ao suporte: #"+o)},e.carregar()}]),angular.module("Proj").controller("PaymentCtrl",["$scope","$rootScope","$cookies","$window","$location","$routeParams","$mdMedia","PaymentService","AuthFactory",function(o,e,a,r,t,n,i,c,s){o.preCondicoes=function(){},o.iniciarCSU=void o.preCondicoes()}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/market/pendencias",{controller:"PendenciasSellerCtrl",templateUrl:"angular/app/market/pendencias/partials/view.tpl.html",tabControl:"Market",title:"Pendências"})}]).controller("PendenciasSellerCtrl",["$scope","$rootScope","$mdMedia","$mdDialog","$routeParams","AuthFactory","MarketService","PendenciasSellerService",function(e,a,o,r,t,n,i,c){e.mdMedia=o,e.pendencias,e.preCondicoes=function(){n.isLoggedIn()||(a.showToast("Você deve estar logado"),a.irPara("/mais")),e.isCliente="1"===n.get().tipo},e.obterPendencias=function(){e.carregando=!0,e.dadosUsuario=n.get(),c.verificarPendencias(e.dadosUsuario.id).then(function(o){e.pendencias=o.pendencias,o.pendencias.isComplete&&(a.showToast("Seus dados estão completos"),a.irPara("market"))}).catch(function(o){console.error(o),e.erro=!0}).finally(function(){e.carregando=!1})},e.verificarEmail=function(){e.verificandoEmail=!0,e.erroVerificacaoEmail=null;var o=n.get().token;i.verificarEmail(o).then(function(o){e.erroVerificacaoEmail=!1}).catch(function(o){alert("Ops, algo de errado aconteceu ao confirmar seu email"),e.erroVerificacaoEmail=!0}).finally(function(){e.verificandoEmail=!1})},e.exibirDialogVerificacaoEmail=function(){r.show({controller:["$scope","$rootScope","$mdDialog","AuthFactory","MarketService",function(e,a,o,r,t){e.uiStates={ConfirmandoEmail:1,EnviandoEmail:2,EnvioBemSucedido:3,EnvioMalSucedido:4},e.currentState=e.uiStates.ConfirmandoEmail,e.dadosConfirmacao={email:r.get().email},e.erroEnvioEmail="",e.cancelarDialog=function(){o.cancel()},e.fecharDialog=function(){o.hide()},e.enviarEmailVerificacao=function(){e.currentState=e.uiStates.EnviandoEmail,t.enviarVerificacaoEmail(r.get().id,e.dadosConfirmacao.email).then(function(o){e.currentState=e.uiStates.EnvioBemSucedido,null!=r.getToken()&&(r.updateUser(r.getToken()),a.isClienteLogado())}).catch(function(o){e.currentState=e.uiStates.EnvioMalSucedido,e.erroEnvioEmail=o})}}],templateUrl:"angular/app/market/pendencias/partials/verificacaoEmailDialog.tpl.html",parent:angular.element(document.body),clickOutsideToClose:!window.cordova},function(o){},function(){})},e.irParaCadastrarContaBancaria=function(){e.pendencias.temDadosPessoais?a.irPara("/market/pg/bankaccount/create"):a.showToast("Informe seus dados pessoais antes de cadastrar uma conta bancária")},e.terminarSessao=function(){n.logout(),a.showToast("Você foi deslogado"),a.irPara("market")},e.iniciarCSU=void e.preCondicoes()}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/relatorio/vendas",{controller:"ReportsCtrl",templateUrl:"angular/app/market/reports/partials/relatorioVendasUsuario.tpl.html",title:"Relatório"})}]).controller("ReportsCtrl",["$scope","ReportsService","AuthFactory","$rootScope",function(r,t,o,e){function a(){if(!o.isLoggedIn())return e.showToast("Para ver o relatório você precisa estar logado."),e.irPara("login"),!1;r.idUsuario=o.get().id,r.selecionarPeriodo()}$.getScript("angular/comp/chartjs/chart.min.js",a),r.periodoBusca="",r.graficoVendas="",r.hoje=new Date,r.dataInicial=new Date,r.dataFinal=new Date,r.relatorioVendedorDto={},r.selecionarPeriodo=function(){r.isRelatorioZerado=!1,r.opcoes=[{id:1,nome:"semana",descricao:"da última semana"},{id:2,nome:"mes",descricao:"do último mês"},{id:3,nome:"personalizado",descricao:"personalizado"}],r.periodo||(r.periodo="semana"),"personalizado"!=r.periodo?(r.dataFiltro=null,r.isFiltroPersonalizado=!1):r.isFiltroPersonalizado=!0,r.relatorioGeralVendedor()},r.atualizarDatas=function(o,e){r.dataInicial=o,r.dataFinal=e,r.relatorioGeralVendedor()},r.relatorioGeralVendedor=function(){var o,e,a;"personalizado"==r.periodo&&(r.isFiltroPersonalizado=!0,o=r.dataInicial.getDate(),e=r.dataInicial.getMonth()+1,a=r.dataInicial.getFullYear(),r.dataFiltro=o+"-"+e+"-"+a,o=r.dataFinal.getDate(),e=r.dataFinal.getMonth()+1,a=r.dataFinal.getFullYear(),r.dataFiltro=r.dataFiltro+"|"+o+"-"+e+"-"+a),r.carregandoRelatorio=!0,t.obterRelatorioDoVendedor(r.idUsuario,r.periodo,r.dataFiltro).then(function(o){r.relatorioVendedorDto=o,0===r.relatorioVendedorDto.contagemVendas?r.isRelatorioZerado=!0:r.isRelatorioZerado=!1;o=document.getElementById("chartVendas"),r.graficoVendas&&r.graficoVendas.destroy(),r.graficoVendas=new Chart(o,{type:"line",data:{labels:r.relatorioVendedorDto.datasRelatorioVendas,datasets:[{label:"# Número de vendas",data:r.relatorioVendedorDto.vendasDiarias,backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],borderWidth:1}]},options:{scales:{y:{beginAtZero:!0}}}}),o=document.getElementById("chartFaturamento");r.graficoFaturamento&&r.graficoFaturamento.destroy(),r.graficoFaturamento=new Chart(o,{type:"line",data:{labels:r.relatorioVendedorDto.datasRelatorioFaturamento,datasets:[{label:"# Faturamento total",data:r.relatorioVendedorDto.faturamentosDiarios,backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],borderWidth:1}]},options:{scales:{y:{beginAtZero:!0}}}})}).catch(function(o){console.error("ERRO",o)}).finally(function(){r.carregandoRelatorio=!1})}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/market/recipient/view",{controller:"RecebedorViewCtrl",templateUrl:"angular/app/market/recebedor/partials/view.tpl.html",tabControl:"Market",title:"Dados de recebimento"}).when("/market/recipient/create",{controller:"RecebedorViewCtrl",templateUrl:"angular/app/market/recebedor/partials/addbanco.tpl.html",tabControl:"Market",title:"Conta bancária"}).when("/market/recipient/historic",{controller:"RecebedorHistoricoCtrl",templateUrl:"angular/app/market/recebedor/partials/historic.tpl.html",tabControl:"Market",title:"Histórico de saques"}).when("/market/recipient/transfer",{controller:"RecebedorSaqueCtrl",templateUrl:"angular/app/market/recebedor/partials/saque.tpl.html",tabControl:"Market",title:"Saque"})}]).controller("RecebedorViewCtrl",["$scope","$rootScope","$routeParams","$location","AuthFactory","RecebedorService","$mdDialog",function(a,r,o,e,t,n,i){a.preCondicoes=function(){t.isLoggedIn()?(a.idusuario=t.get().id,a.carregarSaldo(),a.carregarContasBancarias()):(r.voltarPagina(),r.showToast("Você não está logado"))},a.podeSacar=!1,a.showReceber=!1,a.dados={},a.validation_token=null,a.carregarSaldo=function(){a.carregando=!0,n.obterSaldo(a.idusuario).then(function(o){a.saldo=o}).catch(function(o){a.saldoerro=o}).finally(function(){})},a.carregarContasBancarias=function(){a.carregandoContas=!0,n.obterContasBancarias(a.idusuario).then(function(o){a.contas=o}).catch(function(o){alert("Ocorreu um erro ao carregar as contas bancárias")}).finally(function(){a.carregando=!1,a.carregandoContas=!1})},a.carregaFormBanco=function(){a.carregando=!0,r.showVerificarPIN().then(function(o){null!=o?(a.validation_token=o,a.carregando=!1):(r.voltarPagina(),r.showToast("PIN inválido"))}).catch(function(o){r.voltarPagina(),r.showToast("PIN inválido")})},a.salvarBanco=function(o){a.salvandoBanco=!0,n.criarContaBancaria(t.get().id,o,a.validation_token).then(function(o){r.showToast("Conta adicionada com sucesso"),r.voltarPagina()}).catch(function(o){r.showToast("Verifique os erros"),r.formErrorBinder(a,o)}).finally(function(){a.salvandoBanco=!1})},a.pesquisarBanco=function(o){return n.pesquisarBanco(o)},a.desativar=function(o,e){e=i.confirm().title("Tem certeza que deseja deletar essa conta bancária?").textContent("Essa ação não pode ser desfeita").ariaLabel("Desativar conta bancária").targetEvent(e).ok("Sim").cancel("Não");i.show(e).then(function(){a.carregandoContas=!0,n.apagarConta(t.get().id,o.id).then(function(o){r.showToast("Conta bancária deletada"),a.carregarContasBancarias()}).catch(function(o){r.showToast(o||"Ops, algo de errado aconteceu ao tentar desativar a conta bancária"),a.carregandoContas=!1})},function(){})},a.trocarContaFavorita=function(o){if(1==o.isPreferido)return!1;n.trocarContaPreferida(t.get().id,o.id).then(function(o){r.showToast("Conta bancária preferida alterada"),a.carregarContasBancarias()}).catch(function(o){r.showToast(o||"Ops, algo de errado aconteceu ao tentar desativar a conta bancária")})},a.carregarRecebiveis=function(){a.carregandoRecebiveis=!0,a.showAReceber=!0,n.obterRelatorioALiberar(a.idusuario).then(function(o){a.recebiveisALiberar=o}).catch(function(o){a.showAReceber=!1,r.showToast("Ops, houve um erro ao obter seu saldo a liberar")}).finally(function(){a.carregandoRecebiveis=!1})},a.preCondicoes()}]).controller("RecebedorSaqueCtrl",["$scope","$rootScope","$routeParams","$location","AuthFactory","RecebedorService","$mdDialog",function(r,e,o,a,t,n,i){r.recebiveis=[],r.taxaSaque=3,r.taxaSaqueFormatada=r.taxaSaque.toFixed(2).replace(".",","),r.sacou=!1,r.dadosSaque={idContaBancaria:null,idInteresses:[]},r.preCondicoes=function(){t.isLoggedIn()?r.carregar():(e.voltarPagina(),e.showToast("Você não está logado"))},r.possuiInteressesSelecionados=function(){for(var o=0;o<r.recebiveis.length;o++)if(r.recebiveis[o].selecionadoParaSaque)return!0;return!1},r.interessesSelecionados=function(){for(var o=[],e=0;e<r.recebiveis.length;e++){var a=r.recebiveis[e];a.selecionadoParaSaque&&a.idInteresse&&o.push(a.idInteresse)}return o},r.consignacoesSelecionadas=function(){for(var o=[],e=0;e<r.recebiveis.length;e++){var a=r.recebiveis[e];a.selecionadoParaSaque&&a.idConsignacao&&o.push(a.idConsignacao)}return o},r.totalSaque=function(){for(var o=0,e=0;e<r.recebiveis.length;e++){var a=r.recebiveis[e];a.selecionadoParaSaque&&(o+=a.valorAReceber)}return o},r.totalSaqueFormatado=function(){var o=r.totalSaque();return o<=r.taxaSaque?"0,00":(o-r.taxaSaque).toFixed(2).replace(".",",")},r.carregar=function(){r.carregando=!0,n.obterContaPreferida(t.get().id).then(function(o){r.contaPreferida=o,r.dadosSaque.idContaBancaria=r.contaPreferida.id}).then(function(){return n.obterRecebiveis(t.get().id).then(function(o){r.recebiveis=o})}).catch(function(o){e.voltarPagina(),e.showToast(o)}).finally(function(){r.carregando=!1})},r.carregarSaldo=function(){r.carregandoSaldo=!0,n.obterSaldo(t.get().id).then(function(o){r.saldo=o}).catch(function(o){e.voltarPagina(),e.showToast(o)}).finally(function(){r.carregandoSaldo=!1})},r.realizarSaque=function(){r.realizandoSaque=!0,r.sacou=!1,r.dadosSaque.idContaBancaria=r.contaPreferida.id,r.dadosSaque.idInteresses=r.interessesSelecionados(),r.dadosSaque.idConsignacoes=r.consignacoesSelecionadas(),n.realizarSaque(t.get().id,r.dadosSaque).then(function(o){e.showToast("Saque realizado com sucesso!"),e.saqueSucesso=!0}).catch(function(o){e.saqueSucesso=!1,e.showToast(o||"Ops, houve um erro inesperado"),r.errorMessage=o}).finally(function(){r.realizandoSaque=!1,r.sacou=!0})},r.valorValidoParaSaque=function(o){o=parseFloat(o.replace(",","."));return o<10?!(r.msgErroPreco="O valor mínimo para saque é de R$ 10,00"):100*o>r.saldo.disponivel?!(r.msgErroPreco="Este valor excede o seu saldo disponível"):!(r.msgErroPreco="")},r.showTrocarConta=function(){r.carregandoBancos=!0,i.show({preserveScope:!0,scope:r,templateUrl:"angular/app/market/recebedor/partials/selectContaDialog.tpl.html",parent:angular.element(document.body),clickOutsideToClose:!window.cordova}),n.obterContasBancarias(t.get().id).then(function(o){r.contas=o}).catch(function(o){e.hideDialog(),e.showToast(o||"Ops, algo de errado aconteceu")}).finally(function(){r.carregandoBancos=!1}),r.selecionarContaFavorita=function(o){if(1==o.isPreferida)return e.hideDialog(),!1;n.trocarContaPreferida(t.get().id,o.id).then(function(o){e.showToast("Conta bancária selecionada"),e.hideDialog(),r.contaPreferida=o,r.dadosSaque.idContaBancaria=o.id}).catch(function(o){e.showToast(o||"Ops, algo de errado aconteceu ao tentar desativar a conta bancária"),e.hideDialog()})}},r.selecionarTodasAsVendasParaSacar=function(){var o=r.recebiveis||[];o.every(o=>o.selecionadoParaSaque)?o.forEach(o=>o.selecionadoParaSaque=!1):o.forEach(o=>o.selecionadoParaSaque=!0)}}]).controller("RecebedorHistoricoCtrl",["$scope","$rootScope","$routeParams","$location","AuthFactory","RecebedorService","$mdDialog",function(e,o,a,r,t,n,i){e.carregando=!0,e.erro=!1,e.historico=[],e.carregar=function(){n.obterHistoricoSaques(t.get().id).then(function(o){e.historico=o}).catch(function(o){e.erro=!0}).finally(function(){e.carregando=!1})},e.showAlert=function(o){alert("Em caso de problemas informe esse número ao suporte: #"+o)},e.carregar()}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/vendas",{controller:"VendaCtrl",templateUrl:"angular/app/market/venda/partials/list.tpl.html",tabControl:"Mais",title:"Vendas"}).when("/vendas/historico",{controller:"VendaCtrl",templateUrl:"angular/app/market/venda/partials/historic.tpl.html",tabControl:"Mais",title:"Vendas"}).when("/vendas/relatorio",{controller:"VendaRelatorioCtrl",templateUrl:"angular/app/market/venda/partials/relatorio.tpl.html",tabControl:"Relatório",title:"Vendas"}).when("/vendas/:id/confirmar",{controller:"VendaCtrl",templateUrl:"angular/app/market/venda/partials/confirmar.tpl.html",tabControl:"Mais",title:"Vendas"}).when("/vendas/:id",{controller:"VendaCtrl",templateUrl:"angular/app/market/venda/partials/show.tpl.html",tabControl:"Mais",title:"Venda"})}]).controller("VendaCtrl",["$scope","$rootScope","$location","$mdDialog","$mdMedia","$routeParams","AuthFactory","LocationBackStore","EnderecoService","RastreioService","VendaService","CkViewState",function(i,r,o,t,e,a,n,c,s,l,d,u){i.mdMedia=e;var e=o.path(),p="vendas"===e||"/vendas"===e,f=(i.carregarVendas=function(){if(!n.isLoggedIn())return r.showToast("Para vender você precisa estar logado."),r.irPara("login"),!1;var o=u.vendas(),e=p&&o&&o.changed;e&&(u.restoreScope(o.scope,i),window.setTimeout(function(){window.scroll(o.scroll.x,o.scroll.y)},300)),i.carregando=!e,d.obterVendas().then(function(o){i.vendas=o,i.vendasUnificadas=[].concat(i.vendas.waitPagamento).concat(i.vendas.pagos).concat(i.vendas.iniciados).concat(i.vendas.problemas),v()}).catch(function(o){r.showToast(o),i.erro=!0}).finally(function(){i.carregando=!1})},i.$on("$destroy",function(){var o;p&&(o={scope:i,scroll:{x:window.scrollX,y:window.scrollY}},u.vendas(o))}),i.recarregarVendas=function(){i.recarregando=!0,d.obterVendas().then(function(o){i.vendas=o,i.vendasUnificadas=[].concat(i.vendas.waitPagamento).concat(i.vendas.pagos).concat(i.vendas.iniciados).concat(i.vendas.problemas),v(),r.showToast("Vendas atualizadas")}).catch(function(o){r.showToast(o)}).finally(function(){i.recarregando=!1})},i.obterDetalhesVenda=function(o,e){i.carregandoVenda=!0,i.numeroVenda=e,i.$root=r,i.isDialog=!0,d.obter(e).then(function(o){i.venda=o,null!=i.venda.codigoRastreio&&8<i.venda.codigoRastreio.length&&(console.log("carregar rastreio"),i.carregarRastreioAtual(i.venda))}).catch(function(o){i.carregandoVendaErro=!0}).finally(function(){i.carregandoVenda=!1});function a(o){try{var e=i.tagsCtx.tagsUsuario,a=i.tagsCtx.result.tagsVenda;i.tagsUsuario=angular.copy(e),r=i.vendas,t=i.venda.id,n=angular.copy(a),(r.waitPagamento||[]).forEach(b(t,n)),(r.iniciados||[]).forEach(b(t,n)),(r.pagos||[]).forEach(b(t,n)),(r.problemas||[]).forEach(b(t,n)),w(i.vendas,i.tagsUsuario),i.tagsCtx.reset()}catch(o){console.error(o)}var r,t,n}e={controller:"VendaCtrl",templateUrl:"angular/app/market/venda/partials/viewDialog.tpl.html",parent:angular.element(document.body),scope:i,fullscreen:!0,preserveScope:!0,clickOutsideToClose:!window.cordova};t.show(e).then(function(){a()}).catch(function(){a()})},i.obterDetalhesVendaPath=function(){i.carregandoVenda=!0,i.numeroVenda=a.id,i.isDialog=!1,d.obter(i.numeroVenda).then(function(o){i.venda=o}).catch(function(o){i.carregandoVendaErro=!0}).finally(function(){i.carregandoVenda=!1})},i.showInfo=function(o,e,a){t.show(t.alert().clickOutsideToClose(!0).title(e).textContent(a).ariaLabel("Informações úteis de venda").ok("OK").targetEvent(o))},i.resolverFotoItem=function(o){return null!=o.dropIcon?o.dropIcon:o.linkfoto},i.termoBuscaHistorico,i.carregarHistorico=function(){i.page=0,i.amount=50,i.carregando=!0,d.obterVendasHistorico(i.page,i.amount).then(function(o){i.vendas=o.historico,i.totalVendas=o.total}).catch(function(o){r.showToast(o||"Ops, algo de errado aconteceu. Se o erro persistir entre em contato com a equipe do Droper"),i.erro=!0}).finally(function(){i.carregando=!1})},i.carregarMaisHistorico=function(){i.page=i.page+1,i.carregandoMais=!0,d.obterVendasHistorico(i.page,i.amount).then(function(o){i.vendas=i.vendas.concat(o.historico)}).catch(function(o){r.showToast(o||"Ops, algo de errado aconteceu. Se o erro persistir entre em contato com a equipe do Droper"),i.page=i.page-1}).finally(function(){i.carregandoMais=!1})},i.obterDadosConfirmacao=function(){i.carregando=!0,i.idVenda=a.id,d.obterVenda(a.id).then(function(o){null!=(i.venda=o).identificadorServicoFrete&&i.carregarDadosEnvio(a.id)}).catch(function(o){r.showToast(o),i.erro=!0}).finally(function(){i.carregando=!1})},i.calcularDescontos=function(o){var e=r.calcularTaxa(o.precoProduto),a=e.recebido;return i.valorSubtraidoTaxa=e.subtraido,5==o.tipoFrete&&null!=o.precoFrete?(e=parseFloat(o.precoFrete.replace(",",".")),(parseFloat(a.replace(",","."))-e).toFixed(2).toString().replace(".",",")):a},i.confirmarEstoque=function(o){i.carregando=!0,d.confirmarEstoque(i.venda.id).then(function(o){r.showToast("Estoque confirmado. Agora é só esperar o comprador efetuar o pagamento"),r.irPara("/vendas")}).catch(function(o){i.erro=!0,i.erroConfirmarMensagem=o||"Caso o erro persista entre em contato com o Suporte!",r.showToast(o||"Ops, algo de errado aconteceu ao confirmar estoque. Tente novamento mais tarde"),i.carregando=!1})},i.indisponibilizarEstoque=function(o,e){i.carregando=!0;e=null!=e?e.id:null;d.estaIndisponivel(o.id,e).then(function(o){r.showToast(o||"Foi informado ao comprador que o produto está indisponível"),r.voltarPagina()}).catch(function(o){r.showToast(o||"Agora de errado aconteceu! Tente novamente mais tarde")}).finally(function(){i.carregando=!1})},i.removerItemEstoque=function(e,a){var o="",o=null!=e.TamanhoSelecionado?e.Produto.nome+" no tamanho "+e.TamanhoSelecionado.titulo:e.Produto.nome,o=t.confirm().title("Deseja remover esse item do carrinho e avisar o comprador?").textContent(o).ariaLabel("").ok("SIM").cancel("NÃO");t.show(o).then(function(o){e.removendo=!0,d.removerItemEstoque(i.venda.id,e.id).then(function(o){i.venda.Itens.splice(a,1),i.venda.Itens=o.Itens,i.venda.precoProdutoText=o.precoProdutoText}).catch(function(o){r.showToast(o||"Agora de errado aconteceu! Tente novamente mais tarde")}).finally(function(){e.removendo=!1})},function(){})},i.estaNaConfirmacao=function(){return!0},i.carregarDadosEnvio=function(o){i.carregandoDadosEnvio=!0,d.obterDadosEnvio(o).then(function(o){i.envio=o}).catch(function(o){r.showToast(o||"Ops, algo de errado aconteceu ao obter dados de envio.")}).finally(function(){i.carregandoDadosEnvio=!1})},i.obterStatusVenda=function(e){e.carregandoStatusVenda=!0,d.syncStatusVenda(e.id).then(function(o){e.statusVenda=o.status}).catch(function(o){e.statusVenda={},e.statusVenda.color="blue",e.statusVenda.title=o}).finally(function(){e.carregandoStatusVenda=!1})},i.cancelarVenda=function(e){var o=t.confirm().title("Deseja cancelar a venda de "+e.Produto.nome+"?").textContent("Avisaremos que o produto não poderá mais ser comprado. Atenção, essa ação não poderá mais ser desfeita.").ariaLabel("Confirma que o produto está entregue").ok("SIM").cancel("NÃO");t.show(o).then(function(o){i.carregando=!0,d.cancelarDisponibilidade(e.id).then(function(o){r.showToast("A venda foi cancelada. Evite confirmar o estoque sem ter plena certeza!"),i.recarregarVendas(),i.perguntarRemoverEstoque(e)}).catch(function(o){r.showToast(o||"Agora de errado aconteceu! Tente novamente mais tarde")}).finally(function(){i.carregando=!1})},function(){})},i.perguntarRemoverEstoque=function(e){var o=null!=e.TamanhoSelecionado?" no tamanho "+e.TamanhoSelecionado.titulo:"",o="O produto "+e.Produto.nome+o+" está disponível no seu estoque?",o=t.confirm().title(o).textContent("").ariaLabel("Está disponível no seu estoque").ok("SIM").cancel("NÃO, DAR BAIXA!");t.show(o).then(function(o){},function(o){console.log("CATCH (respondeu não?)",o),d.removerEstoque(e.id).then(function(o){r.showToast("Foi dado baixa nesse item com sucesso")}).catch(function(o){r.showToast(o||"Agora de errado aconteceu! Remova o estoque manualmente")}).finally(function(){})})},i.obterEnderecoEntrega=function(o,e){i.carregandoEndereco=!0,i._venda=o,i.enderecoEntrega={},d.obterEnderecoEntrega(o.id).then(function(o){i.enderecoEntrega=o}).catch(function(o){i.enderecoEntregaErro=!0}).finally(function(){i.carregandoEndereco=!1}),t.show({controller:"VendaCtrl",templateUrl:"angular/app/market/venda/partials/entregaDialog.tpl.html",parent:angular.element(document.body),scope:i,targetEvent:e,fullscreen:!0,preserveScope:!0,clickOutsideToClose:!1})},i.gerarEtiqueta=function(e){i.gerandoEtiqueta=!0,e.etiquetaUrl=null,d.gerarEtiqueta(e.id).then(function(o){e.codigoRastreio=o.codigoRastreio,e.urlEtiqueta=o.url,r.irParaURLExterna(o.url)}).catch(function(o){r.showToast(o||"Erro ao gerar etiqueta. Tente novamento mais tarde")}).finally(function(){i.gerandoEtiqueta=!1})},i.confirmarEntrega=function(e,o){var a=t.confirm().title("Deseja confirmar a entrega do produto "+e.Produto.nome+"?").textContent("Só confirme se o cliente já tenha REALMENTE O PRODUTO EM MÃOS! Logo em seguida pediremos para o comprador confirmar recebimento e avaliar a experiência da compra.").ariaLabel("Confirma que o produto está entregue").ok("SIM").cancel("NÃO");t.show(a).then(function(o){i.carregando=!0,d.confirmarEntrega(e.id).then(function(o){r.showToast("A compra recebeu confirmação de entrega do vendedor."),e=o,i.recarregarVendas()}).catch(function(o){r.showToast(o||"Agora de errado aconteceu! Tente novamente mais tarde")}).finally(function(){i.carregando=!1})},function(o){})},i.confirmarEntregav2=function(e){e.confirmandoEntregaDisabled=!0,e.confirmandoEntrega=!0,e.confirmandoEntregaMensagem="Confirmando entrega...",d.confirmarEntrega(e.id).then(function(o){r.showToast("Você solicitou confirmação de entrega ao comprador. Aguarde resposta!"),e.confirmandoEntregaMensagem="Você solicitou confirmação de entrega ao comprador. Aguarde resposta!",e.confirmandoEntregaErro=null,e.statusInteresse=o.statusInteresse}).catch(function(o){e.confirmandoEntregaMensagem=o||"Agora de errado aconteceu! Tente novamente mais tarde",r.showToast(o||"Agora de errado aconteceu! Tente novamente mais tarde")}).finally(function(){e.confirmandoEntregaVermelho=!0,e.confirmandoEntrega=!1})},i.enviarEtiquetaEmail=function(o){i.gerandoEtiqueta=!0,d.enviarEtiquetaEmail(o.id).then(function(o){r.showToast(o)}).catch(function(o){r.showToast(o||"Erro ao enviar etiqueta no email. Tente novamento mais tarde")}).finally(function(){i.gerandoEtiqueta=!1})},i.confirmarDevolucao=function(e){var o=t.confirm().title("O produto "+e.Produto.nome+" foi devolvido a você corretamente?").textContent("Caso o produto esteja com algum problema informe imediatamente o suporte.").ariaLabel("Confirmar devolução").ok("SIM").cancel("NÃO");t.show(o).then(function(o){i.carregando=!0,d.confirmarDevolucao(e.id).then(function(o){r.showToast("A devolução do produto foi confirmada"),i.carregarVendas()}).catch(function(o){r.showToast(o||"Agora de errado aconteceu! Tente novamente mais tarde")}).finally(function(){i.carregando=!1})},function(o){})},i.enviarDadosEnderecoEntrega=function(e){var o=t.confirm().title("Quer mesmo enviar os dados de destinatário e remetente dessa venda para seu celular e e-mail?").textContent("").ariaLabel("Confirmar se deseja enviar dados").ok("SIM").cancel("NÃO");t.show(o).then(function(o){d.enviarDadosEntregaVendedor(e).then(function(o){r.showToast("Dados enviados")}).catch(function(o){r.showToast(o||"Agora de errado aconteceu! Tente novamente mais tarde")}).finally(function(){i.carregando=!1})},function(o){})},i.carregarRastreioAtual=function(e){l.obterStatusAtual(e.id).then(function(o){console.log(o),e.rastreioStatusAtual=o.status})},i.retirarCom="",i.criandoPedidoLoggi=!1,i.pedidoLoggiCriado=!1,i.pedidoLoggiErro=!1,i.loggiUiStep=0,i.pedirLoggi=function(o){t&&t.close&&t.close();var e={controller:"VendaCtrl",templateUrl:"angular/app/market/venda/partials/entregaLoggiDialog.tpl.html",parent:angular.element(document.body),scope:i,fullscreen:!0,preserveScope:!0,clickOutsideToClose:!1};t.show(e).then(function(){},function(){})},i.obterRetirarCom=function(){i.enderecoEntrega&&i.enderecoEntrega.destinatario&&(i.retirarCom=i.enderecoEntrega.destinatario.recebedor)},i.confirmarPedidoLoggi=function(){i.avancarUiLoggi(),i.criandoPedidoLoggi=!0,i.pedidoLoggiErro=!1,i._venda?d.gerarEnvioLoggi(i._venda.id).then(function(o){r.hideDialog(),r.showToast("Seu pedido foi criado!"),i._venda.temPedidoLoggi=!0}).catch(function(o){console.error(o),i.pedidoLoggiErro=!0}).finally(function(){i.criandoPedidoLoggi=!1}):(i.criandoPedidoLoggi=!1,i.pedidoLoggiErro=!0)},i.voltarUiLoggi=function(){0===i.loggiUiStep?r.hideDialog():--i.loggiUiStep},i.avancarUiLoggi=function(){i.loggiUiStep+=1},i.exibirRastreioLoggi=function(o,e){l.exibirRastreioLoggi(o.id,e).then(function(){})},i.tagsUsuario=[],i.listaTagsUsuario=[],i.carregandoTags=!1,i.expandirTag=!1,i.editarTag=!1,i.excluirTag=!1,i.adicionarTag=!1,null),m=null;function g(o,e){return{cor:o,corDestaque:e}}i.tagDialogData={tagsUsuario:[]};var h={Leve:[g("#d9d9d9","#474646"),g("#b7ffc7","#6f9878"),g("#F77575","#AA4F4F"),g("#8CC5FA","#6289AD"),g("#FCFE84","#B2B45D"),g("#FCD892","#C9AA6F"),g("#FAC2FB","#B78AB8"),g("#BFFDFD","#83BABA"),g("#B1B3DD","#676885")],Medio:[g("#ABABAB","#474646"),g("#70FC8F","#46A75B"),g("#D94D4D","#862F2F"),g("#6D7BF8","#4750A5"),g("#EEF161","#A2A43F"),g("#F1BF5D","#A9843D"),g("#FB9DFD","#9E629F"),g("#86F2F2","#5DADAD"),g("#9893CF","#494667")],Forte:[g("#7F7D7D","#474646"),g("#35F45F","#0B9028"),g("#E62727","#7A1111"),g("#4A5CFB","#222B7C"),g("#F5FA13","#9B9E0D"),g("#F9B126","#9F7117"),g("#FC5CFF","#A439A6"),g("#36FAFA","#219595"),g("#8D91E8","#262742")]};function v(){i.carregandoTags=!0,d.obterTagsDoUsuario().then(function(o){i.tagsUsuario=o,w(i.vendas,i.tagsUsuario)}).catch(function(o){console.log(o)}).finally(function(){i.carregandoTags=!1})}function w(o,e){(o.waitPagamento||[]).forEach(C(e)),(o.iniciados||[]).forEach(C(e)),(o.pagos||[]).forEach(C(e)),(o.problemas||[]).forEach(C(e))}function C(r){return function(o){var a=o.tags,e=r.filter(function(e){return a.some(function(o){return o===e.id})});o.displayTags=e}}function b(e,a){return function(o){o.id===e&&(o.tags=a)}}function S(){i.vinculandoTags=!0;var o=i.listaTags.map(function(o){return o.id}),o={idInteresse:i.venda.id,idsTags:o};console.log("DADOS TAGS",o),d.vincularTagAoInteresse(o).then(function(o){console.log("tag interesse",o)}).catch(function(o){console.log(o)}).finally(function(){i.vinculandoTags=!1})}i.TagCores=h,i.tagsCtx={tagsUsuario:null,exibindoTags:!1,carregandoTags:!1,excluindoTag:!1,idTagSelecionada:null,tipoEdicao:null,result:{idVenda:null,tagsVenda:[]},_timeoutSave:null,reset:function(){this.tagsUsuario=null,this.exibindoTags=!1,this.carregandoTags=!1,this.idTagSelecionada=null,this.tipoEdicao=null,this._timeoutSave=null},load:function(){var e;this.tagsUsuario||(this.tagsUsuario=[],this.carregandoTags=!0,e=this,d.obterTagsDoUsuario().then(function(o){e.tagsUsuario=o}).finally(function(){e.carregandoTags=!1}))},exibirTags:function(){this.exibindoTags=!this.exibindoTags,this.exibindoTags&&!this.tagsUsuario&&this.load()},novaTag:function(){var o=this.tagsUsuario.find(function(o){return!o.id});o?this.focarInputTag(o):(o={id:null,texto:"",cor:h.Leve[0].cor},this.tagsUsuario=this.tagsUsuario.filter(function(o){return!!o.id}),this.tagsUsuario.push(o),this.editarTexto(o))},editarTexto:function(o){"texto"!==this.tipoEdicao||this.idTagSelecionada!==o.id?(this.idTagSelecionada=o.id,this.tipoEdicao="texto",this.focarInputTag(o)):this.fecharEdicao()},editarCor:function(o){"cor"!==this.tipoEdicao||this.idTagSelecionada!==o.id?(this.idTagSelecionada=o.id,this.tipoEdicao="cor"):this.fecharEdicao()},abrirExclusaoTag:function(o){"exclusao"!==this.tipoEdicao||this.idTagSelecionada!==o.id?(this.idTagSelecionada=o.id,this.tipoEdicao="exclusao"):this.fecharEdicao()},atribuirCor:function(e,o){var a=this.tagsUsuario.find(function(o){return o.id===e.id}),r=this;a&&(a.cor=o,o={cor:a.cor,texto:a.texto},a.id&&(o.id=a.id),d.salvarTag(o).then(function(o){r.idTagSelecionada=o.id,a.id=o.id,r.desfocarInputTag(a)}))},estaEditandoTexto:function(o){return this.idTagSelecionada===o.id&&"texto"===this.tipoEdicao},estaEditandoCor:function(o){return this.idTagSelecionada===o.id&&"cor"===this.tipoEdicao},estaExcluindo:function(o){return this.idTagSelecionada===o.id&&"exclusao"===this.tipoEdicao},salvarTagSelecionada:function(){var o,e=this.idTagSelecionada,a="texto"===this.tipoEdicao?600:0,r=this.tagsUsuario.find(function(o){return o.id===e}),t=this;r&&(o={cor:r.cor,texto:r.texto},r.id&&(o.id=r.id),window.clearTimeout(this._timeoutSave),this._timeoutSave=window.setTimeout(function(){d.salvarTag(o).then(function(o){t.idTagSelecionada=o.id,r.id=o.id})},a))},excluirTag:function(e){var a=this.tagsUsuario.find(function(o){return o.id===e.id}),o=this;a&&(null==a.id?this.tagsUsuario=this.tagsUsuario.filter(function(o){return!!o.id}):(this.excluindoTag=!0,d.desativarTag(a.id).then(function(){o.tagsUsuario=(o.tagsUsuario||[]).filter(function(o){return o.id!==a.id}),o.removerTagNaVenda(a),o.fecharEdicao()}).finally(function(){o.excluindoTag=!1})))},fecharEdicao:function(){this.idTagSelecionada=null,this.tipoEdicao=null,(document.querySelectorAll(".taginput")||[]).forEach(function(o){o.disabled=!0,o.placeholder=""})},focarInputTag:function(e,o){var a=(this.tagsUsuario||[]).findIndex(function(o){return o.id===e.id}),a=document.getElementById("taginput-"+a),r=this;a?(a.disabled=!1,a.placeholder="Seu texto aqui...",a.focus()):(!o||o<=10)&&window.setTimeout(function(){r.focarInputTag(e,(o||0)+1)},100)},desfocarInputTag:function(e,o){var a=(this.tagsUsuario||[]).findIndex(function(o){return o.id===e.id}),a=document.getElementById("taginput-"+a),r=this;a?(a.disabled=!0,a.placeholder="",a.blur()):(!o||o<=10)&&window.setTimeout(function(){r.focarInputTag(e,(o||0)+1)},100)},tagClick:function(e){this.estaEditandoTexto(e)||(this.tagsVenda().some(function(o){return o===e.id})?this.removerTagNaVenda(e):this.adicionarTagNaVenda(e))},adicionarTagNaVenda:function(e){var o;this.estaEditandoTexto(e)||(o=this.tagsUsuario.find(function(o){return o.id===e.id}))&&(this.tagsVenda().push(o.id),this.salvarTagsDaVenda())},removerTagNaVenda:function(e){e&&(this.tagsVenda(this.tagsVenda().filter(function(o){return o!==e.id})),this.salvarTagsDaVenda())},salvarTagsDaVenda:function(){var o=i.venda.id,e=this.tagsVenda().filter(function(o){return!!o});d.vincularTagAoInteresse({idInteresse:o,idsTags:e})},tagEstaNaVenda:function(e){this.tagsVenda();return this.tagsVenda().some(function(o){return e.id===o})},idVenda:function(){return this.result.idVenda=i.venda.id,this.result.idVenda},tagsVenda:function(o){return o&&(i.venda.tags=o),this.result.tagsVenda=(i.venda||{}).tags||[],this.result.tagsVenda}},i.selecionarCorDaTag=function(o,e,a){"edit"===a?-1!==(a=i.listaTagsUsuario.findIndex(function(o){return o.id===e.id}))&&(i.listaTagsUsuario[a].cor=o.cor,i.listaTagsUsuario[a].corDestaque=o.corDestaque):(i.novaTag.cor=o.cor,i.novaTag.corDestaque=o.corDestaque),i.salvarTag(e)},i.toggleAdicionarTag=function(){i.novaTag={idUsuario:r.getLoggedUser().id,texto:"",cor:"#D9D9D9"},i.adicionarTag=!i.adicionarTag},i.showTagsForm=function(){i.expandirTag=!i.expandirTag,0===i.listaTagsUsuario.length&&(i.adicionarTag=!i.adicionarTag),console.log("expandir",i.expandirTag)},i.showTagsDoUsuario=function(){i.expandirTag=!i.expandirTag},i.salvarTag=function(e){i.salvandoTag=!0,console.log("tag nova",e),d.salvarTag(e).then(function(o){console.log("tag salva",o),e.id?i.editarTag=!1:i.listaTagsUsuario.push(i.novaTag),e.id=o.id}).catch(function(o){console.log(o),r.showToast("Algo deu errado")}).finally(function(){i.salvandoTag=!1})},i.salvarNovaTag=function(){i.salvandoTag=!0,console.log("NOVA TAG",i.novaTag),d.salvarTag(i.novaTag).then(function(o){i.novaTag.id||i.listaTagsUsuario.push(i.novaTag),i.novaTag.id=o.id}).catch(function(o){console.log(o),r.showToast("Algo deu errado")}).finally(function(){i.salvandoTag=!1})},i.desativarTag=function(e){i.desativandoTag=!0,d.desativarTag(e).then(function(o){r.showToast("Tag excluída."),i.listaTagsUsuario=i.listaTagsUsuario.filter(function(o){return o.id!==e}),i.listaTags=i.listaTags.filter(function(o){return o.id!==e}),0===i.listaTagsUsuario.length&&(i.expandirTag=!1),i.dialogTagResult={idVenda:i.venda.id,tags:i.listaTags},S()}).catch(function(o){console.log(o)}).finally(function(){i.desativandoTag=!1})},i.usarTagVenda=function(e,o){i.listaTags.some(function(o){return o.id===e.id})?i.removerTagVenda(e):(i.listaTags.push(e),S(),i.dialogTagResult={idVenda:i.venda.id,tags:i.listaTags})},i.limparNovaTag=function(){i.novaTag={texto:"",cor:"#D9D9D9",corDestaque:"#474646"},i.adicionarTag=!1},i.removerTagVenda=function(e){i.listaTags=i.listaTags.filter(function(o){return o.id!==e.id}),i.dialogTagResult={idVenda:i.venda.id,tags:i.listaTags},S()},i.agendarSalvarTag=function(o){f&&window.clearTimeout(f);f=window.setTimeout(function(){i.salvarTag(o)},600)},i.agendarSalvarNovaTag=function(){m&&window.clearTimeout(m);m=window.setTimeout(i.salvarNovaTag,600)},i.voltarECarregarVendas=function(){t.hide({idVenda:i.venda.id,tags:i.listaTags})}}]).controller("VendaRelatorioCtrl",["$scope","$rootScope","$mdMedia","ckComp","VendaService",function(r,e,o,a,t){r.mdMedia=o;var n={Tudo:"tudo",TresMeses:"tresmeses",UltimoMes:"ultimomes",UltimaSemana:"ultimasemana",Hoje:"hoje",Personalizado:"personalizado"},i={Faturamento:"faturamento",NumVendas:"numvendas",Payout:"payout",precoCusto:"precoCusto"},c="#chart",s=(r.relatorio=null,r.relatorioVazio=!1,r.Periodo=n,r.Visualizacao=i,r.todoPeriodo=n.Tudo,r.periodo=n.UltimoMes,r.visualizacao=i.Faturamento,r.carregando=!1,r.baixandoCsv=!1,r.erro=null),l={};function d(){r.carregando=!0,t.relatorioVendas(r.periodo,r.periodoPersonalizado).then(function(o){r.relatorio=o,l[i.Faturamento]=p(o),l[i.NumVendas]=f(o),l[i.Payout]=m(o),l[i.precoCusto]=g(o),console.log("relatorio",r.relatorio),a.load("chart.js").then(u)}).catch(function(o){0===r.relatorio.agregado.length&&(r.relatorioVazio=!0),r.erro=o,e.showToast(o)}).finally(function(){r.carregando=!1})}function u(){var e,o,a=document.querySelector(c);a?(o={type:"bar",data:{labels:(e=l[r.visualizacao]||h()).labels,datasets:[{label:e.dataset.label,data:e.dataset.data}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{enabled:!0,displayColors:!1,callbacks:{label:function(o){return e.dataset.display[o.dataIndex]}}}}}},s&&s.destroy(),s=new window.Chart(a,o)):r.erro="Ops, algo deu errado"}function p(o){o=o.agregado||[];return{labels:o.map(function(o){return o.data}),dataset:{label:"R$ Faturamento",data:o.map(function(o){return o.faturamento}),display:o.map(function(o){return"R$ "+o.strFaturamento})}}}function f(o){o=o.agregado||[];return{labels:o.map(function(o){return o.data}),dataset:{label:"N° de vendas",data:o.map(function(o){return o.numVendas}),display:o.map(function(o){return o.strNumVendas+" vendas"})}}}function m(o){o=o.agregado||[];return{labels:o.map(function(o){return o.data}),dataset:{label:"R$ Payout",data:o.map(function(o){return o.payout}),display:o.map(function(o){return"R$ "+o.strPayout})}}}function g(o){o=o.agregado||[];return{labels:o.map(function(o){return o.data}),dataset:{label:"R$ PrecoCusto",data:o.map(function(o){return o.precoCusto}),display:o.map(function(o){return"R$"+o.strPrecoCusto})}}}function h(){return{labels:[],dataset:{label:"",data:[]}}}console.log("dados noov",l),r.periodoPersonalizado={dataInicial:new Date,dataFinal:new Date},l[i.Faturamento]=h(),l[i.NumVendas]=h(),l[i.Payout]=h(),l[i.precoCusto]=h(),d(),r.verFaturamento=function(){r.visualizacao=i.Faturamento,l[i.Faturamento]=p(r.relatorio),u()},r.verNumVendas=function(){r.visualizacao=i.NumVendas,l[i.NumVendas]=f(r.relatorio),u()},r.verPayout=function(){r.visualizacao=i.Payout,l[i.Payout]=m(r.relatorio),u()},r.verPrecoCusto=function(){r.visualizacao=i.precoCusto,l[i.precoCusto]=g(r.relatorio),u()},r.selecionarPeriodo=function(o){r.carregando||(r.periodo=o,r.periodo!=n.Personalizado&&d())},r.selecionarPeriodoPersonalizado=function(){r.periodoPersonalizado.dataInicial&&r.periodoPersonalizado.dataFinal&&d()},r.graficoLabelTitulo=function(){return"faturamento"===r.visualizacao?"Faturamento":"numvendas"===r.visualizacao?"N° de vendas":"precoCusto"===r.visualizacao?"Preço Custo":"Payout"},r.downloadCsv=function(){r.baixandoCsv=!0,t.relatorioVendasIndividual(r.periodo,r.periodoPersonalizado).then(function(o){var o=new Blob(["\ufeff",o],{type:"text/csv;charset=utf-8"}),e=document.createElement("a");e.setAttribute("href",window.URL.createObjectURL(o)),e.setAttribute("download","vendas.csv"),document.body.appendChild(e),e.click()}).catch(function(o){console.log(o)}).finally(function(){r.baixandoCsv=!1})}}]),angular.module("Proj").service("AnuncioMarketService",["$http","$q","ApiCK","$request",function(n,i,c,s){function l(o){o.preco=e(o.preco),o.precoCusto=e(o.precoCusto),o.peso=e(o.peso),o.altura=e(o.altura),o.comprimento=e(o.comprimento),o.largura=e(o.largura)}function e(o){return o?o.replace(",","."):null}return{obterProduto:function(o){var e=i.defer();return n.get(c+"adm/produto/"+o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},listarProdutos:function(o,e,a){var e=e||"",a=a||"",r=i.defer();return n.get(c+"adm/usuarios/"+o+"/anuncios?amount="+e+"&termo="+a).success(function(o){r.resolve(o)}).error(function(o){r.reject(o)}),r.promise},salvarProduto:function(o,e,a){var r=i.defer(),o=c+"adm/usuario/"+o+"/produto",e=angular.copy(e);return l(e),n.post(o,e).success(function(o){r.resolve(o)}).error(function(o){r.reject(o)}),r.promise},salvarMidiaProduto:function(o,e){var a={},r=(a.link=e,i.defer());return n.post(c+"adm/produto/"+o+"/media/add",a).success(function(o){r.resolve(o)}).error(function(o){r.reject(o)}),r.promise},salvarMuitasMidiasProduto:function(o,e){var a=i.defer();return n.post(c+"adm/produto/"+o+"/media/add/many",{imgs:e}).success(a.resolve).error(a.reject),a.promise},excluirMidiaProduto:function(o,e){var a=i.defer();return n.delete(c+"adm/produto/"+o+"/media/"+e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},obterConfiguracaoAnuncio:function(){var e=i.defer();return n.get(c+"adm/produto/configuracoes").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterTipoProduto:function(o){var e=i.defer();return n.get(c+"adm/tiposproduto/"+o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},salvarEdicao:function(o,e){var a=i.defer(),r=c+"adm/produto/"+o.id,o=angular.copy(o);return l(o),n.put(r,o).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},editarPreco:function(o,e){e=(e||"").toString().replace(",",".");return s.patch(c+"adm/produto/"+o+"/preco",{preco:e})},obterDetalhesEstoque:function(o){return s.get(c+"adm/produto/"+o+"/stock")},editarEstoque:function(o,e){return s.put(c+"adm/produto/"+o+"/stock",e)},alterarStatus:function(o,e){return s.patch(c+"adm/anuncios/"+o+"/status",{status:e})},ativarProduto:function(o){return s.put(c+"adm/produto/"+o+"/ativar")},excluirAnuncio:function(o){return s.delete(c+"adm/produto/"+o+"/excluir")},setModoViagem:function(o){return s.patch(c+"usuario/modoviagem/"+(o?"on":"off"),{})},criarConsignacao:function(o){var e=c+"consignacao",o=angular.copy(o);return o.produto.preco=o.produto.preco.replace(".","").replace(",","."),s.post(e,o)},editarConsignacao:function(o,e){e=angular.copy(e);return e.produto.preco=e.produto.preco.replace(",","."),s.put(c+"consignacao/"+o,e)},obterLojas:function(){return s.get(c+"lojafisica?termo= &page=0&amount=5")},obterFormConfig:function(){return s.get(c+"anuncio/formconfig")},searchDrop:function(o,e,a){o=c+"/anuncio/drops?q="+o+"&page="+(a||0);return e&&(o+="&tiposproduto="+e),s.get(o)},obterDadosMercadoDoDrop:function(o,e,a){var o=c+"anuncio/drops/"+o+"/market",r=!!a,t=[];return!!e&&!!e.length&&(e=(e||[]).reduce((o,e)=>o+","+e),t.push("sizes="+e)),r&&t.push("condicao="+a),0<t.length&&(o+="?"+t.join("&")),s.get(o)},salvarProdutoV3:function(o,e,a,r){var t=i.defer(),o=c+"adm/usuario/"+o+"/produto/v3",e=angular.copy(e);return l(e),n.post(o,{produto:e,avarias:r}).success(function(o){t.resolve(o)}).error(function(o){t.reject(o)}),t.promise},salvarEdicaoV3:function(o,e,a){var r=i.defer(),t=c+"adm/produto/"+o.id+"/v3",o=angular.copy(o);return l(o),n.put(t,{produto:o,avarias:a}).success(function(o){r.resolve(o)}).error(function(o){r.reject(o)}),r.promise}}}]),angular.module("Proj").service("ContaWirecardService",["$http","$q","ApiCK","$request",function(o,e,a,r){function t(o){return a+"usuarios/"+o+"/wirecard"}function n(o){return a+"usuarios/"+o+"/empresas"}return{verificarPendencias:function(o){return r.get(t(o)+"/verificar")},obterResumoCadastro:function(o){return r.get(t(o))},obterCadastroWirecard:function(o){return r.get(t(o)+"/sync")},syncCadastro:function(o){return r.post(t(o)+"/sync")},obterEmpresa:function(o){return r.get(n(o))},apagarEmpresa:function(o){return r.delete(n(o))},atualizarEmpresa:function(o,e){return r.put(n(o),e)}}}]),angular.module("Proj").service("FiscalService",["$http","$q","ApiCK","$request",function(o,e,a,r){return{obterDadosFiscais:function(o){return r.get(a+"usuarios/"+o+"/fiscais")},obterEmpresa:function(o){return r.get(a+"usuarios/"+o+"/empresas")},apagarEmpresa:function(o){return r.delete(a+"usuarios/"+o+"/empresas")},atualizarEmpresa:function(o,e){return r.put(a+"usuarios/"+o+"/empresas",e)}}}]),angular.module("Proj").service("PagarmeService",["$http","$q","ApiCK","$request",function(o,e,a,r){return{obterContaRecebedor:function(){return r.get(a+"usuarios/pagarme")},salvarConta:function(o){return r.put(a+"usuarios/pagarme/contabancaria",o)},obterSaldo:function(){return r.get(a+"usuarios/pagarme/saldo")},obterSaldoReal:function(){return r.get(a+"usuarios/pagarme/saldo/real")},obterRecebiveis:function(){return r.get(a+"usuarios/pagarme/recebiveis")},obterAReceber:function(){return r.get(a+"usuarios/pagarme/areceber")},realizarSaque:function(o){return r.post(a+"usuarios/pagarme/saque",o)},realizarSaque_MOCK:function(o,e){return r.post(a+"usuarios/pagarme/mock/saque?sucesso="+(e||!e&&!1!==e),o)},obterHistoricoSaque:function(){return r.get(a+"usuarios/pagarme/saque/historico")},pesquisarInstituicao:function(o){return r.get(a+"usuarios/pagarme/instituicoesbancarias?q="+o)}}}]),angular.module("Proj").service("PaymentService",["$http","$q","ApiCK","$request",function(a,r,t,n){return{obterVendedorPendencias:function(){return n.get(t+"vendas/pendencias")},atualizarCpf:function(o,e){return n.put(t+"usuarios/"+o+"/cpf/"+e)},obterStatusPagamento:function(o){var e=r.defer();return a.get(t+"interesses/"+o+"/mercadopago/status").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},sincronizarPagamentoInteresse:function(o){return n.get(t+"interesses/"+o+"/mercadopago/syncpayment")},sincronizarPagamentoInteresseJuno:function(o){return n.get(t+"interesses/"+o+"/juno/syncpayment")}}}]),angular.module("Proj").service("PendenciasSellerService",["$http","$q","ApiCK","$request",function(o,e,a,r){return{get:function(){return r.get(a+"market")},verificarPendencias:function(o){return r.get(a+"usuarios/"+o+"/pendencias")}}}]),angular.module("Proj").service("ReportsService",["ApiCK","$request",function(r,t){return{obterRelatorioDoVendedor:function(o,e,a){a=null!=a?"dataFiltro="+a+"&":null!=e?"periodo="+e+"&":"";return t.get(r+"adm/usuario/"+o+"/reports/vendas?"+a)}}}]),angular.module("Proj").service("RecebedorService",["$http","$q","ApiCK","$request",function(o,e,r,t){return{obterPerfil:function(o){return t.get(r+"usuarios/"+o+"/perfil")},obterRecebedor:function(o){return t.get(r+"usuarios/0/recebedor")},obterSaldo:function(o){return t.get(r+"usuarios/"+o+"/saldo")},obterRecebiveis:function(o){return t.get(r+"usuarios/"+o+"/recebiveis")},obterRelatorioALiberar:function(o){return t.get(r+"usuarios/"+o+"/saldo/futuro")},pesquisarBanco:function(o){return t.get(r+"banks/"+o)},obterContasBancarias:function(o){return t.get(r+"usuarios/"+o+"/contasbancarias")},obterContaPreferida:function(o){return t.get(r+"usuarios/"+o+"/contasbancarias/preferida")},trocarContaPreferida:function(o,e){return t.put(r+"usuarios/"+o+"/contasbancarias/preferida/"+e)},criarContaBancaria:function(o,e,a){return t.post(r+"usuarios/"+o+"/contasbancarias?vt="+a,e)},apagarConta:function(o,e){return t.delete(r+"usuarios/"+o+"/contasbancarias/"+e)},realizarSaque:function(o,e){return t.post(r+"usuarios/"+o+"/saque",e)},obterHistoricoSaques:function(o){return t.get(r+"usuarios/"+o+"/saques/historico")},__OLD_realizarTransferencia:function(o,e){return t.post(r+"usuarios/"+o+"/recebedor/transferencia",e)}}}]),angular.module("Proj").service("VendaService",["ApiCK","$request",function(r,t){return{obter:function(o){return t.get(r+"vendas/"+o)},obterVendas:function(){return t.get(r+"vendas")},obterVendasHistorico:function(o,e){return t.get(r+"vendas/historico/"+o+"/"+e)},obterVenda:function(o){return t.get(r+"vendas/"+o)},syncStatusVenda:function(o){return t.get(r+"interesses/"+o+"/syncpayment")},estaIndisponivel:function(o,e){o=r+"vendas/"+o;return t.delete(o=0<e?o+"?idtamanho="+e:o)},confirmarEstoque:function(o){return t.post(r+"vendas/"+o+"/confirmar?advanced=false")},cancelarDisponibilidade:function(o){return t.delete(r+"vendas/"+o+"/cancelarconfirmacao")},removerEstoque:function(o){return t.delete(r+"vendas/"+o+"/estoque")},obterDadosEnvio:function(o){return t.get(r+"vendas/"+o+"/frete")},obterEnderecoEntrega:function(o){return t.get(r+"interesses/"+o+"/enderecoentrega")},enviarDadosEntregaVendedor:function(o){return t.post(r+"vendas/"+o+"/sendpostdataforseller")},enviarEtiquetaEmail:function(o){return t.post(r+"vendas/"+o+"/etiqueta/sendforemail")},confirmarEntrega:function(o){return t.put(r+"vendas/"+o+"/entregue")},gerarEtiqueta:function(o){return t.get(r+"vendas/"+o+"/geraretiqueta")},gerarEnvioLoggi:function(o){return t.patch(r+"vendas/"+o+"/gerarloggi")},confirmarDevolucao:function(o){return t.put(r+"vendas/"+o+"/devolucao/confirmar")},removerItemEstoque:function(o,e){return t.delete(r+"vendas/"+o+"/carrinho/item/"+e)},obterTagsDoUsuario:function(){return t.get(r+"tags")},criarTag:function(o){return t.post(r+"tags",o)},editarTag:function(o){var e=r+"tags/"+o.id;return t.put(e,o)},salvarTag:function(o){return o.id?this.editarTag(o):this.criarTag(o)},desativarTag:function(o){return t.delete(r+"tags/"+o)},vincularTagAoInteresse:function(o){return t.post(r+"interesses/tags",o)},relatorioVendas:function(o,e){var a=r+"usuario/relatorio/vendas?periodo="+o;return"personalizado"===o&&(a=a+"&de="+e.dataInicial.toISOString()+"&ate="+e.dataFinal.toISOString()),t.get(a)},relatorioVendasIndividual:function(o,e){var a=r+"usuario/relatorio/vendas/csv?periodo="+o;return"personalizado"===o&&(a=a+"&de="+e.dataInicial.toISOString()+"&ate="+e.dataFinal.toISOString()),t.get(a)}}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/market/cliente/inicio",{controller:"InicioClienteCtrl",templateUrl:"angular/app/market/cliente/inicio/partials/inicio.tpl.html",tabControl:"Market",title:"Anuncie grátis"}).when("/market/cliente/configuracao",{controller:"InicioClienteCtrl",templateUrl:"angular/app/market/cliente/inicio/partials/configuracoes.tpl.html",tabControl:"Market",title:"Configurações"})}]).controller("InicioClienteCtrl",["$scope","$rootScope","$location","$mdMedia","$routeParams","$mdDialog","InicioClienteService","AuthFactory","PaymentService","RecebedorService","ContaWirecardService","SaldoWirecardService","MarketService","AvaliacaoService",function(e,a,o,r,t,n,i,c,s,l,d,u,p,f){e.$mdMedia=r,e.saldo={},e.dadosUsuario={},e.carregandoInicio=!0,e.erroCarregando=!1,e.podeAnunciar=!1,e.podeConsignar=!1,e.isCliente=!0,e.preCondicoes=function(){c.isLoggedIn()&&"1"===c.get().tipo?(e.carregar(),e.isCliente=!0):(a.showToast("Para iniciar suas vendas você deve estar logado"),a.irParaLogin())},e.isDebugMode=function(){return"localhost"==window.location.hostname},e.carregar=function(){e.dadosUsuario=c.get(),i.verificarPendencias(e.dadosUsuario.id).then(function(o){console.log("PENDENCIAS -> ",o),o.pendencias.isComplete?(e.podeAnunciar=!0,e.podeConsignar=o.pendencias.podeConsignar,e.carregarSaldo(),e.carregarResumoAnuncio()):(a.irPara("market/pendencias"),a.showToast("Complete seus dados para anunciar"))}).catch(function(){e.erroCarregando=!0}).finally(function(){e.carregandoInicio=!1,e.podeAnunciar&&e.carregarResumoAnuncio()})},e.carregarSaldo=function(){e.carregandoSaldo=!0,p.obterSaldo(c.get().id).then(function(o){e.saldo=o,e.visaoGeral=o.geral}).catch(function(o){console.error("saldo",o)}).finally(function(){e.carregandoSaldo=!1})},e.carregarResumoAnuncio=function(){e.carregandoResumoAnuncios=!0,i.obterResumoAnuncios().then(function(o){e.totalAnunciosAtivos=o.totalAtivos,e.totalContrato=o.quantidadeContrato,0==e.totalAnunciosAtivos&&(e.showRecomendacoes=!0),e.carregandoResumoAnuncios=!1}).catch(function(o){})},e.terminarSessao=function(){c.logout(),a.showToast("Você foi deslogado"),a.irPara("market")},e.onPodeAnunciar=function(){e.podeAnunciar=!0},e.verDialogAvaliacoes=function(){var o="1"!==e.dadosUsuario.tipo?e.dadosUsuario.idLoja:e.dadosUsuario.idCliente;e.tipo=e.dadosUsuario.tipo,n.show({controller:"RateCtrl",templateUrl:"angular/app/loja/partials/avaliacoesDialog.tpl.html",fullscreen:!1,scope:e,clickOutsideToClose:!!window.cordova,preserveScope:!0}).then(function(){},function(){}),e.carregando=!0,f.obterAvaliacoes(o,e.tipo).then(function(o){e.dados=o}).catch(function(o){a.hideDialog(),a.showToast("Ops, algo de errado aconteceu")}).finally(function(){e.carregando=!1})},e.showRelatorioVendasComparadaDialog=function(o){o={controller:"MarketRelatorioCtrl",templateUrl:"angular/app/market/partials/relatorioVendasComparadasDialog.tpl.html",parent:angular.element(document.body),targetEvent:o,clickOutsideToClose:!window.cordova,fullscreen:!1};n.show(o).then(function(){},function(){})},e.showTaxasDialog=function(o){o={controller:"MarketTaxasDialogCtrl",templateUrl:"angular/app/market/partials/exibicaoTaxasDialog.tpl.html",parent:angular.element(document.body),targetEvent:o,clickOutsideToClose:!window.cordova,fullscreen:!1};n.show(o).then(function(){},function(){})},e.iniciarCSU=void e.preCondicoes()}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/market/cliente/produtos",{controller:"ListaProdutosClienteCtrl",templateUrl:"angular/app/market/cliente/listaproduto/partials/list.tpl.html",tabControl:"Market",title:"Anúncios"})}]).controller("ListaProdutosClienteCtrl",["$scope","$rootScope","$location","$mdMedia","$routeParams","$mdDialog","ListaProdutosClienteService","AuthFactory","$mdBottomSheet","$timeout",function(a,r,o,e,t,n,i,c,s,l){a.$mdMedia=e,a.preCondicoes=function(){c.isLoggedIn()&&"1"===c.get().tipo?a.carregaProdutos():(r.showToast("Sessão encerrada"),r.irPara("market"))},a.carregaProdutos=function(){a.carregando=!0,i.obterAnuncios().then(function(o){a.produtos=o.ativos,a.statusmostrando="ativos",a.produtosAtivos=o.ativos,a.produtosInativos=o.inativos}).catch(function(){r.showToast("Ops, algo de errado aconteceu")}).finally(function(){a.carregando=!1})},a.desativarProduto=function(o){i.desativarProduto(o).then(function(o){a.carregaProdutos(),r.showToast("Anúnio desativado com sucesso!")}).catch(function(o){r.showToast("Erro ao desativar o produto")})},a.ativarProduto=function(o){i.ativarProduto(o).then(function(o){a.carregaProdutos(),r.showToast(o)}).catch(function(o){r.showToast(o)})},a.toogleProdutosStatus=function(){"ativos"===a.statusmostrando?(a.produtos=a.produtosInativos,a.statusmostrando="inativos"):(a.statusmostrando="ativos",a.produtos=a.produtosAtivos)},a.toogleVendidoStatus=function(o,e){i.toogleStatusVendido(o,e).then(function(o){a.carregaProdutos(),r.showToast(o)}).catch(function(o){r.showToast(o)})},a.resolveImagemProduto=function(o,e){return 0<e.indexOf("//")?e:"angular/img/default.jpg"},a.iniciarCSU=void a.preCondicoes()}]),angular.module("Proj").service("InicioClienteService",["$http","$q","ApiCK","AuthFactory","$request",function(a,r,t,n,e){return{obterPerfil:function(o){return e.get(t+"adm/cliente/"+o)},verificarPendencias:function(o){return e.get(t+"usuarios/"+o+"/pendencias")},obterResumoAnuncios:function(){var e=r.defer(),o=t+"adm/cliente/"+n.get().idCliente+"/anuncios/resumo";return a.get(o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise}}}]),angular.module("Proj").service("ListaProdutosClienteService",["$http","$q","ApiCK","AuthFactory",function(r,t,n,a){return{desativarProduto:function(o){var e=t.defer();return r.delete(n+"adm/produto/"+o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},ativarProduto:function(o){var e=t.defer();return r.put(n+"adm/produto/"+o+"/ativar").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},toogleStatusVendido:function(o,e){var e=!e,a=t.defer();return r.put(n+"adm/produto/"+o+"/vendido/"+e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},obterAnuncios:function(){var e=t.defer(),o=n+"adm/cliente/"+a.get().idCliente+"/anuncios";return r.get(o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise}}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/market/loja/cadastro",{controller:"CadastroCtrl",templateUrl:"angular/app/market/loja/cadastro/partials/cadastro.tpl.html",tabControl:"Market",title:"Cadastro de loja"}).when("/market/loja/editar",{controller:"CadastroCtrl",templateUrl:"angular/app/market/loja/cadastro/partials/editar.tpl.html",tabControl:"Market",title:"Editar dados da loja"}).when("/market/loja/editarsenha",{controller:"MudarSenhaCtrl",templateUrl:"angular/app/market/loja/cadastro/partials/senha/edit.tpl.html",tabControl:"Market",title:"Editar senha"}).when("/market/loja/editarrota",{controller:"MudarRotaCtrl",templateUrl:"angular/app/market/loja/cadastro/partials/rota/edit.tpl.html",tabControl:"Market",title:"Editar link"}).when("/market/loja/editaremail",{controller:"MudarEmailCtrl",templateUrl:"angular/app/market/loja/cadastro/partials/email/edit.tpl.html",tabControl:"Market",title:"Editar email"})}]).controller("CadastroCtrl",["$scope","$rootScope","$mdMedia","$mdDialog","$routeParams","$mdToast","AuthFactory","CadastroService","DataValidationService",function(a,r,o,e,t,n,i,c,s){a.cadastrando=!1,a.cadastrarLoja=function(e){a.cadastrando=!0,e.email=e.email.toLowerCase(),c.create(e).then(function(o){r.irPara("market/loja/entrar/mail/"+e.email)}).catch(function(o){r.showToast("Verifique os erros"),r.formErrorBinder(a,o)}).finally(function(){a.cadastrando=!1})},a.carregarEditarLoja=function(){a.carregandoEditarLoja=!0,a.editarLocalizaoShow=0,c.get(i.get().idLoja).then(function(o){a.dadosLoja=o}).catch(function(o){r.voltarPagina(),r.showToast("Ops, algo de errado aconteceu")}).finally(function(){a.carregandoEditarLoja=!1})},a.alterarWallpaper=function(){r.showImageSelector(4e5,1720).then(function(o){a.dadosLoja.wallpaper=o}).catch(function(o){r.showToast("Erro ao atualizar wallpaper. "+o)})},a.alterarFotoPerfil=function(){r.showImageSelector(1e3,100).then(function(o){a.dadosLoja.fotoperfil=o}).catch(function(o){r.showToast("Erro ao atualizar foto de perfil. "+o)})},a.salvarEdicaoLoja=function(){a.salvandoEdicaoLoja=!0,a.dadosLoja.dataNascimento=s.validarDataNascimento(a.dadosLoja.dataNascimentoDia,a.dadosLoja.dataNascimentoMes,a.dadosLoja.dataNascimentoAno),null==a.dadosLoja.dataNascimento?(a.singleError="Data de nascimento inválida",a.salvandoEdicaoLoja=!1):c.edit(i.get().idLoja,a.dadosLoja).then(function(o){i.updateUser(i.getToken()),r.showToast("Dados da loja estão atualizados"),a.irPara("market/loja/inicio")}).catch(function(o){r.formErrorBinder(a,o)}).finally(function(){a.salvandoEdicaoLoja=!1})}}]).controller("MudarSenhaCtrl",["$scope","$rootScope","$location","$routeParams","$mdDialog","CadastroService","AuthFactory",function(e,a,o,r,t,n,i){e.salvarNovaSenha=function(o){e.salvando=!0,n.mudarSenha(i.get().idLoja,o).then(function(o){a.showToast(o),a.irPara("market/loja/inicio")}).catch(function(o){a.formErrorBinder(e,o)}).finally(function(o){e.salvando=!1})}}]).controller("MudarEmailCtrl",["$scope","$rootScope","$mdDialog","CadastroService","AuthFactory",function(e,a,o,r,t){e.salvarEmail=function(o){e.salvando=!0,r.editarEmail(t.get().idLoja,o).then(function(o){a.showToast(o),a.irPara("market/loja/inicio")}).catch(function(o){e.showToast(o.Message||o)}).finally(function(o){e.salvando=!1})}}]).controller("MudarRotaCtrl",["$scope","$rootScope","$location","$routeParams","$mdDialog","CadastroService","AuthFactory",function(e,a,o,r,t,n,i){e.carregarEdicaoRota=function(){e.carregandoEditarRotaLoja=!0,n.get(i.get().idLoja).then(function(o){e.rota=o.url}).catch(function(o){a.showToast(o)}).finally(function(){e.carregandoEditarRotaLoja=!1})},e.salvarRota=function(o){e.salvandoRota=!0,n.editarRota(i.get().idLoja,o).then(function(o){a.showToast(o),e.salvandoRota=!1,a.irPara("market/loja/inicio")}).catch(function(o){e.rotaerror=o.Message||o}).finally(function(){e.salvandoRota=!1})}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/market/loja/categorias",{controller:"CategoriaCtrl",templateUrl:"angular/app/market/loja/categoria/partials/view.tpl.html",tabControl:"Market",title:"Categorias da loja"})}]).controller("CategoriaCtrl",["$scope","$rootScope","$location","$routeParams","$mdDialog","CategoriaService","AuthFactory",function(a,e,o,r,t,n,i){a.preCondicoes=function(){},a.carregarGerenciaCategoria=function(){a.carregandoCategoria=!0,n.obterTodasCategorias(i.get().idLoja).then(function(o){a.categorias=o.categoriaAtivas,a.categoriasInativas=o.categoriaInativas}).finally(function(){a.carregandoCategoria=!1})},a.salvarCategoria=function(o){a.salvandoCategoria=!0,n.salvarCategoria(i.get().idLoja,o).then(function(o){a.hideDialog(),e.showToast(o),a.carregarGerenciaCategoria()}).catch(function(o){e.formErrorBinder(a,o)}).finally(function(){a.salvandoCategoria=!1})},a.editarCategoria=function(o){a.editandoCategoria=!0,n.editarCategoria(i.get().idLoja,o).then(function(o){e.showToast(o),a.hideDialog(),a.carregarGerenciaCategoria()}).catch(function(o){e.formErrorBinder(a,o)}).finally(function(){a.editandoCategoria=!1})},a.opcoesCategoriaDialog=function(o,e){a.dadosCategoria=e,t.show({controller:"CategoriaCtrl",templateUrl:"angular/app/market/loja/categoria/partials/dialogs/opcoesCategoriaDialog.tpl.html",parent:angular.element(document.body),scope:a,preserveScope:!0,targetEvent:o,clickOutsideToClose:!window.cordova}).then(function(){},function(){})},a.cadastroCategoriaDialog=function(o){a.salvandoCategoria=!1,t.show({controller:"CategoriaCtrl",templateUrl:"angular/app/market/loja/categoria/partials/dialogs/cadastroCategoriaDialog.tpl.html",parent:angular.element(document.body),scope:a,preserveScope:!0,targetEvent:o,clickOutsideToClose:!window.cordova}).then(function(){},function(){})},a.dicaCategoriaDialog=function(o){a.salvandoCategoria=!1,t.show({controller:"CategoriaCtrl",templateUrl:"angular/app/market/loja/categoria/partials/dialogs/dicasCategoriaDialog.tpl.html",scope:a,preserveScope:!0,clickOutsideToClose:!window.cordova}).then(function(){},function(){})},a.iniciarCSU=void a.preCondicoes()}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/market/loja/entrar",{controller:"EntrarCtrl",templateUrl:"angular/app/market/loja/entrar/partials/entrar.tpl.html",tabControl:"Market",title:"Login para lojas"}).when("/usuario/recuperarsenha/:token",{controller:"RecuperarSenhaCtrl",templateUrl:"angular/app/market/loja/entrar/partials/recuperarsenha.tpl.html",tabControl:"Market",title:"Redefinição de senha"}).when("/market/loja/entrar/mail/:mail",{controller:"EntrarCtrl",templateUrl:"angular/app/market/loja/entrar/partials/entrar.tpl.html",tabControl:"Market",title:"Login para lojas"})}]).controller("EntrarCtrl",["$scope","$rootScope","$location","$mdDialog","$routeParams","EntrarService","AuthFactory","DeviceService",function(e,a,o,r,t,n,i,c){e.dadosDevice={},e.carregandoDevice=!1,e.carregaLogin=function(){e.entrar={};var o=i.get();"2"===o.tipo&&n.obterDadosLoja(o.idLoja).then(function(o){e.atalho=!0,e.dadosLojaAtalho=o}),t.mail&&(e.entrar.username=t.mail,e.mensagemCadastro=!0)},e.obterDadosDevice=function(){e.carregandoDevice=!0,c.getDevice().then(function(o){e.dadosDevice=o}).finally(function(){e.carregandoDevice=!1})},e.obterDadosDevice(),e.logarLoja=function(o){o.device=e.dadosDevice,e.carregandoLogin=!0,e.loginError="",n.auth(o).then(function(o){var e;"1"==o.tipo?(a.showToast("Sua conta não é PRO! Entre por aqui."),a.irPara("login")):(o.token=o.keypass,i.login(o),e=o.idLoja,o=o.keypass,n.atualizarOneSignal(e,o).then(function(o){}).catch(function(o){}),a.irPara("market/loja/inicio"),a.showToast("Bem-vindo ao painel de gerenciamento da sua loja"))}).catch(function(o){e.loginError="Email ou senha estão incorretos"}).finally(function(){e.carregandoLogin=!1})}}]).controller("RecuperarSenhaCtrl",["$scope","$rootScope","$location","$mdDialog","$routeParams","EntrarService",function(e,a,o,r,t,n){e.validarToken=function(){e.carregando=!0,n.validarTokenRecuperarSenha(t.token).then(function(o){e.email=o.email}).catch(function(o){a.irPara("erro/404")}).finally(function(){e.carregando=!1})},e.redefinirSenha=function(o){e.salvando=!0,n.redefinirSenha(t.token,o).then(function(o){a.showToast("Senha redefinida com sucesso"),a.irPara("market")}).catch(function(o){a.formErrorBinder(e,o)}).finally(function(){e.salvando=!1})}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/market/loja/inicio",{controller:"InicioCtrl",templateUrl:"angular/app/market/loja/inicio/partials/inicio.tpl.html",tabControl:"Market",title:"Painel da loja"}).when("/market/loja/configuracoes",{controller:"InicioCtrl",templateUrl:"angular/app/market/loja/inicio/partials/configuracoes.tpl.html",tabControl:"Market",title:"Configurações"}).when("/market/loja/plano",{controller:"PlanoCtrl",templateUrl:"angular/app/market/loja/inicio/partials/plano.tpl.html",tabControl:"Market",title:"Plano"})}]).controller("InicioCtrl",["$scope","$rootScope","$location","$mdMedia","$routeParams","$mdDialog","InicioService","AuthFactory","PaymentService","RecebedorService","ContaWirecardService","SaldoWirecardService","PendenciasSellerService","MarketService","AvaliacaoService",function(e,a,o,r,t,n,i,c,s,l,d,u,p,f,m){e.$mdMedia=r,e.isCliente=!1,e.podeAnunciar=!1,e.podeConsignar=!1,e.preCondicoes=function(){c.isLoggedIn()?(e.idUsuario=c.get().id,e.isCliente=0<c.get().idCliente,e.carregar()):(a.showToast("Sessão encerrada"),a.irPara("mais"))},e.carregar=function(){e.carregandoInicio=!0,i.obterDadosLoja(c.get().idLoja).then(function(o){e.dadosLoja=o}).then(function(){return p.verificarPendencias(e.idUsuario).then(function(o){o.pendencias.isComplete?(e.podeAnunciar=!0,e.podeConsignar=o.pendencias.podeConsignar,e.carregarSaldo()):(a.irPara("market/pendencias"),a.showToast("Complete seus dados para anunciar"))})}).catch(function(o){e.erroCarregando=!0,e.showToast(o||"Erro ao carregar início da loja")}).finally(function(){e.carregandoInicio=!1,e.podeAnunciar})},e.carregarSaldo=function(){e.carregandoSaldo=!0,f.obterSaldo(c.get().id).then(function(o){e.saldo=o,e.visaoGeral=o.geral}).catch(function(o){}).finally(function(){e.carregandoSaldo=!1})},e.terminarSessao=function(){c.logout(),a.showToast("Você foi deslogado"),a.irPara("market/loja/entrar")},e.verDialogAvaliacoes=function(){var o=e.dadosLoja.url;e.tipo="2",n.show({controller:"RateCtrl",templateUrl:"angular/app/loja/partials/avaliacoesDialog.tpl.html",fullscreen:!1,scope:e,clickOutsideToClose:!!window.cordova,preserveScope:!0}).then(function(){},function(){}),e.carregando=!0,m.obterAvaliacoes(o,e.tipo).then(function(o){e.dados=o}).catch(function(o){a.hideDialog(),a.showToast("Ops, algo de errado aconteceu")}).finally(function(){e.carregando=!1})},e.showRelatorioVendasComparadaDialog=function(o){o={controller:"MarketRelatorioCtrl",templateUrl:"angular/app/market/partials/relatorioVendasComparadasDialog.tpl.html",parent:angular.element(document.body),targetEvent:o,clickOutsideToClose:!window.cordova,fullscreen:!1};n.show(o).then(function(){},function(){})},e.showTaxasDialog=function(o){o={controller:"MarketTaxasDialogCtrl",templateUrl:"angular/app/market/partials/exibicaoTaxasDialog.tpl.html",parent:angular.element(document.body),targetEvent:o,clickOutsideToClose:!window.cordova,fullscreen:!1};n.show(o).then(function(){},function(){})},e.onPodeAnunciar=function(){e.podeAnunciar=!0},e.iniciarCSU=void e.preCondicoes()}]).controller("PlanoCtrl",["$scope","$sce","$rootScope","$location","$mdMedia","$routeParams","$mdDialog","InicioService","AuthFactory",function(e,a,o,r,t,n,i,c,s){e.$mdMedia=t,e.preCondicoes=function(){s.isLoggedIn()||(o.showToast("Sessão encerrada"),o.irPara("market/loja/entrar"))},e.resolveBgPlano=function(o){switch(o){case 1:return"silver";case 2:return"gold";case 3:return"diamond";default:return""}},e.carregarPlanosDisponiveis=function(){c.obterPlanos().then(function(o){e.planos=o}).catch(function(o){})},e.showPrerenderedDialog=function(o){i.show({controller:"PlanoCtrl",contentElement:"#myDialog",parent:angular.element(document.body),targetEvent:o,clickOutsideToClose:!window.cordova})},e.confiarHTML=function(o){return a.trustAsHtml(o)},e.iniciarCSU=void e.preCondicoes()}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/market/loja/produtos",{controller:"ListaProdutosLojaCtrl",templateUrl:"angular/app/market/loja/listaproduto/partials/list.tpl.html",tabControl:"Market",title:"Anúncios"})}]).controller("ListaProdutosLojaCtrl",["$scope","$rootScope","$location","$mdMedia","$routeParams","$mdDialog","ListaProdutosLojaService","CategoriaService","AuthFactory",function(r,t,o,e,a,n,i,c,s){r.preCondicoes=function(){s.isLoggedIn()||(t.showToast("Sessão encerrada"),t.irPara("market/loja/entrar"))},r.carregaProdutos=function(){r.carregandoListaProdutos=!0,i.obterProdutosLoja(s.get().idLoja).then(function(o){r.listaProdutos=o,r.listaProdutos.idLoja=s.get().idLoja,r.carregaCategoriasLoja()}).catch(function(o){r.errorListaProdutos=o}).finally(function(){r.carregandoListaProdutos=!1})},r.carregaProdutosDesativos=function(){r.carregandoListaProdutos=!0,r.idLoja=a.idloja,i.obterProdutosDesativadosLoja(s.get().idLoja).then(function(o){r.listaProdutos=o}).catch(function(o){r.errorListaProdutos=o}).finally(function(){r.carregandoListaProdutos=!1})},r.desativarProduto=function(e,a){i.desativarProduto(e.id).then(function(o){e.isAtivo=!1,t.showToast("Produto desativado com sucesso!"),r.listaProdutos.splice(a,1)}).catch(function(o){t.showToast("Erro ao desativar o produto")})},r.ativarProduto=function(e){i.ativarProduto(e.id).then(function(o){e.isAtivo=!0,t.showToast(o)}).catch(function(o){t.showToast(o)})},r.carregaCategoriasLoja=function(){c.obterCategorias(s.get().idLoja).then(function(o){r.categoriasDisponiveis=o})},r.filtarProdutosCategoria=function(o){r.carregandoListaProdutos=!0,i.obterProdutosLojaPorCategoria(s.get().idLoja,o).then(function(o){r.carregandoListaProdutos=!1,r.listaProdutos=o}).catch(function(o){r.carregandoListaProdutos=!1,r.errorListaProdutos=o})},r.filtrarProdutosLimpar=function(){r.termoPesquisaProdutos="",r.carregaProdutos(),r.filterProdutos=0},r.toogleVendidoStatus=function(e,a){i.toogleStatusVendido(e.id,a).then(function(o){e.isVendido=!a,t.showToast(o)}).catch(function(o){t.showToast(o)})},r.mover=function(o,e){i.moverProdutoNaLista(o,e).then(function(o){r.carregaProdutos(),t.showToast(o)}).catch(function(o){t.showToast(o)})},r.iniciarCSU=void r.preCondicoes()}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/market/loja/report",{controller:"ReportCtrl",templateUrl:"angular/app/market/loja/report/partials/view.tpl.html"})}]).controller("ReportCtrl",["$scope","$rootScope","$location","$routeParams","AuthFactory",function(o,e,a,r,t){o.preCondicoes=function(){t.isLoggedIn()||(e.showToast("Sess�o encerrada"),e.irPara("market/loja/entrar"))},o.iniciarCSU=void o.preCondicoes()}]).controller("ReportViewsCtrl",["$scope","$rootScope","$location","$routeParams","AuthFactory","ReportService",function(e,o,a,r,t,n){e.initReportViews=function(){e.page=-1,e.amount=5,e.views={},e.filtro="mes",e.carregarReport()},e.filtrarReport=function(){e.page=-1,e.filtro=e.views.filtro,e.carregarReport()},e.carregarReport=function(){e.page=e.page+1,e.carregando=!0,n.obterRelatorioProdutosViews(t.get().idLoja,e.filtro,e.page,e.amount).then(function(o){e.views=o,e.filtro=o.filtro}).catch(function(o){}).finally(function(){e.carregando=!1})}}]).controller("ReportConversoesCtrl",["$scope","$rootScope","$location","$routeParams","AuthFactory","ReportService",function(e,o,a,r,t,n){e.initReportConversoes=function(){e.page=-1,e.amount=5,e.views={},e.filtro="mes",e.carregarReport()},e.filtrarReport=function(){e.page=-1,e.filtro=e.views.filtro,e.carregarReport()},e.carregarReport=function(){e.page=e.page+1,e.carregando=!0,n.obterRelatorioProdutosConversoes(t.get().idLoja,e.filtro,e.page,e.amount).then(function(o){e.views=o,e.filtro=o.filtro}).catch(function(o){}).finally(function(){e.carregando=!1})}}]),angular.module("Proj").service("CadastroService",["$http","$q","$request","ApiCK",function(r,t,e,n){return{create:function(o){var e=t.defer();return r.post(n+"loja",o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},get:function(o){var e=t.defer();return r.get(n+"adm/loja/"+o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},edit:function(o,e){var a=t.defer();return r.put(n+"adm/loja/"+o,e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},editarRota:function(o,e){var a=t.defer();return r.put(n+"adm/loja/"+o+"/rota/"+e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},editarEmail:function(o,e){var a=t.defer();return r.put(n+"adm/loja/"+o+"/email",e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},mudarSenha:function(o,e){var a=t.defer();return r.put(n+"adm/loja/"+o+"/mudarsenha",e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},userMudarSenha:function(o){return e.patch(n+"usuarios/senha",o)}}}]),angular.module("Proj").service("CategoriaService",["$http","$q","ApiCK",function(r,t,n){return{salvarCategoria:function(o,e){var a=t.defer();return r.post(n+"adm/loja/"+o+"/categoria",e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},obterCategorias:function(o){var e=t.defer();return r.get(n+"adm/loja/"+o+"/categoria").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterTodasCategorias:function(o){var e=t.defer();return r.get(n+"adm/loja/"+o+"/categoria/todas").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},editarCategoria:function(o,e){var a=t.defer();return r.put(n+"adm/loja/"+o+"/categoria",e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},desativarCategoria:function(o,e){var a=t.defer();return r.delete(n+"adm/loja/"+o+"/categoria").success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise}}}]),angular.module("Proj").service("EntrarService",["$http","$q","ApiCK",function(r,t,n){return{auth:function(o){var e=t.defer();return r.post(n+"auth",o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterDadosLoja:function(o){var e=t.defer();return r.get(n+"adm/loja/"+o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},atualizarOneSignal:function(e,o){var a=t.defer();try{window.cordova?window.plugins.OneSignal.getDeviceState(function(o){o=n+"adm/loja/"+e+"/onesignal/"+o.userId;r.put(o).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)})}):a.reject("is not cordova")}catch(o){a.reject("erro onesignal ",o)}return a.promise},enviarRecuperacaoSenha:function(o){var e=t.defer();return r.post(n+"usuario/recuperarsenha/enviar",o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},validarTokenRecuperarSenha:function(o){var e=t.defer();return r.get(n+"usuario/recuperarsenha/validar/"+o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},redefinirSenha:function(o,e){var a=t.defer();return r.post(n+"usuario/recuperarsenha/redefinir/"+o,e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise}}}]),angular.module("Proj").service("InicioService",["$http","$q","ApiCK",function(a,r,t){return{auth:function(o){var e=r.defer();return a.post(t+"auth",o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterDadosLoja:function(o){var e=r.defer();return a.get(t+"adm/loja/"+o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterContrato:function(o){var e=r.defer();return a.get(t+"adm/loja/"+o+"/contrato").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterPlanos:function(){var e=r.defer();return a.get(t+"adm/planos").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise}}}]),angular.module("Proj").service("ListaProdutosLojaService",["$http","$q","ApiCK",function(r,t,n){return{desativarProduto:function(o){var e=t.defer();return r.delete(n+"adm/produto/"+o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},ativarProduto:function(o){var e=t.defer();return r.put(n+"adm/produto/"+o+"/ativar").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterProdutosLoja:function(o){var e=t.defer();return r.get(n+"adm/loja/"+o+"/produtos").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterProdutosDesativadosLoja:function(o){var e=t.defer();return r.get(n+"adm/loja/"+o+"/produtos/desativados").success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},obterProdutosLojaPorCategoria:function(o,e){var a=t.defer();return r.get(n+"adm/loja/"+o+"/produtos/categoria/"+e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},obterProduto:function(o){var e=t.defer();return r.get(n+"adm/produto/"+o).success(function(o){e.resolve(o)}).error(function(o){e.reject(o)}),e.promise},toogleStatusVendido:function(o,e){var e=!e,a=t.defer();return r.put(n+"adm/produto/"+o+"/vendido/"+e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise},moverProdutoNaLista:function(o,e){var a=t.defer();return r.put(n+"adm/produto/"+o+"/mover/"+e).success(function(o){a.resolve(o)}).error(function(o){a.reject(o)}),a.promise}}}]),angular.module("Proj").service("ReportService",["$http","$q","ApiCK",function(n,i,c){return{obterRelatorioProdutosViews:function(o,e,a,r){var t=i.defer(),o="adm/loja/:idloja/reports/produtos/views/filterby/:filtro/:page/:amount".replace(":idloja",o).replace(":filtro",e).replace(":page",a).replace(":amount",r);return n.get(c+o).success(function(o){t.resolve(o)}).error(function(o){t.reject(o)}),t.promise},obterRelatorioProdutosConversoes:function(o,e,a,r){var t=i.defer(),o="adm/loja/:idloja/reports/produtos/conversoes/filterby/:filtro/:page/:amount".replace(":idloja",o).replace(":filtro",e).replace(":page",a).replace(":amount",r);return n.get(c+o).success(function(o){t.resolve(o)}).error(function(o){t.reject(o)}),t.promise}}}]),angular.module("Proj").service("ContaWirecardService",["$http","$q","ApiCK","$request",function(o,e,a,r){function t(o){return a+"usuarios/"+o+"/wirecard"}function n(o){return a+"usuarios/"+o+"/empresas"}return{verificarPendencias:function(o){return r.get(t(o))},obterResumoCadastro:function(o){return r.get(t(o))},obterCadastroWirecard:function(o){return r.get(t(o)+"/sync")},syncCadastro:function(o){return r.post(t(o)+"/sync")},obterEmpresa:function(o){return r.get(n(o))},apagarEmpresa:function(o){return r.delete(n(o))},atualizarEmpresa:function(o,e){return r.put(n(o),e)}}}]),angular.module("Proj").service("SaldoWirecardService",["$http","$q","ApiCK","$request",function(o,e,a,r){function t(o){return a+"usuarios/"+o+"/wirecard"}return{obterSaldoMisto:function(o){return r.get(t(o)+"/saldo")},obterSaldoALiberar:function(o){return r.get(t(o)+"/saldo/aliberar")},obterSaldoExtrato:function(o){return r.get(t(o)+"/saldo/extrato")}}}]),angular.module("Proj").service("SaqueWirecardService",["$http","$q","ApiCK","$request",function(o,e,r,t){return{obterRecebiveis:function(o){return t.get(r+"usuarios/"+o+"/wirecard/recebiveis")},obterDadosRecebedor:function(o){return t.get(r+"usuarios/"+o+"/wirecard/recebedores")},pesquisarInstituicao:function(o,e){var a={};return a.termo=e,t.post(r+"usuarios/"+o+"/wirecard/contasbancarias/instituicoes",a)},salvarContaBancaria:function(o,e){return t.post(r+"usuarios/"+o+"/wirecard/contasbancarias",e)},apagarContaBancaria:function(o,e){return t.delete(r+"usuarios/"+o+"/wirecard/contasbancarias/"+e)},obterContasBancarias:function(o){return t.post(r+"usuarios/"+o+"/wirecard/contasbancarias")},realizarSaque:function(o,e){return t.post(r+"usuarios/"+o+"/wirecard/saque",e)}}}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/market/wc/confirm",{controller:"ContaWirecardCtrl",templateUrl:"angular/app/market/wirecard/contawirecard/partials/confirm.tpl.html",tabControl:"Market",title:"Confirmação de dados de vendedor"}).when("/market/wc/account",{controller:"ContaWirecardCtrl",templateUrl:"angular/app/market/wirecard/contawirecard/partials/account.tpl.html",tabControl:"Market",title:"Dados para Nota Fiscal"}).when("/market/wc/empresa",{controller:"ContaWirecardCtrl",templateUrl:"angular/app/market/wirecard/contawirecard/partials/empresaform.tpl.html",tabControl:"Market",title:"Criando empresa"}).when("/market/wc/empresa/:id",{controller:"ContaWirecardCtrl",templateUrl:"angular/app/market/wirecard/contawirecard/partials/empresaform.tpl.html",tabControl:"Market",title:"Editando empresa"})}]).controller("ContaWirecardCtrl",["$scope","$rootScope","$routeParams","$location","AuthFactory","ContaWirecardService","$mdDialog","DataValidationService",function(a,r,o,e,t,n,i,c){a.isCliente=!1,a.preCondicoes=function(){t.isLoggedIn()?(0<t.get().idCliente&&(a.isCliente=!0),a.idusuario=t.get().id):(r.voltarPagina(),r.showToast("Você não está logado"))},a.jaTemContaWirecard=!1,a.carregarDetalhesConta=function(){a.carregandoconta=!0,n.obterResumoCadastro(a.idusuario).then(function(o){o.pendencias.temContaWirecard&&(a.jaTemContaWirecard=!0),a.pendencias=o.pendencias,a.conta=o.conta}).catch(function(o){a.erro=!0,r.showToast("Ocorreu um erro ao carregar seus dados. Tente novamente mais tarde!")}).finally(function(){a.carregandoconta=!1})},a.confirmar=function(){a.salvando=!0,n.syncCadastro(a.idusuario).then(function(o){r.showToast("Pronto! Agora você pode continuar anunciando no Droper"),r.irPara("market")}).catch(function(o){console.log(o),r.showToast(o||"Ocorreu um erro ao confirmar seus dados. Verifique seus dados e tente novamente!")}).finally(function(){a.salvando=!1})},a.apagarEmpresa=function(){a.apagandoEmpresa=!0,n.apagarEmpresa(a.idusuario).then(function(o){r.showToast("Dados da empresa excluídos"),r.irPara("market")}).catch(function(o){r.showToast("Ocorreu um erro ao apagar os dados da empresa. Tente novamente mais tarde!")}).finally(function(){a.apagandoEmpresa=!1})},a.carregarDetalhesContaWirecard=function(){a.carregandocontawirecard=!0,n.obterCadastroWirecard(a.idusuario).then(function(o){o.pendencias.temContaWirecard||(a.erro=!0,r.showToast("Você ainda não confirmou sua conta de vendedor. Atualize seu aplicativo e se o erro persistir entre em contato com o suporte!"),r.irPara("market")),a.conta=o.conta,a.temEmpresa=null!=o.conta.company}).catch(function(o){a.erro=!0,alert("Ocorreu um erro ao carregar seus dados de nota fiscal. Tente novamente mais tarde!")}).finally(function(){a.carregandocontawirecard=!1})},a.carregarEmpresa=function(){a.isEdit=!1,a.carregandoconta=!0,a.erro=!1,n.obterEmpresa(a.idusuario).then(function(o){o.temEmpresa&&(a.isEdit=!0),a.dados=o.empresa}).catch(function(o){console.log(o),a.erro=!0}).finally(function(){a.carregandoconta=!1})},a.salvarEmpresa=function(o){a.singleError="";var e=c.validarData(o.dataAberturaDia,o.dataAberturaMes,o.dataAberturaAno);null==e?a.singleError="A data de abertura é inválida":(o.dataAbertura=e,c.validarCNPJ(o.cnpj)?(a.salvando=!0,n.atualizarEmpresa(a.idusuario,o).then(function(o){r.irPara("market/wc/confirm")}).catch(function(o){console.log(o),r.formErrorBinder(a,o),r.showToast("Valide os dados")}).finally(function(){a.salvando=!1})):a.singleError="O CNPJ é inválido")},a.preCondicoes()}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/market/bank",{controller:"SaldoWirecardCtrl",templateUrl:"angular/app/market/wirecard/saldowirecard/partials/view.tpl.html",tabControl:"Market",title:"Droper Bank"}).when("/market/bank/historic",{controller:"SaldoWirecardCtrl",templateUrl:"angular/app/market/wirecard/saldowirecard/partials/historic.tpl.html",tabControl:"Market",title:"Droper Bank"})}]).controller("SaldoWirecardCtrl",["$scope","$rootScope","$routeParams","$location","AuthFactory","ContaWirecardService","$mdDialog","DataValidationService","SaldoWirecardService",function(e,o,a,r,t,n,i,c,s){e.preCondicoes=function(){t.isLoggedIn()?e.idusuario=t.get().id:(o.irPara("market"),o.showToast("Você não está logado"))},e.carregarBank=function(){e.carregando=!0,s.obterSaldoMisto(e.idusuario).then(function(o){e.saldo=o.saldoWirecard,e.carregarVendasALiberar()}).catch(function(o){console.log(o)}).finally(function(){e.carregando=!1})},e.carregarVendasALiberar=function(){e.carregandoVendasALiberar=!0,s.obterSaldoALiberar(e.idusuario).then(function(o){e.recebiveisALiberar=o}).catch(function(o){console.log(o)}).finally(function(){e.carregandoVendasALiberar=!1})},e.carregarExtrato=function(){e.carregandoExtrato=!0,s.obterSaldoExtrato(e.idusuario).then(function(o){e.saldoEmConta=o.saldoWirecard,e.movimentacoes=o.movimentacoes}).catch(function(o){e.erro=!0,console.log(o)}).finally(function(){e.carregandoExtrato=!1})},e.preCondicoes()}]),angular.module("Proj").config(["$routeProvider",function(o){o.when("/market/bank/transfer",{controller:"SaqueWirecardCtrl",templateUrl:"angular/app/market/wirecard/saquewirecard/partials/saque.tpl.html",tabControl:"Market",title:"Saque"}).when("/market/bank/account/add",{controller:"SaqueWirecardCtrl",templateUrl:"angular/app/market/wirecard/saquewirecard/partials/addbanco.tpl.html",tabControl:"Market",title:"Saque"})}]).controller("SaqueWirecardCtrl",["$scope","$rootScope","$routeParams","$location","AuthFactory","ContaWirecardService","$mdDialog","DataValidationService","SaldoWirecardService","SaqueWirecardService",function(r,t,o,e,a,n,i,c,s,l){r.taxaSaque=0,r.taxaSaqueFormatada=r.taxaSaque.toFixed(2).replace(".",","),r.sacou=!1,r.preCondicoes=function(){a.isLoggedIn()?r.idusuario=a.get().id:(t.irPara("market"),t.showToast("Você não está logado"))},r.carregarRecebiveis=function(){r.recebiveis=[],r.contas=[],r.dadosSaque={idContaBancaria:null,idInteresses:[]},r.carregando=!0,l.obterRecebiveis(r.idusuario).then(function(o){r.temContaBancaria=o.temContaBancaria,r.temContaBancaria&&(r.dadosSaque.idContaBancaria=o.conta.id),r.temRecebiveis=o.temRecebiveis,r.saldo=o.saldoWirecard,r.recebiveis=o.recebiveis,r.conta=o.conta,r.contas=o.contas}).catch(function(o){console.log(o)}).finally(function(){r.carregando=!1})},r.mostrarContasDisponiveis=function(o){i.show({controller:"SaqueWirecardCtrl",preserveScope:!0,scope:r,templateUrl:"angular/app/market/wirecard/saquewirecard/partials/selectContaBancariaDialog.tpl.html",parent:angular.element(document.body),clickOutsideToClose:!window.cordova})},r.alternarConta=function(o){r.dadosSaque.idContaBancaria=o.id,r.conta=o,t.hideDialog()},r.totalSaque=function(){for(var o=0,e=0;e<r.recebiveis.length;e++){var a=r.recebiveis[e];a.selecionadoParaSaque&&(o+=a.valorAReceber)}return o},r.totalSaqueFormatado=function(){var o=r.totalSaque();return o<=r.taxaSaque?"0,00":(o-r.taxaSaque).toFixed(2).replace(".",",")},r.possuiInteressesSelecionados=function(){for(var o=0;o<r.recebiveis.length;o++)if(r.recebiveis[o].selecionadoParaSaque)return!0;return!1},r.valorValidoParaSaque=function(o){o=parseFloat(o.replace(",","."));return o<10?!(r.msgErroPreco="O valor mínimo para saque é de R$ 10,00"):100*o>r.saldo.disponivel?!(r.msgErroPreco="Este valor excede o seu saldo disponível"):!(r.msgErroPreco="")},r.realizarSaque=function(){r.realizandoSaque=!0,r.sacou=!1,r.dadosSaque.idInteresses=function(){for(var o=[],e=0;e<r.recebiveis.length;e++){var a=r.recebiveis[e];a.selecionadoParaSaque&&o.push(a.idInteresse)}return o}(),l.realizarSaque(a.get().id,r.dadosSaque).then(function(o){t.showToast("Saque realizado com sucesso!"),t.saqueSucesso=!0}).catch(function(o){t.saqueSucesso=!1,t.showToast(o||"Ops, houve um erro inesperado"),r.errorMessage=o}).finally(function(){r.realizandoSaque=!1,r.sacou=!0})},r.carregaFormBanco=function(){r.carregando=!0,r.dados={},t.showVerificarPIN().then(function(o){}).catch(function(o){t.voltarPagina(),t.showToast("PIN inválido")})},r.pesquisarInstituicaoBancaria=function(o){return l.pesquisarInstituicao(r.idusuario,o)},r.salvarContaBancaria=function(o){r.salvandoBanco=!0,r.singleError=null,l.salvarContaBancaria(r.idusuario,o).then(function(o){t.showToast("Conta bancária adicionada"),t.voltarPagina()}).catch(function(o){t.showToast(o||"Verifique os erros"),t.formErrorBinder(r,o)}).finally(function(){r.salvandoBanco=!1})},r.apagarContaBancaria=function(o,e,a){r.delecaoContaDesabilitada=!0,l.apagarContaBancaria(r.idusuario,o.id).then(function(o){t.showToast("Conta removida com sucesso"),a.splice(e,1),0==a.length&&(r.dadosSaque.idContaBancaria=null,r.temContaBancaria=!1,t.hideDialog())}).catch(function(o){t.hideDialog(),t.showToast(o||"Ops, algo de errado aconteceu ao tentar apagar esta conta bancária. Tente novamente mais tarde!")}).finally(function(){r.delecaoContaDesabilitada=!1})},r.preCondicoes()}]);